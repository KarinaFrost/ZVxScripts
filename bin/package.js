(function () {
    try{sys.rm('js_modules');}catch(_){}
    sys.mkdir('js_modules');
    var fdata = {
 "js_modules/admin_commands.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n    require: [\"eval_command\", \"modprobe\", \"io_commands\"]\n});\n",
 "js_modules/announcement.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"com\", \"commands\", \"theme\", \"user\", \"io\"],\n\n     loadModule: function ()\n     {\n         var announcementObject =\n             {\n                 get text ()\n                 {\n                     return sys.getAnnouncement();\n                 },\n\n                 set text (v)\n                 {\n                     sys.changeAnnouncement(v);\n                 }\n\n             };\n\n         this.io.registerConfig(this, announcementObject, true);\n         this.commands.registerCommand(\"announcement\", this);\n     },\n\n     announcement:\n     {\n         mode: \"lazy\",\n         category: \"alias\",\n         server: true,\n         desc: \"Shortcut for /configure announcement.text .\",\n         perm: \"CONFIGURE[ANNOUNCEMENT.TEXT]\",\n         code: function (src, cmd, chan)\n         {\n             if (!cmd.input) this.commands.issueCommand(src, \"/configure announcement.text\", chan);\n             else this.commands.issueCommand(src, \"/configure announcement.text = \" + JSON.stringify(cmd.input), chan);\n         }\n     }\n\n });",
 "js_modules/antidos.js": "({\n\n     require: [\"time\", \"io\", \"util\", \"com\", \"theme\"],\n\n     ipdata: null,\n\n     loadModule: function ()\n     {\n         this.ipdata = new Object;\n\n         this.script.registerHandler(\"beforeIPConnected\", this);\n         this.script.registerHandler(\"beforeLogIn\", this);\n\n         this.io.registerConfig(this, {  limit: 10,  time: 600000, wayOverLimit: 60,  wayOverTime: 1209600000 } );\n     },\n\n     beforeLogIn: function (src)\n     {\n         var ip = sys.ip(src);\n\n         if (this.ipdata[ip] >= 10)\n         {\n             this.com.message(src, \"Exceeded attempt login limit. Limit \" + this.config.limit + \" login attempts per \" + this.time.diffToStr (this.config.time)+ \". Note: Failed attempts are counted towards this limit.\");\n             sys.stopEvent();\n             return;\n         }\n     },\n\n     beforeIPConnected: function (ipaddr)\n     {\n         if (! (ipaddr in this.ipdata))\n\n         {\n             this.ipdata[ipaddr] = 0;\n\n             return;\n\n         }\n\n         if (this.ipdata[ipaddr]++ >= this.limit + 5) sys.stopEvent();\n\n         var that = this;\n\n\n\n         var t =  (this.ipdata[ipaddr] <= this.config.wayOverLimit ?  this.config.time :  this.config.wayOverTime );\n\n\n         sys.setTimer(\n             function ()\n             {\n                \n                 that.ipdata[ipaddr]--;\n\n             },\n             t\n\n             ,\n\n             false\n         );\n\n\n\n     }\n\n\n });",
 "js_modules/antiproxy.js": "({\n     require: [\"io\", \"util\", \"user\", \"com\", \"theme\", 'logs'],\n\n\n     loadModule: function()\n     {\n         this.io.registerConfig(this, {enabled: true, type: \"remote\", pathway: \"https://raw.github.com/ArchZombie/proxylist/master/proxylist.txt\"});\n\n         this.script.registerHandler(\"beforeLogIn\", this);\n\n         if (this.config.enabled && this.config.type == \"remote\")\n         {\n             var a = sys.synchronousWebCall(this.config.pathway).split(/\\r\\n|\\n|r/g);\n             for (var x in a) if (a[x].match(/:/)) a[x] = a[x].split(/:/)[0];\n             this.PROXYBANS = this.util.keyify(a);\n         }\n         else if (this.config.enabled && this.config.type == \"local\")\n         {\n\n             var a = sys.read(this.config.pathway).split(/\\r\\n|\\n|r/g);\n             for (var x in a) if (a[x].match(/:/)) a[x] = a[x].split(/:/)[0];\n             this.PROXYBANS = this.util.keyify(a);\n         }\n\n\n     },\n     beforeLogIn: function (src)\n     {\n         if (this.config.enabled && sys.ip(src) in this.PROXYBANS && ! this.user.hasPerm(src, \"PROXY\"))\n         {\n             this.com.message(src, \"Proxies are not allowed.\", this.theme.CRITICAL);\n             this.logs.logMessage(this.logs.WARN, this.user.name(src) + \" tried to log in using a proxy (IP \" + sys.ip(src) + \")\");\n             sys.stopEvent();\n         }\n     },\n\n     configureEvent: function()\n     {\n         if (this.config.enabled && this.config.type == \"remote\")\n         {\n             var a = sys.synchronousWebCall(this.config.pathway).split(/\\r\\n|\\n|r/g);\n             for (var x in a) if (a[x].match(/:/)) a[x] = a[x].split(/:/)[0];\n             this.PROXYBANS = this.util.keyify(a);\n         }\n         else if (this.config.enabled && this.config.type == \"local\")\n         {\n\n             var a = sys.read(this.config.pathway).split(/\\r\\n|\\n|r/g);\n             for (var x in a) if (a[x].match(/:/)) a[x] = a[x].split(/:/)[0];\n             this.PROXYBANS = this.util.keyify(a);\n         }\n     }\n\n });",
 "js_modules/authlist.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n\n     require: [\"commands\", \"text\", \"com\", \"theme\", \"util\", \"user\"],\n\n     LEVELS: null,\n\n     LEVEL_ORDER: null,\n\n     loadModule: function ()\n     {\n         this.commands.registerCommand(\"authlist\", this);\n\n         this.LEVELS = this.util.keyify([1, 2, 3]);\n         this.LEVEL_ORDER = this.util.keyify([3,2,1,0]);\n     },\n\n     authlist:\n     {\n         desc: \"Lists the auth on the server.\",\n         aliases: [\"auths\"],\n         category: \"basic\",\n         \n         perm: function () { return true; }\n         ,\n         code: function (src)\n         {\n             this.com.message([src], \"Authlist:\", this.theme.INFO);\n             var auths = sys.dbAuths();\n\n             var lvs = [[],[],[],[]];\n\n             for (var x in auths)\n             {\n                 var lv = void 0;\n\n                 if (sys.id(auths[x])) lv = sys.auth(sys.id(auths[x]));\n                 else lv = sys.dbAuth(auths[x]);\n\n                 if ((\"\"+lv) in this.LEVELS) lvs[lv].push(auths[x]);\n\n                 else lvs[0].push(auths[x]);\n\n             }\n\n             lvs.forEach(\n                 function (e)\n                 {\n                     e.sort();\n                 }\n             );\n\n             for (var y in this.LEVEL_ORDER) for (x in lvs[y])\n             {\n                 this.com.message(src, \"<b>\" + ([null, \"Moderator\", \"Admin\", \"Owner\"][sys.dbAuth(lvs[y][x])] || \"?\") + \"</b> \" + this.text.escapeHTML(this.user.nameToProper(lvs[y][x])) +\n                                  (sys.id(lvs[y][x])?\" <span style='color:green'>online (\"+sys.id(lvs[y][x])+\")</span>\":\" <span style='color:red'>offline</span>\"), this.theme.RAW, true);\n             }\n\n         }\n     }\n });\n",
 "js_modules/automute.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"chat\", \"theme\", \"com\", \"user\", \"server\", \"commands\"],\n\n     counter:null,\n\n\n     loadModule: function ()\n     {\n         this.chat.registerFilter(this.autoFilter, this);\n\n         this.counter = new Object;\n     },\n\n\n     autoFilter: function (src, msg, chan)\n     {\n         if (this.user.hasPerm(src, \"PROTECTED\")) return msg;\n         var ip = sys.ip(src);\n\n         if (! (ip in this.counter)) this.counter[ip] = 0;\n\n         this.counter[ip]++;\n\n         var bind = this.counter;\n\n         sys.setTimer( function () {\n                           bind[ip]--;\n                       }, 2000, false);\n\n\n         var l = msg.length;\n\n         for (var i = 0; i*100 <= l; i++)\n         {\n\n             this.counter[ip]++;\n             sys.setTimer( function () {\n                               bind[ip]--;\n                           }, 15000, false);\n\n         }\n\n\n         if (this.counter[ip] >= 45)\n         {\n             this.commands.tryCommand(this.server.SERVER, {name:\"mute\", args:[this.user.name(src)], flags: {ip:true, time: Math.round((+this.counter[ip])/5) + \" minutes.\", reason: \"Anti spam counter is \" +this.counter[ip]+ \".\"}}, chan);\n             this.commands.tryCommand(this.server.SERVER, {name:\"kick\", args:[this.user.name(src)], flags: {reason: \"Anti spam counter is \" +this.counter[ip]+ \".\"}}, chan);\n             return \"\";\n         }\n\n         if (this.counter[ip] >= 10)\n         {\n             this.com.message(src, \"You are flooding, please message less.\");\n             return \"\";\n         }\n\n         if (this.counter[ip] >= 15)\n         {\n             this.commands.tryCommand(this.server.SERVER, {name:\"kick\", args:[this.user.name(src)], flags: {reason: \"Anti spam counter is \" +this.counter[ip]+ \".\"}}, chan);\n             return \"\";\n         }\n\n\n\n         return msg;\n     }\n\n\n });",
 "js_modules/ban.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** Module that holds /ban, /banlist, /unban, etc.\n * @name ban_command\n * @memberOf script.modules\n * @namespace\n * */\n/** @scope script.modules.ban_command */\n({\n     require: [\"commands\", \"security\", \"text\", \"com\", \"theme\", \"time\", \"user\", \"util\"],\n\n     /** The unban command descriptor\n      * @type commandDescriptor\n      * */\n     unbanall:\n     {\n         mode: \"strict\",\n         server: true,\n         category: \"security/ban\",\n         desc: \"Clears the ban list\",\n         perm: \"BAN\",\n         code: function (src, cmd)\n         {\n             if (!(cmd.flags.force))\n             {\n                 this.com.message([src], \"Are you sure you want to do this? Retry with --force option.\", this.theme.WARN);\n                 return;\n             }\n\n             this.com.broadcast(this.user.name(src) + \" has cleared the server's ban list.\");\n\n             this.security.database.bans = new Object;\n         }\n     },\n\n     unban:\n     {\n         mode: \"strict\",\n         server: true,\n         category: \"security/ban\",\n         desc: \"Removes bans from users\",\n         perm: function (src)\n         {\n             return this.user.hasPerm(src, \"BAN\");\n         },\n         code: function (src, cmd, chan)\n         {\n\n             var removes = [];\n\n             for (var x in cmd.args)\n             {\n                 removes = removes.concat(this.security.removeAfflicted(cmd.args[x], this.security.database.bans));\n             }\n\n             removes = this.util.concatSets(removes);\n\n             this.com.broadcast(this.user.name(src) + \" has removed ban(s) #\" + removes.join(\", #\") + \"!\");\n\n         }\n     },\n\n     ban:\n     {\n         mode: \"strict\",\n         server: true,\n         category: \"security/ban\",\n         desc:  \"Ban prevents users from joining the server. Can ban usernames, IPs, regular expressions, or subnets. Users with PROTECTED permission are not affecte by bans.\",\n         options:\n         {\n             reason: \"Specifies a reason for the ban\",\n             time: \"Duration of ban\"\n         },\n         perm: function (src)\n         {\n             return this.user.hasPerm(src, \"BAN\");\n         },\n         code: function (src, cmd, chan)\n         {\n\n             var ips = [];\n             var subnets = [];\n             var names = [];\n             var regexes = [];\n             var hostnames = [];\n\n\n             if (cmd.flags.silent && !this.user.hasPerm(src, \"SILENT\"))\n             {\n                 this.com.message(src, \"Silent option: Permission denied.\", this.theme.WARN);\n                 cmd.flags.silent = false;\n             }\n\n             for (var x in cmd.args)\n             {\n                 if (cmd.args[x].match(/^\\d+\\.\\d+\\.\\d+\\.\\d+$/))\n                 {\n                     ips.push(cmd.args[x]);\n                 }\n\n                 else if (cmd.args[x].match(/^\\d+\\.\\d+\\.\\d+\\.\\d+\\/\\d+$/))\n                 {\n                     subnets.push(cmd.args[x]);\n                 }\n\n                 else if (cmd.args[x].match(/^\\/.+\\/\\w*$/))\n                 {\n                     regexes.push(cmd.args[x]);\n                 }\n\n                 else if (cmd.args[x].match(/^hostname\\/.+\\/\\w*$/))\n                 {\n                     hostnames.push(cmd.args[x].replace(/^hostname\\/(.+)\\/(\\w+)$/, function (m, a, b) { return \"/\" + a + \"/\" +b; }));\n                 }\n\n                 else\n                 {\n                     names.push(cmd.args[x]);\n                 }\n\n\n             }\n\n             if (cmd.flags.ip) for (var x in names)\n             {\n\n                 ips = this.util.concatSets(ips, [sys.dbIp(names[x])]);\n\n             }\n\n\n             var exp = 1000*3600*24 + (+new Date);\n             var t = null;\n\n             if (cmd.flags.time && String(cmd.flags.time).match(/forever|infinite|indefinite/i))\n             {\n                 exp = false;\n             }\n             else if (cmd.flags.time)\n             {\n                 t = this.time.strToDiff(cmd.flags.time);\n\n                 if (t) exp = t + +new Date;\n             }\n\n             var o =  {\n                 ips: ips,\n                 subnets: subnets,\n                 names: names,\n                 nameRegex: regexes,\n                 hostnames: hostnames,\n                 expires: exp,\n                 reason: cmd.flags.reason || null,\n                 author: this.user.name(src)\n             };\n\n             if (!cmd.flags.silent) this.com.broadcast(\n                 this.text.escapeHTML(\n                     \"Posted ban #\" +this.security.database.banCtr\n                 ) +\n                     \"<br/>\" + this.theme.issuehtml(o) +\n                     \"\"\n                 ,\n                 this.theme.CRITICAL,\n                 true\n             );\n\n\n\n\n             this.security.database.bans[this.security.database.banCtr++] = o;\n\n             this.security.chk();\n\n\n         }\n     },\n\n     banlist:\n     {\n         mode: \"strict\",\n         server: true,\n         category: \"security/ban\",\n         desc: \"Lists banned users\",\n         perm: function (src)\n         {\n             return this.user.hasPerm(src, \"LIST[BANS]\");\n         },\n         code: function (src)\n         {\n\n             var mutes = [];\n             var mutelist = this.security.database.bans;\n\n             for (var x in mutelist)\n             {\n                 mutes.push (\n                     \"<b>Ban #\" + x + \":</b><br/>\" + this.theme.issuehtml(mutelist[x])\n                 );\n             }\n\n             this.com.message([src], \"Ban list:<br/>\" + mutes.join(\"<br/><br/>\"), this.theme.INFO, true);\n         }\n\n     },\n\n     loadModule: function()\n     {\n         this.commands.registerCommand(\"ban\", this);\n         this.commands.registerCommand(\"unban\", this);\n         this.commands.registerCommand(\"banlist\", this);\n         this.commands.registerCommand(\"unbanall\", this);\n     }\n });\n",
 "js_modules/boot.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n\n/** @fileOverview The, bootloader\n *\n *\n */\n(function () {\n\n     sys.enableStrict();\n\n     var start = +new Date;\n\n     print(\"ZScriptInitializer Starting.\");\n\n     var conf;\n\n     try\n     {\n         conf = sys.read(\"zscriptinit.json\");\n     }\n     catch (x)\n     {\n         conf = null;\n     }\n     var timer = null;\n\n     timer = sys.setTimer(loadMain, 5000, false);\n\n     print(\"Automatically starting modloader with default configuration in 5 seconds, or enter another option. Type help for assitance.\");\n\n     function loadMain()\n     {\n         var modloader = sys.exec(\"js_modules/modloader.js\");\n\n         for (var x in scriptobject) delete scriptobject[x];\n\n         for (x in modloader) scriptobject[x] = modloader[x];\n\n         scriptobject.init();\n\n         scriptobject.addSource({type: \"web\", path: \"https://raw.github.com/ArchZombie/zvxscripts/master/js_modules/\"});\n\n         try\n         {\n             scriptobject.loadModule(\"default\");\n         }\n         catch (e)\n         {\n             print(e);\n         }\n\n         return;\n\n\n     }\n\n     var scriptobject = new Object;\n\n     scriptobject.beforeServerMessage = function (message)\n     {\n         if (timer)\n         {\n             sys.unsetTimer(timer);\n             timer = null;\n         }\n\n         if (message.toLowerCase() === \"start\")\n         {\n             loadMain();\n             return;\n         }\n\n         if (message.toLowerCase() === \"help\")\n         {\n             print(\"Type start, atm this is the only option :P\");\n         }\n\n     };\n\n     return scriptobject;\n })();\n",
 "js_modules/channels.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** Implements channels\n * @name channels\n * @memberOf script.modules\n * @namespace\n * */\n/** @scope script.modules.channels */\n({\n     require: [\"io\", \"user\", \"commands\", 'theme', \"logs\", 'theme', \"com\", \"chat\", 'util'],\n\n     meta:\n     {\n         commands: [\"channelregister\", \"channeltopic\", \"channelban\", \"channelunban\", \"channelunmute\", \"channelauth\", \"channelmute\", \"channelctrl\", \"channelinfo\", \"channeljoin\"]\n     },\n\n     /** The chans property stores channel databases. Key is channel permanent ID. */\n     chans: null,\n\n     /** ChanDB keeps track of the IDs of channel databases */\n     /* Example:\n\n      chanDB: {\n      chans:\n      {\n      \"indigo pleateu\": 2,\n      \"watch\": 3,\n      \"testchan\": 9,\n      ...\n      },\n      counter: 10\n      },\n\n      */\n     chanDB: null\n     ,\n     /** Active channels associates channel IDs with channel objects, currently unused. */\n     activeChannels: null\n     ,\n     loadModule: function ()\n     {\n         this.chanDB = this.io.registerDB(this, \"channels\");\n         this.chans = new Object;\n         this.chanDB.counter || (this.chanDB.counter = 1);\n         this.chanDB.chans || (this.chanDB.chans = new Object);\n         this.activeChannels = new Object;\n         this.script.registerHandler(\"beforeChannelCreated\", this);\n         this.script.registerHandler(\"beforeChannelJoin\", this);\n         this.script.registerHandler(\"afterChannelJoin\", this);\n         this.script.registerHandler(\"beforeChannelDestroyed\", this);\n         this.script.registerHandler(\"afterLogIn\", this);\n         this.user.registerConfigHook(this, \"configuration\");\n\n         this.chat.registerFilter(this.chanMuteFilter, this);\n     }\n     ,\n     configuration: function (c)\n     {\n         if (!c.autoJoinChannels) c.autoJoinChannels = [];\n     },\n\n\n\n     unloadModule: function ()\n     {\n         for (var x in this.chans)\n         {\n             try\n             {\n                 this.io.closeDB(\"channels$c\"+x);\n             }\n             catch(e)\n             {\n                 this.script.error(e);\n             }\n         }\n     }\n     ,\n     /** Opens a chan DB if it exists\n      * @event\n      */\n     beforeChannelCreated: function (id, name, src)\n     {\n         this.activeChannels[id] = this.channelObj(id, name);\n     },\n\n\n\n     channelregister:\n     {\n         desc: \"Register an un-owned channel in your name.\",\n         category: \"channel\",\n         aliases: [\"cregister\"],\n         perm: \"CHANNEL[REGISTER]\",\n         code: function (src, cmd, chan)\n         {\n             var cobj;\n\n             if (chan == -1 || (this.channelObj(chan) && !this.user.hasPerm(src, \"CHANNEL[OVERRIDE]\")))\n             {\n                 this.com.message(src, \"That channel is already registered!\", this.theme.ERROR);\n                 return;\n             }\n\n             if (chan == 0)\n             {\n                 this.com.message(src, \"That channel is not registerable!\", this.theme.ERROR);\n                 return;\n             }\n\n             cobj = this.channelRegister(chan);\n\n             cobj.owner = this.user.name(src).toLowerCase();\n             cobj.auth = new Object;\n             cobj.bans = new Object;\n             cobj.mutes = new Object;\n             cobj.registeredAt = +new Date;\n\n\t     this.com.broadcast(this.user.name(src) + \" registered #\" + sys.channel(chan) + \"!\");\n\n\n         }\n     },\n\n     channeltopic:\n     {\n         desc: \"Modifies a channel's topic.\",\n         category: \"channel\",\n         aliases: [\"ctopic\"],\n         perm: function (src, cmd, chan)\n         {\n             return this.user.hasPerm(src, \"CHANNEL[OVERRIDE]\") || (this.user.hasPerm(src, \"CHANNEL[MODERATE]\"));\n         },\n         code: function (src, cmd, chan)\n         {\n             var cobj, lname;\n\n             if (cmd.flags.chan && sys.channelId(cmd.flags.chan))\n             {\n                 chan = sys.channelId(cmd.flags.chan);\n             }\n\n             cobj = this.channelObj(chan);\n\n             if (chan == 0 || !cobj || chan == -1)\n             {\n                 this.com.message(src, \"That channel is not registered!\", this.theme.ERROR);\n                 return;\n             }\n\n             lname = this.user.name(src).toLowerCase();\n\n             if (!cmd.input)\n             {\n                 this.com.message(src, \"Channel Topic: \" + cobj.topic);\n                 return;\n             }\n\n             // Note: auth comparison statement is order sensitive in the undefined case.\n             if (!this.user.hasPerm(src, \"CHANNEL[OVERRIDE]\") && lname !== cobj.owner && !( 2 <= cobj.auth[lname] ))\n\n             {\n                 this.com.message(src, \"You are not high enough auth in that channel.\", this.theme.ERROR);\n                 return;\n             }\n\n             cobj.topic = cmd.input;\n\n             this.com.broadcast(this.user.name(src) + \" changed the topic for \" + sys.channel(chan) + \"!\", this.theme.INFO, false, chan);\n             this.com.broadcast(\"Channel Topic: \" + cobj.topic, this.theme.INFO, false, chan);\n\n\n         }\n     },\n\n     channelinfo:\n     {\n         aliases: [\"cinfo\"],\n         category: \"channel\",\n         desc: \"Returns information about a channel\",\n         perm: function ()\n         {\n             return true;\n         },\n\n         code: function (src, cmd, chan)\n         {\n             var cobj = this.channelObj(chan);\n\n             if (chan == 0 || chan == -1 || !cobj)\n             {\n                 this.com.message(src, \"That channel is not registered.\", this.theme.ERROR, false, chan);\n                 return;\n             }\n\n\n             var modes = [];\n\n             if (cobj.voiceOnly) modes.push(\"+silent\");\n             if (cobj.memberOnly) modes.push(\"+private\");\n             if (cobj.perm) modes.push(\"+permanent\");\n\n             this.com.message(src, \"Info:\\nOwner: \" + cobj.owner + \"\\nTopic: \" + cobj.topic + \"\\nMode(s): \" + (modes.join(\" \") || \"+default\"));\n         }\n     },\n\n     channelctrl:\n     {\n         desc: \"Modifies a channel's mode options.\",\n         category: \"channel\",\n         examples:\n         [\n             [{flags:{perm:true}, args: []}, \"Makes the channel permanent.\"]\n         ],\n         options:\n         {\n             \"private\": \"Only voiced members may join.\",\n             silent: \"Only voiced members may talk.\",\n             permanent: \"Channel will not be closed.\"\n         },\n         aliases: [\"cctrl\"],\n         perm: function (src, cmd, chan)\n         {\n             return this.user.hasPerm(src, \"CHANNEL[OVERRIDE]\") || (this.user.hasPerm(src, \"CHANNEL[MODERATE]\"));\n         },\n         code: function (src, cmd, chan)\n         {\n             var cobj, lname;\n\n             if (cmd.flags.chan && sys.channelId(cmd.flags.chan))\n             {\n                 chan = sys.channelId(cmd.flags.chan);\n             }\n\n             cobj = this.channelObj(chan);\n\n             if (chan == 0 || !cobj || chan == -1)\n             {\n                 this.com.message(src, \"That channel is not registered!\", this.theme.ERROR);\n                 return;\n             }\n\n             lname = this.user.name(src).toLowerCase();\n\n             // Note: auth comparison statement is order sensitive in the undefined case.\n             if (!this.user.hasPerm(src, \"CHANNEL[OVERRIDE]\") && lname !== cobj.owner && !( 3 <= cobj.auth[lname] ))\n\n             {\n                 this.com.message(src, \"You are not high enough auth in that channel.\", this.theme.ERROR);\n                 return;\n             }\n\n             if (cmd.flags.perm && !this.user.hasPerm(src, \"CHANNEL[PERM]\"))\n             {\n                 this.com.message(src, \"You don't have permission to use the perm option\");\n                 delete cmd.flags.perm;\n             }\n\n             cobj.voiceOnly = !!(cmd.flags.mute || cmd.flags.silent);\n             cobj.memberOnly = !!(cmd.flags.invite || cmd.flags.inviteonly || cmd.flags[\"private\"] ||cmd.flags.prot || cmd.flags.protect);\n             cobj.perm = !!(cmd.flags.perm);\n\n             if (cmd.flags.topic || cmd.flags.motd)\n             {\n                 cobj.topic = cmd.flags.topic || cmd.flags.motd;\n             }\n\n             var modes = [];\n\n             if (cobj.voiceOnly) modes.push(\"+silent\");\n             if (cobj.memberOnly) modes.push(\"+private\");\n             if (cobj.perm) modes.push(\"+permanent\");\n\n\n             this.com.broadcast(this.user.name(src) + \" set mode \"+ (modes.join(\" \") || \"+default\") + \" for #\" + sys.channel(chan) + \"!\", this.theme.INFO, false, chan);\n\n\n         }\n     },\n\n     channelunban:\n     {\n         desc: \"Unbans a user(s) from channel\",\n         category: \"channel\",\n         aliases: [\"cunban\"],\n         perm: function (src, cmd, chan)\n         {\n             return this.user.hasPerm(src, \"CHANNEL[OVERRIDE]\") || (this.user.hasPerm(src, \"CHANNEL[MODERATE]\"));\n         },\n         code: function (src, cmd, chan)\n         {\n             var cobj, lname;\n\n             if (cmd.flags.chan && sys.channelId(cmd.flags.chan))\n             {\n                 chan = sys.channelId(cmd.flags.chan);\n             }\n\n             cobj = this.channelObj(chan);\n\n             if (chan == 0 || !cobj || chan == -1)\n             {\n                 this.com.message(src, \"That channel is not registered!\", this.theme.ERROR);\n                 return;\n             }\n\n             lname = this.user.name(src).toLowerCase();\n\n             // Note: auth comparison statement is order sensitive in the undefined case.\n             if (!this.user.hasPerm(src, \"CHANNEL[OVERRIDE]\") && lname !== cobj.owner && !( 3 <= cobj.auth[lname] ))\n\n             {\n                 this.com.message(src, \"You are not high enough auth in that channel.\", this.theme.ERROR);\n                 return;\n             }\n\n             for (var x in cmd.args)\n             {\n                 delete cobj.bans[cmd.args[x].toLowerCase()];\n\n                 this.com.broadcast(this.user.name(src) + \" has unbanned \" + cmd.args[x] + \" in #\" + sys.channel(chan) + \"!\", this.theme.INFO, false, chan);\n\n             }\n\n\n         }\n     },\n\n     channelban:\n     {\n         desc: \"Bans a user(s) from channel.\",\n         aliases: [\"cban\"],\n         category: \"channel\",\n         perm: function (src, cmd, chan)\n         {\n             return this.user.hasPerm(src, \"CHANNEL[OVERRIDE]\") || (this.user.hasPerm(src, \"CHANNEL[MODERATE]\"));\n         },\n         code: function (src, cmd, chan)\n         {\n             var cobj, lname;\n\n             if (cmd.flags.chan && sys.channelId(cmd.flags.chan))\n             {\n                 chan = sys.channelId(cmd.flags.chan);\n             }\n\n             cobj = this.channelObj(chan);\n\n             if (chan == 0 || !cobj || chan == -1)\n             {\n                 this.com.message(src, \"That channel is not registered!\", this.theme.ERROR);\n                 return;\n             }\n\n             lname = this.user.name(src).toLowerCase();\n\n             // Note: auth comparison statement is order sensitive in the undefined case.\n             if (!this.user.hasPerm(src, \"CHANNEL[OVERRIDE]\") && lname !== cobj.owner && !( 3 <= cobj.auth[lname] ))\n\n             {\n                 this.com.message(src, \"You are not high enough auth in that channel.\", this.theme.ERROR);\n                 return;\n             }\n\n             for (var x in cmd.args)\n             {\n                 cobj.bans[cmd.args[x].toLowerCase()] = true;\n\n                 this.com.broadcast(this.user.name(src) + \" has banned \" + cmd.args[x] + \" in #\" + sys.channel(chan) + \"!\", this.theme.CRITICAL, false, chan);\n\n                 var id = sys.id(cmd.args[x]);\n\n                 if (id && !this.user.hasPerm(id, \"PROTECTED\"))\n                 {\n                     sys.kick(id, chan);\n                 }\n\n             }\n\n\n         }\n     },\n\n\n     channelmute:\n     {\n         aliases: [\"cmute\"],\n         category: \"channel\",\n         perm: function (src, cmd, chan)\n         {\n             return this.user.hasPerm(src, \"CHANNEL[OVERRIDE]\") || (this.user.hasPerm(src, \"CHANNEL[MODERATE]\"));\n         },\n         code: function (src, cmd, chan)\n         {\n             var cobj, lname;\n\n             if (cmd.flags.chan && sys.channelId(cmd.flags.chan))\n             {\n                 chan = sys.channelId(cmd.flags.chan);\n             }\n\n             cobj = this.channelObj(chan);\n\n             if (chan == 0 || !cobj || chan == -1)\n             {\n                 this.com.message(src, \"That channel is not registered!\", this.theme.ERROR);\n                 return;\n             }\n\n             lname = this.user.name(src).toLowerCase();\n\n             // Note: auth comparison statement is order sensitive in the undefined case.\n             if (!this.user.hasPerm(src, \"CHANNEL[OVERRIDE]\") && lname !== cobj.owner && !( 2 <= cobj.auth[lname] ))\n\n             {\n                 this.com.message(src, \"You are not auth in that channel.\", this.theme.ERROR);\n                 return;\n             }\n\n             for (var x in cmd.args)\n             {\n                 cobj.mutes[cmd.args[x].toLowerCase()] = true;\n\n                 this.com.broadcast(this.user.name(src) + \" has muted \" + cmd.args[x] + \" in #\" + sys.channel(chan) + \"!\", this.theme.CRITICAL, false, chan);\n\n             }\n\n\n         }\n     },\n\n     channeljoin:\n     {\n         desc: \"Join a channel(s)\",\n         category: \"channel\",\n         aliases: [\"cjoin\"],\n         perm: function () {return true;},\n         code:\n         function (src, cmd, chan)\n         {\n             for (var x in cmd.args)\n             {\n                 var id = sys.channelId(cmd.args[x]);\n                 if (typeof id === \"undefined\")\n                 {\n                     sys.createChannel(cmd.args[x]);\n                     id = sys.channelId(cmd.args[x]);\n                 }\n\n                 sys.putInChannel(src, id);\n\n             }\n         }\n     },\n\n     channelunmute:\n     {\n         desc: \"Unmutes a user in a channel\",\n         category: \"channel\",\n         aliases: [\"cunmute\"],\n         perm: function (src, cmd, chan)\n         {\n             return this.user.hasPerm(src, \"CHANNEL[OVERRIDE]\") || (this.user.hasPerm(src, \"CHANNEL[MODERATE]\"));\n         },\n         code: function (src, cmd, chan)\n         {\n             var cobj, lname;\n\n             if (cmd.flags.chan && sys.channelId(cmd.flags.chan))\n             {\n                 chan = sys.channelId(cmd.flags.chan);\n             }\n\n             cobj = this.channelObj(chan);\n\n             if (chan == 0 || !cobj || chan == -1)\n             {\n                 this.com.message(src, \"That channel is not registered!\", this.theme.ERROR);\n                 return;\n             }\n\n             lname = this.user.name(src).toLowerCase();\n\n             // Note: auth comparison statement is order sensitive in the undefined case.\n             if (!this.user.hasPerm(src, \"CHANNEL[OVERRIDE]\") && lname !== cobj.owner && !( 2 <= cobj.auth[lname] ))\n\n             {\n                 this.com.message(src, \"You are not auth in that channel.\", this.theme.ERROR);\n                 return;\n             }\n\n             for (var x in cmd.args)\n             {\n                 delete cobj.mutes[cmd.args[x].toLowerCase()];\n\n                 this.com.broadcast(this.user.name(src) + \" has unmuted \" + cmd.args[x] + \" in #\" + sys.channel(chan) + \".\", this.theme.INFO, false, chan);\n\n             }\n\n\n         }\n     },\n\n     channelauth:\n     {\n         desc: \"Sets auth for a user(s) in a channel.\",\n         category: \"channel\",\n         examples:\n         [\n             [{ args: [\"User name\"], flags: {level:\"voice\"}}, \"Makes 'User name' a voiced member of the channel.\"]\n         ],\n         aliases: [\"cauth\"],\n         server: true,\n         perm: \"CHANNEL[MODERATE]\",\n         code: function (src, cmd, chan)\n         {\n             var level, x, lname;\n\n             if (cmd.flags.chan && sys.channelId(cmd.flags.chan))\n             {\n                 chan = sys.channelId(cmd.flags.chan);\n             }\n\n             var cobj = this.channelObj(chan);\n\n             if (chan == 0 || !cobj || chan == -1)\n             {\n                 this.com.message(src, \"That channel is not registered!\", this.theme.ERROR);\n                 return;\n             }\n\n             lname = this.user.name(src).toLowerCase();\n\n             // Note: auth comparison statement is order sensitive in the undefined case.\n             if (!this.user.hasPerm(src, \"CHANNEL[OVERRIDE]\") && lname !== cobj.owner && !( 2 <= cobj.auth[lname] ))\n\n             {\n                 this.com.message(src, \"You are not auth in that channel.\", this.theme.ERROR);\n                 return;\n             }\n\n             if (!(\"level\" in cmd.flags))\n             {\n                 this.com.message(src, \"Please provide a level option! Type /help channelauth !\");\n                 return;\n             }\n\n             level = {\n                 \"0\":0, user:0, \"normal\":0,\n                 \"1\":1, voice: 1, member:1, \"true\":1,\n                 \"2\":2, moderator:2, mod:2,\n                 \"3\":3, admin:3, administrator:3\n             }[String(cmd.flags.level).toLowerCase()];\n\n             if (level === undefined)\n             {\n                 this.com.message(src, \"Level must be user, voice, moderator, or admin!\");\n                 return;\n             }\n\n             for (x in cmd.args)\n             {\n                 if (level === 0)\n                 {\n                     delete cobj.auth[cmd.args[x].toLowerCase()];\n\n                     this.com.broadcast(this.user.name(src) + \" has removed \" + cmd.args[x] + \" from channel membership in #\" + sys.channel(chan) + \".\", this.theme.INFO, false, chan);\n                 }\n                 else\n                 {\n                     cobj.auth[cmd.args[x].toLowerCase()] = level;\n\n                     this.com.broadcast(this.user.name(src) + \" has made \" + cmd.args[x] + \" \"+({\"1\":\"voiced\", \"2\":\"a moderator\", \"3\":\"an administrator\"}[level])+\" in #\" + sys.channel(chan) + \".\", this.theme.INFO, false, chan);\n                 }\n             }\n         }\n     },\n\n\n\n     /** Registers the channel. Primitive at the moment.\n      * @param id Channel to register\n      */\n     channelRegister: function (id)\n     {\n         var chanNameLw = sys.channel(id).toLowerCase();\n\n         if (!this.chanDB.chans[chanNameLw])\n         {\n             this.chanDB.chans[chanNameLw] = this.chanDB.counter++;\n             //  this.io.markDB(\"channels\");\n         }\n\n         var chanid = this.chanDB.chans[chanNameLw];\n\n         this.chans[chanid] = this.io.openDB(\"channels$c\" + chanid);\n\n         return this.chans[chanid];\n     },\n     /** Returns a channel object for chan, or null if not registered.\n      * @param {Number} chan The channel ID.\n      * @return {Object|Null} The associated channel database.\n      */\n     channelObj: function (chan, name)\n     {\n         if(chan == 0 || chan == -1) return null;\n\n         var chanNameLw = (name || sys.channel(chan)).toLowerCase();\n\n         if (!this.chanDB.chans[chanNameLw]) return null;\n\n\n         var chanid = this.chanDB.chans[chanNameLw];\n\n         this.chans[chanid] || (this.chans[chanid] = this.io.openDB(\"channels$c\" + chanid));;\n\n         return this.chans[chanid];\n     }\n     ,\n     /** Close the channel from the channel databases\n      * @event\n      * @param {Number} chan Channel ID.\n      *  */\n     beforeChannelDestroyed: function (chan)\n     {\n         var chanNameLw = sys.channel(chan).toLowerCase();\n\n         var chanid = this.chanDB.chans[chanNameLw];\n\n         if (!chanid) return;\n\n         if (this.chans[chanid])\n         {\n             if (this.chans[chanid].perm)\n             {\n                 sys.stopEvent();\n                 return;\n             }\n             this.io.closeDB(\"channels$c\" + chanid);\n             delete this.chans[chanid];\n\n             return;\n         }\n     },\n     beforeChannelJoin: function (src, chan)\n     {\n         var co = this.channelObj(chan);\n\n         if (!co) return;\n\n         var uname = this.user.name(src).toLowerCase();\n\n         if (uname in co.bans && !this.user.hasPerm(src, \"PROTECTED\") && !this.user.hasPerm(src, \"CHANNEL[PROTECTED]\")  && uname !== co.owner && !(uname in co.auth) )\n         {\n             this.com.message(src, \"You are banned from that channel.\", this.theme.CRITICAL);\n             sys.stopEvent();\n             return;\n         }\n\n         if (co.memberOnly && !this.user.hasPerm(src, \"PROTECTED\") && !this.user.hasPerm(src, \"CHANNEL[PROTECTED]\")  && uname !== co.owner && !(uname in co.auth))\n         {\n             this.com.message(src, \"Channel is members-only.\");\n             sys.stopEvent();\n             return;\n         }\n\n\n\n     },\n\n     afterLogIn: function (src)\n     {\n         var cfg = this.user.userConfig(src);\n         try\n         {\n             for (x in cfg.autoJoinChannels)\n             {\n                 this.com.message(src, \"Autojoin #\" + cfg.autoJoinChannels[x]);\n                 sys.putInChannel(src, sys.channelId(cfg.autoJoinChannels));\n             }\n         } catch(e) {}\n     },\n\n     afterChannelJoin: function (src, chan)\n     {\n         var co = this.channelObj(chan);\n\n         if (!co) return;\n\n         if (co.topic)\n         {\n             this.com.message(src, \"Channel Topic: \" + co.topic, this.theme.INFO, false, chan);\n         }\n     },\n     chanMuteFilter: function (src, msg, chan)\n     {\n         var cobj = this.channelObj(chan);\n         var uname = this.user.name(src).toLowerCase();\n\n         if (!cobj) return msg;\n\n         if (this.user.hasPerm(src, \"PROTECTED\") || this.user.hasPerm(src, \"CHANNEL[PROTECTED]\") || uname === cobj.owner || uname in cobj.auth) return msg;\n\n         if (uname in cobj.mutes)\n         {\n             this.com.message(src, \"You are muted in that channel.\");\n             return \"\";\n         }\n\n         if (cobj.voiceOnly)\n         {\n             this.com.message(src, \"You are not voice in that channel.\");\n             return \"\";\n         }\n\n\n         return msg;\n     }\n });\n",
 "js_modules/chat.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n(function () {\n     return {\n         require: [\"commands\", \"security\",  \"com\", \"theme\", \"time\", \"logs\", \"text\", \"util\", \"user\"]\n         ,\n         filters: []\n         ,\n         capture: new Object\n         ,\n         registerCapture: function (src, func, object)\n         {\n             if (!this.capture[src]) this.capture[src] = [];\n\n             var capper = this.util.bind(object, func);\n\n             this.capture[src].push(capper);\n             object.onUnloadModule( this.util.bind(\n                                        this,\n                                        function ()\n                                        {\n                                            this.filters.splice(this.filters.indexOf(capper), 1);\n                                        }\n                                    ));\n\n         },\n\n\n         beforeChatMessage: function beforeChatMessage (src, msg, chan)\n         {\n             if (!msg) msg = \"\";\n             //if (msg.length == 0) return;\n\n             if (this.capture[src] && this.capture[src].length >= 1)\n             {\n                 sys.stopEvent();\n                 var f = this.capture[src].pop();\n\n                 f.call(new Object, src, msg, chan);\n\n                 return;\n             }\n\n             if (msg[0] == \"/\")\n             {\n\n                 sys.stopEvent();\n                 this.commands.issueCommand(src, msg, chan);\n                 return;\n             }\n\n             else if (! this.user.hasPerm(src, \"CHAT\"))\n             {\n                 sys.stopEvent();\n                 this.com.message(src, \"CHAT: Permission denied.\", this.theme.WARN, false, chan);\n                 return;\n             }\n\n             if (chan == -1 && !this.user.hasPerm(src, \"BROADCAST\"))\n             {\n                 this.com.message(src, \"BROADCAST: Permission denied.\", this.theme.WARN, false, chan);\n                 sys.stopEvent();\n                 return;\n                 // can't write outside of all channels here >_<\n             }\n\n\n             var muteID = this.security.muteID(src);\n\n             if (muteID !== null && !this.user.hasPerm(src, \"PROTECTED\") )\n             {\n                 var mute = this.security.database.mutes[this.security.muteID(src)];\n\n                 this.com.message(\n                     [src],\n                     \"<hr/>You are muted.<br>\" + this.theme.issuehtml(mute) + \"<hr/>\",\n                     this.theme.CRITICAL,\n                     true\n                 );\n\n                 this.logs.logMessage(this.logs.INFO, \"Muted message from \"+sys.name(src)+\": \" + msg);\n                 sys.stopEvent();\n\n                 return;\n             }\n\n             var m = msg;\n\n             if (m[0] == \"%\")\n             {\n                 m = this.commands.augment(m.substring(1), src, chan);\n             }\n\n             for (var x in this.filters)\n             {\n                 m = this.filters[x](src, m, chan);\n\n                 if (!m) break;\n             }\n\n             if (m)\n             {\n                 sys.broadcast(m, chan, src, false, -1);\n                 this.logs.logMessage(this.logs.CHAT, (chan == -1? \"\" : \"[#\"+sys.channel(chan)+\"] \") + this.user.name(src) + \": \" + msg);\n             }\n\n             sys.stopEvent();\n\n         }\n         ,\n         registerFilter: function (filter, object)\n         {\n             var filt = this.util.bind(object, filter);\n             this.filters.push(filt);\n             object.onUnloadModule( this.util.bind(\n                                        this,\n                                        function ()\n                                        {\n                                            this.filters.splice(this.filters.indexOf(filt), 1);\n                                        }\n                                    ));\n         }\n         ,\n         loadModule: function loadModule ()\n         {\n             this.script.registerHandler(\"beforeChatMessage\", this);\n         }\n\n\n\n     };})();\n",
 "js_modules/clearchat.js": "({\n     require: [\"io\"],\n\n     counter: null,\n\n     loadModule: function ()\n     {\n         this.counter = 0;\n         this.io.registerConfig(this, { duration: 60000 });\n     },\n\n     step: function ()\n     {\n         if (this.counter >= this.config.duration)\n         {\n             this.counter = 0;\n\n             sys.clearChat();\n         }\n\n         counter++;\n     }\n\n });\n",
 "js_modules/cmdlist.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** Commands list\n * @name cmdlist_command\n * @memberOf script.modules\n * @namespace\n * */\n/** @scope script.modules.cmdlist_command */\n({\n    require: [\"commands\", \"com\",\"text\", \"theme\", \"less\", \"user\", \"parsecommand\"]\n    ,\n    /** Lists all commands available to the user\n     * @type commandDescriptor\n     * */\n    commandlist:\n    {\n        server: true,\n        category: \"basic\",\n        aliases: [\"commands\", \"cmdlist\"]\n        ,\n        desc: \"Lists the commands available to the user.\"\n        ,\n\n        examples:\n        [\n            [{args:[], flags:{all:true}}, \"Shows all of the commands.\"],\n            [{args:[], flags:{nodesc:true}}, \"Be brief.\"],\n            [{args:[], flags:{noexamples:true}}, \"Don't show the examples.\"]\n\n        ],\n        options:\n        {\n            \"all\": \"Also list commands the user doesn't have permission to use\",\n            \"nodesc\": \"Do not show the long description of the commands\",\n            \"noexamples\": \"Don't show examples\"\n        }\n        ,\n        perm: function ()\n        {\n            return true;\n        }\n        ,\n        code: function (src, cmd, chan)\n        {\n            var cmds = this.commands.commands_db;\n            var com = this.com;\n            var text = this.text;\n            var msg = [];\n            var sys_auth$src = sys.auth(src);\n\n\n\n            var cmdtab = Object.keys(cmds);\n\n            function cmpstr (a,b)\n            {\n                if (a === b) return 0;\n                if ([a,b].sort()[0] === a) return -1;\n                return 1;\n            }\n\n            function catsort(a, b)\n            {\n                return cmpstr(cmds[a].category, cmds[b].category);\n            }\n\n            //print(cmdtab);\n            cmdtab.sort(catsort);\n            //print(cmdtab);\n\n            var lastcat = null;\n\n            if (!cmd.flags.nodesc) for (var i in cmdtab)\n            {\n                var x = cmdtab[i];\n                if (cmds[x].name != x) continue;\n\n\n\n                var canuse = this.commands.commandPerm(src, {name:cmds[x].name}, chan);\n\n                if (!cmd.flags.all && !canuse) continue;\n\n                if (!cmd.flags.nodesc)\n                {\n                    if (lastcat !== (lastcat = cmds[x].category))\n                    {\n                        msg.push(\"<font color=blue><b>\"+lastcat[0].toUpperCase() + lastcat.substr(1) + \"</b></font>\");\n\n                    }\n\n                    msg.push(\"<b>/\" + text.escapeHTML(x) +\"</b>\" + (canuse?\"\":\" [NO PERMISSION]\") + this.text.escapeHTML(cmds[x].desc?\" \"+cmds[x].desc:\"\") );\n\n                    if (cmds[x].options)\n                    {\n                        msg.push(\"<em>Options:</em>\");\n                        var options = cmds[x].options;\n\n                        for (var x2 in options)\n                        {\n                            msg.push(\"&nbsp;&nbsp;&nbsp;&nbsp;<em>\" + text.escapeHTML(x2) + \"</em>&nbsp;&nbsp;&nbsp;&nbsp;\" + text.escapeHTML(options[x2]));\n                        }\n                    }\n\n                    if (!cmd.flags.noexamples && cmds[x].examples)\n                    {\n                        msg.push(\"<em>Examples:</em>\");\n\n                        function estring(ex)\n                        {\n                            if (typeof ex == \"string\") return ex;\n\n                            return this.parsecommand.parsers[this.user.userConfig(src).commandParser].unparse(ex);\n\n                        }\n\n                        for (x2 in cmds[x].examples) msg.push(this.text.escapeHTML(\"    /\" + cmds[x].name + \" \" + estring.call(this, cmds[x].examples[x2][0]) +\"\\n        \" + cmds[x].examples[x2][1]));\n                    }\n                }\n\n                else msg.push(x);\n            }\n\n            if (!cmd.flags.nodesc)\n            {\n                this.com.message([src], \"Commands list:\", this.theme.INFO, true);\n                this.less.less(src, msg.join(\"<br />\"), true);\n            }\n            else this.com.message(src, \"Commands list:\\n\" + Object.keys(cmds).join(\", \") + \".\\nFor more information about a command, type /help <command name>.\");\n\n        }\n    }\n    ,\n    loadModule: function ()\n    {\n        this.commands.registerCommand(\"commandlist\", this);\n    }\n});\n",
 "js_modules/color.js": "({\n\n     /** Computes the result of averaging two colors together of proportion p.\n      *\n      */\n     colorMixProp: function (a, b, p)\n     {\n         if (typeof p === \"undefined\") p = 0.5;\n         if (p > 1) p = 1;\n         if (p < 0) p = 0;\n         if (!(p < 1 || p > 0)) p = 0.5;\n\n\n\n         var res=  [Math.round(a[0]*p + b[0]*(1-p)), Math.round(a[1]*p + b[1]*(1-p)), Math.round(a[2]*p + b[2]*(1-p))];\n\n\n         // print(\"Mix \" + JSON.stringify([a, b, p]) + \" -> \" + JSON.stringify(res));\n         return res;\n     },\n\n     neonify: function (c, level)\n     {\n        // return c;\n         if (level === undefined) level = 1;\n\n\n         level = level*0xff;\n\n         var m = Math.max(c[0], c[1], c[2]);\n\n         if (m >= level) {if (script.__debug_mode__) print (\"neonify \" + JSON.stringify({c:c,level:level,m:m,q:q, out:out })); return c;}\n\n         var q = level/m;\n\n\n         var out = [Math.floor(c[0]*q), Math.floor(c[1]*q), Math.floor(c[2]*q)];\n         return out;\n     },\n\n     colorTriadToString: function (triad)\n     {\n         var c = \"#\";\n\n\n         var red = Math.max(Math.min(Math.round(triad[0]), 255), 0).toString(16);\n         if (red.length == 1) red = \"0\" + red;\n         var green =  Math.max(Math.min(Math.round(triad[1]), 255), 0).toString(16);\n         if (green.length == 1) green = \"0\" + green;\n         var blue =  Math.max(Math.min(Math.round(triad[2]), 255), 0).toString(16);\n         if (blue.length == 1) blue = \"0\" + blue;\n\n\n         var q = \"#\" + red + green + blue;\n\n         return q;\n     }\n\n });",
 "js_modules/com.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** Implements communication layer\n * @name com\n * @memberOf script.modules\n * @namespace\n * */\n/** @scope script.modules.com */\n({\n     require: [\"text\", \"theme\", \"util\", \"user\", \"logs\"],\n\n\n     hotswap: true,\n\n     /** Sends a message to user(s)\n      * @param {Number|String|String[]} usrs The user(s) to send the message to.\n      * @param {String} msg The message to send\n      * @param {Number} [type] Constant from theme module describing how to format the message.\n      * @param {Boolean} [html=false] If the message is in html or plaintext.\n      * @param {Array} [chans=all] List of channels\n      * @param {String} [servercode] If present, logs the message with the servercode prefix.\n      */\n     message: function (usrs, msg, type, html, chans, servercode )\n     {\n         var x, x2, x1;\n         usrs = this.util.arrayify(usrs);\n         chans = this.util.arrayify(chans);\n         var fmt_msg = this.theme.formatAs(this.escapeHtmlBool(msg, html), type || 0);\n         if (!chans)\n         {\n             for ( x in usrs)\n             {\n                 if (usrs[x] === 0) print(this.text.stripHTML(fmt_msg));\n                 else sys.sendHtmlMessage(usrs[x], fmt_msg );\n             }\n         }\n         else\n         {\n             for ( x1 in usrs)\n             {\n                 var cnames = [];\n\n                 for ( x2 in chans) cnames.push(sys.channel(chans[x2]));\n                 if (usrs[x1] == 0) print(\"[#\" + cnames.join(\", #\")+\"] \"+this.text.stripHTML(fmt_msg));\n                 else for (x2 in chans)\n                 {\n                     sys.sendHtmlMessage(usrs[x1], fmt_msg, chans[x2]);\n                 }\n             }\n         }\n\n         if (typeof servercode == \"undefined\") return;\n\n         print(servercode + \" \" + this.theme.scriptText + this.stripHtmlBool(msg, html));\n\n\n     },\n\n     PermClass:\n     function (params)\n     {\n\n     },\n\n     ALL: new Object,\n\n     /* Send datums.\n      *\n      */\n     send:\n     function (users, dgram)\n     {\n         var x, uclass, rqclass, dgclass, user;\n\n\n\n         dgclass = this.datagramRegistry[dgram.type];\n\n         if (users === this.ALL) users = this.user.users();\n\n         else users = this.util.arrayify(users);\n\n         users = this.util.arrayify(users);\n         users = this.util.concatSets(users);\n         users.sort();\n\n         for (x in users)\n         {\n             user = users[x];\n             if (typeof user == typeof String() || typeof user == typeof Number())\n             {\n                 if (user == 0) // server\n                 {\n                     uclass = \"server\";\n                 }\n                 else\n                 {\n                     rqclass = this.user.userConfig(user).dataGramClass;\n                     if (rqclass != \"default\") uclass = rqclass;\n                 }\n             }\n         }\n\n\n     },\n\n     notify: function (users, msg, chans)\n     {\n         users = this.util.arrayify(users);\n\n         for (var x in users)\n         {\n             if (users[x] == 0)\n             {\n                 print(\"~Script~: \" + msg);\n             }\n             else\n             {\n                 sys.sendHtmlMessage(users[x], \"&#x200e;<font color=blue><timestamp /><b>~Script~:</b> \" + this.text.escapeHTML(msg)+ \"&#x200e;\");\n             }\n\n         }\n     },\n\n     /** Sends a message to all users.\n      * @param {String} msg The message to send.\n      * @param {Number} [type] Constant from theme module describing how to format the message.\n      * @param {Boolean} [html=false] If the message is in html or plaintext.\n      * @param {Array} [chans=all] List of channels\n      * @param {String} [servercode] If present, logs the message with the servercode prefix.\n      */\n     broadcast: function (msg, type, html, chans)\n     {\n         var usrs = new Object;\n         var channames = [];\n\n\n\n         chans = this.util.arrayify(chans);\n\n         this.logs.logMessage(this.logs.BROADCAST, this.stripHtmlBool(msg, html));\n\n         if (chans) for (var x in chans)\n         {\n             channames.push(\"[#\" + sys.channel(chans[x]) +\"] \");\n         }\n\n         var fmt_msg = this.theme.formatAs(this.escapeHtmlBool(msg, html), type || 0);\n         if (chans)\n         {\n             for (var x1 in chans)\n             {\n                 var ids = sys.playersOfChannel(chans[x1]);\n\n                 for (var x2 in ids)\n                 {\n                     usrs[ids[x2]] = null;\n                 }\n             }\n         }\n         else\n         {\n             var t = this.user.users();\n\n             for (x in t)\n             {\n                 usrs[t[x]] = null;\n             }\n         }\n\n         usrs = Object.keys(usrs);\n\n         if (!chans)\n         {\n             for (x in usrs)\n             {\n                 sys.sendHtmlMessage(usrs[x], fmt_msg );\n             }\n         }\n         else\n         {\n             for (var x1 in usrs)\n             {\n                 for (var x2 in chans)\n                 {\n                     sys.sendHtmlMessage(usrs[x1], fmt_msg, chans[x2]);\n                 }\n             }\n         }\n\n         print(channames.join(\"\") +  (type != -1 ? \"~Script~: \": \"\") + this.stripHtmlBool(msg, html));\n     }\n     ,\n     /** @private */\n     escapeHtmlBool: function (text, bool)\n     {\n         if (bool) return text;\n\n         return this.text.escapeHTML(text);\n     }\n     ,\n     /** @private */\n     stripHtmlBool: function (text, bool)\n     {\n         if (bool) return this.text.stripHTML(text);\n\n         return text;\n     }\n     ,\n     loadModule: function ()\n     {\n\n     }\n });\n",
 "js_modules/commands.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** Commands\n * @name commands\n * @memberOf script.modules\n * @namespace\n * */\n/**\n * @name commandDescriptor\n * @class\n */\n/** Check for permission.\n * @name perm\n * @memberOf commandDescriptor.prototype\n * @type {Function|String}\n * @param {Number} src User ID\n * @param {Object} cmd Parsed command\n * @param {Number} chan Channel ID\n * @return {Boolean|Object} True/False, or if true, may also be object with cache.\n */\n/** Exectutes the command, sometimes ignoring permission. (best to check for permission first)\n * @name code\n * @memberOf commandDescriptor.prototype\n * @function\n * @param {Number} src User ID\n * @param {Object} cmd Parsed command\n * @param {Number} chan Channel ID\n * @param {Object} [cache] Cache object as a result of perm function if applicable. Must not assume this is present.\n */\n/** Describes the command\n * @name desc\n * @memberOf commandDescriptor.prototype\n * @type String\n */\n/** If the server console can use the command, requires special handling in some cases.\n * @name server\n * @memberOf commandDescriptor.prototype\n * @type Boolean\n * @deprecated\n */\n/** Describes the command's options. Key is option name, value is description.\n * @name options\n * @memberOf commandDescriptor.prototype\n * @type {Object.String}\n */\n/** Category for /commands\n * @name commands\n * @memberOf commandDescriptor.prototype\n * @type {String}\n */\n/** @scope script.modules.commands */\n({\n     require: [\"com\", \"theme\", \"parsecommand\", \"util\", \"logs\", \"io\", \"dmp\", \"user\"],\n\n\n     dmpO: null,\n\n\n     /** A list of all the command object descriptors loaded\n      * @type {Object.<commandDescriptor>}\n      */\n     commands_db: new Object,\n\n\n     /** Error of Permission. */\n     PERMISSION_ERROR: new Object,\n     FORMAT_ERROT: new Object,\n\n     /** @event */\n     loadModule: function ()\n     {\n\n         this.dmpO = new this.dmp.constructor();\n         this.dmpO.Match_Threshold = 0.5;\n         this.dmpO.Match_Distance = 0;\n\t this.user.registerConfigHook(this, \"userConfiguration\");\n\n     },\n\n\n     userConfiguration: function (conf)\n     {\n         if (!conf.commandParser || !(conf.commandParser in this.parsecommand.parsers)) conf.commandParser = \"standard\";\n     },\n\n\n     /** Registeres command.\n      * @param {String} name Name of command.\n      * @param {Module} object Module object.\n      * @param {String} [prop=name] Name of property from module to use\n      */\n     registerCommand: function (name, object, prop)\n     {\n         if (name in this.commands_db)\n         {\n             this.script.log(\"WARN: Overwriting command \" +name);\n         }\n\n         var comnd = object[prop || name];\n         comnd.bind = object;\n         comnd.name = name;\n\n         this.commands_db[name] = object[prop || name];\n         //this.commands_db[name].config = this.config.commands[name];\n\n         if (!comnd.category)\n         {\n             print(\"WARN: Command /\"+comnd.name+ \" has no category!\");\n             comnd.category = \"other\";\n         }\n\n         if (comnd.aliases) for (var x in comnd.aliases)\n         {\n             this.commands_db[comnd.aliases[x]] = comnd;\n         }\n\n         object.onUnloadModule(\n             this.util.bind(\n                 this,\n                 function ()\n                 {\n                     this.unregisterCommand(name);\n                 }\n             )\n         );\n         return;\n     },\n\n\n\n     /** Unregisters a command\n      * @param {String} name Name of command to unregister\n      * */\n     unregisterCommand: function (name)\n     {\n         if (this.commands_db[name])\n         {\n             if (this.commands_db[name].aliases) for (var x in this.commands_db[name].aliases)\n             {\n                 delete this.commands_db[this.commands_db[name].aliases[x]];\n             }\n         }\n         delete this.commands_db[name];\n     },\n\n\n\n\n\n\n\n     /** Checks if player has permission to use a command\n      * @param {Number} src Player ID.\n      * @param {parsedCommand} cmd\n      * @param {Number} chan Channel ID.\n      */\n     commandPerm: function (src, cmd, chan)\n     {\n         var cmdobj = this.commands_db[cmd.name];\n\n         if (this.user.hasPerm(src, \"COMMAND[\" + cmdobj.name.toUpperCase() + \"]\")) return true;\n\n         else if (typeof cmdobj.perm == \"string\")\n         {\n             return this.user.hasPerm(src, cmdobj.perm);\n         }\n         else if (typeof cmdobj.perm == \"boolean\")\n         {\n             return cmdobj.perm;\n         }\n         else if (cmdobj.perm === undefined)\n         {\n             return false;\n         }\n         else\n         {\n\n             return (cmdobj.perm || cmdobj.perm2).call(cmdobj.bind, src, cmd, chan);\n         }\n     },\n\n\n     tryCommand: function(src, cmd, chan)\n     {\n         var cmd_obj = this.commands_db[cmd.name];\n\n         if (!cmd_obj)\n         {\n             this.com.message([src], \"Command \\\"\"+cmd.name+\"\\\": Command does not exist.\", this.theme.WARN);\n\n             if (1) // bugfix\n             {\n                 var matches = [];\n\n                 for (var x in this.commands_db) if (this.dmpO.match_main(x, cmd.name, 0) != -1)\n                 {\n                     matches.push(x);\n                 }\n\n                 if (matches.length) this.com.message(src, \"Did you mean one of these?: \" + matches.join(\", \") + \"?\");\n\n             }\n\n             return;\n         }\n\n         var perm = this.commandPerm(src, cmd, chan);\n\n         if (!perm)\n         {\n             this.com.message(src, \"Command \\\"\"+cmd.name+\"\\\": Permission denied.\", this.theme.WARN);\n\n             var matches = [];\n\n             for (var x in this.commands_db) if (x != cmd.name && this.dmpO.match_main(x, cmd.name, 0) != -1 && this.commandPerm(src, {name:x, flags: {}, args: []}, chan))\n             {\n                 matches.push(x);\n             }\n\n             if (matches.length) this.com.message(src, \"Did you mean one of these?: \" + matches.join(\", \") + \"?\");\n\n             return;\n         }\n\n         if (cmd.errorhtml && cmd_obj.mode != \"lazy\")\n         {\n             this.com.message(src, \"Parser Error: \" + cmd.errorhtml, this.theme.warn, true, chan);\n             if (cmd_obj.mode == \"strict\") return;\n         }\n\n         try\n         {\n             var retval = cmd_obj.code.call(cmd_obj.bind, src, cmd, chan, (perm === true ? void 0 : perm));\n             if (retval)\n             {\n                 if (retval.status === this.PERMISSION_ERROR)\n                 {\n\n                     this.com.message(src, \"Error: No permission for \" + (retval.perm || \"?\")  + \"!\");\n\n                 }\n\n             }\n         }\n         catch (e)\n         {\n             this.script.error(e);\n         }\n     },\n\n\n     /** Parses text from a user as a command, checks relevant permissions etc.\n      * @event\n      * @param src User ID\n      * @param text Unparsed text object\n      * @param chan Channel ID\n      */\n     issueCommand: function(src, text, chan)\n     {\n         var cmd = this.parsecommand.parsers[this.user.userConfig(src).commandParser].parse.call(this.parsecommand, text), x;\n\n         for (x in cmd.args)\n         {\n             cmd.args[x] = this.augment(cmd.args[x], src, chan, true);\n         }\n\n         for (x in cmd.flags) if (typeof cmd.flags[x] == typeof String())\n         {\n             cmd.flags[x] = this.augment(cmd.flags[x], src, chan, true);\n         }\n\n         this.logs.logMessage(this.logs.COMMAND, (chan == -1 ? \"[N/A] \" : \"[#\"+sys.channel(chan)+\"] \") + this.user.name(src) + \": \" + text);\n\n         this.tryCommand(src, cmd, chan);\n     },\n\n     loadSubmodule: function (md)\n     {\n         if (md.meta && md.meta.commands)\n         {\n             for (var x in md.meta.commands)\n             {\n                 this.registerCommand(md.meta.commands[x], md);\n             }\n         }\n     },\n\n     augment:\n     function (text, src, chan, iscmd)\n     {\n         if (typeof text != typeof String()) return text;\n         var nt = text.split(/\\\\%/g), x, t;\n\n         var that = this;\n         function pid(r1, r2)\n         {\n             var n = that.user.name(r2);\n\n             if (n) return n;\n\n             return \"?\";\n         }\n         /*\n          function query(r1, r2)\n          {\n          if (!this.user.hasPerm(src, \"EVAL\"))\n          {\n          return \"[%q{...}: Permission Denied: EVAL permission is required to use %q(...)]\";\n          }\n\n          try\n          {\n          var f = new Function(r2);\n          } catch (e)\n          {\n\n          }\n          }*/\n\n         function evalp(r1, r2)\n         {\n             if (typeof src == typeof undefined || !that.user.hasPerm(src, \"EVAL\"))\n             {\n                 return \"[%eval{{...}}: Permission Denied: EVAL permission is required to use %eval{{...}}]\";\n             }\n\n             var t = \"\";\n\n             try\n             {\n                 t = JSON.stringify(eval(r2.replace(/\\\\(.)/g, \"$1\")));\n             }\n             catch (e)\n             {\n                 t = e;\n             }\n\n             return t;\n         }\n\n\n         for (x in nt)\n         {\n             nt[x] = nt[x].replace(/%p\\[(\\d+)\\]/g, pid);\n             nt[x] = nt[x].replace(/%eval\\{{2}((?:\\\\\\}{2}|[^\\]\\\\])+)\\}{2}/g, evalp);\n             nt[x] = nt[x].replace(/\\\\./g, \"$1\");\n         }\n\n         return nt.join(\"%\");\n     }\n\n\n });\n",
 "js_modules/configure.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"commands\", \"io\", \"com\", \"theme\", \"user\"],\n\n\n     loadModule: function ()\n     {\n         this.commands.registerCommand(\"configure\", this);\n     },\n\n     configure:\n     {\n         mode: \"strict\",\n         server: true,\n         category: \"administrative\",\n\n         code: function (src, cmd, chan, cache)\n         {\n             try\n             {\n                 var groups = cache || this.user.groups(src);\n                 if (this.parseConfigureString(src, cmd.input || \"\", groups) != 2) this.com.message(src, \"Configured.\", this.theme.INFO);\n                 return;\n             }\n             catch (e)\n             {\n                 this.com.message(src, \"Configure error in \" + cmd.input + \": \" + e, this.theme.WARN);\n\n\n\n                 return;\n             }\n         },\n\n         perm: function (src)\n         {\n             return this.user.hasPerm(src, \"CONFIGURE\");\n\n         }\n\n\n     },\n\n     parseConfigureString: function (src, string)\n     {\n         var match = string.match(/^\\s*([\\w]+(?:\\.[\\w]+)*)(?:\\s*(\\=|\\+\\=|<<|>>|~)\\s*(.*$))?/i);\n\n         //if (this.user.isSuper(src)\n         //implement permission checks later\n\n         if (!match)\n         {\n             this.com.message(src, \"Server Configuration:\\n\" + JSON.stringify(this.io.configs, 1, \" \"), this.theme.INFO);\n             return 2;\n         }\n\n         var pathway = match[1].split(/\\./g);\n\n         if (pathway.length <= 1 && (match[2] || pathway.length == 0)) throw new Error(\"Inconfigurable property\");\n\n\n\t var modname = pathway[0];\n         var finalProp = pathway.pop();\n\n         if (finalProp === \"__proto__\") throw new Error(\"Smartass eh?\");\n\n         var modobj = this.io.configs;\n         // var schemaobj = this.io.schemas[module];\n         // var schema;\n\n         for (var x in pathway)\n         {\n\n             var i = pathway[x];\n\n             if (i === \"__proto__\") throw new Error(\"Smartass eh?\");\n\n             modobj = modobj[pathway[x]];\n\n             if (typeof modobj !== \"object\" || modobj instanceof Array) throw new Error(\"Invalid property chain\");\n\n         }\n\n         if (! match[2])\n         {\n             this.com.message(src, \"Property Value:\\n\" + JSON.stringify(modobj[finalProp], 1, \" \"), this.theme.INFO);\n             return 2;\n         }\n\n         if (!this.user.hasPerm(src, \"CONFIGURE[\" + match[1].toUpperCase() + \"]\"))\n         {\n             throw new Error(\"Permission denied.\");\n         }\n\n         var prop = JSON.parse(match[3]);\n\n\n\n         switch (match[2])\n         {\n         case \":=\":\n         case \"=\":\n             if (typeof prop != \"object\" && typeof prop === typeof modobj[finalProp])\n             {\n                 modobj[finalProp] = prop;\n                 this.io.callConfigureHooks(modname);\n                 return true;\n             }\n             else if (typeof modobj[finalProp] === \"object\" && modobj[finalProp] instanceof Array && typeof prop === \"object\" && prop instanceof Array)\n             {\n                 for (x in prop) if (typeof prop[x] === \"object\") throw new Error(\"Wrong argument type or wrong operator.\");\n\n                 modobj[finalProp] = prop;\n                 this.io.callConfigureHooks(modname);\n                 return true;\n             }\n             throw new Error(\"Wrong argument type or wrong operator.\");\n         case \"<<\":\n             if (typeof modobj[finalProp] === \"object\" && modobj[finalProp] instanceof Array && typeof prop != \"object\")\n             {\n                 modobj[finalProp].push(prop);\n                 this.io.callConfigureHooks(modname);\n                 return true;\n             }\n             throw new Error(\"Wrong argument type or wrong operator.\");\n         case \">>\":\n             if (typeof modobj[finalProp] === \"object\" && modobj[finalProp] instanceof Array && typeof prop != \"object\")\n             {\n                 if (modobj[finalProp].indexOf(prop) !== -1) modobj[finalProp].splice(modobj[finalProp].indexOf(prop), 1);\n                 this.io.callConfigureHooks(modname);\n                 return true;\n             }\n             throw new Error(\"Wrong argument type or wrong operator.\");\n         case \"~\":\n\n\n\n\n         }\n\n         throw new Error(\"Wrong argument type or wrong operator.\");\n\n\n     },\n\n     listConfigureProperties: function ()\n     {\n\n     }\n\n\n\n });",
 "js_modules/constdata.js": "({\n     SCRIPT_AUTHORS: [\"ArchZombie0x\"],\n\n     SCRIPT_VERSION: \"?\",\n\n     RENAMES:\n     {\n         \"setauth_command\": \"setauth\",\n         eval_command: \"eval\",\n         cmdlist_command: \"commandslist\",\n         kick_command: \"kick\",\n         authlist_command: \"authlist\",\n         readlogs_command: \"readlogs\",\n         me_command: \"me\",\n         mute_command: \"mute\",\n         ban_command: \"ban\",\n         info_command: \"info\",\n         io_commands: \"ioctrl\"\n     }\n\n });",
 "js_modules/crypto.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n\n     Locker: function (password, object)\n     {\n         var sha = sys.sha1;\n\n         var salt = Math.random();\n         var cryptpass = sha(  salt.toString() + password );\n\n         password = null;\n\n         return (\n             function (passwd)\n             {\n                 if (sha(salt.toString() + passwd) == cryptpass) return object;\n\n                 else return null;\n             }\n         );\n     },\n\n     HardCrypt: function (key, data)\n     {\n         // Combination of a stream and block cipher\n         var output, hash, salt, crypto, cipher, passes, temp, ciphers, i, subcipher, i2, unencrypted_output, compressed_output, num_blocks;\n\n         if (typeof data == \"string\") data = sys.ByteArray(data);\n         if (typeof key == \"string\") key = sys.ByteArray(key);\n\n         salt = sys.ByteArray(8);\n\n         for (i = 0; i < 8; i++)\n         {\n             salt[i] = Math.floor(Math.random() * 256);\n         }\n\n         cipher = this.sha1x128(sys.ByteArray(0).append(salt).append(key));\n\n         output = sys.ByteArray(0).append(salt);\n\n         unencrypted_output = sys.ByteArray(8);\n\n\n         // Add garbage to make the data more secure\n         for (i = 0; i < 8; i++)\n         {\n             unencrypted_output[i] = Math.floor(Math.random() * 256);\n         }\n\n         unecrypted_output.append(data.length); // Append data's length\n\n         unencrypted_output.append(data); // Add the data\n\n         unencrypted_output.append(sys.sha1Binary(unencrypted_output)); // Add hash to prevent tampering.\n\n         i2 = Math.floor(Math.random()*200); // Arbitrary amount of garbage\n\n         temp = sys.ByteArray(i2);\n\n         // Add garbage to make the data more secure\n         for (i = 0; i < i2; i++)\n         {\n             temp[i] = Math.floor(Math.random() * 256);\n         }\n\n         unencrypted_output.append(temp);\n\n         // final unecrypted_output\n\n         compressed_output = sys.qCompress(unencrypted_output);\n\n         // now add garbage so that compressed output is of block size:\n\n         while(compressed_output.length % 64 != 0)\n         {\n             temp = sys.ByteArray(1);\n             temp[0] = Math.floor(Math.random() * 256);\n             compressed_output.append(temp);\n         }\n\n         num_blocks = compressed_output.length / 64;\n\n         ciphers = [];\n\n         for (i = 0; i < num_blocks; i++)\n         {\n             ciphers[i] = this.applyCipher(cipher, (i == 0? cipher: ciphers[i - 1]));\n         }\n\n     },\n\n\n     sha1x128: function (data)\n     {\n         var output, i;\n         output = sys.ByteArray(0);\n\n         for (i = 0; i < 7; i++)\n         {\n             output.append( sys.sha1Binary( data.append(this.intToBin(i)) ));\n         }\n\n         output.truncate(128);\n\n         return output;\n     },\n\n     HardCryptReverse: function (key, crypt)\n     {\n         var sha = sys.sha1;\n\n         var salt = crypt[0];\n\n         var chrc = crypt[1].split(\"\");\n\n         var cryptoproc = sha(salt.toString() + key);\n\n\n\n         var cryptoxormask = [];\n\n         for (var x in chrc)\n         {\n             if (x >= cryptoxormask.length) cryptoxormask = cryptoxormask.concat((cryptoproc = sha((salt+x).toString() + cryptoproc) + sha(cryptoproc + \":\")).split());\n\n             chrc[x] = chrc[x].charCodeAt(0) ^ cryptoxormask[x].charCodeAt(0);\n\n             cryptoxormask[x] = 0;\n         }\n\n         for ( x in chrc)\n         {\n             chrc[x] = String.fromCharCode(chrc[x]);\n         }\n\n         return chrc.join(\"\");\n     }\n\n });\n",
 "js_modules/default.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"io\", \"user\", \"constdata\"],\n\n     metatype: \"runtime\",\n\n     DEFAULTS: [\"logs\",  \"iologger\", \"interceptor\", \"dump\", \"gateway\", \"chat\", \"reset\", \"modprobe\", \"server\",\"cmdlist\", \"kick\", \"mute\", \"info\", \"groupmod\", \"configure\", \"ban\", \"setauth\", \"sourcedist\", \"eval\", \"help\", \"modprobe\", \"io\", \"userconf\", \"ioctrl\"],\n\n     loadModule: function ()\n     {\n         var x;\n\n\n\n         this.io.registerConfig(this, { modules: [\"me\", \"channels\",\"info\", \"serverimp\", \"authlist\", \"readlogs\", \"automute\", \"logmessager\", \"rules\", \"die\", \"announcement\", \"clearchat\", \"antiproxy\", \"motd\", \"playerlist\" ] });\n\n         for (x in this.DEFAULTS)\n         {\n\n             this.script.loadModule(this.DEFAULTS[x]);\n         }\n\n         for (x in this.config.modules)\n         {\n             try\n             {\n\n                 if (this.constdata.RENAMES[this.config.modules[x]]) this.config.modules[x] = this.constdata.RENAMES[this.config.modules[x]];\n                 this.script.loadModule(this.config.modules[x]);\n             } catch(e)\n             {\n                 this.script.error(e);\n             }\n         }\n     }\n\n\n});\n",
 "js_modules/die.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n\n     require: [\"commands\", \"com\", \"theme\", \"user\", \"io\"],\n\n\n     loadModule: function ()\n     {\n         this.commands.registerCommand(\"die\", this);\n         this.io.registerConfig(this, {waysOfDying: [\n                                           \"% found an anvil from above.\", \"% got hit by a meteor.\", \"Salamence thought % was tasty.\",\n                                           \"% looked a bit too much like fish food to Sharpedo.\",\n                                           \"% went dancing with Blaziken.\", \"% listened to Lapras sing.\", \"% was tackled by Magikarp!\"\n                                       ]\n                                      });\n     },\n\n\n     die:\n     {\n         server: true,\n         category: \"fun\",\n\n         desc: \"Leave the server with style.\",\n\n         perm: function ()\n         {\n             return true;\n         },\n\n         code: function (src, cmd, chan)\n         {\n             var i = Math.floor(Math.random() * this.config.waysOfDying.length);\n\n             this.com.broadcast(this.config.waysOfDying[i].replace(/%/g, this.user.name(src)), this.theme.GAME);\n\n             if (src) sys.kick(src);\n         }\n\n     }\n\n});\n",
 "js_modules/dismiss.js": "({\n     require: [\"commands\", \"com\"],\n\n     meta:\n     {\n         commands: [\"dismiss\"]\n     },\n\n     dismiss:\n     {\n         category: \"basic\",\n\t desc: \"Dissmiss the announcement.\",\n         perm: function () {return true;},\n         code:\n         function (src, cmd, chan)\n         {\n\n             this.com.message(src, \"Dismissed the announcement.\");\n             sys.setAnnouncement(\" \", src);\n         }\n\n\n     }\n\n });",
 "js_modules/dmp.js": "/*  ///////////////////////// LEGAL NOTICES ///////////////////////////////\n\n Diff Match and Patch\n\n Copyright 2006 Google Inc.\n http://code.google.com/p/google-diff-match-patch/\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n\n author fraser@google.com (Neil Fraser)\n\n ////////////////////////////////////////////////////////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICES /////////////////////////////// */\n\n\n/**\n * @fileoverview Computes the difference between two texts to create a patch.\n * Applies the patch onto another text, allowing for errors.\n * @author fraser@google.com (Neil Fraser)\n */\n(function () {\n     /**\n      * Class containing the diff, match and patch methods.\n      * @constructor\n      * @name diff_match_patch\n      */\n     function diff_match_patch() {\n\n         // Defaults.\n         // Redefine these in your program to override the defaults.\n\n         // Number of seconds to map a diff before giving up (0 for infinity).\n         this.Diff_Timeout = 0;\n         // Cost of an empty edit operation in terms of edit characters.\n         this.Diff_EditCost = 04;\n         // At what point is no match declared (0.0 = perfection, 1.0 = very loose).\n         this.Match_Threshold = 0;\n         // How far to search for a match (0 = exact location, 1000+ = broad match).\n         // A match this many characters away from the expected location will add\n         // 1.0 to the score (0.0 is a perfect match).\n         this.Match_Distance = 4;\n         // When deleting a large block of text (over ~64 characters), how close do\n         // the contents have to be to match the expected contents. (0.0 = perfection,\n         // 1.0 = very loose).  Note that Match_Threshold controls how closely the\n         // end points of a delete need to match.\n         this.Patch_DeleteThreshold = 0.5;\n         // Chunk size for context length.\n         this.Patch_Margin = 4;\n\n         // The number of bits in an int.\n         this.Match_MaxBits = 32;\n     }\n\n\n     //  DIFF FUNCTIONS\n\n\n     /**\n      * The data structure representing a diff is an array of tuples:\n      * [[DIFF_DELETE, 'Hello'], [DIFF_INSERT, 'Goodbye'], [DIFF_EQUAL, ' world.']]\n      * which means: delete 'Hello', add 'Goodbye' and keep ' world.'\n      */\n     var DIFF_DELETE = -1;\n     var DIFF_INSERT = 1;\n     var DIFF_EQUAL = 0;\n\n     /** @typedef {{0: number, 1: string}} */\n     diff_match_patch.Diff;\n\n\n     /**\n      * Find the differences between two texts.  Simplifies the problem by stripping\n      * any common prefix or suffix off the texts before diffing.\n      * @param {string} text1 Old string to be diffed.\n      * @param {string} text2 New string to be diffed.\n      * @param {boolean=} opt_checklines Optional speedup flag. If present and false,\n      *     then don't run a line-level diff first to identify the changed areas.\n      *     Defaults to true, which does a faster, slightly less optimal diff.\n      * @param {number} opt_deadline Optional time when the diff should be complete\n      *     by.  Used internally for recursive calls.  Users should set DiffTimeout\n      *     instead.\n      * @return {!Array.<!diff_match_patch.Diff>} Array of diff tuples.\n      */\n     diff_match_patch.prototype.diff_main = function(text1, text2, opt_checklines,\n                                                     opt_deadline) {\n         // Set a deadline by which time the diff must be complete.\n         if (typeof opt_deadline == 'undefined') {\n             if (this.Diff_Timeout <= 0) {\n                 opt_deadline = Number.MAX_VALUE;\n             } else {\n                 opt_deadline = (new Date).getTime() + this.Diff_Timeout * 1000;\n             }\n         }\n         var deadline = opt_deadline;\n\n         // Check for null inputs.\n         if (text1 == null || text2 == null) {\n             throw new Error('Null input. (diff_main)');\n         }\n\n         // Check for equality (speedup).\n         if (text1 == text2) {\n             if (text1) {\n                 return [[DIFF_EQUAL, text1]];\n             }\n             return [];\n         }\n\n         if (typeof opt_checklines == 'undefined') {\n             opt_checklines = true;\n         }\n         var checklines = opt_checklines;\n\n         // Trim off common prefix (speedup).\n         var commonlength = this.diff_commonPrefix(text1, text2);\n         var commonprefix = text1.substring(0, commonlength);\n         text1 = text1.substring(commonlength);\n         text2 = text2.substring(commonlength);\n\n         // Trim off common suffix (speedup).\n         commonlength = this.diff_commonSuffix(text1, text2);\n         var commonsuffix = text1.substring(text1.length - commonlength);\n         text1 = text1.substring(0, text1.length - commonlength);\n         text2 = text2.substring(0, text2.length - commonlength);\n\n         // Compute the diff on the middle block.\n         var diffs = this.diff_compute_(text1, text2, checklines, deadline);\n\n         // Restore the prefix and suffix.\n         if (commonprefix) {\n             diffs.unshift([DIFF_EQUAL, commonprefix]);\n         }\n         if (commonsuffix) {\n             diffs.push([DIFF_EQUAL, commonsuffix]);\n         }\n         this.diff_cleanupMerge(diffs);\n         return diffs;\n     };\n\n\n     /**\n      * Find the differences between two texts.  Assumes that the texts do not\n      * have any common prefix or suffix.\n      * @param {string} text1 Old string to be diffed.\n      * @param {string} text2 New string to be diffed.\n      * @param {boolean} checklines Speedup flag.  If false, then don't run a\n      *     line-level diff first to identify the changed areas.\n      *     If true, then run a faster, slightly less optimal diff.\n      * @param {number} deadline Time when the diff should be complete by.\n      * @return {!Array.<!diff_match_patch.Diff>} Array of diff tuples.\n      * @private\n      */\n     diff_match_patch.prototype.diff_compute_ = function(text1, text2, checklines,\n                                                         deadline) {\n         var diffs;\n\n         if (!text1) {\n             // Just add some text (speedup).\n             return [[DIFF_INSERT, text2]];\n         }\n\n         if (!text2) {\n             // Just delete some text (speedup).\n             return [[DIFF_DELETE, text1]];\n         }\n\n         var longtext = text1.length > text2.length ? text1 : text2;\n         var shorttext = text1.length > text2.length ? text2 : text1;\n         var i = longtext.indexOf(shorttext);\n         if (i != -1) {\n             // Shorter text is inside the longer text (speedup).\n             diffs = [[DIFF_INSERT, longtext.substring(0, i)],\n                      [DIFF_EQUAL, shorttext],\n                      [DIFF_INSERT, longtext.substring(i + shorttext.length)]];\n             // Swap insertions for deletions if diff is reversed.\n             if (text1.length > text2.length) {\n                 diffs[0][0] = diffs[2][0] = DIFF_DELETE;\n             }\n             return diffs;\n         }\n\n         if (shorttext.length == 1) {\n             // Single character string.\n             // After the previous speedup, the character can't be an equality.\n             return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];\n         }\n\n         // Check to see if the problem can be split in two.\n         var hm = this.diff_halfMatch_(text1, text2);\n         if (hm) {\n             // A half-match was found, sort out the return data.\n             var text1_a = hm[0];\n             var text1_b = hm[1];\n             var text2_a = hm[2];\n             var text2_b = hm[3];\n             var mid_common = hm[4];\n             // Send both pairs off for separate processing.\n             var diffs_a = this.diff_main(text1_a, text2_a, checklines, deadline);\n             var diffs_b = this.diff_main(text1_b, text2_b, checklines, deadline);\n             // Merge the results.\n             return diffs_a.concat([[DIFF_EQUAL, mid_common]], diffs_b);\n         }\n\n         if (checklines && text1.length > 100 && text2.length > 100) {\n             return this.diff_lineMode_(text1, text2, deadline);\n         }\n\n         return this.diff_bisect_(text1, text2, deadline);\n     };\n\n\n     /**\n      * Do a quick line-level diff on both strings, then rediff the parts for\n      * greater accuracy.\n      * This speedup can produce non-minimal diffs.\n      * @param {string} text1 Old string to be diffed.\n      * @param {string} text2 New string to be diffed.\n      * @param {number} deadline Time when the diff should be complete by.\n      * @return {!Array.<!diff_match_patch.Diff>} Array of diff tuples.\n      * @private\n      */\n     diff_match_patch.prototype.diff_lineMode_ = function(text1, text2, deadline) {\n         // Scan the text on a line-by-line basis first.\n         var a = this.diff_linesToChars_(text1, text2);\n         text1 = a.chars1;\n         text2 = a.chars2;\n         var linearray = a.lineArray;\n\n         var diffs = this.diff_main(text1, text2, false, deadline);\n\n         // Convert the diff back to original text.\n         this.diff_charsToLines_(diffs, linearray);\n         // Eliminate freak matches (e.g. blank lines)\n         this.diff_cleanupSemantic(diffs);\n\n         // Rediff any replacement blocks, this time character-by-character.\n         // Add a dummy entry at the end.\n         diffs.push([DIFF_EQUAL, '']);\n         var pointer = 0;\n         var count_delete = 0;\n         var count_insert = 0;\n         var text_delete = '';\n         var text_insert = '';\n         while (pointer < diffs.length) {\n             switch (diffs[pointer][0]) {\n             case DIFF_INSERT:\n                 count_insert++;\n                 text_insert += diffs[pointer][1];\n                 break;\n             case DIFF_DELETE:\n                 count_delete++;\n                 text_delete += diffs[pointer][1];\n                 break;\n             case DIFF_EQUAL:\n                 // Upon reaching an equality, check for prior redundancies.\n                 if (count_delete >= 1 && count_insert >= 1) {\n                     // Delete the offending records and add the merged ones.\n                     diffs.splice(pointer - count_delete - count_insert,\n                                  count_delete + count_insert);\n                     pointer = pointer - count_delete - count_insert;\n                     var a = this.diff_main(text_delete, text_insert, false, deadline);\n                     for (var j = a.length - 1; j >= 0; j--) {\n                         diffs.splice(pointer, 0, a[j]);\n                     }\n                     pointer = pointer + a.length;\n                 }\n                 count_insert = 0;\n                 count_delete = 0;\n                 text_delete = '';\n                 text_insert = '';\n                 break;\n             }\n             pointer++;\n         }\n         diffs.pop();  // Remove the dummy entry at the end.\n\n         return diffs;\n     };\n\n\n     /**\n      * Find the 'middle snake' of a diff, split the problem in two\n      * and return the recursively constructed diff.\n      * See Myers 1986 paper: An O(ND) Difference Algorithm and Its Variations.\n      * @param {string} text1 Old string to be diffed.\n      * @param {string} text2 New string to be diffed.\n      * @param {number} deadline Time at which to bail if not yet complete.\n      * @return {!Array.<!diff_match_patch.Diff>} Array of diff tuples.\n      * @private\n      */\n     diff_match_patch.prototype.diff_bisect_ = function(text1, text2, deadline) {\n         // Cache the text lengths to prevent multiple calls.\n         var text1_length = text1.length;\n         var text2_length = text2.length;\n         var max_d = Math.ceil((text1_length + text2_length) / 2);\n         var v_offset = max_d;\n         var v_length = 2 * max_d;\n         var v1 = new Array(v_length);\n         var v2 = new Array(v_length);\n         // Setting all elements to -1 is faster in Chrome & Firefox than mixing\n         // integers and undefined.\n         for (var x = 0; x < v_length; x++) {\n             v1[x] = -1;\n             v2[x] = -1;\n         }\n         v1[v_offset + 1] = 0;\n         v2[v_offset + 1] = 0;\n         var delta = text1_length - text2_length;\n         // If the total number of characters is odd, then the front path will collide\n         // with the reverse path.\n         var front = (delta % 2 != 0);\n         // Offsets for start and end of k loop.\n         // Prevents mapping of space beyond the grid.\n         var k1start = 0;\n         var k1end = 0;\n         var k2start = 0;\n         var k2end = 0;\n         for (var d = 0; d < max_d; d++) {\n             // Bail out if deadline is reached.\n             if ((new Date()).getTime() > deadline) {\n                 break;\n             }\n\n             // Walk the front path one step.\n             for (var k1 = -d + k1start; k1 <= d - k1end; k1 += 2) {\n                 var k1_offset = v_offset + k1;\n                 var x1;\n                 if (k1 == -d || (k1 != d && v1[k1_offset - 1] < v1[k1_offset + 1])) {\n                     x1 = v1[k1_offset + 1];\n                 } else {\n                     x1 = v1[k1_offset - 1] + 1;\n                 }\n                 var y1 = x1 - k1;\n                 while (x1 < text1_length && y1 < text2_length &&\n                        text1.charAt(x1) == text2.charAt(y1)) {\n                     x1++;\n                     y1++;\n                 }\n                 v1[k1_offset] = x1;\n                 if (x1 > text1_length) {\n                     // Ran off the right of the graph.\n                     k1end += 2;\n                 } else if (y1 > text2_length) {\n                     // Ran off the bottom of the graph.\n                     k1start += 2;\n                 } else if (front) {\n                     var k2_offset = v_offset + delta - k1;\n                     if (k2_offset >= 0 && k2_offset < v_length && v2[k2_offset] != -1) {\n                         // Mirror x2 onto top-left coordinate system.\n                         var x2 = text1_length - v2[k2_offset];\n                         if (x1 >= x2) {\n                             // Overlap detected.\n                             return this.diff_bisectSplit_(text1, text2, x1, y1, deadline);\n                         }\n                     }\n                 }\n             }\n\n             // Walk the reverse path one step.\n             for (var k2 = -d + k2start; k2 <= d - k2end; k2 += 2) {\n                 var k2_offset = v_offset + k2;\n                 var x2;\n                 if (k2 == -d || (k2 != d && v2[k2_offset - 1] < v2[k2_offset + 1])) {\n                     x2 = v2[k2_offset + 1];\n                 } else {\n                     x2 = v2[k2_offset - 1] + 1;\n                 }\n                 var y2 = x2 - k2;\n                 while (x2 < text1_length && y2 < text2_length &&\n                        text1.charAt(text1_length - x2 - 1) ==\n                        text2.charAt(text2_length - y2 - 1)) {\n                     x2++;\n                     y2++;\n                 }\n                 v2[k2_offset] = x2;\n                 if (x2 > text1_length) {\n                     // Ran off the left of the graph.\n                     k2end += 2;\n                 } else if (y2 > text2_length) {\n                     // Ran off the top of the graph.\n                     k2start += 2;\n                 } else if (!front) {\n                     var k1_offset = v_offset + delta - k2;\n                     if (k1_offset >= 0 && k1_offset < v_length && v1[k1_offset] != -1) {\n                         var x1 = v1[k1_offset];\n                         var y1 = v_offset + x1 - k1_offset;\n                         // Mirror x2 onto top-left coordinate system.\n                         x2 = text1_length - x2;\n                         if (x1 >= x2) {\n                             // Overlap detected.\n                             return this.diff_bisectSplit_(text1, text2, x1, y1, deadline);\n                         }\n                     }\n                 }\n             }\n         }\n         // Diff took too long and hit the deadline or\n         // number of diffs equals number of characters, no commonality at all.\n         return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];\n     };\n\n\n     /**\n      * Given the location of the 'middle snake', split the diff in two parts\n      * and recurse.\n      * @param {string} text1 Old string to be diffed.\n      * @param {string} text2 New string to be diffed.\n      * @param {number} x Index of split point in text1.\n      * @param {number} y Index of split point in text2.\n      * @param {number} deadline Time at which to bail if not yet complete.\n      * @return {!Array.<!diff_match_patch.Diff>} Array of diff tuples.\n      * @private\n      */\n     diff_match_patch.prototype.diff_bisectSplit_ = function(text1, text2, x, y,\n                                                             deadline) {\n         var text1a = text1.substring(0, x);\n         var text2a = text2.substring(0, y);\n         var text1b = text1.substring(x);\n         var text2b = text2.substring(y);\n\n         // Compute both diffs serially.\n         var diffs = this.diff_main(text1a, text2a, false, deadline);\n         var diffsb = this.diff_main(text1b, text2b, false, deadline);\n\n         return diffs.concat(diffsb);\n     };\n\n\n     /**\n      * Split two texts into an array of strings.  Reduce the texts to a string of\n      * hashes where each Unicode character represents one line.\n      * @param {string} text1 First string.\n      * @param {string} text2 Second string.\n      * @return {{chars1: string, chars2: string, lineArray: !Array.<string>}}\n      *     An object containing the encoded text1, the encoded text2 and\n      *     the array of unique strings.\n      *     The zeroth element of the array of unique strings is intentionally blank.\n      * @private\n      */\n     diff_match_patch.prototype.diff_linesToChars_ = function(text1, text2) {\n         var lineArray = [];  // e.g. lineArray[4] == 'Hello\\n'\n         var lineHash = {};   // e.g. lineHash['Hello\\n'] == 4\n\n         // '\\x00' is a valid character, but various debuggers don't like it.\n         // So we'll insert a junk entry to avoid generating a null character.\n         lineArray[0] = '';\n\n         /**\n          * Split a text into an array of strings.  Reduce the texts to a string of\n          * hashes where each Unicode character represents one line.\n          * Modifies linearray and linehash through being a closure.\n          * @param {string} text String to encode.\n          * @return {string} Encoded string.\n          * @private\n          */\n         function diff_linesToCharsMunge_(text) {\n             var chars = '';\n             // Walk the text, pulling out a substring for each line.\n             // text.split('\\n') would would temporarily double our memory footprint.\n             // Modifying text would create many large strings to garbage collect.\n             var lineStart = 0;\n             var lineEnd = -1;\n             // Keeping our own length variable is faster than looking it up.\n             var lineArrayLength = lineArray.length;\n             while (lineEnd < text.length - 1) {\n                 lineEnd = text.indexOf('\\n', lineStart);\n                 if (lineEnd == -1) {\n                     lineEnd = text.length - 1;\n                 }\n                 var line = text.substring(lineStart, lineEnd + 1);\n                 lineStart = lineEnd + 1;\n\n                 if (lineHash.hasOwnProperty ? lineHash.hasOwnProperty(line) :\n                     (lineHash[line] !== undefined)) {\n                     chars += String.fromCharCode(lineHash[line]);\n                 } else {\n                     chars += String.fromCharCode(lineArrayLength);\n                     lineHash[line] = lineArrayLength;\n                     lineArray[lineArrayLength++] = line;\n                 }\n             }\n             return chars;\n         }\n\n         var chars1 = diff_linesToCharsMunge_(text1);\n         var chars2 = diff_linesToCharsMunge_(text2);\n         return {chars1: chars1, chars2: chars2, lineArray: lineArray};\n     };\n\n\n     /**\n      * Rehydrate the text in a diff from a string of line hashes to real lines of\n      * text.\n      * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n      * @param {!Array.<string>} lineArray Array of unique strings.\n      * @private\n      */\n     diff_match_patch.prototype.diff_charsToLines_ = function(diffs, lineArray) {\n         for (var x = 0; x < diffs.length; x++) {\n             var chars = diffs[x][1];\n             var text = [];\n             for (var y = 0; y < chars.length; y++) {\n                 text[y] = lineArray[chars.charCodeAt(y)];\n             }\n             diffs[x][1] = text.join('');\n         }\n     };\n\n\n     /**\n      * Determine the common prefix of two strings.\n      * @param {string} text1 First string.\n      * @param {string} text2 Second string.\n      * @return {number} The number of characters common to the start of each\n      *     string.\n      */\n     diff_match_patch.prototype.diff_commonPrefix = function(text1, text2) {\n         // Quick check for common null cases.\n         if (!text1 || !text2 || text1.charAt(0) != text2.charAt(0)) {\n             return 0;\n         }\n         // Binary search.\n         // Performance analysis: http://neil.fraser.name/news/2007/10/09/\n         var pointermin = 0;\n         var pointermax = Math.min(text1.length, text2.length);\n         var pointermid = pointermax;\n         var pointerstart = 0;\n         while (pointermin < pointermid) {\n             if (text1.substring(pointerstart, pointermid) ==\n                 text2.substring(pointerstart, pointermid)) {\n                 pointermin = pointermid;\n                 pointerstart = pointermin;\n             } else {\n                 pointermax = pointermid;\n             }\n             pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);\n         }\n         return pointermid;\n     };\n\n\n     /**\n      * Determine the common suffix of two strings.\n      * @param {string} text1 First string.\n      * @param {string} text2 Second string.\n      * @return {number} The number of characters common to the end of each string.\n      */\n     diff_match_patch.prototype.diff_commonSuffix = function(text1, text2) {\n         // Quick check for common null cases.\n         if (!text1 || !text2 ||\n             text1.charAt(text1.length - 1) != text2.charAt(text2.length - 1)) {\n             return 0;\n         }\n         // Binary search.\n         // Performance analysis: http://neil.fraser.name/news/2007/10/09/\n         var pointermin = 0;\n         var pointermax = Math.min(text1.length, text2.length);\n         var pointermid = pointermax;\n         var pointerend = 0;\n         while (pointermin < pointermid) {\n             if (text1.substring(text1.length - pointermid, text1.length - pointerend) ==\n                 text2.substring(text2.length - pointermid, text2.length - pointerend)) {\n                 pointermin = pointermid;\n                 pointerend = pointermin;\n             } else {\n                 pointermax = pointermid;\n             }\n             pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);\n         }\n         return pointermid;\n     };\n\n\n     /**\n      * Determine if the suffix of one string is the prefix of another.\n      * @param {string} text1 First string.\n      * @param {string} text2 Second string.\n      * @return {number} The number of characters common to the end of the first\n      *     string and the start of the second string.\n      * @private\n      */\n     diff_match_patch.prototype.diff_commonOverlap_ = function(text1, text2) {\n         // Cache the text lengths to prevent multiple calls.\n         var text1_length = text1.length;\n         var text2_length = text2.length;\n         // Eliminate the null case.\n         if (text1_length == 0 || text2_length == 0) {\n             return 0;\n         }\n         // Truncate the longer string.\n         if (text1_length > text2_length) {\n             text1 = text1.substring(text1_length - text2_length);\n         } else if (text1_length < text2_length) {\n             text2 = text2.substring(0, text1_length);\n         }\n         var text_length = Math.min(text1_length, text2_length);\n         // Quick check for the worst case.\n         if (text1 == text2) {\n             return text_length;\n         }\n\n         // Start by looking for a single character match\n         // and increase length until no match is found.\n         // Performance analysis: http://neil.fraser.name/news/2010/11/04/\n         var best = 0;\n         var length = 1;\n         while (true) {\n             var pattern = text1.substring(text_length - length);\n             var found = text2.indexOf(pattern);\n             if (found == -1) {\n                 return best;\n             }\n             length += found;\n             if (found == 0 || text1.substring(text_length - length) ==\n                 text2.substring(0, length)) {\n                 best = length;\n                 length++;\n             }\n         }\n     };\n\n\n     /**\n      * Do the two texts share a substring which is at least half the length of the\n      * longer text?\n      * This speedup can produce non-minimal diffs.\n      * @param {string} text1 First string.\n      * @param {string} text2 Second string.\n      * @return {Array.<string>} Five element Array, containing the prefix of\n      *     text1, the suffix of text1, the prefix of text2, the suffix of\n      *     text2 and the common middle.  Or null if there was no match.\n      * @private\n      */\n     diff_match_patch.prototype.diff_halfMatch_ = function(text1, text2) {\n         if (this.Diff_Timeout <= 0) {\n             // Don't risk returning a non-optimal diff if we have unlimited time.\n             return null;\n         }\n         var longtext = text1.length > text2.length ? text1 : text2;\n         var shorttext = text1.length > text2.length ? text2 : text1;\n         if (longtext.length < 4 || shorttext.length * 2 < longtext.length) {\n             return null;  // Pointless.\n         }\n         var dmp = this;  // 'this' becomes 'window' in a closure.\n\n         /**\n          * Does a substring of shorttext exist within longtext such that the substring\n          * is at least half the length of longtext?\n          * Closure, but does not reference any external variables.\n          * @param {string} longtext Longer string.\n          * @param {string} shorttext Shorter string.\n          * @param {number} i Start index of quarter length substring within longtext.\n          * @return {Array.<string>} Five element Array, containing the prefix of\n          *     longtext, the suffix of longtext, the prefix of shorttext, the suffix\n          *     of shorttext and the common middle.  Or null if there was no match.\n          * @private\n          */\n         function diff_halfMatchI_(longtext, shorttext, i) {\n             // Start with a 1/4 length substring at position i as a seed.\n             var seed = longtext.substring(i, i + Math.floor(longtext.length / 4));\n             var j = -1;\n             var best_common = '';\n             var best_longtext_a, best_longtext_b, best_shorttext_a, best_shorttext_b;\n             while ((j = shorttext.indexOf(seed, j + 1)) != -1) {\n                 var prefixLength = dmp.diff_commonPrefix(longtext.substring(i),\n                                                          shorttext.substring(j));\n                 var suffixLength = dmp.diff_commonSuffix(longtext.substring(0, i),\n                                                          shorttext.substring(0, j));\n                 if (best_common.length < suffixLength + prefixLength) {\n                     best_common = shorttext.substring(j - suffixLength, j) +\n                         shorttext.substring(j, j + prefixLength);\n                     best_longtext_a = longtext.substring(0, i - suffixLength);\n                     best_longtext_b = longtext.substring(i + prefixLength);\n                     best_shorttext_a = shorttext.substring(0, j - suffixLength);\n                     best_shorttext_b = shorttext.substring(j + prefixLength);\n                 }\n             }\n             if (best_common.length * 2 >= longtext.length) {\n                 return [best_longtext_a, best_longtext_b,\n                         best_shorttext_a, best_shorttext_b, best_common];\n             } else {\n                 return null;\n             }\n         }\n\n         // First check if the second quarter is the seed for a half-match.\n         var hm1 = diff_halfMatchI_(longtext, shorttext,\n                                    Math.ceil(longtext.length / 4));\n         // Check again based on the third quarter.\n         var hm2 = diff_halfMatchI_(longtext, shorttext,\n                                    Math.ceil(longtext.length / 2));\n         var hm;\n         if (!hm1 && !hm2) {\n             return null;\n         } else if (!hm2) {\n             hm = hm1;\n         } else if (!hm1) {\n             hm = hm2;\n         } else {\n             // Both matched.  Select the longest.\n             hm = hm1[4].length > hm2[4].length ? hm1 : hm2;\n         }\n\n         // A half-match was found, sort out the return data.\n         var text1_a, text1_b, text2_a, text2_b;\n         if (text1.length > text2.length) {\n             text1_a = hm[0];\n             text1_b = hm[1];\n             text2_a = hm[2];\n             text2_b = hm[3];\n         } else {\n             text2_a = hm[0];\n             text2_b = hm[1];\n             text1_a = hm[2];\n             text1_b = hm[3];\n         }\n         var mid_common = hm[4];\n         return [text1_a, text1_b, text2_a, text2_b, mid_common];\n     };\n\n\n     /**\n      * Reduce the number of edits by eliminating semantically trivial equalities.\n      * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n      */\n     diff_match_patch.prototype.diff_cleanupSemantic = function(diffs) {\n         var changes = false;\n         var equalities = [];  // Stack of indices where equalities are found.\n         var equalitiesLength = 0;  // Keeping our own length var is faster in JS.\n         /** @type {?string} */\n         var lastequality = null;\n         // Always equal to diffs[equalities[equalitiesLength - 1]][1]\n         var pointer = 0;  // Index of current position.\n         // Number of characters that changed prior to the equality.\n         var length_insertions1 = 0;\n         var length_deletions1 = 0;\n         // Number of characters that changed after the equality.\n         var length_insertions2 = 0;\n         var length_deletions2 = 0;\n         while (pointer < diffs.length) {\n             if (diffs[pointer][0] == DIFF_EQUAL) {  // Equality found.\n                 equalities[equalitiesLength++] = pointer;\n                 length_insertions1 = length_insertions2;\n                 length_deletions1 = length_deletions2;\n                 length_insertions2 = 0;\n                 length_deletions2 = 0;\n                 lastequality = diffs[pointer][1];\n             } else {  // An insertion or deletion.\n                 if (diffs[pointer][0] == DIFF_INSERT) {\n                     length_insertions2 += diffs[pointer][1].length;\n                 } else {\n                     length_deletions2 += diffs[pointer][1].length;\n                 }\n                 // Eliminate an equality that is smaller or equal to the edits on both\n                 // sides of it.\n                 if (lastequality && (lastequality.length <=\n                                      Math.max(length_insertions1, length_deletions1)) &&\n                     (lastequality.length <= Math.max(length_insertions2,\n                                                      length_deletions2))) {\n                     // Duplicate record.\n                     diffs.splice(equalities[equalitiesLength - 1], 0,\n                                  [DIFF_DELETE, lastequality]);\n                     // Change second copy to insert.\n                     diffs[equalities[equalitiesLength - 1] + 1][0] = DIFF_INSERT;\n                     // Throw away the equality we just deleted.\n                     equalitiesLength--;\n                     // Throw away the previous equality (it needs to be reevaluated).\n                     equalitiesLength--;\n                     pointer = equalitiesLength > 0 ? equalities[equalitiesLength - 1] : -1;\n                     length_insertions1 = 0;  // Reset the counters.\n                     length_deletions1 = 0;\n                     length_insertions2 = 0;\n                     length_deletions2 = 0;\n                     lastequality = null;\n                     changes = true;\n                 }\n             }\n             pointer++;\n         }\n\n         // Normalize the diff.\n         if (changes) {\n             this.diff_cleanupMerge(diffs);\n         }\n         this.diff_cleanupSemanticLossless(diffs);\n\n         // Find any overlaps between deletions and insertions.\n         // e.g: <del>abcxxx</del><ins>xxxdef</ins>\n         //   -> <del>abc</del>xxx<ins>def</ins>\n         // e.g: <del>xxxabc</del><ins>defxxx</ins>\n         //   -> <ins>def</ins>xxx<del>abc</del>\n         // Only extract an overlap if it is as big as the edit ahead or behind it.\n         pointer = 1;\n         while (pointer < diffs.length) {\n             if (diffs[pointer - 1][0] == DIFF_DELETE &&\n                 diffs[pointer][0] == DIFF_INSERT) {\n                 var deletion = diffs[pointer - 1][1];\n                 var insertion = diffs[pointer][1];\n                 var overlap_length1 = this.diff_commonOverlap_(deletion, insertion);\n                 var overlap_length2 = this.diff_commonOverlap_(insertion, deletion);\n                 if (overlap_length1 >= overlap_length2) {\n                     if (overlap_length1 >= deletion.length / 2 ||\n                         overlap_length1 >= insertion.length / 2) {\n                         // Overlap found.  Insert an equality and trim the surrounding edits.\n                         diffs.splice(pointer, 0,\n                                      [DIFF_EQUAL, insertion.substring(0, overlap_length1)]);\n                         diffs[pointer - 1][1] =\n                             deletion.substring(0, deletion.length - overlap_length1);\n                         diffs[pointer + 1][1] = insertion.substring(overlap_length1);\n                         pointer++;\n                     }\n                 } else {\n                     if (overlap_length2 >= deletion.length / 2 ||\n                         overlap_length2 >= insertion.length / 2) {\n                         // Reverse overlap found.\n                         // Insert an equality and swap and trim the surrounding edits.\n                         diffs.splice(pointer, 0,\n                                      [DIFF_EQUAL, deletion.substring(0, overlap_length2)]);\n                         diffs[pointer - 1][0] = DIFF_INSERT;\n                         diffs[pointer - 1][1] =\n                             insertion.substring(0, insertion.length - overlap_length2);\n                         diffs[pointer + 1][0] = DIFF_DELETE;\n                         diffs[pointer + 1][1] =\n                             deletion.substring(overlap_length2);\n                         pointer++;\n                     }\n                 }\n                 pointer++;\n             }\n             pointer++;\n         }\n     };\n\n\n     /**\n      * Look for single edits surrounded on both sides by equalities\n      * which can be shifted sideways to align the edit to a word boundary.\n      * e.g: The c<ins>at c</ins>ame. -> The <ins>cat </ins>came.\n      * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n      */\n     diff_match_patch.prototype.diff_cleanupSemanticLossless = function(diffs) {\n         /**\n          * Given two strings, compute a score representing whether the internal\n          * boundary falls on logical boundaries.\n          * Scores range from 6 (best) to 0 (worst).\n          * Closure, but does not reference any external variables.\n          * @param {string} one First string.\n          * @param {string} two Second string.\n          * @return {number} The score.\n          * @private\n          */\n         function diff_cleanupSemanticScore_(one, two) {\n             if (!one || !two) {\n                 // Edges are the best.\n                 return 6;\n             }\n\n             // Each port of this function behaves slightly differently due to\n             // subtle differences in each language's definition of things like\n             // 'whitespace'.  Since this function's purpose is largely cosmetic,\n             // the choice has been made to use each language's native features\n             // rather than force total conformity.\n             var char1 = one.charAt(one.length - 1);\n             var char2 = two.charAt(0);\n             var nonAlphaNumeric1 = char1.match(diff_match_patch.nonAlphaNumericRegex_);\n             var nonAlphaNumeric2 = char2.match(diff_match_patch.nonAlphaNumericRegex_);\n             var whitespace1 = nonAlphaNumeric1 &&\n                 char1.match(diff_match_patch.whitespaceRegex_);\n             var whitespace2 = nonAlphaNumeric2 &&\n                 char2.match(diff_match_patch.whitespaceRegex_);\n             var lineBreak1 = whitespace1 &&\n                 char1.match(diff_match_patch.linebreakRegex_);\n             var lineBreak2 = whitespace2 &&\n                 char2.match(diff_match_patch.linebreakRegex_);\n             var blankLine1 = lineBreak1 &&\n                 one.match(diff_match_patch.blanklineEndRegex_);\n             var blankLine2 = lineBreak2 &&\n                 two.match(diff_match_patch.blanklineStartRegex_);\n\n             if (blankLine1 || blankLine2) {\n                 // Five points for blank lines.\n                 return 5;\n             } else if (lineBreak1 || lineBreak2) {\n                 // Four points for line breaks.\n                 return 4;\n             } else if (nonAlphaNumeric1 && !whitespace1 && whitespace2) {\n                 // Three points for end of sentences.\n                 return 3;\n             } else if (whitespace1 || whitespace2) {\n                 // Two points for whitespace.\n                 return 2;\n             } else if (nonAlphaNumeric1 || nonAlphaNumeric2) {\n                 // One point for non-alphanumeric.\n                 return 1;\n             }\n             return 0;\n         }\n\n         var pointer = 1;\n         // Intentionally ignore the first and last element (don't need checking).\n         while (pointer < diffs.length - 1) {\n             if (diffs[pointer - 1][0] == DIFF_EQUAL &&\n                 diffs[pointer + 1][0] == DIFF_EQUAL) {\n                 // This is a single edit surrounded by equalities.\n                 var equality1 = diffs[pointer - 1][1];\n                 var edit = diffs[pointer][1];\n                 var equality2 = diffs[pointer + 1][1];\n\n                 // First, shift the edit as far left as possible.\n                 var commonOffset = this.diff_commonSuffix(equality1, edit);\n                 if (commonOffset) {\n                     var commonString = edit.substring(edit.length - commonOffset);\n                     equality1 = equality1.substring(0, equality1.length - commonOffset);\n                     edit = commonString + edit.substring(0, edit.length - commonOffset);\n                     equality2 = commonString + equality2;\n                 }\n\n                 // Second, step character by character right, looking for the best fit.\n                 var bestEquality1 = equality1;\n                 var bestEdit = edit;\n                 var bestEquality2 = equality2;\n                 var bestScore = diff_cleanupSemanticScore_(equality1, edit) +\n                     diff_cleanupSemanticScore_(edit, equality2);\n                 while (edit.charAt(0) === equality2.charAt(0)) {\n                     equality1 += edit.charAt(0);\n                     edit = edit.substring(1) + equality2.charAt(0);\n                     equality2 = equality2.substring(1);\n                     var score = diff_cleanupSemanticScore_(equality1, edit) +\n                         diff_cleanupSemanticScore_(edit, equality2);\n                     // The >= encourages trailing rather than leading whitespace on edits.\n                     if (score >= bestScore) {\n                         bestScore = score;\n                         bestEquality1 = equality1;\n                         bestEdit = edit;\n                         bestEquality2 = equality2;\n                     }\n                 }\n\n                 if (diffs[pointer - 1][1] != bestEquality1) {\n                     // We have an improvement, save it back to the diff.\n                     if (bestEquality1) {\n                         diffs[pointer - 1][1] = bestEquality1;\n                     } else {\n                         diffs.splice(pointer - 1, 1);\n                         pointer--;\n                     }\n                     diffs[pointer][1] = bestEdit;\n                     if (bestEquality2) {\n                         diffs[pointer + 1][1] = bestEquality2;\n                     } else {\n                         diffs.splice(pointer + 1, 1);\n                         pointer--;\n                     }\n                 }\n             }\n             pointer++;\n         }\n     };\n\n     // Define some regex patterns for matching boundaries.\n     diff_match_patch.nonAlphaNumericRegex_ = /[^a-zA-Z0-9]/;\n     diff_match_patch.whitespaceRegex_ = /\\s/;\n     diff_match_patch.linebreakRegex_ = /[\\r\\n]/;\n     diff_match_patch.blanklineEndRegex_ = /\\n\\r?\\n$/;\n     diff_match_patch.blanklineStartRegex_ = /^\\r?\\n\\r?\\n/;\n\n     /**\n      * Reduce the number of edits by eliminating operationally trivial equalities.\n      * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n      */\n     diff_match_patch.prototype.diff_cleanupEfficiency = function(diffs) {\n         var changes = false;\n         var equalities = [];  // Stack of indices where equalities are found.\n         var equalitiesLength = 0;  // Keeping our own length var is faster in JS.\n         /** @type {?string} */\n         var lastequality = null;\n         // Always equal to diffs[equalities[equalitiesLength - 1]][1]\n         var pointer = 0;  // Index of current position.\n         // Is there an insertion operation before the last equality.\n         var pre_ins = false;\n         // Is there a deletion operation before the last equality.\n         var pre_del = false;\n         // Is there an insertion operation after the last equality.\n         var post_ins = false;\n         // Is there a deletion operation after the last equality.\n         var post_del = false;\n         while (pointer < diffs.length) {\n             if (diffs[pointer][0] == DIFF_EQUAL) {  // Equality found.\n                 if (diffs[pointer][1].length < this.Diff_EditCost &&\n                     (post_ins || post_del)) {\n                     // Candidate found.\n                     equalities[equalitiesLength++] = pointer;\n                     pre_ins = post_ins;\n                     pre_del = post_del;\n                     lastequality = diffs[pointer][1];\n                 } else {\n                     // Not a candidate, and can never become one.\n                     equalitiesLength = 0;\n                     lastequality = null;\n                 }\n                 post_ins = post_del = false;\n             } else {  // An insertion or deletion.\n                 if (diffs[pointer][0] == DIFF_DELETE) {\n                     post_del = true;\n                 } else {\n                     post_ins = true;\n                 }\n                 /*\n                  * Five types to be split:\n                  * <ins>A</ins><del>B</del>XY<ins>C</ins><del>D</del>\n                  * <ins>A</ins>X<ins>C</ins><del>D</del>\n                  * <ins>A</ins><del>B</del>X<ins>C</ins>\n                  * <ins>A</del>X<ins>C</ins><del>D</del>\n                  * <ins>A</ins><del>B</del>X<del>C</del>\n                  */\n                 if (lastequality && ((pre_ins && pre_del && post_ins && post_del) ||\n                                      ((lastequality.length < this.Diff_EditCost / 2) &&\n                                       (pre_ins + pre_del + post_ins + post_del) == 3))) {\n                     // Duplicate record.\n                     diffs.splice(equalities[equalitiesLength - 1], 0,\n                                  [DIFF_DELETE, lastequality]);\n                     // Change second copy to insert.\n                     diffs[equalities[equalitiesLength - 1] + 1][0] = DIFF_INSERT;\n                     equalitiesLength--;  // Throw away the equality we just deleted;\n                     lastequality = null;\n                     if (pre_ins && pre_del) {\n                         // No changes made which could affect previous entry, keep going.\n                         post_ins = post_del = true;\n                         equalitiesLength = 0;\n                     } else {\n                         equalitiesLength--;  // Throw away the previous equality.\n                         pointer = equalitiesLength > 0 ?\n                             equalities[equalitiesLength - 1] : -1;\n                         post_ins = post_del = false;\n                     }\n                     changes = true;\n                 }\n             }\n             pointer++;\n         }\n\n         if (changes) {\n             this.diff_cleanupMerge(diffs);\n         }\n     };\n\n\n     /**\n      * Reorder and merge like edit sections.  Merge equalities.\n      * Any edit section can move as long as it doesn't cross an equality.\n      * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n      */\n     diff_match_patch.prototype.diff_cleanupMerge = function(diffs) {\n         diffs.push([DIFF_EQUAL, '']);  // Add a dummy entry at the end.\n         var pointer = 0;\n         var count_delete = 0;\n         var count_insert = 0;\n         var text_delete = '';\n         var text_insert = '';\n         var commonlength;\n         while (pointer < diffs.length) {\n             switch (diffs[pointer][0]) {\n             case DIFF_INSERT:\n                 count_insert++;\n                 text_insert += diffs[pointer][1];\n                 pointer++;\n                 break;\n             case DIFF_DELETE:\n                 count_delete++;\n                 text_delete += diffs[pointer][1];\n                 pointer++;\n                 break;\n             case DIFF_EQUAL:\n                 // Upon reaching an equality, check for prior redundancies.\n                 if (count_delete + count_insert > 1) {\n                     if (count_delete !== 0 && count_insert !== 0) {\n                         // Factor out any common prefixies.\n                         commonlength = this.diff_commonPrefix(text_insert, text_delete);\n                         if (commonlength !== 0) {\n                             if ((pointer - count_delete - count_insert) > 0 &&\n                                 diffs[pointer - count_delete - count_insert - 1][0] ==\n                                 DIFF_EQUAL) {\n                                 diffs[pointer - count_delete - count_insert - 1][1] +=\n                                 text_insert.substring(0, commonlength);\n                             } else {\n                                 diffs.splice(0, 0, [DIFF_EQUAL,\n                                                     text_insert.substring(0, commonlength)]);\n                                 pointer++;\n                             }\n                             text_insert = text_insert.substring(commonlength);\n                             text_delete = text_delete.substring(commonlength);\n                         }\n                         // Factor out any common suffixies.\n                         commonlength = this.diff_commonSuffix(text_insert, text_delete);\n                         if (commonlength !== 0) {\n                             diffs[pointer][1] = text_insert.substring(text_insert.length -\n                                                                       commonlength) + diffs[pointer][1];\n                             text_insert = text_insert.substring(0, text_insert.length -\n                                                                 commonlength);\n                             text_delete = text_delete.substring(0, text_delete.length -\n                                                                 commonlength);\n                         }\n                     }\n                     // Delete the offending records and add the merged ones.\n                     if (count_delete === 0) {\n                         diffs.splice(pointer - count_insert,\n                                      count_delete + count_insert, [DIFF_INSERT, text_insert]);\n                     } else if (count_insert === 0) {\n                         diffs.splice(pointer - count_delete,\n                                      count_delete + count_insert, [DIFF_DELETE, text_delete]);\n                     } else {\n                         diffs.splice(pointer - count_delete - count_insert,\n                                      count_delete + count_insert, [DIFF_DELETE, text_delete],\n                                      [DIFF_INSERT, text_insert]);\n                     }\n                     pointer = pointer - count_delete - count_insert +\n                         (count_delete ? 1 : 0) + (count_insert ? 1 : 0) + 1;\n                 } else if (pointer !== 0 && diffs[pointer - 1][0] == DIFF_EQUAL) {\n                     // Merge this equality with the previous one.\n                     diffs[pointer - 1][1] += diffs[pointer][1];\n                     diffs.splice(pointer, 1);\n                 } else {\n                     pointer++;\n                 }\n                 count_insert = 0;\n                 count_delete = 0;\n                 text_delete = '';\n                 text_insert = '';\n                 break;\n             }\n         }\n         if (diffs[diffs.length - 1][1] === '') {\n             diffs.pop();  // Remove the dummy entry at the end.\n         }\n\n         // Second pass: look for single edits surrounded on both sides by equalities\n         // which can be shifted sideways to eliminate an equality.\n         // e.g: A<ins>BA</ins>C -> <ins>AB</ins>AC\n         var changes = false;\n         pointer = 1;\n         // Intentionally ignore the first and last element (don't need checking).\n         while (pointer < diffs.length - 1) {\n             if (diffs[pointer - 1][0] == DIFF_EQUAL &&\n                 diffs[pointer + 1][0] == DIFF_EQUAL) {\n                 // This is a single edit surrounded by equalities.\n                 if (diffs[pointer][1].substring(diffs[pointer][1].length -\n                                                 diffs[pointer - 1][1].length) == diffs[pointer - 1][1]) {\n                     // Shift the edit over the previous equality.\n                     diffs[pointer][1] = diffs[pointer - 1][1] +\n                         diffs[pointer][1].substring(0, diffs[pointer][1].length -\n                                                     diffs[pointer - 1][1].length);\n                     diffs[pointer + 1][1] = diffs[pointer - 1][1] + diffs[pointer + 1][1];\n                     diffs.splice(pointer - 1, 1);\n                     changes = true;\n                 } else if (diffs[pointer][1].substring(0, diffs[pointer + 1][1].length) ==\n                            diffs[pointer + 1][1]) {\n                     // Shift the edit over the next equality.\n                     diffs[pointer - 1][1] += diffs[pointer + 1][1];\n                     diffs[pointer][1] =\n                         diffs[pointer][1].substring(diffs[pointer + 1][1].length) +\n                         diffs[pointer + 1][1];\n                     diffs.splice(pointer + 1, 1);\n                     changes = true;\n                 }\n             }\n             pointer++;\n         }\n         // If shifts were made, the diff needs reordering and another shift sweep.\n         if (changes) {\n             this.diff_cleanupMerge(diffs);\n         }\n     };\n\n\n     /**\n      * loc is a location in text1, compute and return the equivalent location in\n      * text2.\n      * e.g. 'The cat' vs 'The big cat', 1->1, 5->8\n      * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n      * @param {number} loc Location within text1.\n      * @return {number} Location within text2.\n      */\n     diff_match_patch.prototype.diff_xIndex = function(diffs, loc) {\n         var chars1 = 0;\n         var chars2 = 0;\n         var last_chars1 = 0;\n         var last_chars2 = 0;\n         var x;\n         for (x = 0; x < diffs.length; x++) {\n             if (diffs[x][0] !== DIFF_INSERT) {  // Equality or deletion.\n                 chars1 += diffs[x][1].length;\n             }\n             if (diffs[x][0] !== DIFF_DELETE) {  // Equality or insertion.\n                 chars2 += diffs[x][1].length;\n             }\n             if (chars1 > loc) {  // Overshot the location.\n                 break;\n             }\n             last_chars1 = chars1;\n             last_chars2 = chars2;\n         }\n         // Was the location was deleted?\n         if (diffs.length != x && diffs[x][0] === DIFF_DELETE) {\n             return last_chars2;\n         }\n         // Add the remaining character length.\n         return last_chars2 + (loc - last_chars1);\n     };\n\n\n     /**\n      * Convert a diff array into a pretty HTML report.\n      * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n      * @return {string} HTML representation.\n      */\n     diff_match_patch.prototype.diff_prettyHtml = function(diffs) {\n         var html = [];\n         var pattern_amp = /&/g;\n         var pattern_lt = /</g;\n         var pattern_gt = />/g;\n         var pattern_para = /\\n/g;\n         for (var x = 0; x < diffs.length; x++) {\n             var op = diffs[x][0];    // Operation (insert, delete, equal)\n             var data = diffs[x][1];  // Text of change.\n             var text = data.replace(pattern_amp, '&amp;').replace(pattern_lt, '&lt;')\n                 .replace(pattern_gt, '&gt;').replace(pattern_para, '&para;<br>');\n             switch (op) {\n             case DIFF_INSERT:\n                 html[x] = '<ins style=\"background:#e6ffe6;\">' + text + '</ins>';\n                 break;\n             case DIFF_DELETE:\n                 html[x] = '<del style=\"background:#ffe6e6;\">' + text + '</del>';\n                 break;\n             case DIFF_EQUAL:\n                 html[x] = '<span>' + text + '</span>';\n                 break;\n             }\n         }\n         return html.join('');\n     };\n\n\n     /**\n      * Compute and return the source text (all equalities and deletions).\n      * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n      * @return {string} Source text.\n      */\n     diff_match_patch.prototype.diff_text1 = function(diffs) {\n         var text = [];\n         for (var x = 0; x < diffs.length; x++) {\n             if (diffs[x][0] !== DIFF_INSERT) {\n                 text[x] = diffs[x][1];\n             }\n         }\n         return text.join('');\n     };\n\n\n     /**\n      * Compute and return the destination text (all equalities and insertions).\n      * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n      * @return {string} Destination text.\n      */\n     diff_match_patch.prototype.diff_text2 = function(diffs) {\n         var text = [];\n         for (var x = 0; x < diffs.length; x++) {\n             if (diffs[x][0] !== DIFF_DELETE) {\n                 text[x] = diffs[x][1];\n             }\n         }\n         return text.join('');\n     };\n\n\n     /**\n      * Compute the Levenshtein distance; the number of inserted, deleted or\n      * substituted characters.\n      * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n      * @return {number} Number of changes.\n      */\n     diff_match_patch.prototype.diff_levenshtein = function(diffs) {\n         var levenshtein = 0;\n         var insertions = 0;\n         var deletions = 0;\n         for (var x = 0; x < diffs.length; x++) {\n             var op = diffs[x][0];\n             var data = diffs[x][1];\n             switch (op) {\n             case DIFF_INSERT:\n                 insertions += data.length;\n                 break;\n             case DIFF_DELETE:\n                 deletions += data.length;\n                 break;\n             case DIFF_EQUAL:\n                 // A deletion and an insertion is one substitution.\n                 levenshtein += Math.max(insertions, deletions);\n                 insertions = 0;\n                 deletions = 0;\n                 break;\n             }\n         }\n         levenshtein += Math.max(insertions, deletions);\n         return levenshtein;\n     };\n\n\n     /**\n      * Crush the diff into an encoded string which describes the operations\n      * required to transform text1 into text2.\n      * E.g. =3\\t-2\\t+ing  -> Keep 3 chars, delete 2 chars, insert 'ing'.\n      * Operations are tab-separated.  Inserted text is escaped using %xx notation.\n      * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n      * @return {string} Delta text.\n      */\n     diff_match_patch.prototype.diff_toDelta = function(diffs) {\n         var text = [];\n         for (var x = 0; x < diffs.length; x++) {\n             switch (diffs[x][0]) {\n             case DIFF_INSERT:\n                 text[x] = '+' + encodeURI(diffs[x][1]);\n                 break;\n             case DIFF_DELETE:\n                 text[x] = '-' + diffs[x][1].length;\n                 break;\n             case DIFF_EQUAL:\n                 text[x] = '=' + diffs[x][1].length;\n                 break;\n             }\n         }\n         return text.join('\\t').replace(/%20/g, ' ');\n     };\n\n\n     /**\n      * Given the original text1, and an encoded string which describes the\n      * operations required to transform text1 into text2, compute the full diff.\n      * @param {string} text1 Source string for the diff.\n      * @param {string} delta Delta text.\n      * @return {!Array.<!diff_match_patch.Diff>} Array of diff tuples.\n      * @throws {!Error} If invalid input.\n      */\n     diff_match_patch.prototype.diff_fromDelta = function(text1, delta) {\n         var diffs = [];\n         var diffsLength = 0;  // Keeping our own length var is faster in JS.\n         var pointer = 0;  // Cursor in text1\n         var tokens = delta.split(/\\t/g);\n         for (var x = 0; x < tokens.length; x++) {\n             // Each token begins with a one character parameter which specifies the\n             // operation of this token (delete, insert, equality).\n             var param = tokens[x].substring(1);\n             switch (tokens[x].charAt(0)) {\n             case '+':\n                 try {\n                     diffs[diffsLength++] = [DIFF_INSERT, decodeURI(param)];\n                 } catch (ex) {\n                     // Malformed URI sequence.\n                     throw new Error('Illegal escape in diff_fromDelta: ' + param);\n                 }\n                 break;\n             case '-':\n                 // Fall through.\n             case '=':\n                 var n = parseInt(param, 10);\n                 if (isNaN(n) || n < 0) {\n                     throw new Error('Invalid number in diff_fromDelta: ' + param);\n                 }\n                 var text = text1.substring(pointer, pointer += n);\n                 if (tokens[x].charAt(0) == '=') {\n                     diffs[diffsLength++] = [DIFF_EQUAL, text];\n                 } else {\n                     diffs[diffsLength++] = [DIFF_DELETE, text];\n                 }\n                 break;\n             default:\n                 // Blank tokens are ok (from a trailing \\t).\n                 // Anything else is an error.\n                 if (tokens[x]) {\n                     throw new Error('Invalid diff operation in diff_fromDelta: ' +\n                                     tokens[x]);\n                 }\n             }\n         }\n         if (pointer != text1.length) {\n             throw new Error('Delta length (' + pointer +\n                             ') does not equal source text length (' + text1.length + ').');\n         }\n         return diffs;\n     };\n\n\n     //  MATCH FUNCTIONS\n\n\n     /**\n      * Locate the best instance of 'pattern' in 'text' near 'loc'.\n      * @param {string} text The text to search.\n      * @param {string} pattern The pattern to search for.\n      * @param {number} loc The location to search around.\n      * @return {number} Best match index or -1.\n      */\n     diff_match_patch.prototype.match_main = function(text, pattern, loc) {\n         // Check for null inputs.\n         if (text == null || pattern == null || loc == null) {\n             throw new Error('Null input. (match_main)');\n         }\n\n         loc = Math.max(0, Math.min(loc, text.length));\n         if (text == pattern) {\n             // Shortcut (potentially not guaranteed by the algorithm)\n             return 0;\n         } else if (!text.length) {\n             // Nothing to match.\n             return -1;\n         } else if (text.substring(loc, loc + pattern.length) == pattern) {\n             // Perfect match at the perfect spot!  (Includes case of null pattern)\n             return loc;\n         } else {\n             // Do a fuzzy compare.\n             return this.match_bitap_(text, pattern, loc);\n         }\n     };\n\n\n     /**\n      * Locate the best instance of 'pattern' in 'text' near 'loc' using the\n      * Bitap algorithm.\n      * @param {string} text The text to search.\n      * @param {string} pattern The pattern to search for.\n      * @param {number} loc The location to search around.\n      * @return {number} Best match index or -1.\n      * @private\n      */\n     diff_match_patch.prototype.match_bitap_ = function(text, pattern, loc) {\n         if (pattern.length > this.Match_MaxBits) {\n             throw new Error('Pattern too long for this browser.');\n         }\n\n         // Initialise the alphabet.\n         var s = this.match_alphabet_(pattern);\n\n         var dmp = this;  // 'this' becomes 'window' in a closure.\n\n         /**\n          * Compute and return the score for a match with e errors and x location.\n          * Accesses loc and pattern through being a closure.\n          * @param {number} e Number of errors in match.\n          * @param {number} x Location of match.\n          * @return {number} Overall score for match (0.0 = good, 1.0 = bad).\n          * @private\n          */\n         function match_bitapScore_(e, x) {\n             var accuracy = e / pattern.length;\n             var proximity = Math.abs(loc - x);\n             if (!dmp.Match_Distance) {\n                 // Dodge divide by zero error.\n                 return proximity ? 1.0 : accuracy;\n             }\n             return accuracy + (proximity / dmp.Match_Distance);\n         }\n\n         // Highest score beyond which we give up.\n         var score_threshold = this.Match_Threshold;\n         // Is there a nearby exact match? (speedup)\n         var best_loc = text.indexOf(pattern, loc);\n         if (best_loc != -1) {\n             score_threshold = Math.min(match_bitapScore_(0, best_loc), score_threshold);\n             // What about in the other direction? (speedup)\n             best_loc = text.lastIndexOf(pattern, loc + pattern.length);\n             if (best_loc != -1) {\n                 score_threshold =\n                     Math.min(match_bitapScore_(0, best_loc), score_threshold);\n             }\n         }\n\n         // Initialise the bit arrays.\n         var matchmask = 1 << (pattern.length - 1);\n         best_loc = -1;\n\n         var bin_min, bin_mid;\n         var bin_max = pattern.length + text.length;\n         var last_rd;\n         for (var d = 0; d < pattern.length; d++) {\n             // Scan for the best match; each iteration allows for one more error.\n             // Run a binary search to determine how far from 'loc' we can stray at this\n             // error level.\n             bin_min = 0;\n             bin_mid = bin_max;\n             while (bin_min < bin_mid) {\n                 if (match_bitapScore_(d, loc + bin_mid) <= score_threshold) {\n                     bin_min = bin_mid;\n                 } else {\n                     bin_max = bin_mid;\n                 }\n                 bin_mid = Math.floor((bin_max - bin_min) / 2 + bin_min);\n             }\n             // Use the result from this iteration as the maximum for the next.\n             bin_max = bin_mid;\n             var start = Math.max(1, loc - bin_mid + 1);\n             var finish = Math.min(loc + bin_mid, text.length) + pattern.length;\n\n             var rd = Array(finish + 2);\n             rd[finish + 1] = (1 << d) - 1;\n             for (var j = finish; j >= start; j--) {\n                 // The alphabet (s) is a sparse hash, so the following line generates\n                 // warnings.\n                 var charMatch = s[text.charAt(j - 1)];\n                 if (d === 0) {  // First pass: exact match.\n                     rd[j] = ((rd[j + 1] << 1) | 1) & charMatch;\n                 } else {  // Subsequent passes: fuzzy match.\n                     rd[j] = (((rd[j + 1] << 1) | 1) & charMatch) |\n                         (((last_rd[j + 1] | last_rd[j]) << 1) | 1) |\n                         last_rd[j + 1];\n                 }\n                 if (rd[j] & matchmask) {\n                     var score = match_bitapScore_(d, j - 1);\n                     // This match will almost certainly be better than any existing match.\n                     // But check anyway.\n                     if (score <= score_threshold) {\n                         // Told you so.\n                         score_threshold = score;\n                         best_loc = j - 1;\n                         if (best_loc > loc) {\n                             // When passing loc, don't exceed our current distance from loc.\n                             start = Math.max(1, 2 * loc - best_loc);\n                         } else {\n                             // Already passed loc, downhill from here on in.\n                             break;\n                         }\n                     }\n                 }\n             }\n             // No hope for a (better) match at greater error levels.\n             if (match_bitapScore_(d + 1, loc) > score_threshold) {\n                 break;\n             }\n             last_rd = rd;\n         }\n         return best_loc;\n     };\n\n\n     /**\n      * Initialise the alphabet for the Bitap algorithm.\n      * @param {string} pattern The text to encode.\n      * @return {!Object} Hash of character locations.\n      * @private\n      */\n     diff_match_patch.prototype.match_alphabet_ = function(pattern) {\n         var s = {};\n         for (var i = 0; i < pattern.length; i++) {\n             s[pattern.charAt(i)] = 0;\n         }\n         for (var i = 0; i < pattern.length; i++) {\n             s[pattern.charAt(i)] |= 1 << (pattern.length - i - 1);\n         }\n         return s;\n     };\n\n\n     //  PATCH FUNCTIONS\n\n\n     /**\n      * Increase the context until it is unique,\n      * but don't let the pattern expand beyond Match_MaxBits.\n      * @param {!diff_match_patch.patch_obj} patch The patch to grow.\n      * @param {string} text Source text.\n      * @private\n      */\n     diff_match_patch.prototype.patch_addContext_ = function(patch, text) {\n         if (text.length == 0) {\n             return;\n         }\n         var pattern = text.substring(patch.start2, patch.start2 + patch.length1);\n         var padding = 0;\n\n         // Look for the first and last matches of pattern in text.  If two different\n         // matches are found, increase the pattern length.\n         while (text.indexOf(pattern) != text.lastIndexOf(pattern) &&\n                pattern.length < this.Match_MaxBits - this.Patch_Margin -\n                this.Patch_Margin) {\n             padding += this.Patch_Margin;\n             pattern = text.substring(patch.start2 - padding,\n                                      patch.start2 + patch.length1 + padding);\n         }\n         // Add one chunk for good luck.\n         padding += this.Patch_Margin;\n\n         // Add the prefix.\n         var prefix = text.substring(patch.start2 - padding, patch.start2);\n         if (prefix) {\n             patch.diffs.unshift([DIFF_EQUAL, prefix]);\n         }\n         // Add the suffix.\n         var suffix = text.substring(patch.start2 + patch.length1,\n                                     patch.start2 + patch.length1 + padding);\n         if (suffix) {\n             patch.diffs.push([DIFF_EQUAL, suffix]);\n         }\n\n         // Roll back the start points.\n         patch.start1 -= prefix.length;\n         patch.start2 -= prefix.length;\n         // Extend the lengths.\n         patch.length1 += prefix.length + suffix.length;\n         patch.length2 += prefix.length + suffix.length;\n     };\n\n\n     /**\n      * Compute a list of patches to turn text1 into text2.\n      * Use diffs if provided, otherwise compute it ourselves.\n      * There are four ways to call this function, depending on what data is\n      * available to the caller:\n      * Method 1:\n      * a = text1, b = text2\n      * Method 2:\n      * a = diffs\n      * Method 3 (optimal):\n      * a = text1, b = diffs\n      * Method 4 (deprecated, use method 3):\n      * a = text1, b = text2, c = diffs\n      *\n      * @param {string|!Array.<!diff_match_patch.Diff>} a text1 (methods 1,3,4) or\n      * Array of diff tuples for text1 to text2 (method 2).\n      * @param {string|!Array.<!diff_match_patch.Diff>} opt_b text2 (methods 1,4) or\n      * Array of diff tuples for text1 to text2 (method 3) or undefined (method 2).\n      * @param {string|!Array.<!diff_match_patch.Diff>} opt_c Array of diff tuples\n      * for text1 to text2 (method 4) or undefined (methods 1,2,3).\n      * @return {!Array.<!diff_match_patch.patch_obj>} Array of Patch objects.\n      */\n     diff_match_patch.prototype.patch_make = function(a, opt_b, opt_c) {\n         var text1, diffs;\n         if (typeof a == 'string' && typeof opt_b == 'string' &&\n             typeof opt_c == 'undefined') {\n             // Method 1: text1, text2\n             // Compute diffs from text1 and text2.\n             text1 = /** @type {string} */(a);\n             diffs = this.diff_main(text1, /** @type {string} */(opt_b), true);\n             if (diffs.length > 2) {\n                 this.diff_cleanupSemantic(diffs);\n                 this.diff_cleanupEfficiency(diffs);\n             }\n         } else if (a && typeof a == 'object' && typeof opt_b == 'undefined' &&\n                    typeof opt_c == 'undefined') {\n             // Method 2: diffs\n             // Compute text1 from diffs.\n             diffs = /** @type {!Array.<!diff_match_patch.Diff>} */(a);\n             text1 = this.diff_text1(diffs);\n         } else if (typeof a == 'string' && opt_b && typeof opt_b == 'object' &&\n                    typeof opt_c == 'undefined') {\n             // Method 3: text1, diffs\n             text1 = /** @type {string} */(a);\n             diffs = /** @type {!Array.<!diff_match_patch.Diff>} */(opt_b);\n         } else if (typeof a == 'string' && typeof opt_b == 'string' &&\n                    opt_c && typeof opt_c == 'object') {\n             // Method 4: text1, text2, diffs\n             // text2 is not used.\n             text1 = /** @type {string} */(a);\n             diffs = /** @type {!Array.<!diff_match_patch.Diff>} */(opt_c);\n         } else {\n             throw new Error('Unknown call format to patch_make.');\n         }\n\n         if (diffs.length === 0) {\n             return [];  // Get rid of the null case.\n         }\n         var patches = [];\n         var patch = new diff_match_patch.patch_obj();\n         var patchDiffLength = 0;  // Keeping our own length var is faster in JS.\n         var char_count1 = 0;  // Number of characters into the text1 string.\n         var char_count2 = 0;  // Number of characters into the text2 string.\n         // Start with text1 (prepatch_text) and apply the diffs until we arrive at\n         // text2 (postpatch_text).  We recreate the patches one by one to determine\n         // context info.\n         var prepatch_text = text1;\n         var postpatch_text = text1;\n         for (var x = 0; x < diffs.length; x++) {\n             var diff_type = diffs[x][0];\n             var diff_text = diffs[x][1];\n\n             if (!patchDiffLength && diff_type !== DIFF_EQUAL) {\n                 // A new patch starts here.\n                 patch.start1 = char_count1;\n                 patch.start2 = char_count2;\n             }\n\n             switch (diff_type) {\n             case DIFF_INSERT:\n                 patch.diffs[patchDiffLength++] = diffs[x];\n                 patch.length2 += diff_text.length;\n                 postpatch_text = postpatch_text.substring(0, char_count2) + diff_text +\n                     postpatch_text.substring(char_count2);\n                 break;\n             case DIFF_DELETE:\n                 patch.length1 += diff_text.length;\n                 patch.diffs[patchDiffLength++] = diffs[x];\n                 postpatch_text = postpatch_text.substring(0, char_count2) +\n                     postpatch_text.substring(char_count2 +\n                                              diff_text.length);\n                 break;\n             case DIFF_EQUAL:\n                 if (diff_text.length <= 2 * this.Patch_Margin &&\n                     patchDiffLength && diffs.length != x + 1) {\n                     // Small equality inside a patch.\n                     patch.diffs[patchDiffLength++] = diffs[x];\n                     patch.length1 += diff_text.length;\n                     patch.length2 += diff_text.length;\n                 } else if (diff_text.length >= 2 * this.Patch_Margin) {\n                     // Time for a new patch.\n                     if (patchDiffLength) {\n                         this.patch_addContext_(patch, prepatch_text);\n                         patches.push(patch);\n                         patch = new diff_match_patch.patch_obj();\n                         patchDiffLength = 0;\n                         // Unlike Unidiff, our patch lists have a rolling context.\n                         // http://code.google.com/p/google-diff-match-patch/wiki/Unidiff\n                         // Update prepatch text & pos to reflect the application of the\n                         // just completed patch.\n                         prepatch_text = postpatch_text;\n                         char_count1 = char_count2;\n                     }\n                 }\n                 break;\n             }\n\n             // Update the current character count.\n             if (diff_type !== DIFF_INSERT) {\n                 char_count1 += diff_text.length;\n             }\n             if (diff_type !== DIFF_DELETE) {\n                 char_count2 += diff_text.length;\n             }\n         }\n         // Pick up the leftover patch if not empty.\n         if (patchDiffLength) {\n             this.patch_addContext_(patch, prepatch_text);\n             patches.push(patch);\n         }\n\n         return patches;\n     };\n\n\n     /**\n      * Given an array of patches, return another array that is identical.\n      * @param {!Array.<!diff_match_patch.patch_obj>} patches Array of Patch objects.\n      * @return {!Array.<!diff_match_patch.patch_obj>} Array of Patch objects.\n      */\n     diff_match_patch.prototype.patch_deepCopy = function(patches) {\n         // Making deep copies is hard in JavaScript.\n         var patchesCopy = [];\n         for (var x = 0; x < patches.length; x++) {\n             var patch = patches[x];\n             var patchCopy = new diff_match_patch.patch_obj();\n             patchCopy.diffs = [];\n             for (var y = 0; y < patch.diffs.length; y++) {\n                 patchCopy.diffs[y] = patch.diffs[y].slice();\n             }\n             patchCopy.start1 = patch.start1;\n             patchCopy.start2 = patch.start2;\n             patchCopy.length1 = patch.length1;\n             patchCopy.length2 = patch.length2;\n             patchesCopy[x] = patchCopy;\n         }\n         return patchesCopy;\n     };\n\n\n     /**\n      * Merge a set of patches onto the text.  Return a patched text, as well\n      * as a list of true/false values indicating which patches were applied.\n      * @param {!Array.<!diff_match_patch.patch_obj>} patches Array of Patch objects.\n      * @param {string} text Old text.\n      * @return {!Array.<string|!Array.<boolean>>} Two element Array, containing the\n      *      new text and an array of boolean values.\n      */\n     diff_match_patch.prototype.patch_apply = function(patches, text) {\n         if (patches.length == 0) {\n             return [text, []];\n         }\n\n         // Deep copy the patches so that no changes are made to originals.\n         patches = this.patch_deepCopy(patches);\n\n         var nullPadding = this.patch_addPadding(patches);\n         text = nullPadding + text + nullPadding;\n\n         this.patch_splitMax(patches);\n         // delta keeps track of the offset between the expected and actual location\n         // of the previous patch.  If there are patches expected at positions 10 and\n         // 20, but the first patch was found at 12, delta is 2 and the second patch\n         // has an effective expected position of 22.\n         var delta = 0;\n         var results = [];\n         for (var x = 0; x < patches.length; x++) {\n             var expected_loc = patches[x].start2 + delta;\n             var text1 = this.diff_text1(patches[x].diffs);\n             var start_loc;\n             var end_loc = -1;\n             if (text1.length > this.Match_MaxBits) {\n                 // patch_splitMax will only provide an oversized pattern in the case of\n                 // a monster delete.\n                 start_loc = this.match_main(text, text1.substring(0, this.Match_MaxBits),\n                                             expected_loc);\n                 if (start_loc != -1) {\n                     end_loc = this.match_main(text,\n                                               text1.substring(text1.length - this.Match_MaxBits),\n                                               expected_loc + text1.length - this.Match_MaxBits);\n                     if (end_loc == -1 || start_loc >= end_loc) {\n                         // Can't find valid trailing context.  Drop this patch.\n                         start_loc = -1;\n                     }\n                 }\n             } else {\n                 start_loc = this.match_main(text, text1, expected_loc);\n             }\n             if (start_loc == -1) {\n                 // No match found.  :(\n                 results[x] = false;\n                 // Subtract the delta for this failed patch from subsequent patches.\n                 delta -= patches[x].length2 - patches[x].length1;\n             } else {\n                 // Found a match.  :)\n                 results[x] = true;\n                 delta = start_loc - expected_loc;\n                 var text2;\n                 if (end_loc == -1) {\n                     text2 = text.substring(start_loc, start_loc + text1.length);\n                 } else {\n                     text2 = text.substring(start_loc, end_loc + this.Match_MaxBits);\n                 }\n                 if (text1 == text2) {\n                     // Perfect match, just shove the replacement text in.\n                     text = text.substring(0, start_loc) +\n                         this.diff_text2(patches[x].diffs) +\n                         text.substring(start_loc + text1.length);\n                 } else {\n                     // Imperfect match.  Run a diff to get a framework of equivalent\n                     // indices.\n                     var diffs = this.diff_main(text1, text2, false);\n                     if (text1.length > this.Match_MaxBits &&\n                         this.diff_levenshtein(diffs) / text1.length >\n                         this.Patch_DeleteThreshold) {\n                         // The end points match, but the content is unacceptably bad.\n                         results[x] = false;\n                     } else {\n                         this.diff_cleanupSemanticLossless(diffs);\n                         var index1 = 0;\n                         var index2;\n                         for (var y = 0; y < patches[x].diffs.length; y++) {\n                             var mod = patches[x].diffs[y];\n                             if (mod[0] !== DIFF_EQUAL) {\n                                 index2 = this.diff_xIndex(diffs, index1);\n                             }\n                             if (mod[0] === DIFF_INSERT) {  // Insertion\n                                 text = text.substring(0, start_loc + index2) + mod[1] +\n                                     text.substring(start_loc + index2);\n                             } else if (mod[0] === DIFF_DELETE) {  // Deletion\n                                 text = text.substring(0, start_loc + index2) +\n                                     text.substring(start_loc + this.diff_xIndex(diffs,\n                                                                                 index1 + mod[1].length));\n                             }\n                             if (mod[0] !== DIFF_DELETE) {\n                                 index1 += mod[1].length;\n                             }\n                         }\n                     }\n                 }\n             }\n         }\n         // Strip the padding off.\n         text = text.substring(nullPadding.length, text.length - nullPadding.length);\n         return [text, results];\n     };\n\n\n     /**\n      * Add some padding on text start and end so that edges can match something.\n      * Intended to be called only from within patch_apply.\n      * @param {!Array.<!diff_match_patch.patch_obj>} patches Array of Patch objects.\n      * @return {string} The padding string added to each side.\n      */\n     diff_match_patch.prototype.patch_addPadding = function(patches) {\n         var paddingLength = this.Patch_Margin;\n         var nullPadding = '';\n         for (var x = 1; x <= paddingLength; x++) {\n             nullPadding += String.fromCharCode(x);\n         }\n\n         // Bump all the patches forward.\n         for (var x = 0; x < patches.length; x++) {\n             patches[x].start1 += paddingLength;\n             patches[x].start2 += paddingLength;\n         }\n\n         // Add some padding on start of first diff.\n         var patch = patches[0];\n         var diffs = patch.diffs;\n         if (diffs.length == 0 || diffs[0][0] != DIFF_EQUAL) {\n             // Add nullPadding equality.\n             diffs.unshift([DIFF_EQUAL, nullPadding]);\n             patch.start1 -= paddingLength;  // Should be 0.\n             patch.start2 -= paddingLength;  // Should be 0.\n             patch.length1 += paddingLength;\n             patch.length2 += paddingLength;\n         } else if (paddingLength > diffs[0][1].length) {\n             // Grow first equality.\n             var extraLength = paddingLength - diffs[0][1].length;\n             diffs[0][1] = nullPadding.substring(diffs[0][1].length) + diffs[0][1];\n             patch.start1 -= extraLength;\n             patch.start2 -= extraLength;\n             patch.length1 += extraLength;\n             patch.length2 += extraLength;\n         }\n\n         // Add some padding on end of last diff.\n         patch = patches[patches.length - 1];\n         diffs = patch.diffs;\n         if (diffs.length == 0 || diffs[diffs.length - 1][0] != DIFF_EQUAL) {\n             // Add nullPadding equality.\n             diffs.push([DIFF_EQUAL, nullPadding]);\n             patch.length1 += paddingLength;\n             patch.length2 += paddingLength;\n         } else if (paddingLength > diffs[diffs.length - 1][1].length) {\n             // Grow last equality.\n             var extraLength = paddingLength - diffs[diffs.length - 1][1].length;\n             diffs[diffs.length - 1][1] += nullPadding.substring(0, extraLength);\n             patch.length1 += extraLength;\n             patch.length2 += extraLength;\n         }\n\n         return nullPadding;\n     };\n\n\n     /**\n      * Look through the patches and break up any which are longer than the maximum\n      * limit of the match algorithm.\n      * Intended to be called only from within patch_apply.\n      * @param {!Array.<!diff_match_patch.patch_obj>} patches Array of Patch objects.\n      */\n     diff_match_patch.prototype.patch_splitMax = function(patches) {\n         var patch_size = this.Match_MaxBits;\n         for (var x = 0; x < patches.length; x++) {\n             if (patches[x].length1 <= patch_size) {\n                 continue;\n             }\n             var bigpatch = patches[x];\n             // Remove the big old patch.\n             patches.splice(x--, 1);\n             var start1 = bigpatch.start1;\n             var start2 = bigpatch.start2;\n             var precontext = '';\n             while (bigpatch.diffs.length !== 0) {\n                 // Create one of several smaller patches.\n                 var patch = new diff_match_patch.patch_obj();\n                 var empty = true;\n                 patch.start1 = start1 - precontext.length;\n                 patch.start2 = start2 - precontext.length;\n                 if (precontext !== '') {\n                     patch.length1 = patch.length2 = precontext.length;\n                     patch.diffs.push([DIFF_EQUAL, precontext]);\n                 }\n                 while (bigpatch.diffs.length !== 0 &&\n                        patch.length1 < patch_size - this.Patch_Margin) {\n                     var diff_type = bigpatch.diffs[0][0];\n                     var diff_text = bigpatch.diffs[0][1];\n                     if (diff_type === DIFF_INSERT) {\n                         // Insertions are harmless.\n                         patch.length2 += diff_text.length;\n                         start2 += diff_text.length;\n                         patch.diffs.push(bigpatch.diffs.shift());\n                         empty = false;\n                     } else if (diff_type === DIFF_DELETE && patch.diffs.length == 1 &&\n                                patch.diffs[0][0] == DIFF_EQUAL &&\n                                diff_text.length > 2 * patch_size) {\n                         // This is a large deletion.  Let it pass in one chunk.\n                         patch.length1 += diff_text.length;\n                         start1 += diff_text.length;\n                         empty = false;\n                         patch.diffs.push([diff_type, diff_text]);\n                         bigpatch.diffs.shift();\n                     } else {\n                         // Deletion or equality.  Only take as much as we can stomach.\n                         diff_text = diff_text.substring(0,\n                                                         patch_size - patch.length1 - this.Patch_Margin);\n                         patch.length1 += diff_text.length;\n                         start1 += diff_text.length;\n                         if (diff_type === DIFF_EQUAL) {\n                             patch.length2 += diff_text.length;\n                             start2 += diff_text.length;\n                         } else {\n                             empty = false;\n                         }\n                         patch.diffs.push([diff_type, diff_text]);\n                         if (diff_text == bigpatch.diffs[0][1]) {\n                             bigpatch.diffs.shift();\n                         } else {\n                             bigpatch.diffs[0][1] =\n                                 bigpatch.diffs[0][1].substring(diff_text.length);\n                         }\n                     }\n                 }\n                 // Compute the head context for the next patch.\n                 precontext = this.diff_text2(patch.diffs);\n                 precontext =\n                     precontext.substring(precontext.length - this.Patch_Margin);\n                 // Append the end context for this patch.\n                 var postcontext = this.diff_text1(bigpatch.diffs)\n                     .substring(0, this.Patch_Margin);\n                 if (postcontext !== '') {\n                     patch.length1 += postcontext.length;\n                     patch.length2 += postcontext.length;\n                     if (patch.diffs.length !== 0 &&\n                         patch.diffs[patch.diffs.length - 1][0] === DIFF_EQUAL) {\n                         patch.diffs[patch.diffs.length - 1][1] += postcontext;\n                     } else {\n                         patch.diffs.push([DIFF_EQUAL, postcontext]);\n                     }\n                 }\n                 if (!empty) {\n                     patches.splice(++x, 0, patch);\n                 }\n             }\n         }\n     };\n\n\n     /**\n      * Take a list of patches and return a textual representation.\n      * @param {!Array.<!diff_match_patch.patch_obj>} patches Array of Patch objects.\n      * @return {string} Text representation of patches.\n      */\n     diff_match_patch.prototype.patch_toText = function(patches) {\n         var text = [];\n         for (var x = 0; x < patches.length; x++) {\n             text[x] = patches[x];\n         }\n         return text.join('');\n     };\n\n\n     /**\n      * Parse a textual representation of patches and return a list of Patch objects.\n      * @param {string} textline Text representation of patches.\n      * @return {!Array.<!diff_match_patch.patch_obj>} Array of Patch objects.\n      * @throws {!Error} If invalid input.\n      */\n     diff_match_patch.prototype.patch_fromText = function(textline) {\n         var patches = [];\n         if (!textline) {\n             return patches;\n         }\n         var text = textline.split('\\n');\n         var textPointer = 0;\n         var patchHeader = /^@@ -(\\d+),?(\\d*) \\+(\\d+),?(\\d*) @@$/;\n         while (textPointer < text.length) {\n             var m = text[textPointer].match(patchHeader);\n             if (!m) {\n                 throw new Error('Invalid patch string: ' + text[textPointer]);\n             }\n             var patch = new diff_match_patch.patch_obj();\n             patches.push(patch);\n             patch.start1 = parseInt(m[1], 10);\n             if (m[2] === '') {\n                 patch.start1--;\n                 patch.length1 = 1;\n             } else if (m[2] == '0') {\n                 patch.length1 = 0;\n             } else {\n                 patch.start1--;\n                 patch.length1 = parseInt(m[2], 10);\n             }\n\n             patch.start2 = parseInt(m[3], 10);\n             if (m[4] === '') {\n                 patch.start2--;\n                 patch.length2 = 1;\n             } else if (m[4] == '0') {\n                 patch.length2 = 0;\n             } else {\n                 patch.start2--;\n                 patch.length2 = parseInt(m[4], 10);\n             }\n             textPointer++;\n\n             while (textPointer < text.length) {\n                 var sign = text[textPointer].charAt(0);\n                 try {\n                     var line = decodeURI(text[textPointer].substring(1));\n                 } catch (ex) {\n                     // Malformed URI sequence.\n                     throw new Error('Illegal escape in patch_fromText: ' + line);\n                 }\n                 if (sign == '-') {\n                     // Deletion.\n                     patch.diffs.push([DIFF_DELETE, line]);\n                 } else if (sign == '+') {\n                     // Insertion.\n                     patch.diffs.push([DIFF_INSERT, line]);\n                 } else if (sign == ' ') {\n                     // Minor equality.\n                     patch.diffs.push([DIFF_EQUAL, line]);\n                 } else if (sign == '@') {\n                     // Start of next patch.\n                     break;\n                 } else if (sign === '') {\n                     // Blank line?  Whatever.\n                 } else {\n                     // WTF?\n                     throw new Error('Invalid patch mode \"' + sign + '\" in: ' + line);\n                 }\n                 textPointer++;\n             }\n         }\n         return patches;\n     };\n\n\n     /**\n      * Class representing one patch operation.\n      * @constructor\n      */\n     diff_match_patch.patch_obj = function() {\n         /** @type {!Array.<!diff_match_patch.Diff>} */\n         this.diffs = [];\n         /** @type {?number} */\n         this.start1 = null;\n         /** @type {?number} */\n         this.start2 = null;\n         /** @type {number} */\n         this.length1 = 0;\n         /** @type {number} */\n         this.length2 = 0;\n     };\n\n\n     /**\n      * Emmulate GNU diff's format.\n      * Header: @@ -382,8 +481,9 @@\n      * Indicies are printed as 1-based, not 0-based.\n      * @return {string} The GNU diff string.\n      */\n     diff_match_patch.patch_obj.prototype.toString = function() {\n         var coords1, coords2;\n         if (this.length1 === 0) {\n             coords1 = this.start1 + ',0';\n         } else if (this.length1 == 1) {\n             coords1 = this.start1 + 1;\n         } else {\n             coords1 = (this.start1 + 1) + ',' + this.length1;\n         }\n         if (this.length2 === 0) {\n             coords2 = this.start2 + ',0';\n         } else if (this.length2 == 1) {\n             coords2 = this.start2 + 1;\n         } else {\n             coords2 = (this.start2 + 1) + ',' + this.length2;\n         }\n         var text = ['@@ -' + coords1 + ' +' + coords2 + ' @@\\n'];\n         var op;\n         // Escape the body of the patch with %xx notation.\n         for (var x = 0; x < this.diffs.length; x++) {\n             switch (this.diffs[x][0]) {\n             case DIFF_INSERT:\n                 op = '+';\n                 break;\n             case DIFF_DELETE:\n                 op = '-';\n                 break;\n             case DIFF_EQUAL:\n                 op = ' ';\n                 break;\n             }\n             text[x + 1] = op + encodeURI(this.diffs[x][1]) + '\\n';\n         }\n         return text.join('').replace(/%20/g, ' ');\n     };\n\n\n     // Export these global variables so that they survive Google's JS compiler.\n     // In a browser, 'this' will be 'window'.\n     // Users of node.js should 'require' the uncompressed version since Google's\n     // JS compiler may break the following exports for non-browser environments.\n     this['diff_match_patch'] = diff_match_patch;\n     this['DIFF_DELETE'] = DIFF_DELETE;\n     this['DIFF_INSERT'] = DIFF_INSERT;\n     this['DIFF_EQUAL'] = DIFF_EQUAL;\n\n     var r = { constructor: this.diff_match_patch, def: new this.diff_match_patch };\n\n     return r;\n\n}).call(new Object);",
 "js_modules/donate.js": "({\n     require: [\"com\", \"user\", \"commands\", \"theme\", 'io'],\n     counter: 0,\n     udb: null,\n\n     BUTTON: '<a href=\"https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=8BQHLUEXVWVQ2&lc=US&item_name=ZVX%20Scripts%20%26%20RPG%20Open%20Source%20Development&item_number=zvx0&currency_code=USD&bn=PP%2dDonationsBF%3abtn_donate_SM%2egif%3aNonHosted\"><img width=\"74\" height=\"21\" title=\"\" alt=\"\" src=\"data:image/gif;base64,R0lGODlhSgAVAPcmAP+sLf7iq/7gpf7ksf7en/+6Tf+vM7+LNv+xOu7bskBedhA+a/+0QN+aLo9/WHBuWxA+aoCQl0BfeXB+f2BhUc+TMn+Jg7+YU76zkZ+HVp6jmX+Nj97Qre+iKo6Xk56gke+yT/63R3+LiTBUdO7Tm1BdXs4HAkBfd+7ZrH+Khs+VON7MomB0fkBgeq6ojf7HbGBze765o87Bnp6hlf/s0M7Do/7Rhb62mjBKWxA7YjBUczBUcv64SmB2gp9+Qs7EqP/89jBTcY6Uif+lNEBedN+dNIBwSa6wov/NgtEQBY6Vjb+OO/7amP++Xf+3RlBpev7UjP/Ti6+QVb++r8+hUs6/mf/05P/CYNEOBc6+lN7Knf7epP+oLH+MjJ6fjVBrfmBmXf/05v/ryf61Rv/ZoCBJbv/it3BoTY6WkP/py//YnyBCX/+vOkBVYP+/Wf63S767qP7WjP65Tf/w2f/FZu/gwv/u0++kMVBsgmB1gP7hqmB4h//uzv7dnv/w2HCAhP7Qf66smf+mLf/boP6/WTBMYf7Jcv+uM//y2yBIba6unv/sz//itv+pNP+yP/7mt/+pJv/15//rzv7pvv/syP/dqv/46v/03//OhP/w0/+/Xv+xOAAzZswAAP+ZMwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACYALAAAAABKABUAAAj/AE0IHGjCk8GDCBMqXMiwocOEBCMONLgoTKSLGC8CAZKxo8ePIEN+tJLGoMSJcyypXMmypcuXMGPKfGnH00lPfi7p3Mmzp8+fQIMKDYrIJkFPYjIpXcq0qdOnUKNKncrHaMFBlLJq3cqVUoSvEaZ0HUuWa52yaClFMeppktu3cONOgsOpbt09cvPqfXsEz96/k6DY9MRjy6PDiBMr9sBJw6MELTj9OBxjgwcOhznESKBhQ4LDnDdoSJBAEacWmH9Y/qy49WEbPAy+MTSgtu3buHtwqlE7EKcuA3SPWLCA9xdOEkYgH4CCuATkaOzOmMFp+AIUuLMP0ENIjsExIWwE/xhPvnx5HZzI3+Ak4gOnPwFWcMoTAP2HABDSyxAhI8CJ9CJwcoN8JwTgnhLmJRjACyGEYJAjDDDwQh8CVGjhhRVyooCFQnDixROcaJHhhpzsMKIAVbCgQBklCqAAJwJ0qEAKLHCSAoYYMuFGhAwYxAYCQDJARxwEFGmkkRhwMkGRJCQCAQlEcFJkFpzAkOSSV5IAQRAuuKAkAVsSYEGVFpSJwZFHAnIFkGwadIgBcMZpQAF01kmnA5w8cIEUhXDiQAEPcJIBCG1wcgGeGRSA6AV5glCCoFRwUkIBjD6gKBgg2EmnE3LKaZAgAIQq6qikUmAXJzkYEeodONSVgw8AmLCqQqyczNoqJ2twskQRdVEAwBl2wUrqsKJyMRgkyCar7LIVHODsActC0mwHyDZbLbTIHtBAB9pC0kC33h5AbbTkIsvWEJukq+667Lbr7rvwxitvuo1Y5UkTmuSr77789uvvvwAHLLAmVgnkCRKYJKzwwgw37PDDEEccccETqVHJxRhnrPHGHHfs8ccck0HxUZ6YIcnJKKNMAw0pt+zyyzDHDDMjJp1E8kM456wzQycFBAA7\" /></a>',\n\n     loadModule: function()\n     {\n         this.script.registerHandler(\"afterLogIn\", this);\n         this.commands.registerCommand(\"donate\", this);\n         this.io.registerConfig(this, {alwaysShowDonate: false});\n         this.udb = new Object;\n     },\n\n\n     afterLogIn: function (src)\n     {\n         if (!this.config.alwaysShowDonate)\n         {\n             if (sys.name(src).toLowerCase() in this.udb && this.udb[sys.name(src).toLowerCase()] < +new Date + 3600*24*3) return;\n\n             this.udb[sys.name(src).toLowerCase()] = +new Date;\n         }\n\n\t if (sys.os(src) == \"android\")\n         {\n             sys.sendHtmlMessage(src, \"<timestamp />Contribute to ZVxScripts & RPG Development! <a href='https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=8BQHLUEXVWVQ2&lc=US&item_name=ZVX%20Scripts%20%26%20RPG%20Open%20Source%20Development&item_number=zvx0&currency_code=USD&bn=PP%2dDonationsBF%3abtn_donate_SM%2egif%3aNonHosted'>[donate with paypal]</a> or use bitcoin: 17Act28nb7vLqkWMDridtz8KjBXpaWXBpA\");\n         } else\n\n         {\n             sys.sendHtmlMessage(src, \"<timestamp />Contribute to ZVxScripts & RPG Development! \" + this.BUTTON + \" or use bitcoin: 17Act28nb7vLqkWMDridtz8KjBXpaWXBpA\");\n         }\n     },\n\n\n     donate:\n     {\n         desc: \"Donate to development!\",\n         perm: function () {return true;},\n\n         code:\n         function (src, cmd, chan)\n         {\n             sys.sendHtmlMessage(src, \"<timestamp />Contribute to ZVxScripts & RPG Development! <a href='https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=8BQHLUEXVWVQ2&lc=US&item_name=ZVX%20Scripts%20%26%20RPG%20Open%20Source%20Development&item_number=zvx0&currency_code=USD&bn=PP%2dDonationsBF%3abtn_donate_SM%2egif%3aNonHosted'>[donate with paypal]</a> or use bitcoin: 17Act28nb7vLqkWMDridtz8KjBXpaWXBpA\", chan);\n         }\n     }\n\n\n\n });",
 "js_modules/download.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n    require: [\"commands\", \"com\", \"util\", \"theme\", \"logs\"]\n    ,\n    loadModule: function (src, cmd, chan)\n    {\n        this.commands.registerCommand(\"download\", this);\n    }\n    ,\n    download:\n    {\n        server: true,\n        \n        desc: \"Download a file.\"\n        ,\n        options:\n        {\n            filename: \"Where to download the file to.\"\n            ,\n            url: \"URL to get the file from.\"\n        }\n        ,\n        perm: function (src, cmd, chan)\n        {\n            return \"DOWNLOAD\" in this.user.groups(src);\n        }\n        ,\n        code: function (src, cmd, chan)\n        {\n            var fname = cmd.flags.filename;\n\n            var url = cmd.flags.url;\n\n            if (!fname || !url)\n            {\n                this.com.message([src], \"Invalid filename or url\", this.theme.WARN);\n                return;\n            }\n\n            if (sys.fileExists(fname) && !cmd.flags.force)\n            {\n                this.com.message([src], \"File already exists, must specifiy --force to overwrite\", this.theme.WARN);\n                return;\n            }\n\n\n            sys.webCall(url, this.util.bind(\n                this,\n                function _webcall_resp_handler_ (data) {\n                    try {\n                        sys.write(fname, data);\n                        this.logs.logMessage(this.logs.INFO, \"Downloaded \" + url + \" and saved to \" + fname);\n                        return;\n                    }\n                    catch (e)\n                    {\n                        print(e.backtracetext);\n                        print(e);\n                    }\n                })\n            );\n        }\n    }\n});\n",
 "js_modules/dump.js": "({\n     require: [\"commands\", \"util\", \"com\", \"theme\"],\n\n\n     loadModule:\n     function()\n     {\n         this.commands.registerCommand(\"coredump\", this);\n     },\n\n\n     coredump:\n     {\n         category: \"system/debug\",\n         perm: \"COREDUMP\",\n         code:\n         function ()\n         {\n             this.com.broadcast(\"Writing core dump to file on next tick, expect lots of lag.\", this.theme.CRITICAL);\n\n             sys.setTimer(this.util.bind(this, this.dump), 200, false);\n         }\n     },\n\n     dump:\n     function()\n     {\n         try {\n             var fname = (+new Date).toString() + \".core\";\n\n             var dtext = this.util.inspect(global, true);\n\n             sys.write(fname, dtext);\n\n             this.com.broadcast(\"Wrote core dump to \" + fname, this.theme.CRITICAL);\n         } catch (e) { scirpt.error(e); }\n     }\n });",
 "js_modules/eval.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n\n     require: [\"com\", \"commands\", \"theme\", \"util\", \"less\", \"io\", \"user\", \"time\", \"text\", 'zsrx'],\n\n     eval:\n     {\n\t mode: \"lazy\",\n         category: \"system/eval\",\n         desc: \"Executes code. Shows the resut.\",\n         perm: \"EVAL\",\n         code: function (src, cmd, chan)\n         {\n             var start = +new Date;\n             try\n             {\n\n                 var r = eval(cmd.input);\n                 var end = +new Date;\n                 var start2 = +new Date;\n                 var result_text = this.text.escapeHTML(this.util.inspect(r, true));\n                 this.less.less(src, \"<b>Exec Time:</b> \" + (this.time.diffToStr(end - start) || \"&lt;1 milisecond\" ) +\n                                \"<br /><b>Serializer Time:</b> \" + (this.time.diffToStr(+new Date-start2) || \"&lt;1 milisecond\")+ \"<br/><b>Result:</b><br/>\" + result_text, true);\n             }\n             catch (e)\n             {\n                 this.com.message([src], e.toString(), this.theme.CRITICAL);\n                 this.com.message([src], e.backtracetext, -1);\n             }\n         }\n     },\n\n     keys:\n     {\n         mode: \"lazy\",\n         category: \"system/eval\",\n         desc: \"Executes code. Shows the keys of the result.\",\n         perm: \"EVAL\",\n         code: function (src, cmd, chan)\n         {\n             var start = +new Date;\n             try\n             {\n\n                 var r = eval(cmd.input);\n                 var end = +new Date;\n                 var start2 = +new Date;\n                 var result_text = this.text.escapeHTML(JSON.stringify(Object.keys(r)));\n                 this.less.less(src, \"<b>Exec Time:</b> \" + (this.time.diffToStr(end - start) || \"&lt;1 milisecond\" ) +\n                                \"<br /><b>Serializer Time:</b> \" + (this.time.diffToStr(+new Date-start2) || \"&lt;1 milisecond\")+ \"<br/><b>Result:</b><br/>\" + result_text, true);\n             }\n             catch (e)\n             {\n                 this.com.message([src], e.toString(), this.theme.CRITICAL);\n                 this.com.message([src], e.backtracetext, -1);\n             }\n         }\n     },\n\n     inspect:\n     {\n         mode: \"strict\",\n         category: \"system/eval\",\n         desc: \"Executes code as postinput. Shows the result, with any options.\",\n         options:\n         {\n             \"depth\": \"How deep to look in the object.\",\n             iter: \"How many times to iterate at maximum.\"//,\n          //   maxtotal: \"How many total properties to look at, at maximum.\"\n         },\n\n         perm: \"EVAL\",\n         code: function (src, cmd, chan)\n         {\n             var start = +new Date;\n             try\n             {\n                 var r = eval(cmd.postinput);\n                 var end = +new Date;\n                 var start2 = +new Date;\n                 var result_text = this.text.escapeHTML(this.util.inspect(r, true, (cmd.flags.depth? +cmd.flags.depth: 4), (cmd.flags.iter? +cmd.flags.iter: 50)));\n                 this.less.less(src, \"<b>Exec Time:</b> \" + (this.time.diffToStr(end - start) || \"&lt;1 milisecond\" ) +\n                                \"<br /><b>Serializer Time:</b> \" + (this.time.diffToStr(+new Date-start2) || \"&lt;1 milisecond\")+ \"<br/><b>Result:</b><br/>\" + result_text, true);\n             }\n             catch (e)\n             {\n                 this.com.message([src], e.toString(), this.theme.CRITICAL);\n                 this.com.message([src], e.backtracetext, -1);\n             }\n         }\n     },\n\n     json:\n     {\n         mode: \"lazy\",\n         category: \"system/eval\",\n         desc: \"Executes code. Shows the result as JSON if possible.\",\n         perm: \"EVAL\",\n         code: function (src, cmd, chan)\n         {\n             var start = +new Date;\n             try\n             {\n                 var r = eval(cmd.input);\n                 var end = +new Date;\n                 var start2 = +new Date;\n                 var result_text = this.text.escapeHTML(this.zsrx.zsrx(r));\n                 this.less.less(src, \"<b>Exec Time:</b> \" + (this.time.diffToStr(end - start) || \"&lt;1 milisecond\" ) +\n                                \"<br /><b>Serializer Time:</b> \" + (this.time.diffToStr(+new Date-start2) || \"&lt;1 milisecond\")+ \"<br/><b>Result:</b><br/>\" + result_text, true);\n             }\n             catch (e)\n             {\n                 this.com.message([src], e.toString(), this.theme.CRITICAL);\n                // this.com.message([src], e.backtracetext, -1);\n             }\n         }\n     },\n\n\n     loadModule: function ()\n     {\n         this.commands.registerCommand(\"eval\", this);\n         this.commands.registerCommand(\"inspect\", this);\n         this.commands.registerCommand(\"keys\", this);\n         this.commands.registerCommand(\"json\", this);\n     }\n });\n",
 "js_modules/gateway.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"security\",  \"com\", \"theme\", \"time\", \"logs\", \"user\", 'util'],\n\n\n     loadModule: function()\n     {\n         this.script.registerHandler(\"beforeLogIn\", this );\n         this.script.registerHandler(\"afterLogIn\", this );\n         this.script.registerHandler(\"beforeLogOut\", this );\n         this.script.registerHandler(\"afterChangeTeam\", this);\n     },\n\n     checkUser: function (src)\n     {\n\n         var banID = this.security.banID(src);\n\n         if (banID)\n         {\n\n             var ban = this.security.database.bans[banID];\n\n\n\n             if (!this.user.hasPerm(src, \"PROTECTED\"))\n             {\n\n\n                 return false;\n             }\n             else\n             {\n                 this.com.message(src, \"Note: Your account is protected, and therefore the ban is void.\");\n             }\n         }\n\n         return true;\n     },\n\n     beforeLogIn: function(src)\n     {\n\n\n         if (! this.checkUser(src))\n         {\n             var banID = this.security.banID(src);\n             var ban = this.security.database.bans[banID];\n             this.com.message(\n                 [src],\n                 \"<hr/>You are banned.<br>\" + this.theme.issuehtml(ban) + \"<hr/>\",\n                 this.theme.CRITICAL,\n                 true\n             );\n             sys.stopEvent();\n             this.logs.logMessage(this.logs.WARN, \"Banned user: \" + sys.name(src) + \" (IP: \" + sys.ip(src) + \") (#: \" + banID + \") tried to log in.\");\n             return;\n         }\n\n\n\n\n         return;\n     },\n\n     afterLogIn: function (src)\n     {\n         var n = sys.name(src);\n         var ip = sys.ip(src);\n         var t = this;\n\n\n         this.logs.logMessage(this.logs.INFO, sys.name(src) + \" logged in. (IP \"+sys.ip(src)+ \")\");\n         sys.hostName(ip, function (r)\n                      {\n                          t.logs.logMessage(t.logs.INFO, \"Recived hostname for (Name \"+n+\")\" + \" (IP \"+ip+ \") (Hostname \"+r+\")\");\n                      }\n                     );\n     },\n\n\n     beforeLogOut: function (src)\n     {\n         this.logs.logMessage(this.logs.INFO, sys.name(src) + \" logged out. (IP \"+sys.ip(src)+\")\");\n     },\n\n     afterChangeTeam: function (src)\n     {\n        // this.profile.registerPlayer(src);\n     }\n });\n",
 "js_modules/greeting.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n    require: [\"com\", \"theme\", \"help_command\", \"uptime\"]\n    ,\n    loadModule: function ()\n    {\n        this.script.registerHandler(\"afterLogIn\", this);\n        this.script.registerHandler(\"beforeLogOut\", this);\n    }\n    ,\n    afterLogIn: function (src)\n    {\n        this.com.broadcast(\"Hello \" + sys.name(src) +\"!\", this.theme.INFO );\n    },\n\n    beforeLogOut: function (src)\n    {\n        this.com.broadcast(\"Goodbye \" + sys.name(src)+ \"!\");\n    }\n});\n",
 "js_modules/groupmod.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"commands\", \"user\", \"theme\", \"com\"],\n\n     loadModule: function ()\n     {\n         this.commands.registerCommand(\"usermod\", this);\n         this.commands.registerCommand(\"permmod\", this);\n         this.commands.registerCommand(\"groupmod\", this);\n     },\n\n     usermod:\n     {\n         mode: \"strict\",\n         server: true,\n\t category: \"administrative\",\n         desc: \"Adds or removes users from MajorGroups.\",\n\n         options:\n         {\n             group: \"What group to add/remove the user(s) to.\",\n             add: \"Add users.\",\n             drop: \"Drop users.\"\n         },\n\n         perm: function (src, cmd, chan)\n         {\n             return this.user.hasPerm(src, \"USERMOD\");\n         },\n\n         code: function (src, cmd, chan)\n         {\n             var x;\n\n             var groups = this.user.groups(src);\n\n             if (!cmd.flags.group)\n             {\n                 this.com.message(src, \"Include a --group=<group> option.\", this.theme.WARN);\n                 return;\n             }\n\n             if (!this.user.majorGroupExists(cmd.flags.group))\n             {\n                 this.com.message(src, \"Group does not exist...\", this.theme.WARN);\n                 return;\n             }\n\n             if (cmd.flags.add && !cmd.flags.drop)\n             {\n                 if (! this.user.hasPerm(src, \"USERMOD[\" + cmd.flags.group.toUpperCase() + \"]\"))\n                 {\n                     this.com.message(src, \"You don't have permission to manage that group.\");\n                     return;\n                 }\n\n                 for (x in cmd.args)\n                 {\n                     if (sys.dbRegistered(cmd.args[x]))\n                     {\n                         var lname = cmd.args[x].toLowerCase();\n\n                         if (this.user.majorGroupAddMemberName(cmd.flags.group, cmd.args[x]))\n                         {\n                             this.com.broadcast(this.user.name(src) + \" added \" + cmd.args[x] + \" to the \" +  cmd.flags.group  + \" group.\", this.theme.INFO);\n                         }\n                         else\n                         {\n                             this.com.message(src, \"User is already in that group.\");\n                         }\n                     } else this.com.message(src, \"Unregistered users are uneligible for group membership.\", this.theme.WARN);\n                 }\n             }\n             else if (!cmd.flags.add && cmd.flags.drop)\n             {\n                 if (! this.user.hasPerm(src, \"USERMOD[\" + cmd.flags.group.toUpperCase() + \"]\"))\n                 {\n                     this.com.message(src, \"You don't have permission to manage that group.\", this.theme.WARN);\n                     return;\n                 }\n\n                 for (x in cmd.args)\n                 {\n                     if (sys.dbRegistered(cmd.args[x]))\n                     {\n                         var lname = cmd.args[x].toLowerCase();\n\n                         if (this.user.majorGroupDropMemberName(cmd.flags.group, cmd.args[x]))\n                         {\n                             this.com.broadcast(this.user.name(src) + \" removed \" + cmd.args[x] + \" from the \" +  cmd.flags.group  + \" group.\", this.theme.INFO);\n                         }\n                         else\n                         {\n                             this.com.message(src, \"User not in that group.\");\n                         }\n                     } else this.com.message(src, \"Unregistered users are uneligible for group membership.\", this.theme.WARN);\n                 }\n             }\n         }\n     },\n\n     permmod:\n     {\n         mode: \"strict\",\n         server: true,\n         category: \"administrative\",\n         desc: \"Modifies MinorGroups directly. Normally you will want to use MajorGroups instead of this command. As each change is manual, this command can make your server difficult to manage.\",\n\n         perm: function (src, cmd, chan)\n         {\n             return this.user.hasPerm(src, \"PERMMOD\");\n         },\n\n         code: function (src, cmd, chan)\n         {\n             var x;\n\n             var groups = this.user.groups(src);\n\n             if (!cmd.flags.perm)\n             {\n                 this.com.message(src, \"Include a --perm=<permgroup> option.\", this.theme.WARN);\n                 return;\n             }\n\n             if (cmd.flags.add && !cmd.flags.drop)\n             {\n                 if (! this.user.hasPerm(src, \"PERMMOD[\" + cmd.flags.perm.toUpperCase() + \"]\"))\n                 {\n                     this.com.message(src, \"You don't have permission to manage that group.\");\n                     return;\n                 }\n\n                 for (x in cmd.args)\n                 {\n                     if (sys.dbRegistered(cmd.args[x]))\n                     {\n                         var lname = cmd.args[x].toLowerCase();\n\n                         this.user.database.usergroups[lname] = this.user.database.usergroups[lname] || [];\n\n                         var a = this.user.database.usergroups[lname];\n\n\n                         if (a.indexOf(cmd.flags.perm) === -1)\n                         {\n                             a.push(cmd.flags.perm);\n                             this.com.broadcast(this.user.name(src) + \" added \" + cmd.args[x] + \" to the \" +  cmd.flags.perm  + \" permission group.\", this.theme.INFO);\n                         }\n                         else\n                         {\n                             this.com.message(src, \"User is already in that group.\");\n                         }\n                     } else this.com.message(src, \"Unregistered users are uneligible for group membership.\", this.theme.WARN);\n                 }\n             }\n             else if (!cmd.flags.add && cmd.flags.drop)\n             {\n                 if (! this.user.hasPerm(src, \"PERMMOD[\" + cmd.flags.perm.toUpperCase() + \"]\"))\n                 {\n                     this.com.message(src, \"You don't have permission to manage that minorgroup.\", this.theme.WARN);\n                     return;\n                 }\n\n                 for (x in cmd.args)\n                 {\n                     if (sys.dbRegistered(cmd.args[x]))\n                     {\n                         var lname = cmd.args[x].toLowerCase();\n\n                         this.user.database.usergroups[lname] = this.user.database.usergroups[lname] || [];\n\n                         var a = this.user.database.usergroups[lname];\n\n                         if (a.indexOf(cmd.flags.perm) !== -1)\n                         {\n                             a.splice(a.indexOf(cmd.flags.perm), 1);\n                             this.com.broadcast(this.user.name(src) + \" removed \" + cmd.args[x] + \" from the \" +  cmd.flags.perm  + \" permission group.\", this.theme.INFO);\n                         }\n                         else\n                         {\n                             this.com.message(src, \"User is not in that group.\", this.theme.WARN);\n                         }\n                     } else this.com.message(src, \"Unregistered users are uneligible for group membership.\", this.theme.WARN);\n                 }\n             }\n         }\n     },\n\n\n     groupmod:\n     {\n         desc: \"Modifies user groups\",\n         options:\n         {\n             group: \"Name of group to modify\",\n             create: \"Creates group.\",\n             \"delete\": \"Deletes group.\",\n             addperms: \"Add permissions, comma separated.\",\n             dropperms: \"Drop permissions, comma separated.\",\n             inherits: \"Set inheritance, comma separated.\",\n             add: \"Add arguments as users of the group.\",\n             drop: \"Remove arguments as users from the group.\"\n         },\n         perm: \"GROUPMOD\",\n         category: \"administrative\",\n         code: function (src, cmd, chan)\n         {\n             if (!cmd.flags.group)\n             {\n                 this.com.message(src, \"Must specify group option.\");\n                 return;\n             }\n\n             var group = cmd.flags.group;\n\n\n\n             if (!this.user.majorGroupExists(group))\n             {\n                 if (!cmd.flags.create)\n                 {\n                     this.com.message(src, \"Group does not exist.\");\n                     return;\n                 }\n                 else\n                 {\n                     this.user.createMajorGroup(group);\n                     this.com.broadcast(this.user.name(src) + \" created the \" + group + \" group!\");\n                 }\n             }\n             else if (cmd.flags[\"delete\"])\n             {\n                 this.user.deleteMajorGroup(group);\n                 this.com.broadcast(this.user.name(src) + \" deleted the \" + group + \" group!\");\n                 return;\n             }\n\n             if (cmd.flags.addperms)\n             {\n                 this.com.broadcast(this.user.name(src) + \" modified the \" + group + \" group by adding permissions: \" + cmd.flags.addperms);\n                 this.user.majorGroupAddPerms(group, cmd.flags.addperms.split(/,/g));\n             }\n\n             if (cmd.flags.dropperms)\n             {\n                 this.com.broadcast(this.user.name(src) + \" modified the \" + group + \" group by dropping permissions: \" + cmd.flags.dropperms);\n                 this.user.majorGroupDropPerms(group, cmd.flags.dropperms.split(/,/g));\n             }\n\n\n             if (cmd.flags.inherits)\n             {\n                 this.com.broadcast(this.user.name(src) + \" modified the \" + group + \" group by setting the inhertance prototype to: \" + cmd.flags.inherits);\n                 this.user.majorGroupInheritsSet(group, cmd.flags.inherits.split(/,/g));\n             }\n\n             if (cmd.flags.add)\n             {\n                 for (var x in cmd.args)\n                 {\n                     if (this.user.majorGroupAddMemberName(group, cmd.args[x]))\n                     {\n                         this.com.broadcast(this.user.name(src) + \" added \" + this.user.nameToProper(cmd.args[x]) + \" to the \" + group + \" group!\");\n                     }\n                 }\n             }\n\n             if (cmd.flags.drop)\n             {\n                 for (var x in cmd.args)\n                 {\n                     if (this.user.majorGroupDropMemeberName(group, cmd.args[x]))\n                     {\n                         this.com.broadcast(this.user.name(src) + \" removed \" + this.user.nameToProper(cmd.args[x]) + \" from the \" + group + \" group!\");\n                     }\n                 }\n             }\n\n\n\n         }\n     }\n\n });",
 "js_modules/help.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"com\", \"theme\", \"chat\", \"util\", \"commands\", \"text\", \"parsecommand\", \"user\"],\n\n     loadModule: function ()\n     {\n         this.commands.registerCommand(\"help\", this);\n         this.topics = new Object;\n     },\n\n     topics: null,\n\n     help:\n     {\n         category: \"basic\",\n         desc: \"Type /help <command name> for help with a command, or /help <topic> for other things(e.g. /help source).\",\n\n         examples:\n         [\n             [\"source\",\"Shows source code information\"],\n             [\"setauth\", \"Shows help for /setauth\"]\n         ],\n\n\n         perm: function (src)\n         {\n             return true;\n         },\n\n\n         code: function (src, cmd, chan)\n         {\n             var topic = String(cmd.input).toLowerCase();\n\n             if (cmd.input == \"\" || !cmd.input)\n             {\n                 this.com.message(src, \"Please enter (/help <topic>), example topics: commands, script, source, administration, <command name>.\", this.theme.INFO);\n                 return;\n             }\n\n\n\n             if (topic.match(/scripts?|sources?(?:code)?|licenses?|a?gpl/i))\n             {\n                 this.com.message(\n                     src,\n\n                    \"<hr/><b>\" + this.text.escapeHTML(\n                         [\n                             \"Scripts Copyright (C) 2013  Ryan P. Nicholl, aka \\\"ArchZombie\\\" / \\\"ArchZombie0x\\\", <archzombielord@gmail.com>\",\n\n                             \"This program is free software: you can redistribute it and/or modify\",\n                             \"it under the terms of the GNU Affero General Public License as\",\n                             \"published by the Free Software Foundation, either version 3 of the\",\n                             \"License, or (at your option) any later version.\",\n                             \"\",\n                             \"This program is distributed in the hope that it will be useful,\",\n                             \"but WITHOUT ANY WARRANTY; without even the implied warranty of\",\n                             \"MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\",\n                             \"See the GNU Affero General Public License for more details.\",\n                             \"\",\n                             \"You should have received a copy of the GNU Affero General Public License\",\n                             \"along with this program.  If not, see <http://www.gnu.org/licenses/>.\"\n                         ].join(\"\\n\")) + \"</b><hr/>\" +\n\n                     \"Source code may be available at <a href='https://github.com/ArchZombie/zvxscripts'>https://github.com/ArchZombie/zvxscripts</a>, or in the following .ZIP file: \" +\n                         \"<a href='https://github.com/ArchZombie/zvxscripts/archive/master.zip'>https://github.com/ArchZombie/zvxscripts/archive/master.zip</a>.<br/><br/>\" +\n                         \"If the source code is modified but this license notice is not updated, you may be able to get the source using /getsource.<br/>\"+\n                         \"Report license violations to <a href='mailto:archzombielord@gmail.com'>&lt;archzombielord@gmail.com&gt;</a>.<hr/>\" +\n\n                         \"Using ZScript Framework v\" + (this.script.version ? this.script.version : \"BETA-1.0.0\"),\n\n                     this.theme.INFO, // theme\n\n                     true // html\n\n                 );\n             }\n\n             else if (topic in this.commands.commands_db)\n             {\n\n                 var canuse = this.commands.commandPerm(src, {name:topic, args: [], flags:{}}, chan);\n\n                 var str = \"<b>Command \" + this.commands.commands_db[topic].name + \":</b><br/>\" +\n                     \"<b>Permission:</b> \" +(canuse?\"yes\":\"<font color=red><b>no</b></font>\")+\"<br/>\"+\n                     \"<b>Description:</b> \" + (this.commands.commands_db[topic].desc?\" \"+this.commands.commands_db[topic].desc:\"n/a\")+\"<br/>\"+\n                     \"<b>Options:</b> \";\n\n                 if (this.commands.commands_db[topic].options)\n                 {\n                     var options = this.commands.commands_db[topic].options;\n\n                     for (var x2 in options)\n                     {\n                         str += (\"<br/>&nbsp;&nbsp;&nbsp;&nbsp;<em>\" + this.text.escapeHTML(x2) + \"</em>&nbsp;&nbsp;&nbsp;&nbsp;\" + this.text.escapeHTML(options[x2]));\n                     }\n                 }\n                 else\n                 {\n                     str += \"<i>none</i>\";\n                 }\n\n                 function estring(ex)\n                 {\n                     if (typeof ex == \"string\") return ex;\n\n                     return this.parsecommand.commandUnParsers[this.user.userConfig(src).commandParser](ex);\n\n                 }\n\n                 if (this.commands.commands_db[topic].examples)\n\n                 {\n                     str += \"<br/><b>Examples:</b>\";\n\n\n\n                     for (x2 in this.commands.commands_db[topic].examples) str += (\"<br/>\" + this.text.escapeHTML(\"    /\" + topic + \" \" + estring.call(this, this.commands.commands_db[topic].examples[x2][0]) +\"\\n        \" + this.commands.commands_db[topic].examples[x2][1]));\n\n                 }\n\n                 this.com.message(src, str, this.theme.INFO, true);\n             }\n\n         }\n     }\n\n\n });\n",
 "js_modules/info.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"com\", \"text\", \"commands\", \"theme\", \"logs\", \"user\"],\n\n     info:\n     {\n         server: true,\n         category: \"security\",\n         options:\n         {\n             group: \"Take info about groups instead of users.\"\n         },\n         desc: \"Shows information about users/groups\",\n         perm: \"INFO\",\n         code: function (src, cmd, chan)\n         {\n             var names = cmd.args, x, m = [];\n\n\n             var se_group_perm = this.user.hasPerm(src, \"INFO[PERMS]\");\n             var mj_group_perm = this.user.hasPerm(src, \"INFO[GROUPS]\");\n             var auth_perm = this.user.hasPerm(src, \"INFO[AUTH]\");\n             var ip_perm = this.user.hasPerm(src, \"INFO[IP]\");\n\n             if (cmd.flags.group)\n             {\n                 if (!mj_group_perm)\n                 {\n                     return { status: this.commands.PERMISSION_ERROR, perm: \"INFO[GROUPS]\"};\n                 }\n\n                 if (Object.keys(names).length === 0)\n                 {\n                     names = Object.keys(this.user.database.majorgroupinfo);\n                 }\n                 for (x in names)\n                 {\n                     var g = this.user.getGroup(names[x]);\n\n                     m.push(\"<b>Info about group: </b>\" + names[x]);\n\n                     if (!g) {m.push(\"<i>Does not exist.</i>\"); continue;}\n\n\n                     if (! (g.name in {\"User\": null, \"Registered\": null} )) m.push(\"Members: \" + g.members.join(\", \"));\n                     if (se_group_perm)\n                     {\n                         m.push(\"Permissions: </b>\" + g.perms.join(\", \"));\n                         m.push(\"Inherits: </b>\" + g.inherits.join(\", \"));\n                     }\n\n                 }\n             }\n             else\n             {\n\n\n                 for (x in names)\n                 {\n                     m.push(\"<b>Info about user: \" + names[x] +\"</b>\");\n                     if (auth_perm) m.push(\"Auth level: \" + this.user.nameAuth(names[x]));\n                     if (ip_perm) m.push(\"IP Address: \" + sys.dbIp(names[x]));\n                     if (mj_group_perm) m.push(\"Major Groups: \" + Object.keys(this.user.nameMajorGroups(names[x])).join (\", \") + \".\");\n                     if (se_group_perm) m.push(\"Permissions: \" + Object.keys(this.user.nameGroups(names[x])));\n                 }\n\n\n             }\n\n             this.com.message([src], \"<br/>\"+m.join(\"<br/>\"), this.theme.INFO, true, chan);\n         }\n     },\n\n     loadModule: function()\n     {\n         this.commands.registerCommand(\"info\", this);\n     }\n });\n",
 "js_modules/interceptor.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n\n     require: [\"commands\"],\n\n     beforePlayerBan: function (src, dest)\n     {\n         sys.stopEvent();\n\n         this.commands.tryCommand(src, {name: \"ban\", args: [sys.name(dest)], flags: {reason: \"Banned via GUI\"} }, sys.channelsOfPlayer(src)[0]);\n\n     },\n\n     beforePlayerKick: function (src, dest)\n     {\n         sys.stopEvent();\n\n         this.commands.tryCommand(src, {name: \"kick\", args: [sys.name(dest)], flags: {reason: \"Kicked via GUI\"} }, sys.channelsOfPlayer(src)[0]);\n\n     },\n\n\n     loadModule: function ()\n     {\n         this.script.registerHandler(\"beforePlayerKick\", this);\n         this.script.registerHandler(\"beforePlayerBan\", this);\n\n     }\n });",
 "js_modules/io.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** Implements I/O layer\n * @name io\n * @memberOf script.modules\n * @augments Module\n * @namespace\n * */\n/** @scope script.modules.io */\n({\n     require: [\"dmp\", \"logs\", \"util\", \"zsrx\", \"zjdata\", 'constdata'],\n\n     /** When database is opened */\n     OPEN: 1,\n     /** When database is closed */\n     CLOSE: 2,\n     /** On database commit */\n     COMMIT: 3,\n     /** On database sync */\n     SYNC: 4,\n     /** On databse backup */\n     BACKUP: 5,\n     /** On database purge */\n     PURGE: 6,\n     /** On database mark */\n     MARK: 7,\n\n     // DB types\n     IODB: 1,\n     IOCFG: 2,\n\n     /** Object that contains all databases\n      * @type {Object}\n      */\n     openDBs: null,\n\n     /** Object that stores configuration objects. */\n     configs: null,\n\n     /** Object that stores configuration schemas. */\n     schemas: null,\n\n     unloadModule: function ()\n     {\n         for (var x in this.openDBs)\n         {\n            this.closeDB(x);\n         }\n     },\n\n\n\n     loadModule: function ()\n     {\n         if (!sys.fileExists(\"js_databases\")) sys.mkdir(\"js_databases\");\n         this.openDBs = new Object;\n         this.configs = new Object;\n         this.script.registerHandler(\"step\", this);\n\n\n\n         this.configs.io = this.openDB(\"io.config\");\n\n         this.config = this.configs.io;\n\n\n         if (!this.configs.io.autosave) this.configs.io.autosave = 3600000;\n         if (!this.configs.io.autosavemethod) this.configs.io.autosavemethod = \"commit\";\n\n         this.registerIOWatcher = this.util.generateRegistor(this, this.util.UNARY_REGISTOR, \"IOWatchers\");\n\n\n     },\n\n     /** Registers the module's module.config property.\n      * @param module The \"this\" modules to apply the function to.\n      * @param defs The default configuration\n      */\n     registerConfig: function (module, defs, direct)\n     {\n         if (direct)\n         {\n             this.configs[module.modname] = defs;\n             module.config = defs;\n             return;\n         }\n\n\n\n         if (!this.configs[module.modname])\n         {\n             this.configs[module.modname] = this.openDB(module.modname + \".config\");\n             if (Object.keys(this.configs[module.modname]).length == 0) for (var x in this.constdata.RENAMES) if (this.constdata.RENAMES[x] == module.modname && sys.fexists('js_databases/' +x+'.config.jsqz'))\n             {\n                 print(\"WARN: Migrating database.\");\n                 var tempdb = this.openDB(x + \".config\");\n                 if (!tempdb) break;\n                 for (var x2 in tempdb)\n                 {\n                     // deep copy\n                     this.configs[module.modname][x2] = JSON.parse(this.zsrx.zsrx(tempdb[x2]));\n                 }\n\n                 this.closeDB(x + \".config\");\n                 this.purgeDB(x + \".config\");\n             }\n         }\n\n         for (var x in defs)\n         {\n             if (! (x in this.configs[module.modname]) ) this.configs[module.modname][x] = defs[x];\n         }\n\n         module.config = this.configs[module.modname];\n\n     },\n\n     /** (Unimplemented) Registeres a module's config and related schema information.\n      *\n      */\n     registerConfig2: function (module, schema)\n     {\n         //\n     },\n\n\n     /** Calls the configure events.\n      * @param modname What module to call.\n      */\n     callConfigureHooks: function (modname)\n     {\n         if (this.script.modules[modname].configureEvent)\n         {\n             this.script.modules[modname].configureEvent();\n         }\n     },\n\n     registerDB: function (module, dbname, dboptions)\n     {\n         var io = this, dataText, db;\n\n         module.onUnloadModule(\n             function()\n             {\n                 io.closeDB(dbname);\n             }\n         );\n\n         return this.openDB(dbname);\n\n         // v2\n\n\n\n         //return this.openDB(dbname, dboptions);\n     },\n\n     registerDatabase2: function (module, dbname, dboptions)\n     {\n         var dataText, db, test;\n\n         if (this.openDBs[dbname]) throw new Error(\"??\");\n\n         if (sys.fexists(\"js_databases/\" + dbname + \".jsdb\"))\n         {\n             dataText = sys.read(\"js_databases/\" + dbname + \".jsdb\");\n\n             test = this.zjdata.parse(dataText, null, true);\n\n             db = test.variant;\n\n             if (test.error)\n             {\n                 this.script.error(test.error);\n             }\n\n         }\n\n         if (!dboptions)\n         {\n             dboptions = {\n                 journaled: true,\n                 transactional: false\n             };\n         }\n\n         this.openDBs[dbname] =\n             {\n                 db: db,\n                 dataText: dataText,\n                 type: type,\n                 lastSave: +new Date,\n                 lastCommit: +new Date\n             };\n\n         return db;\n     },\n\n\n     /** Opens a database\n      * @returns {IOdatabase}\n      */\n     openDB: function (dbname, dboptions)\n     {\n         if (! dboptions) dboptions = new Object;\n         var start = +new Date;\n         var end;\n         if (dbname in this.openDBs)\n         {\n             throw new Error(\"DB already open!\");\n             //return this.openDBs[dbname].db;\n         }\n         var db, patches, dbo, dataText;\n\n         get_data:\n         {\n             if (!sys.fileExists(\"js_databases/\" + dbname + \".jsqz\"))\n             {\n                 db = new Object;\n                 sys.writeObject(\"js_databases/\" +dbname + \".jsqz\", db, 9);\n                 break get_data;\n             }\n             else\n             {\n                 db = sys.readObject(\"js_databases/\" + dbname + \".jsqz\");\n             }\n\n             if (!sys.fileExists(\"js_databases/\" + dbname + \".jsqz.transactions\")) break get_data;\n\n             this.logs.logMessage(this.logs.IO, \"Applying patches to database \" + dbname);\n\n             dataText = this.zsrx.zsrx(db, null, 1);\n\n             patches = sys.read(\"js_databases/\" + dbname + \".jsqz.transactions\").split(/\\n/g);\n\n             if (patches[patches.length - 1] === \"\") patches.pop();\n\n             try\n             {\n                 for (var x in patches)\n                 {\n                     var parsed = JSON.parse(patches[x]);\n                     {\n                         dataText = this.dmp.def.patch_apply(parsed, dataText)[0];\n                     }\n                 }\n             }\n             catch(e)\n             {\n                 print(JSON.stringify(patches));\n                 print(dataText);\n                 throw e;\n             }\n\n\n\t     try\n             {\n                 db = JSON.parse(dataText);\n             }\n             catch(e)\n             {\n                 print(dataText);\n                 throw e;\n             }\n\n             sys.writeObject(\"js_databases/\" +  dbname + \".jsqz\", db, 3);\n\n             sys.rm(\"js_databases/\" + dbname + \".jsqz.transactions\");\n         }\n\n         if (!dataText) dataText = this.zsrx.zsrx(db);\n\n         dbo = { db: db, lastSave: +new Date, lastCommit: +new Date, dataText: dataText, hasChanges:null };\n\n         this.openDBs[dbname] = dbo;\n\n         end = +new Date;\n\n\n         for (var x in this.IOWatchers) try {\n             this.IOWatchers[x](dbname, this.OPEN, (end-start));\n         } catch (_) {}\n         // this.logs.logMessage(this.logs.IO, \"Opened database \" + dbname + \", took \" + (end - start) + \"ms.\");\n\n         db.__proto__ = this.DATABASE.prototype;\n\n         return db;\n     }\n     ,\n     DATABASE: new Function,\n\n     /** Writes all changes to file */\n     flushDB: function (dbname)\n     {\n         var metadb = this.openDBs[dbname];\n         var db = metadb.db;\n         var start = +new Date;\n\n         sys.writeObject(\"js_databases/\" + dbname + \".jsqz\", db, 3);\n         if (metadb.hasChanges === true) metadb.hasChanges = false;\n         metadb.dataText = JSON.stringify(db, null, 1);\n         if (sys.fileExists(\"js_databases/\" + dbname + \".jsqz.transactions\")) sys.rm(\"js_databases/\" + dbname + \".jsqz.transactions\");\n\n         metadb.lastSave = +new Date;\n         var end = +new Date;\n         for (var x in this.IOWatchers) try {\n             this.IOWatchers[x](dbname, this.SYNC, (end-start));\n         } catch (_) {}\n     }\n     ,\n     /** Commits all changes to file, this may be slower or faster than flush depending on the computer. Fast CPU: Use commit; Fast disk: Use flush. */\n     commitDB: function (dbname)\n     {\n\n         var start = +new Date;\n\n         var newData = this.zsrx.zsrx(this.openDBs[dbname].db, true, [this.skipDBs]);\n\n         if (newData === this.openDBs[dbname].dataText) return;\n\n         var patch = this.dmp.def.patch_make(this.openDBs[dbname].dataText, this.dmp.def.diff_lineMode_(this.openDBs[dbname].dataText, newData));\n\n         sys.append(\"js_databases/\" + dbname + \".jsqz.transactions\", this.zsrx.zsrx(patch).replace(/\\n/g, \" \") + \"\\n\");\n\n         this.openDBs[dbname].dataText = newData;\n\n         var end = +new Date;\n\n         for (var x in this.IOWatchers) try {\n             this.IOWatchers[x](dbname, this.COMMIT, (end-start));\n         } catch (e) { this.logs.logMessage(this.logs.ERROR, \"I/O Watcher error: \" + e.toString(), e.backtracetext); }\n     },\n\n     /** Marks a database as changed */\n     markDB: function (dbname)\n     {\n         this.openDBs[dbname].hasChanges = true;\n         for (var x in this.IOWatchers) try {\n             this.IOWatchers[x](dbname, this.MARK, 1);\n         } catch (_) {}\n     },\n\n     /** Closes an open database */\n     closeDB: function (dbname)\n     {\n         var metadb = this.openDBs[dbname];\n         var db = metadb.db;\n\n         if (!db) return;\n         var start = +new Date;\n         sys.writeObject(\"js_databases/\" + dbname + \".jsqz\", db, 8);\n\n         if (sys.fileExists(\"js_databases/\" +dbname + \".jsqz.transactions\")) sys.rm(\"js_databases/\" + dbname + \".jsqz.transactions\");\n\n         delete this.openDBs[dbname];\n         var end = +new Date;\n\n         for (var x in this.IOWatchers) try {\n             this.IOWatchers[x](dbname, this.CLOSE, (end-start));\n         } catch (_) {}\n\n     },\n\n     /** Erase database */\n     purgeDB: function (dbname)\n     {\n\n\n         this.logs.logMessage(this.logs.IO, \"Purging DB \" + dbname);\n\n         if (this.openDBs[dbname]) this.openDBs[dbname].db = new Object;\n\n         if (sys.fileExists(\"js_databases/\" + dbname + \".jsqz\")) sys.rm(\"js_databases/\" + dbname + \".jsqz\");\n         if (sys.fileExists(\"js_databases/\" + dbname + \".jsqz.transactions\")) sys.rm(\"js_databases/\" + dbname + \".jsqz.transactions\");\n\n     }\n     ,\n     backupDB: function (dbname)\n     {\n         var metadb = this.openDBs[dbname];\n         var db = metadb.db;\n         var start = +new Date;\n         var backupname = dbname + \".backup.\"+start+\".jsqz.bak\";\n         sys.writeObject(\"js_databases/\" + backupname, db, 9);\n         var end = +new Date;\n         for (var x in this.IOWatchers) try {\n             this.IOWatchers[x](dbname, this.BACKUP, (end-start));\n         } catch (_) {}\n     }\n     ,\n     step: function ()\n     {\n         var now = +new Date;\n         if (this.config.autosave) for (var x in this.openDBs)\n         {\n             if (this.openDBs[x].lastSave + this.config.autosave <= now)\n             {\n                 var start = +new Date;\n                 if (this.config.autosavemethod === \"commit\")\n                 {\n                     this.commitDB(x);\n                 }\n                 else\n                 {\n                     this.flushDB(x);\n                 }\n                 var end = +new Date;\n\n                 this.openDBs[x].lastSave = +new Date;\n\n                 return;\n             }\n         }\n     }\n\n });\n\n/** The event run post-configure.\n * @event\n * @memberOf Module.prototype\n * @name configureEvent\n */\n\n/** Implements configuration schemas\n * @name Schema\n * @class\n */\n/**\n * @name\n */",
 "js_modules/io2.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** Implements I/O layer, version 2\n * @name io2\n * @memberOf script.modules\n * @namespace\n * */\n/** @scope script.modules.io2 */\n({\n     require: [\"dmp\", \"logs\", \"util\", \"zsrx\"],\n\n     \n });",
 "js_modules/ioctrl.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n    require: [\"io\", \"com\", \"logs\", \"theme\", \"commands\", \"less\", \"user\"]\n    ,\n    loadModule: function ()\n    {\n        this.commands.registerCommand(\"ioctrl\", this);\n    }\n    ,\n    ioctrl:\n    {\n        server: true,\n        category: \"system\",\n        \n        desc: \"Controls I/O Layer\"\n        ,\n        options:\n        {\n            purge: \"Delete database(s)\"\n            ,\n            sync: \"Write database(s) to file\"\n            ,\n            backup: \"Back-up databases(s)\"\n            ,\n            close: \"Closes databases\"\n            ,\n            all: \"Apply actions to all open databases as well\"\n        }\n        ,\n        perm: function (src)\n        {\n            return \"IO\" in this.user.groups(src);\n        }\n        ,\n        code: function (src, cmd)\n        {\n            var dblist = cmd.args;\n            var now = +new Date;\n\n            if (!cmd.flags.all && !cmd.flags.sync && !cmd.flags.backup && !cmd.flags.purge && cmd.args.length == 0)\n            {\n                this.com.message([src], \"Loaded databases:\", this.theme.INFO);\n                this.less.less(src, Object.keys(this.io.openDBs).join(\"\\n\"), false);\n                return;\n            }\n\n\n\n            if (cmd.flags.all)\n            {\n                var dblist2 = Object.keys(this.io.openDBs);\n                for (var x in dblist2) if (dblist.indexOf(dblist2[x]) === -1) dblist.push(dblist2[x]);\n            }\n\n            if (cmd.flags.sync) for (var x in dblist)\n            {\n                var start = +new Date;\n                this.io.flushDB(dblist[x]);\n                var end = +new Date;\n\n            }\n\n            if (cmd.flags.commit) for (var x in dblist)\n            {\n                var start = +new Date;\n                this.io.commitDB(dblist[x]);\n                var end = +new Date;\n\n            }\n\n            if (cmd.flags.backup) for (var x in dblist)\n            {\n                var start = +new Date;\n                this.io.backupDB(dblist[x]);\n                var end = +new Date;\n\n            }\n\n            if (cmd.flags.close) for (var x in dblist)\n            {\n                var start = +new Date;\n                this.io.closeDB(dblist[x]);\n                var end = +new Date;\n\n            }\n\n            if (cmd.flags.purge)\n            {\n                for (var x in dblist)\n                {\n                    this.io.purgeDB(dblist[x]);\n\n                }\n                this.script.reloadModule(\"io\");\n            }\n        }\n    }\n});\n",
 "js_modules/iologger.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"io\", \"logs\"],\n\n     loadModule: function ()\n     {\n         this.io.registerIOWatcher(this, \"IOLogger\");\n     },\n\n     IOLogger: function (db, iop, time)\n     {\n         var convtab = new Object;\n         \n         convtab[this.io.OPEN] = \"Opened\";\n         convtab[this.io.CLOSE] = \"Closed\";\n         convtab[this.io.SYNC] = \"Synchronized\";\n         convtab[this.io.COMMIT] = \"Commited changes to\";\n         convtab[this.io.BACKUP] = \"Backed up\";\n         convtab[this.io.PURGE] = \"Purged\";\n\n         if (!convtab[iop]) return;\n\n         this.logs.logMessage(this.logs.IO, convtab[iop] + \" database \" + db + \", took \" + time + \" miliseconds.\");\n     }\n});",
 "js_modules/kick.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"commands\", \"com\", \"theme\", \"user\", \"text\"],\n\n     kick:\n     {\n         category: \"security\",\n         server: true,\n\n         desc: \"Kicks user(s) off the server\",\n\n         options:\n         {\n             \"force\": \"Kicks users normally immune to kick.\",\n\n             silent: \"Does not display a message.\",\n\n             \"reason\": \"Reason for the kick.\"\n         },\n\n\n         perm: \"KICK\",\n\n         code: function (src, cmd)\n         {\n             var kicklist = [];\n             var groups = this.user.groups(src);\n             var kicknameslist = [];\n             var sys_auth$src = (src == 0 ? 3 : sys.auth(src));\n\n             if (cmd.flags.force && !this.user.hasPerm(src, \"OVERRIDE\"))\n             {\n                 this.com.message(src, \"Force option: Permission denied.\", this.theme.WARN);\n                 cmd.flags.force = false;\n             }\n\n             if (cmd.flags.silent && !this.user.hasPerm(src, \"SILENT\"))\n             {\n                 this.com.message(src, \"Silent option: Permission denied.\", this.theme.WARN);\n                 cmd.flags.silent = false;\n             }\n\n             for (var x in cmd.args)\n             {\n                 var i = sys.id(cmd.args[x]);\n\n\n\n                 if (!i)\n                 {\n                     this.com.message([src], \"Cant find user: \" + cmd.args[x], this.theme.WARN);\n                     continue;\n                 }\n\n                 if (this.user.hasPerm(i, \"PROTECTED\") && !cmd.flags.force)\n                 {\n                     this.com.message([src], \"User is immune to kick.\", this.theme.WARN);\n                     continue;\n                 }\n\n                 kicklist.push(i);\n                 kicknameslist.push(cmd.args[x]);\n\n             }\n\n             if (kicklist.length == 0) return;\n\n\n\n             if (!cmd.flags.silent)\n             {\n                 this.com.broadcast(this.user.name(src) + \" kicked \" + kicknameslist.join(\", \") + \"!\" +\n                                    (cmd.flags.reason ? \" (Reason: \" + cmd.flags.reason + \")\" : String() ), this.theme.CRITICAL);\n             }\n\n             for (x in kicklist)\n             {\n                 sys.kick(kicklist[x]);\n             }\n         }\n     }\n     ,\n     loadModule: function ()\n     {\n         this.commands.registerCommand(\"kick\", this);\n     }\n });\n",
 "js_modules/less.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** Provides the less function\n * @name less\n * @memberOf script.modules\n * @namespace\n * */\n/** @scope script.modules.less */\n({\n     require: [\"chat\", \"com\", \"theme\", \"io\", \"user\"],\n\n\n\n\n     loadModule: function ()\n     {\n         this.io.registerConfig(\n             this,\n             {\n                 fmtEnd: \"<b><span style='color:green;background-color:black'>END OF TEXT. EXITED VIEW MODE.</span></b>\",\n                 fmtPage: \"<b><span style='color:green;background-color:black'>END OF PAGE <pagenumber/> OF <pagecount/>. TYPE 'NEXT' TO GO FORWARD, 'EXIT' TO QUIT.</span></b>\",\n                 fmtError: \"<b><span style='color:green;background-color:black'>YOU ARE IN VIEW MODE. TYPE 'NEXT' TO GO TO THE NEXT PAGE, OR 'QUIT' TO EXIT VIEW MODE.</span></b>\",\n                 defaultLessLength: 30,\n                 defaultLessEnabled: false\n\n             });\n\n         this.user.registerConfigHook(this, \"configuration\");\n     },\n\n\n     configuration: function (c)\n     {\n         if (!c.lessLength) c.lessLength = this.config.defaultLessLength;\n\n         if (!( \"lessEnabled\" in c)) c.lessEnabled = this.config.defaultLessEnabled;\n     },\n\n     /** Less function\n      * @param {Number} src User to send less to\n      * @param msg The message to send\n      * @param html If msg is html.\n      */\n     less: function (src, msg, html, chan)\n     {\n         var lines;\n\n         var cfg = this.user.userConfig(src);\n\n         if (!cfg.lessEnabled){ this.com.message(src, msg, -1, html, chan); return; }\n\n         if (!html) lines = msg.split(/\\n/g);\n         else lines = msg.split(/<\\s*br\\s*\\/?>/g);\n\n\n         if (src == 0 || cfg.lessLength >= lines.length) {\n             this.com.message(src, msg, -1, html);\n             return;\n         }\n\n         var p = 0;\n\n         var bind = this;\n\n         function showPage()\n         {\n\n             for (var i = 0; ((i < cfg.lessLength) && (i+(cfg.lessLength*p) < lines.length)); i++)\n             {\n                 bind.com.message(src, lines[i+cfg.lessLength*p], -1, html);\n             }\n\n\n             p++;\n\n             if (p*cfg.lessLength >= lines.length)\n             {\n                 bind.com.message([src], bind.config.fmtEnd, -1, true);\n                 return;\n             }\n             var maxpages =  Math.ceil(lines.length / cfg.lessLength);\n\n             bind.com.message([src], bind.config.fmtPage.replace(/<pagenumber\\s*\\/\\s*>/g, p).replace(/<pagecount\\s*\\/\\s*>/g, maxpages), -1, true, chan);\n\n             bind.chat.registerCapture(src, handle, bind);\n\n         }\n\n         function handle (_, msg)\n         {\n             var lmsg = msg.toLowerCase();\n             if (lmsg === \"exit\" || lmsg === \"e\" || lmsg === \"q\" || lmsg === \"quit\")\n             {\n                 bind.com.message([src], this.config.fmtEnd, -1, true, chan);\n                 return;\n             }\n\n             if (lmsg === \"next\" || lmsg === \"n\")\n             {\n                 showPage();\n                 return;\n             }\n             var maxpages =  Math.ceil(lines.length / cfg.lessLength);\n             bind.com.message([src], bind.config.fmtError.replace(/<pagenumber\\s*\\/\\s*>/g, p).replace(/<pagecount\\s*\\/\\s*>/g, maxpages), -1, true, chan);\n             bind.chat.registerCapture(src, handle, bind);\n         }\n\n         showPage(this);\n     }\n });\n",
 "js_modules/logmessager.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"logs\", \"com\", \"theme\", \"commands\", \"io\", \"user\", \"theme\"],\n\n     loadModule: function ()\n     {\n\n\n         this.io.registerConfig(this, { useLoggingChannel: true, loggingChannel: \"Watch\"});\n         this.user.registerConfigHook(this, \"configuration\");\n\n         this.logs.registerLogHandler(this, \"logMessage\");\n\n         this.script.registerHandler(\"afterLogIn\", this);\n     },\n\n\n     configuration: function (c)\n     {\n         if (!c.recieveLogTypes) c.recieveLogTypes = [\"script\", \"io\", \"scripterror\", \"user\", \"command\", \"security\"];\n         if (!(\"logsChannel\" in c)) c.logsChannel = \"Watch\";\n     },\n\n     afterLogIn: function (src)\n     {\n         var cfg;\n         try\n         {\n             if (this.user.hasPerm(src, \"LOGS\") && (cfg = this.user.userConfig(src)).logsChannel)\n             {\n                 sys.putInChannel(src, sys.channelId(cfg.logsChannel));\n\n             }\n         }catch(e) {}\n     },\n\n\n     logMessage: function(log)\n     {\n         var level = log.level, msg = log.msg, players = sys.playerIds().concat([0]);\n\n\t try\n         {\n             l0: for (var x in players)\n             {\n\n                 if (this.user.hasPerm(players[x], \"LOGS\"))\n                 {\n                     var cfg = this.user.userConfig(players[x]),\n                     lt = cfg.recieveLogTypes,\n                     c = (cfg.logsChannel == \"\" ? -1 : (sys.channelId(cfg.logsChannel)|0));\n                     if (c != -1 && players[x] != 0 &&sys.channelsOfPlayer(players[x]).indexOf(c) == -1) continue l0;\n\n                     // Check if the user wants to recieve this tpe of log\n                     if (lt.indexOf(\"*\") !== -1 || lt.indexOf(level) !== -1)\n                     {\n                         //Check if the user has permission to view this type of log message.\n                         if (this.user.hasPerm(players[x], \"LOGS[\" + level.toUpperCase()+\"]\"))\n                         {\n                             this.com.message(players[x], log.msg + (log.level == this.logs.SCRIPTERROR ? \"\\n\" + log.trace: \"\"), this.theme.LOG, false, (c == -1? undefined : c));\n                         }\n                     }\n\n                 }\n             }\n         } catch(e)\n         {\n             print(e + \"\\n\\n\" + e.backtracetext);//  this.script.error(e);\n         }\n     }\n });",
 "js_modules/logs.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n    require: [\"text\", \"util\", \"zjdata\"],\n\n\n    hotswap: function (old)\n    {\n        this.savedLogFunction = old.savedLogFunction;\n\n        this.savedErrorFunction = old.savedErrorFunction;\n        this.script.log = this.util.bind(\n            this\n            ,\n            function(msg)\n            {\n                this.logMessage(this.SCRIPT, msg);\n            }\n        );\n\n\n        this.logs = old.logs;\n\n        this.registerLogHandler = this.util.generateRegistor(this, this.util.UNARY_REGISTOR, \"logHandlers\", false);\n\n        return true;\n    },\n\n    logs: [],\n\n     logFname: +(new Date) + \".logs.txt\",\n\n     DEBUG: \"debug\",\n     USER: \"user\",\n     COMMAND: \"command\",\n     SCRIPT: \"script\",\n     WARN: \"security\",\n     ERROR: \"scripterror\",\n     CRITICAL: \"scripterror\",\n     SCRIPTERROR: \"scripterror\",\n     INFO: \"info\",\n     CHAT: \"chat\",\n     IO: \"io\",\n     BROADCAST: \"public\",\n     MODULE: \"module\",\n\n\n\n\n    logMessage: function (level, msg, trace)\n    {\n        var log = {level: level, msg:msg, time: (new Date).toString(), trace: trace || sys.backtrace()};\n\n        try\n        {\n           sys.append(this.logFname, JSON.stringify(log) + \"\\n\");\n        } catch (_) {}\n\n        this.logs.push(log);\n\n        if (Object.keys(this.logHandlers).length === 0)\n        {\n            print(\"SCRIPT: \" + msg);\n        }\n\n        for (var x in this.logHandlers)\n        {\n            this.logHandlers[x].apply(this.logHandlers[x].module, [log]);\n        }\n\n        if (this.logs.length >= 15000)\n\n            print(\"Clearing some older log messages...\"),\n            this.logs.splice(0, 1000);\n\n\n\n    },\n\n\n    loadModule: function ()\n    {\n        this.registerLogHandler = this.util.generateRegistor(this, this.util.UNARY_REGISTOR, \"logHandlers\", false);\n\n        this.savedLogFunction = this.script.log;\n        this.script.log = this.util.bind(\n            this\n            ,\n            function(msg)\n            {\n                this.logMessage(this.SCRIPT, \"\"+ msg);\n            }\n        );\n\n        this.savedInfoFunction = this.script.scriptinfo;\n        this.script.scriptinfo = this.util.bind(\n            this\n            ,\n            function(msg, bt)\n            {\n                if (script.debugMode) this.logMessage(this.MODULE, \"\"+ msg, bt);\n            }\n        );\n\n        this.savedErrorFunction = this.script.error;\n        this.script.error = this.util.bind(\n            this,\n\n            function (e)\n            {\n                this.logMessage(this.ERROR, e.toString(), e.backtracetext);\n            }\n        );\n\n\n    },\n\n\n    unloadModule: function ()\n    {\n        this.script.log = this.savedLogFunction;\n\n        this.script.error = this.savedErrorFunction;\n        this.script.scriptinfo = this.savedInfoFunction;\n    }\n});\n",
 "js_modules/main.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n//\"use strict\";\n/**\n * @fileOverview This file is the main modloader.\n * @author <a href=\"mailto:archzombielord@gmail.com\">ArchZombie0x</a>\n */\n/** Scripts are loaded using modules.\n * @class\n * @name Module\n */\n/** List of names of modules to \"require\" by gluing them unto the \"this\" property.\n * @name require\n * @memberOf Module.prototype\n */\n/** Name of the module, glued unto the module by the modloader\n * @name modname\n * @memberOf Module.prototype\n */\n/** List of names of submodules to \"include\" by gluing them unto the \"this\" property. These are not added as separate module objects, but rather the properties are glued directly unto the module.\n * @name include\n * @memberOf Module.prototype\n */\n/** Called when a module is loaded. Should initialize the internal state of the module.\n * @name loadModule\n * @event\n * @memberOf Module.prototype\n */\n/** Called when a module is unloaded. Should deinitialize the internal state of the module, at least saving to disk.\n * @name unloadModule\n * @event\n * @memberOf Module.prototype\n */\n/** Sets up a call to activate during the unload module event.\n * @name onUnloadModule\n * @function\n * @param callback Function to be called.\n * @memberOf Module.prototype\n */\n/** The module loader object\n *  @name script\n *  @namespace\n */\n/** @scope script */\n({\n\n     /** Holds some very basic configuration */\n     config: null,\n\n\n     /** The modules object stores all the modules\n      * @namespace\n      * @memberOf script\n      */\n     modules: null,\n\n//     modInfo: null,\n\n     debug: function (m)\n     {\n         print(m);\n     },\n\n\n     /** Logs a message to the console or the logging module*/\n     log: function (msg)\n     {\n         print (\"SCRIPT: \" + msg);\n     },\n\n\n     error: function (e)\n     {\n         print(\"SCRIPTERROR: \" + e + \"\\n\" + e.backtracetext);\n     },\n\n     _beforeServerMessage: function (msg)\n     {\n         if (msg.match(/^\\/~reset ?/))\n         {\n             sys.stopEvent();\n             sys.changeScript(sys.read('scripts.js'));\n             return;\n         }\n\n         if (msg.match(/^\\/~eval (.*)$/))\n         {\n             sys.stopEvent();\n             eval(msg.match(/^\\/~eval (.*)$/)[1]);\n             return;\n         }\n     },\n\n     /** Does nothing\n      * @deprecated Doesn't do anything\n      */\n     broadcast : function (msg)\n     {\n\n     },\n\n\n     /** Registers a script event handler\n      * @param {string} handlername The event name of the script handler.\n      * @param {Module} object The module to register this handler from\n      * @param {string} [propname=handlername] The name of the handler on the module, if it is different from the event name.\n      * */\n     registerHandler: function (handlername, object, propname)\n     {\n         var bind, f, callbk;\n\n         if (!propname) propname = handlername;\n\n         bind = this;\n\n         if ( !(handlername in script) )\n         {\n             f = function ()\n             {\n                 var x;\n\n                 try\n                 {\n                     for (x in f.callbacks)\n                     {\n                         f.callbacks[x].func.apply(f.callbacks[x].bind, arguments);\n                     }\n                 }\n                 catch (err)\n                 {\n                     bind.error(err);\n                 }\n             };\n\n             script[handlername] = f;\n             script[handlername].callbacks = [];\n         }\n\n         if ( !(script[handlername].callbacks)) throw new Error(\"Not registerable\");\n\n         callbk = {func:object[propname], bind:object};\n\n         script[handlername].callbacks.push(callbk);\n\n\n         if (\"onUnloadModule\" in object)\n         {\n             object.onUnloadModule(\n                 function ()\n                 {\n                     script[handlername].callbacks.splice(script[handlername].callbacks.indexOf(callbk),1);\n                 }\n             );\n         }\n\n         return;\n\n     },\n\n\n     hotswapModule: function (modname)\n     {\n         var oldmod = this.modules[modname];\n\n         if (!oldmod) return false;\n\n         if (!oldmod.hotswap) return false;\n\n         var newMod = sys.exec(\"js_modules/\" + modname + \".js\");\n\n         if (!newMod.hotswap) return false;\n\n         this.log(\"Hotswapping module: \" + modname);\n\n         Object.defineProperty(newMod, \"script\", {value: this, configurable: true});\n\n         for (var x in newMod.require)\n         {\n             this.loadModule(newMod.require[x]);\n             Object.defineProperty(newMod, newMod.require[x], {value: this.modules[newMod.require[x]], configurable: true});\n             if (this.modules[newMod.require[x]].submodules.indexOf(modname) == -1) this.modules[newMod.require[x]].submodules.push(modname);\n         }\n\n         function nil(){};\n\n         switch (typeof newMod.hotswap)\n         {\n         case \"function\":\n             if (newMod.hotswap(oldmod))\n             {\n                 if (oldmod.submodules) for (var x in oldmod.submodules)\n                 {\n                     delete this.modules[oldmod.submodules[x]][modname];\n                     Object.defineProperty(this.modules[oldmod.submodules[x]], modname, {value: newMod, configurable: true});\n                 }\n\n                 newMod.submodules = this.modules[modname].submodules;\n\n                 this.modules[modname] = newMod;\n\n\n                 return true;\n             }\n             else return false;\n         case \"boolean\":\n             (oldmod.unloadModule || nil) ();\n\n             if (oldmod.submodules) for (var x in oldmod.submodules)\n             {\n                 delete this.modules[oldmod.submodules[x]][modname];\n                 Object.defineProperty(this.modules[oldmod.submodules[x]], modname, {value: newMod, configurable: true});\n             }\n\n             newMod.submodules = oldmod.submodules;\n             this.modules[modname] = newMod;\n             (newMod.loadModule || nil)();\n             return true;\n         default:\n             return false;\n         }\n     }\n     ,\n     /** Reloads a module\n      * @param {string} modname\n      * @throws Error When the module can't be loaded.\n      * */\n     reloadModule: function (modname)\n     {\n         // if(this.hotswapModule(modname)) return; // try hotswap if possible\n\n         var unloads = this.unloadModule(modname);\n\n         for (var x in unloads)\n         {\n             this.loadModule(unloads[x]);\n         }\n\n         this.loadModule(modname); // load even if unload failed\n     }\n     ,\n     /** Loads a module\n      * @param {string} modname Name of the module to be loaded.\n      */\n     loadModule: function (modname)\n     {\n         if (this.modules[modname] && !(this.modules[modname] instanceof Error)) return;\n\n\n         try {\n             var mod = sys.exec(\"js_modules/\" + modname +\".js\");\n\n             mod.modname = modname;\n\n             this.modules[modname] = mod;\n\n             if (mod.include) for (var x in mod.include)\n             {\n                 var temp = sys.exec(\"js_modules/\" + mod.include[x] + \".js\");\n\n                 for (var x2 in temp)\n                 {\n                     if (x2 in mod && mod[x2] != null)\n                     {\n                         if (typeof mod[x2] != typeof temp[x2] || (typeof mod[x2] != \"object\" && typeof mod[x2] != \"function\"))\n                         {\n                             throw new Error(\"Unable to merge\");\n                         }\n                         if (typeof mod[x2] === \"function\")\n                         {\n                             // use a closure to merge the two functions as one\n                             mod[x2] = (function (m, t) {\n                                            return function ()\n                                            {\n                                                m.apply(mod, arguments);\n                                                t.apply(mod, arguments);\n                                            };\n                                        })(mod[x2], temp[x2]);\n                         }\n                         else if (mod[x2] instanceof Array)\n                         {\n                             mod[x2] = mod[x2].concat( temp[x2] );\n                         }\n                         else\n                         {\n                             for (var x3 in temp[x2])\n                             {\n                                 if (x3 in mod[x2]) throw new Error(\"Unable to merge\");\n\n                                 mod[x2][x3] = temp[x2][x3];\n                             }\n                         }\n                     }\n                     else\n                     {\n                         mod[x2] = temp[x2];\n                     }\n                 }\n             }\n\n             if (!mod.require) mod.require = [];\n             mod.submodules = [];\n\n             for (var x in this.hooks)\n             {\n                 mod[x] = this.hooks[x];\n             }\n\n             for (var x in mod.require)\n             {\n                 var reqmodname = mod.require[x];\n\n                 this.loadModule(reqmodname);\n\n                 if ( !(reqmodname in this.modules) || this.modules[reqmodname] instanceof Error)\n                 {\n                     this.modules[modname] = new Error(\"Unmet dependencies\");\n                     return;\n                 }\n\n                 this.modules[reqmodname].submodules.push(modname);\n\n                 if (this.modules[reqmodname].submodules.indexOf(modname) === -1) throw new Error(\":(\");\n\n                 Object.defineProperty(this.modules[modname], reqmodname, {configurable: true, value: this.modules[reqmodname]});\n             }\n\n             Object.defineProperty(this.modules[modname], \"script\", {configurable : true, value: this});\n\n             if (\"loadModule\" in mod)\n             {\n                 mod.loadModule();\n             }\n\n             for (var x in mod.require)\n             {\n                 if (this.modules[mod.require[x]].loadSubmodule)\n                 {\n                     this.modules[mod.require[x]].loadSubmodule(mod, modname);\n                 }\n             }\n             this.log(\"Loaded module: \" + modname);\n         }\n         catch (e)\n         {\n\n             delete this.modules[modname];\n             throw e;\n         }\n\n     }\n     ,\n     /** Unloads a module\n      * @param {string} modname Name of module to remove.\n      * @return {string[]} List of all modules that were removed, includes others due to dependencies.\n      */\n     unloadModule: function (modname, hot)\n     {\n         if ( !(modname in this.modules)) return [];\n         if (this.modules[modname] instanceof Error) return [modname];\n         this.log(\"Unloading module: \" + modname);\n\n         try\n         {\n\n\n\n             var unloads = [modname];\n\n             var thisModule = this.modules[modname];\n\n             var q = [];\n\n             thisModule.submodules.forEach(function (i){ q.push(i); });\n\n             for (var x in q)\n             {\n                 unloads.push(q[x]);\n                 var u = this.unloadModule(q[x]);\n                 unloads = unloads.concat(u);\n\n             }\n\n             if (thisModule.require) for (x in thisModule.require)\n             {\n                 if (this.modules[thisModule.require[x]].unloadSubmodule)\n                 {\n                     this.modules[thisModule.require[x]].unloadSubmodule(thisModule, modname);\n                 }\n\n                 this.modules[thisModule.require[x]].submodules.splice(this.modules[thisModule.require[x]].submodules.indexOf(modname), 1);\n             }\n\n             if (\"unloadModuleHooks\" in thisModule)\n             {\n                 var unloadModuleHooks = thisModule.unloadModuleHooks;\n                 for (x in unloadModuleHooks)\n                 {\n                     unloadModuleHooks[x].apply(thisModule, [thisModule]);\n                 }\n\n             }\n\n             if (\"unloadModule\" in thisModule) try\n             {\n                 thisModule.unloadModule();\n             }\n             catch (e)\n             {\n                 this.log(\"[[ERROR:]]\" + e.toString() + \"\\n\" + e.backtracetext);\n             }\n         } catch (e2)\n         {\n\n         }\n         finally\n         {\n             delete this.modules[modname];\n             return unloads;\n         }\n\n\n\n\n     }\n     ,\n     /** Handles loading the script\n      * @event\n      */\n     loadScript: function ()\n     {\n\n         var test1 = [\"print\",\"gc\",\"version\",\"global\",\"sys\",\"SESSION\",\"Qt\",\"script\"];\n\n         var test2 = Object.keys(global);\n\n         var poisoned = false;\n\n         sys.enableStrict();\n\n         this.modules = new Object;\n\n         if (sys.fileExists(\"ZSCRIPTS_COPYING\")) print(sys.read(\"ZSCRIPTS_COPYING\"));\n         else if (sys.fileExists(\"ZVXSCRIPTS_COPYING\")) print(sys.read(\"ZVXSCRIPTS_COPYING\"));\n         else print(\"!!! Missing license, see http://github.com/archzombie/zvxscripts !!!\");\n\n         /*for (var x in test2) if (test1.indexOf(test2[x]) === -1)\n         {\n             print(\"WARNING: Global object poisoned. Removing property: \" + test2[x]);\n             delete global[test2[x]];\n             poisoned = true;\n         }*/\n\n         if (poisoned) gc();\n\n         this.registerHandler(\"beforeLogIn\", this, \"AGPL\");\n         this.registerHandler(\"beforeServerMessage\", this, \"_beforeServerMessage\");\n\n         sys.unsetAllTimers();\n\n         try {\n             var f;\n             if (sys.fileExists(\"main.json\")) f = sys.read(\"main.json\");\n\n             else f = \"{}\";\n\n             var o = JSON.parse(f);\n\n             if (typeof o == typeof new Object);\n\n                 else throw new Error(\"Corrupt File\");\n\n             this.config = o;\n\n             if (!this.config.modules) this.config.modules = [\"default\"];\n\n             for ( x in this.config.modules)\n             {\n                 this.loadModule(this.config.modules[x]);\n             }\n\n             sys.writeToFile(\"main.json\", JSON.stringify(this.config));\n         }\n         catch(e)\n         {\n             var stack = (e.backtracetext);\n\n             print(\"Failed to start, error in \" + e.fileName + \" at line #\" + e.lineNumber + \": \" + e.toString() +\"\\n\" + stack);\n             this.beforeServerMessage = this._beforeServerMessage;\n\n             for (x in this) if (x != \"beforeServerMessage\") delete this[x];\n             sys.stopEvent();\n         }\n     }\n     ,\n     /** Handles unloading the script\n      * @event\n      */\n     unloadScript: function  ()\n     {\n         var mods = Object.keys (this.modules);\n\n         this.unloadedModules = mods;\n\n         //this.config.modules = Object.keys(this.modules);\n\n         //sys.write(\"main.json\", JSON.stringify(this.config));\n\n         for (var x in mods)\n         {\n             this.unloadModule(mods[x]);\n         }\n     }/*\n       ,\n       switchError: function ()\n       {\n       print(\"Recover\");\n       for (var x in this.unloadedModules)\n       {\n       this.loadModule(this.unloadedModules[x]);\n       }\n       }*/\n     ,\n     /** Sends a license message to src\n      * @param {number} src User ID to send message to.\n      */\n     AGPL: function (src)\n     {\n         sys.sendHtmlMessage(\n             src,\n             \"<timestamp /><b>ZVxScripts Copyright © 2013 Ryan P. Nicholl \\\"ArchZombie0x\\\" &lt;archzombielord@gmail.com&gt;</b><br/>\" +\n                 \"You may download these scripts for your own server at <a href=\\'https://github.com/ArchZombie/zvxscripts\\'>https://github.com/ArchZombie/zvxscripts</a> <a href='https://github.com/ArchZombie/ZVxScripts/releases'>[link to releases]</a>. Scripts are available under the <em>GNU Affero General Public License</em> as published by the Free Software Foundation, version 3, or, at your option, any later version.<br/>For help with using the scripts, <a href='https://github.com/ArchZombie/ZVxScripts/raw/master/manual.pdf'>click here</a>.\"\n         );\n     }\n     ,\n     /** Hooks to be added to all modules\n      *\n      */\n     hooks:\n     /**\n      * @scope script.hooks\n      */\n     {\n         /** Runs the function when the module is unloaded\n          * @param {function} f Function to be run when the module is unloaded.\n          */\n         onUnloadModule: function (f)\n         {\n             if (!this.unloadModuleHooks) this.unloadModuleHooks = [];\n\n             this.unloadModuleHooks.push(f);\n         }\n\n     },\n\n     debugInspector: function ()\n     {\n         function assert (cond)\n         {\n             if (!cond)\n             {\n                 print(\"ASSERT FALURE\");\n                 print(sys.backtrace());\n                 throw new Error(\"Assert failure.\");\n             }\n         }\n\n         for (var x in this.modules)\n         {\n             for (var x2 in this.modules[x].require)\n             {\n                 (function(x, x2) {\n\n                      var name = this.modules[x].require[x2];\n                      assert(this.modules[name].submodules.indexOf(x) !== -1);\n\n                  }).call(this, x, x2);\n             }\n         }\n\n     },\n\n     get script()\n     {\n         print(\"WARNING: getting script.script\\n\" + sys.backtrace());\n         return this;\n     }\n\n });\n",
 "js_modules/me.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n    require: [\"commands\", \"text\", \"security\", \"com\", \"user\", \"io\"]\n    ,\n    loadModule: function ()\n    {\n        this.commands.registerCommand(\"me\", this);\n        this.io.registerConfig(this, { fmt: \"<font color=blue><timestamp /><i><username/> <message/></i></font>\" });\n    }\n    ,\n    \"me\":\n    {\n        mode: \"lazy\",\n        server: true,\n        category: \"fun\",\n\n        desc: \"Says something\"\n        ,\n        perm: function(src)\n        {\n            return this.user.hasPerm(src, \"CHAT\");\n        }\n        ,\n        code: function(src, cmd, chan)\n        {\n            this.com.broadcast(this.config.fmt.replace(/<username\\s*\\/?>/g, this.text.escapeHTML(this.user.name(src))).replace(/<message\\s*\\/?>/g, this.text.escapeHTML(cmd.input || \"\")) , -1, true, (chan == -1?void 0:chan));\n        }\n    }\n});\n",
 "js_modules/modloader.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     modules: null,\n\n     moduleTable: null,\n\n     sources: null,\n\n     init: function ()\n     {\n         this.sources = new Array;\n\n         this.modules = new Object;\n\n         this.moduleTable = new Object;\n     },\n\n     addSource: function (source)\n     {\n         this.sources.push(source);\n     },\n\n\n     fetch: function (modname, source)\n     {\n         if (source.type === \"local\")\n         {\n             if (source.modules && source.modules.indexOf(modname) === -1) return null;\n\n             try\n             {\n                 var text = sys.read(source.path + \"/\" + modname + \".js\");\n\n                 if (!source.sha1 || source.sha1[modname] === sys.sha1(text)) return text;\n\n\n                 try\n                 {\n                     this.modules.logs.logMessage(this.modules.logs.WARN, \"Invalid sha1 string for module.\");\n                 }\n                 catch (_)\n                 {\n                     print(\"Invalid sha1 string for module.\");\n                 }\n                 return null;\n\n             }\n             catch (e)\n             {\n                 return null;\n             }\n         }\n\n         if (source.type === \"web\")\n         {\n             if (source.modules && source.modules.indexOf(modname) === -1) return null;\n\n             var text = sys.synchronousWebCall(source.path + \"/\"+modname + \".js\");\n\n             if (!text) return null;\n\n             if (!source.sha1 || source.sha1[modname] === sys.sha1(text)) return text;\n\n             try\n             {\n                 this.modules.logs.logMessage(this.modules.logs.WARN, \"Invalid SHA1 string for module.\");\n             }\n             catch (_)\n             {\n                 print(\"Invalid SHA1 string for module.\");\n             }\n             return null;\n\n         }\n\n         else return null;\n     },\n\n     statModule: function (modname)\n     {\n         // TODO: fix this\n\n         var stat = {\n             state: \"unloaded\",\n             text: null\n         };\n\n         for (var x in this.sources)\n         {\n             if (this.sources.modules && this.sources[x].modules.indexOf(modname) !== -1)\n             {\n                 stat.source = this.sources[x];\n\n                 return stat;\n             }\n\n             var text;\n             if (!this.sources.modules && (text = this.fetch(modname, this.sources[x])))\n             {\n                 stat.source = this.sources[x];\n                 stat.text = text;\n\n                 return stat;\n             }\n         }\n\n         return null;\n     },\n\n     loadModule: function (modname)\n     {\n         var modinf = this.moduleTable[modname];\n\n         if (!modinf) modinf = this.moduleTable[modname] = this.statModule(modname);\n\n         if (!modinf) return; // failure\n\n         if (modinf.state === \"loaded\" || modinf.state === \"error\") return;\n\n         if (modinf.state === \"ready\" || modinf.state === \"pending\")\n         {\n             this.enableModule(modname, modinf.code);\n             return;\n         }\n\n         if (modinf.state === \"unloaded\")\n         {\n\n             var text = modinf.text || this.fetch(modname, modinf.source);\n\n             if (!text) return;\n\n             var code = null;\n             var extratext = null;\n             var extra;\n\n             try\n             {\n                 try { code = sys.eval(text, modinf.source.path +\"/\"+ modname + \".js\"); }\n                 catch(_) { code = sys.eval(text); }\n\n                 if (code.include) for (var x in code.include)\n                 {\n                     var i = code.include[x];\n\n                     extratext = this.fetch(code.include[x], modinf.source);\n\n                     if (!extratext) return;\n\n                     try { extra = sys.eval(extratext, modinf.source.path +\"/\"+ modname + \".js\"); }\n                     catch(_) { extra = sys.eval(extratext); }\n\n                     this.fuse(code, extra);\n                 }\n\n                 extra = null; extratext = null;\n\n                 if (code.initializeModule) code.initializeModule();\n\n                 modinf.code = code;\n                 modinf.pendingCode = null;\n\n                 if (this.enableModule(modname, modinf.code))\n                 {\n                     modinf.state = \"loaded\";\n\n                     if (this.log) this.log(\"Loading module \" + modname);\n                 }\n                 else\n                 {\n\n                     modinf.state = \"error\";\n                     print(\"error\");\n                 }\n\n\n             }\n             catch(e)\n             {\n                 modinf.state = \"error\";\n                 print(e);\n             }\n\n         }\n     },\n\n     registerHandler: function registerHandler (handlername, object, propname)\n     {\n         if (!propname) propname = handlername;\n\n         if (! (handlername in this))\n         {\n             var f = function _meta_event_handler_func_ ()\n             {\n                 try\n                 {\n                     for (var x in f.callbacks)\n                     {\n                         f.callbacks[x].func.apply(f.callbacks[x].bind, arguments);\n                     }\n                 }\n\n                 catch (err)\n                 {\n                     this.error(err);\n                 }\n             };\n\n             this[handlername] = f;\n             this[handlername].callbacks = [];\n         }\n\n         if ( !(this[handlername].callbacks)) throw new Error(\"Not registerable\");\n\n         var callbk = {func:object[propname], bind:object};\n\n         this[handlername].callbacks.push(callbk);\n\n         var _bind = this;\n         if (\"onUnloadModule\" in object)\n         {\n             object.onUnloadModule(\n                 function _meta_callback_unload_ ()\n                 {\n                     script[handlername].callbacks.splice(script[handlername].callbacks.indexOf(callbk),1);\n                 }\n             );\n         }\n\n         return;\n     },\n\n     /** Enables a module: Takes the module object and glues it into to the system.\n      * @param modname The name of the module\n      * @param module The module object\n      */\n     enableModule: function (modname, module)\n     {\n         var x;\n\n         module.submodules = [];\n         Object.defineProperty(module, \"script\", {value: this, configurable: true});\n\n         this.modules[modname] = module;\n\n         if (!module.require) module.require = [];\n\n         for (x in module.require)\n         {\n             var i = module.require[x];\n\n             delete module[i]; // clean up old refs\n\n             this.loadModule(i);\n\n             if (!this.moduleTable[i] || this.moduleTable[i].state !== \"loaded\" || !this.modules[i])\n             {\n                 this.moduleTable[modname].state = \"pending\";\n\n                 delete this.modules[modname];\n\n                 return false;\n\n             }\n\n\n             if (this.modules[i].submodules.indexOf(modname) !== -1) throw new Error(\"Corrupt module system.\");\n\n             // Add this module to submodules of the other module\n             this.modules[i].submodules.push(modname);\n\n             // Apply requirements:\n             Object.defineProperty(this.modules[modname], i, {configurable: true, value: this.modules[i]});\n\n         }\n\n\n         for (x in this.hooks)\n         {\n             module[x] = this.hooks[x];\n         }\n\n\n         for (x in module.require)\n         {\n             var i = module.require[x];\n\n             if (this.modules[i].loadSubmodule) this.modules[i].loadSubmodule(modname, module);\n         }\n\n\n         if (module.loadModule) module.loadModule();\n\n         return true;\n\n     },\n\n     unloadModule: function (modname)\n     {\n         var x;\n\n         if (! (modname in this.modules)) return;\n\n         var disabled = [];\n\n         var module = this.modules[modname];\n\n         var submodules = [];\n\n         for (x in module.submodules) submodules.push(module.submodules[x]);\n\n         for (x in submodules) disabled = disabled.concat(this.unloadModule(submodules[x]));\n\n         if (module.unloadModule) module.unloadModule();\n\n         if (module.unloadModuleHooks)\n         {\n             var unloadModuleHooks = module.unloadModuleHooks;\n\n             for (x in unloadModuleHooks)\n             {\n                 unloadModuleHooks[x].apply(new Object, [module]);\n             }\n\n         }\n\n\n         delete this.modules[modname];\n\n         this.moduleTable[modname].state = \"ready\";\n\n         if (this.log) this.log(\"Unloaded module: \" + modname);\n\n     },\n\n     fuse: function (origin, extra)\n     {\n         for (var x2 in extra)\n         {\n             if (x2 in origin && origin[x2] != null)\n             {\n                 if (typeof origin[x2] != typeof extra[x2] || (typeof origin[x2] != \"object\" && typeof origin[x2] != \"function\"))\n                 {\n                     throw new Error(\"Unable to merge\");\n                 }\n                 if (typeof origin[x2] === \"function\")\n                 {\n                     // use a closure to merge the two functions as one\n                     origin[x2] = (function (a, b) {\n                                    return function ()\n                                    {\n                                        a.apply(origin, arguments);\n                                        b.apply(origin, arguments);\n                                    };\n                                })(origin[x2], extra[x2]);\n                 }\n                 else if (origin[x2] instanceof Array)\n                 {\n                     origin[x2] = origin[x2].concat( extra[x2] );\n                 }\n                 else\n                 {\n                     for (var x3 in extra[x2])\n                     {\n                         if (x3 in origin[x2]) throw new Error(\"Unable to merge\");\n\n                         origin[x2][x3] = extra[x2][x3];\n                     }\n                 }\n             }\n             else\n             {\n                 origin[x2] = extra[x2];\n             }\n         }\n     },\n\n     hooks:\n     {\n             /** Runs the function when the module is unloaded\n              * @param {function} f Function to be run when the module is unloaded.\n              */\n             onUnloadModule: function _meta_hook_onUnloadModule_ (f)\n             {\n                 if (!this.unloadModuleHooks) this.unloadModuleHooks = [];\n\n                 this.unloadModuleHooks.push(f);\n             }\n     }\n\n\n\n\n });",
 "js_modules/modprobe.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** Modprobe\n * @memberOf script.modules\n * @name modprobe\n * @namespace\n */\n/** @scope script.modules.modprobe */\n({\n     require: [\"commands\", \"logs\", \"com\", \"theme\", \"less\", \"user\"]\n     ,\n     loadModule: function ()\n     {\n         this.commands.registerCommand(\"modulectrl\", this);\n     }\n     ,\n     /** The modprobe command loads and unloads modules. See the user manual.\n      * @type commandDescriptor\n      */\n     modulectrl:\n     {\n         category: \"system\",\n         aliases: [\"modprobe\", \"modctrl\"],\n         server: true,\n         desc: \"Manages loadable modules. If run without any option, lists modules.\",\n         options :\n         {\n             \"load\": \"Loads modules.\"\n             ,\n             \"unload\": \"Unloads modules.\"\n             ,\n             \"reload\": \"Reloads modules, will attempt to hotswap if possible.\"\n             ,\n             \"hotswap\": \"Hotswaps modules (does not reload if hotswapping is not possible.)\"\n         }\n         ,\n         perm: \"MODPROBE\",\n         /** The modprobe command will list all the modules, or --load, --unload, or --reload them */\n         code: function (src, cmd, chan)\n         {\n             var flags = Object.keys(cmd.flags);\n\n             if (flags.length === 0)\n             {\n                 var k = Object.keys(this.script.modules);\n\n                 this.com.message(src, \"Loaded Modules: \" + k.join(\" , \") + \" .\");\n                 return;\n\n                 if (cmd.args.length === 0)\n                 {\n                     this.com.message([src], \"Statted modules:\", this.theme.INFO);\n                     var modlist = \"Loaded Modules: <br/><table><tr><td><b>Module Name:</b></td><td><b>Module State:</b></td></tr><br/>\";\n                     for (var x in this.script.modInfo)\n                     {\n                         modlist += \"<tr><td>\" + x + \"</td><td>\" + this.script.modInfo[x].state + \"</td></tr>\";\n                     }\n\n                     this.com.message(src, modlist + \"</table>\", this.theme.INFO, true);\n                     return;\n                 }\n\n                 var str = [];\n\n                 for (var x in cmd.args)\n                 {\n\n                     var test = this.script.modules[cmd.args[x]];\n\n                     str.push(\"<b>Module \" + cmd.args[x] + \":</b>\");\n                     if (!test)\n                     {\n                         str.push(\"Module not loaded.\");\n                         continue;\n                     }\n\n                     str.push(\"Requires: \" + this.script.modules[cmd.args[x]].require.join(\", \"));\n                     str.push(\"Required by: \" + this.script.modules[cmd.args[x]].submodules.join(\", \"));\n                     str.push(\"Contains: \" + Object.keys(this.script.modules[cmd.args[x]]).join (\", \"));\n\n                 }\n\n                 this.less.less(src, str.join(\"<br/>\"), true);\n\n                 return;\n             }\n\n             if (cmd.flags.load || cmd.flags.l) for (var x in cmd.args) this.script.loadModule(cmd.args[x]);\n\n             if (cmd.flags.unload || cmd.flags.u) for (var x in cmd.args) this.script.unloadModule(cmd.args[x]);\n\n             if (cmd.flags.reload || cmd.flags.r) for (var x in cmd.args) this.script.reloadModule(cmd.args[x]);\n\n             if (cmd.flags.hotswap || cmd.flags.h) for (var x in cmd.args)\n             {\n                 if (!this.script.hotswapModule(cmd.args[x]))\n                 {\n                     this.com.message(src, \"Failed to hotswap module: \" + cmd.args[x], this.theme.WARN);\n                 }\n             }\n         }\n     }\n });\n",
 "js_modules/motd.js": "({ // starts module\n    require: [\"commands\", \"com\", \"io\"],\n    loadModule: // rules.loadModule\n    function ()\n    {\n        this.commands.registerCommand(\"motd\", this);\n        this.io.registerConfig(this, { message: \"\", sendMOTDOnLogin: false });\n        this.script.registerHandler(\"afterLogIn\", this);\n    },\n    motd:\n    {\n        category: \"basic\",\n        desc: \"Shows the server's MOTD\",\n        perm: function ()\n        {\n            return true; // all users shoudl be able to use /motd so don't check anything\n        },\n        code: function (src, cmd, chan) // code that runs /motd\n        {\n             this.com.message(src, \"MOTD: \" + this.config.message);\n        }\n    },\n    afterLogIn: function (src)\n    {\n        if (this.config.sendMOTDOnLogin )\n        {\n            this.com.message(src,\"MOTD: \" + this.config.message);\n        }\n    }\n});\n",
 "js_modules/mute.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n    require: [\"commands\", \"security\",  \"text\", \"com\", \"theme\", \"time\", \"user\", \"util\"],\n\n    unmuteall:\n    {\n        mode: \"strict\",\n        server:true,\n        category: \"security/mute\",\n        desc: \"Clear the mute list\"\n        ,\n        perm:\"MUTE\",\n\n        code: function (src, cmd)\n        {\n            if (!(cmd.flags.force))\n            {\n                this.com.message([src], \"Are you sure you want to do this? Retry with --force option.\", this.theme.WARN);\n                return;\n            }\n\n            this.com.broadcast(this.user.name(src) + \" has cleared the server's mute list.\");\n\n            this.security.database.mutes = new Object;\n        }\n    }\n    ,\n    unmute:\n    {\n        mode: \"strict\",\n        server: true,\n        category: \"security/mute\",\n        desc: \"Remove mute(s) from user(s)\",\n        perm: \"MUTE\",\n        code: function (src, cmd, chan)\n        {\n            var removes = [];\n\n            for (var x in cmd.args)\n            {\n                removes = removes.concat(this.security.removeAfflicted(cmd.args[x], this.security.database.mutes));\n            }\n\n            removes = this.util.concatSets(removes);\n\n            this.com.broadcast(this.user.name(src) + \" has removed mute(s) #\" + removes.join(\", #\") + \"!\");\n        }\n    }\n    ,\n    mute:\n    {\n        mode: \"strict\",\n        server:true,\n        desc: \"Mute prevents users from talking in the main chat. Can mute usernames, IPs, regular expressions, or subnets. Users with PROTECTED permission are not affecte by mutes.\",\n        options:\n        {\n            reason: \"Reason for the mute\",\n            time: \"Duration to mute for\",\n            ip: \"Also mute the user's IP address.\"\n        },\n        category: \"security/mute\",\n        examples:\n        [\n            [{args:[\"spammer\", \"spammer2\"], flags:{reason:\"spamming\", time:\"1 hour, 30 minutes, 20 seconds\"}}, \"Mutes the players spammer and spammer2 for a while. Also puts in a log as to why they were muted.\"]\n        ],\n        perm: \"MUTE\",\n        code: function (src, cmd, chan)\n        {\n            var b = new Object;\n\n            var ips = [];\n            var subnets = [];\n            var names = [];\n            var regexes = [];\n            var hostnames = [];\n\n\n            for (var x in cmd.args)\n            {\n                if (cmd.args[x].match(/^\\d+\\.\\d+\\.\\d+\\.\\d+$/))\n                {\n                    ips.push(cmd.args[x]);\n                }\n\n                else if (cmd.args[x].match(/^\\d+\\.\\d+\\.\\d+\\.\\d+\\/\\d+$/))\n                {\n                    subnets.push(cmd.args[x]);\n                }\n\n                else if (cmd.args[x].match(/^\\/.+\\/\\w*$/))\n                {\n                    regexes.push(cmd.args[x]);\n                }\n\n                else if (cmd.args[x].match(/^hostname\\/.+\\/\\w*$/))\n                {\n                    hostnames.push(cmd.args[x].replace(/^hostname\\/(.+)\\/(\\w*)$/, function (m, a, b) { return \"/\" + a + \"/\" +b; }));\n                }\n\n                else\n                {\n                    names.push(cmd.args[x]);\n                }\n\n\n            }\n\n            if (cmd.flags.ip) for (var x in names)\n            {\n                ips = this.util.concatSets(ips, [sys.dbIp(names[x])]);\n            }\n\n            var exp = 1000*60*15 + (+new Date);\n            var t = null;\n\n            if (cmd.flags.time && String(cmd.flags.time).match(/forever|infinite|indefinite/i))\n            {\n                exp = false;\n            }\n            else if (cmd.flags.time)\n            {\n                t = this.time.strToDiff(cmd.flags.time);\n\n                if (t) exp = t + +new Date;\n            }\n\n            var o =  {\n                ips: ips,\n                subnets: subnets,\n                names: names,\n                nameRegex: regexes,\n                hostnames: hostnames,\n                expires: exp,\n                reason: cmd.flags.reason,\n                author: this.user.name(src)\n            };\n\n            this.com.broadcast(\n                 this.text.escapeHTML(\n                     \"Posted mute #\" +this.security.database.muteCtr\n                 ) +\n                     \"<br/>\" + this.theme.issuehtml(o) +\n                     \"\"\n                 ,\n                 this.theme.CRITICAL,\n                 true\n             );\n\n\n\n\n            this.security.database.mutes[this.security.database.muteCtr++] = o;\n\n        }\n    }\n    ,\n    mutelist:\n    {\n        mode: \"strict\",\n        server:true,\n        category: \"security/mute\",\n        perm: \"LIST[MUTES]\",\n        code: function (src)\n        {\n            var mutes = [];\n\n            var mutelist = this.security.database.mutes;\n\n            for (var x in mutelist)\n            {\n                mutes.push (\n                    \"<b>Mute #\" + x + \":</b><br/>\" + this.theme.issuehtml(mutelist[x])\n                );\n            }\n\n            this.com.message([src], \"Mute list:<br/>\" + mutes.join(\"<br/><br/>\"), this.theme.INFO, true);\n        }\n    }\n    ,\n    loadModule: function()\n    {\n        this.commands.registerCommand(\"mute\", this);\n        this.commands.registerCommand(\"unmute\", this);\n        this.commands.registerCommand(\"mutelist\", this);\n        this.commands.registerCommand(\"unmuteall\", this);\n    }\n});\n",
 "js_modules/parseargs.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n\n({\n    require: [\"profile\"]\n    ,\n    parseArgs: function (args)\n    {\n        var retval =\n            {\n                profs: [],\n                uids: [],\n                names: []\n            };\n        \n        for (var x in args)\n        {\n            if (args[x].length == 0) continue;\n            \n            if (args[x][0] == \":\")\n            {\n                var m = args[x].match(/^:\\?(\\w+)\\.(.+)$/);\n                \n                if (!m) continue;\n                \n                (({\n                      ip: function ()\n                      {\n                          var prof = this.profile.profileByIP(m[1]);\n\n                          if (prof == -1) return;\n\n                          retval.profs.push(prof);\n\n                          this.profile.idsOfProf(prof).forEach(\n                              function (elm)\n                              {\n                                  if (retval.uids.indexOf(elm) === -1) retval.uids.push(elm);\n                              }\n                          );\n                      },\n\n                      id: function ()\n                      {\n                          var profs \n                      }\n                  })[m[1]] || this.util.nil).call(this);\n            }\n        }\n    }\n });\n \n ",
 "js_modules/parsecommand.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** Command parser\n * @name parsecommand\n * @memberOf script.modules\n * @namespace\n * */\n/** A parsed command\n * @name parsedCommand\n * @class\n */\n/** A list of all the arguments\n * @name args\n * @memberOf parsedCommand.prototype\n * @type Array\n */\n/** A list of all the flags\n * @name flags\n * @memberOf parsedCommand.prototype\n * @type Object\n */\n/** @scope script.modules.parsecommand */\n({\n     require: [\"text\"],\n\n     hotswap: true,\n\n     parsers:\n     {\n         standard:\n         {\n\n             parse:\n             function (text, src, cobj)\n             {\n\n\n\n                 var cmd = new Object, match = text.match(/^(?:!|\\/)([^\\s]*)(?:\\s+(.*))?/i);\n\n                 cmd.args = [];\n                 cmd.flags = {};\n\n                 if (!match) return cmd;\n\n                 cmd.name = match[1];\n                 cmd.input = match[2];\n\n\n                 var input = cmd.input;\n\n                 if (!input) return cmd;\n\n\n                 var that = this;\n//\n                 while (input != (input =\n\t\t\t         input.replace(/^(?:(?:-{2}(\\w+)(?:(?:=((?:\\\\(?:\\\\|;|%)|[^;\\- \\\\]| (?!-{2})|-(?!-))+))|:\"((?:[^\"\\\\]|\\\\\")*)\")?)|((?:[^;\\- =\\?%\\\\\":]|\\\\[;\\\\])(?:[^;\\- \\\\]|-(?!-)| (?!-{2})|\\\\[;-\\\\])*)|\"((?:[^\"\\\\]|\\\\\")*)\"|::(.*$)|;| |(.+$))/, cl_next))\n\t\t        //                                     ^flagname                  ^flagvalstr        ^flagvalueraw                  ^argvalstr          ^argvalraw             ^postinput\n                       ) {};\n\n\n\n                 function cl_next (text, flagname, flagvalueraw, flagvaluestr, argvalueraw, argvaluestr, postinput, fatal)\n                 {\n                     if (postinput)\n                     {\n                         cmd.postinput = postinput;\n                     }\n                     else if (flagname)\n                     {\n                         var f = ((flagvaluestr ? flagvaluestr: void 0) || flagvalueraw);\n\n                         if (f) cmd.flags[flagname] = f;//.replace(/\\\\(.)/g, \"$1\");\n                         else cmd.flags[flagname] = true;\n                     }\n                     else if (argvaluestr || argvalueraw)\n                     {\n                         cmd.args.push(((argvaluestr !== undefined ? argvaluestr: void 0) || argvalueraw));\n                     }\n\n                     else if (fatal)\n                     {\n                         cmd.error = \"Unexpected input at position \" + (cmd.input.length - input.length) + \": \" + cmd.input;\n                         cmd.errorhtml = \"Unexpected input at position \" + (cmd.input.length - input.length) + \": <b>\" + that.text.escapeHTML(cmd.input.substring(0, cmd.input.length - input.length)) + \"<font color=red>\" + that.text.escapeHTML(cmd.input.substring(cmd.input.length - input.length)) + \"</font></b>\";\n\n                         cmd.args = [];\n                         cmd.flags = {};\n                     }\n\n                     return \"\";\n                 }\n\n                 if (input)\n                 {\n\n                 }\n\n                 return cmd;\n             },\n\n             unparse:\n             function (cmd)\n             {\n                 var output = [];\n                 for (var x in cmd.args)\n                 {\n                     if (cmd.args[x].match(/[:;\"]|--/)) output.push(\"\\\"\" + cmd.args[x].replace(/\\\\/g, \"\\\\\\\\\").replace(/\"/g, \"\\\\\\\"\")+\"\\\";\");\n                     else output.push(cmd.args[x]+\";\");\n                 }\n\n                 for (var x in cmd.flags)\n                 {\n                     if (cmd.flags[x] === true) output.push(\"--\" + x+\";\");\n                     else if (!cmd.flags[x].match(/[:;\"]|--/)) output.push(\"--\" + \"=\"+ cmd.flags[x].replace(/\\\\/g, \"\\\\\\\\\"));\n                     else output.push(\"--\" + x + \":\\\"\" +  cmd.flags[x].replace(/\\\\/g, \"\\\\\\\\\").replace(/\"/g, \"\\\\\\\"\") + \"\\\";\");\n\n                 }\n\n                 if(cmd.postinput)\n                 {\n                     output.push(\"::\" + cmd.postinput);\n                 }\n\n                 return output.join(\" \");\n             }\n         },\n\n         optargs:\n         {\n             parse:\n             function (text)\n             {\n                 var cmd = new Object;\n\n                 var match = text.match(/^(?:!|\\/)([^\\s]*)(?:\\s+(.*))?/i);\n\n                 cmd.args = [];\n                 cmd.flags = {};\n\n                 if (!match) return cmd;\n\n                 cmd.name = match[1];\n                 cmd.input = match[2];\n\n                 var input = cmd.input;\n\n                 if (!input) return cmd;\n\n                 while (input != (input =\n\t\t\t          input.replace(/^\\s*(?:\\-{1,2}((?:[^\\s=]|\\\\ )+)(?:\\=(?:\\\"((?:\\\\.|[^\\\"])+)\\\"|((?:[^\\s\"]|\\\\ )+)))?)|(?:(?:\\\"((?:\\\\.|[^\\\"])+)\\\")|((?:[^\\s\"\\$]|\\\\ )+))|(?:\\$(.*))/, cl_next))\n\t\t        //                                     ^flagname                  ^flagvalstr        ^flagvalueraw                  ^argvalstr          ^argvalraw             ^postinput\n                       ) {};\n\n                 function cl_next (text, flagname, flagvaluestr, flagvalueraw, argvaluestr, argvalueraw, postinput)\n                 {\n                     if (postinput)\n                     {\n                         cmd.postinput = postinput;\n                     }\n                     else if (flagname)\n                     {\n                         var f = ((flagvaluestr ? flagvaluestr: void 0) || flagvalueraw);\n\n                         if (f) cmd.flags[flagname] = f.replace(/\\\\(.)/g, \"$1\");\n                         else cmd.flags[flagname] = true;\n                     }\n                     else\n                     {\n                         cmd.args.push(((argvaluestr !== undefined ? argvaluestr: void 0) || argvalueraw).replace(/\\\\(.)/g, \"$1\"));\n                     }\n                     return \"\";\n                 }\n\n                 return cmd;\n\n             }, // end function parsers.optargs.parse\n\n             unparse:\n             function (cmd)\n             {\n                 var output = [];\n                 for (var x in cmd.args)\n                 {\n                     output.push(JSON.stringify(cmd.args[x]));\n                 }\n\n                 for (var x in cmd.flags)\n                 {\n                     output.push(\"--\" + x + (cmd.flags[x] === true?\"\":\"=\"+ JSON.stringify(cmd.flags[x])));\n                 }\n                 if(cmd.postinput)\n                 {\n                     output.push(\"$\" + cmd.postinput);\n                 }\n\n                 return output.join(\" \");\n             } // end function parsers.optargs.unparse\n         }, // end optargs\n\n         simple:\n         {\n             parse:\n             function (text)\n\t     {\n\t         var cmd = new Object;\n\n                 var match = text.match(/^(?:!|\\/)([^\\s]*)(?:\\s+(.*))?/i);\n\n                 cmd.args = [];\n                 cmd.flags = {};\n\n                 if (!match) return cmd;\n\n                 cmd.name = match[1];\n                 cmd.input = match[2];\n\n                 var input = cmd.input;\n\n                 if (!input) return cmd;\n\n                 while (input != (input =\n\t\t\t          input.replace(/^[\\s\\*]*(?:\\:((?:[^\\s:\\*=]|\\\\.)+)(?:\\=(?:\\\"((?:\\\\.|[^\\\"])+)\\\"|((?:[^:\\*\"]|\\\\.)+)))?)|(?:(?:\\\"((?:\\\\.|[^\\\"])+)\\\")|((?:[^:\\*]|\\\\.)+))/, cl_next))\n\t\t        //                           ^flagname                          ^flagvalstr        ^flagvalueraw                  ^argvalstr          ^argvalraw\n                       ) {};\n\n                 print(input);\n\n                 function cl_next (text, flagname, flagvaluestr, flagvalueraw, argvaluestr, argvalueraw)\n                 {\n                     if (flagname)\n                     {\n                         var f = ((flagvaluestr ? flagvaluestr: void 0) || flagvalueraw);\n\n                         if (f)\n                         {\n                             cmd.flags[flagname] = f.replace(/\\\\(.)/g, \"$1\");\n                         }\n                         else\n                         {\n                             cmd.flags[flagname] = true;\n                         }\n                     }\n                     else\n                     {\n                         cmd.args.push(((argvaluestr !== undefined ? argvaluestr: void 0) || argvalueraw).replace(/\\\\(.)/g, \"$1\"));\n                     }\n                     return \"\";\n                 }\n\n                 if (cmd.flags.postinput) cmd.postinput = String(cmd.flags.postinput);\n\n                 return cmd;\n\n\t     },\n             unparse:\n             function (cmd)\n             {\n                 var output = [];\n\n                 var string = \"\";\n                 for (var x in cmd.args)\n                 {\n                     output.push(cmd.args[x].replace(/[\\:\\*\\\\]/g, \"\\\\$1\"));\n                 }\n\n                 string = output.join(\"*\");\n\n                 for (x in cmd.flags)\n                 {\n                     string += (\":\" + x + (cmd.flags[x] === true?\"\":\"=\"+ (cmd.flags[x]).replace(/[\\:\\*\\\\]/g, \"\\\\$1\")));\n                 }\n                 if (cmd.postinput) string += \":postinput=\"+ cmd.postinput.replace(/[\\:\\*\\\\]/g, \"\\\\$1\");\n\n                 return string;\n             }\n         }\n     },\n\n     loadModule: function ()\n     {\n         //\n     }\n });\n",
 "js_modules/perquiz.js": "({\n     require: [\"commands\", \"theme\", \"com\", \"chat\", \"user\"],\n\n     ADV:\n     {\n         // Primary Dual Types Ne\n\n         // Prime\n         \"ne/ti\": [\"eN/T\", \"The Inventor\", \"Stereotyped as the 'Mad Scientist', the eN/T is the best idea generator. Equivalent to ENTP in MBTI.\"],\n         \"ne/fi\": [\"eN/F\", \"The Journalist\", \"eN/Fs are compelled to make the world a better place, and to affect the opinions of those around them. MBTI ENFP.\"],\n         \"ne/si\": [\"eN/S\", \"The Pioneer\", \"Focused on doing what they love, and being good at it, the eN/S focuses on preception.\"],\n\n         // Conflicting\n         \"ne/ni\": [\"eN*\", \"The Idea Machine\", \"The eN/N has too many ideas. They need to take a BREAK FROM THINKING AND GO FOR A WALK.\" ],\n\n         // Artificial\n         \"ne/te\": [\"E+NT\", \"The Insane Dictator\", \"The E+NT is OVERLY ENTHUSIATIC, and sells their ideas HARD AND FORCEFULLY.\"],\n         \"ne/fe\": [\"E+NF\", \"The Dreamy Empath\", \"The E+NF might be preoccupied with some social ideal, with no focus on themselves.\"],\n         \"ne/se\": [\"E+NS\", \"The ADD Manic\", \"Please don't get me started.\"],\n\n         // Primary Dual Types Ni\n\n         \"ni/te\": [\"iN/T\", \"The Scientist\", null],\n         \"ni/fe\": [\"iN/F\", \"The Psychologist\", null],\n         \"ni/se\": [\"iN/S\", \"The Strategist\", null],\n\n\n         \"ni/ne\": [\"iN*\", \"The Psychic Theorist\", \"Completely lost in their heads, the iN/N loves all things theoretical. Particularly capable at predicting all the possibles courses of events and reacting to them.\"],\n\n\n         \"ni/ti\": [\"I+NT\", \"The Schizofrenic\", null],\n         \"ni/fi\": [\"I+NF\", \"The Psychotic Strategist\", null],\n         \"ni/si\": [\"I+NS\", \"The Autistic Thinker\", null],\n\n\n         // SE\n\n         \"se/fi\": [\"eS/F\", \"The Fun One\", null],\n         \"se/ti\": [\"eS/T\", \"The Doer\", null],\n         \"se/ni\": [\"eS/N\", \"The Tactician\", null],\n\n         \"se/si\": [\"eS*\", \"The Practicioner\", null],\n\n         \"se/fe\": [\"E+SF\", \"The, HyyyperacTIVE!1!!1one!\", null],\n         \"se/te\": [\"E+ST\", \"The Draconian Madman\", null],\n         \"se/ne\": [\"E+SN\", \"The ADHD Nut\", null],\n\n\n         // Si\n\n         \"si/fe\": [\"iS/F\", \"The Law Enforcement\", null],\n         \"si/te\": [\"iS/T\", \"The Coffee Lover\", null],\n         \"si/ne\": [\"iS/N\", \"The Suggestor\", null],\n\n         \"si/se\": [\"iS*\", \"The Detailer\", null],\n\n         \"si/ti\": [\"I+ST\", \"The Paranoid One\", null],\n         \"si/fi\": [\"I+SF\", \"The Sentimentalist\", null],\n\n         // Primary Dual Types Ti\n\n         \"ti/ne\": [\"iT/N\", \"The Architect\", null],\n         \"ti/fe\": [\"iT/F\", \"The Social Engineer\", null],\n         \"ti/se\": [\"iT/S\", \"The Craftsman\", null],\n\n         \"ti/te\": [\"iT*\", \"The Empricist\", null],\n\n         \"ti/ni\": [\"I+TN\", \"The Schizoid\", null],\n         \"ti/fi\": [\"I+TF\", \"The Inquizitor\", null],\n         \"ti/si\": [\"I+TS\", \"The Knowledge Keeper\", null],\n\n\n         // FI\n         \"fi/ne\": [\"iF/N\", \"The Idealist\", null],\n         \"fi/te\": [\"iF/T\", \"The Moral Order Enforcer\", null],\n         \"fi/se\": [\"iF/S\", \"The Artist\", null],\n\n         \"fi/fe\": [\"iF*\", \"The Rather Emotional\", null],\n\n         \"fi/ni\": [\"I+TN\", \"The Insane Doomsay Prepper\", null],\n         \"fi/ti\": [\"I+TF\", \"The Delusional Idealist\", null],\n         \"fi/si\": [\"I+TS\", \"The Scarred\", null],\n\n         // TE\n\n         \"te/ni\": [\"eT/N\", \"The Executive\", null],\n         \"te/si\": [\"eT/S\", \"The Administrator\", null],\n         \"te/fi\": [\"eT/F\", \"The Extremist Nut\", null],\n\n         \"te/ti\": [\"eT*\", \"The Judge\", null],\n\n         \"te/fe\": [\"E+TF\", \"The Harmonizer\", null],\n         \"te/ne\": [\"E+TN\", \"The Juggernaut\", null],\n         \"te/se\": [\"E+TS\", \"The Opportunist\", null],\n\n         // FE\n\n         \"fe/ti\": [\"eF/T\", \"The Merry One\", null],\n         \"fe/si\": [\"eF/S\", \"The Guardian\", null],\n         \"fe/ni\": [\"eF/N\", \"The Counselor\", null],\n\n         \"fe/fi\": [\"eF*\", \"The Empath\", null],\n\n         \"fe/te\": [\"E+FT\", \"The Cult Master\", null],\n         \"fe/ne\": [\"E+FN\", \"The Bubbly One\", null],\n         \"fe/se\": [\"E+FS\", \"The Initiator\", null],\n\n\n\n     },\n\n     loadModule: function ()\n     {\n         this.commands.registerCommand(\"perquiz\", this);\n     },\n     perquiz:\n     {\n         server: false,\n\n         desc: \"Take a free personality quiz!\",\n\n         perm: function () {return true;},\n\n         code: function (src, cmd, chan)\n         {\n             var i = 0;\n\n             var bind = this;\n\n             var quizObj = {};\n\n             var answers = [];\n\n             function answerQ (src, value, chan)\n             {\n                 if (value == \"exit\")\n                 {\n                     bind.com.message(src, \"Exited quiz\");\n                 }\n\n                 var num = +value;\n\n                 if (num < -5)\n                 {\n                     bind.com.warn(src, \"Input invlalid, treating as -5\");\n                     num = -5;\n                 }\n\n                 if (num > 5) num = 5;\n\n                 if (! (num > 2 || num < 4)) num = 0;\n\n                 var elm = bind.QUIZ[i][1];\n\n                 if (!quizObj[elm]) quizObj[elm] = 0;\n\n                 quizObj[elm] += num;\n                 answers.push([i, sys.sha1(bind.QUIZ[i][0]), num]);\n\n                 i++;\n                 if (i >= bind.QUIZ.length)\n                 {\n                     endQ();\n\n                     return;\n                 }\n\n                 else nextQ();\n             }\n\n             function nextQ ()\n             {\n\n\n                 bind.com.message(src, bind.QUIZ[i][0], bind.theme.GAME);\n\n                 bind.chat.registerCapture(src, answerQ, bind);\n\n\n             }\n\n             function endQ()\n             {\n                 var type = new Array(4);\n\n                 type[0] = (quizObj.ti + quizObj.fi + quizObj.si + quizObj.ni > quizObj.te + quizObj.fe + quizObj.ne + quizObj.se ? \"I\":\"E\");\n                 type[1] = (quizObj.ni + quizObj.ne > quizObj.si + quizObj.se ? \"N\":\"S\");\n                 type[2] = (quizObj.ti + quizObj.te > quizObj.fe + quizObj.fi ? \"T\":\"F\");\n                 type[3] = (quizObj.ti + quizObj.fi + quizObj.ne + quizObj.se > quizObj.te + quizObj.fe + quizObj.ni + quizObj.si ? \"P\":\"J\");\n\n                 // Now find Adva+ Type\n\n                 var types = [[\"fe\", quizObj.fe], [\"fi\", quizObj.fi], [\"te\", quizObj.te], [\"ti\", quizObj.ti], [\"ne\", quizObj.ne], [\"ni\", quizObj.ni], [\"si\", quizObj.si], [\"se\", quizObj.se]];\n\n                 types.sort(function(a, b)\n                            {\n                                return b[1] - a[1];\n                            });\n\n                 var adva = bind.ADV[types[0][0] + \"/\" + types[1][0]][0]+\" - \" + bind.ADV[types[0][0] + \"/\" + types[1][0]][1];\n\n\n\n                 bind.com.broadcast(bind.user.name(src) + \" got this personality result!: MBTI: \" + type.join(\"\") + \", Adva+: \"+adva+\"!\", bind.theme.GAME);\n\n                 sys.append(\"perquiz.log\", JSON.stringify([bind.user.name(src), sys.ip(src), answers, type]));\n             }\n\n\n             this.com.message(src, \"Free MBTI-like personality type quiz! Simply type your responce into the chatbox, after you have answered all the questions your answers will be analyzed and the result shared with others in the chat! Have fun! (To quit, type 'exit')\", bind.theme.GAME);\n\n             nextQ();\n         }\n\n     },\n\n     QUIZ:\n     [\n         [\"On a scale: -5 (Aloof and distant) to 5 (Aware of your surroundings) you are:\", \"se\"],\n         [\"On a scale: -5 (Often forget where things are) to 5 (Always remember where you put things) you are:\", \"si\"],\n         [\"On a scale: -5 (Oblivious to unusual, clever solutions that may exist) to 5 (See all the various unusual ways things could be done) you are:\", \"ne\"],\n         [\"On a scale: -5 (Unable to predict the future) to 5 (Aware of the future) you are:\", \"ni\"],\n         [\"On a scale: -5 (Oblivious to the underlying mechanisms of reality) to 5 (Easily understand the rules and laws which objects and things operate under) you are:\", \"ti\"],\n         [\"On a scale: -5 (Unconcerned with structure) to 5 (Structured, goal-oriented and effective) you are:\", \"te\"],\n         [\"On a scale: -5 (Unable to read the emotional atmosphere) to 5 (Able to emphasize easily) you are:\", \"fe\"],\n         [\"On a scale: -5 (Unprone to sympathy and moral laws) to 5 (Easily sympatsize with others, value morality) you are:\", \"fi\"],\n         [\"On a scale: -5 (Not at all) to 5 (I feel trapped in life, I always want to rush to the next thing to do, create, thing to learn or project to start. I get bored easily and learn quickly) you are:\", \"ne\"],\n         [\"On a scale: -5 (Not at all) to 5 (I have unusual dreams or symbolic image preceptions that give me insight into the true workings or reality or my goals) you are:\", \"ni\"],\n         [\"On a scale: -5 (Not at all) to 5 (I feel energized, like power flows through my blood. I see things that are real with the greatest clarity, aware of everything around me.) you are:\", \"se\"],\n         [\"On a scale: -5 (Not at all) to 5 (Everything has a value, one or the other. I act to keep things of value preserved and protected. Traditions, structures, family and comfort are all important to me) you are:\", \"si\"],\n         [\"On a scale: -5 (Not at all) to 5 (Always evaluating things based on what their real value is) you are:\", \"te\"],\n         [\"On a scale: -5 (Not at all) to 5 (Seek to understand the most complicated truths which escape preception of the common minds) you are:\", \"ti\"],\n         [\"On a scale: -5 (Not at all) to 5 (Always concerned with other people's opinions and input, always coopertive) you are:\", \"fe\"],\n         [\"On a scale: -5 (Not at all) to 5 (Guided by an inate sense of right and wrong, good an evil) you are:\", \"fi\"],\n         [\"On a scale: -5 (Neither or not both) to 5 (Both very aware of my surroundings and always having new ideas) you are:\", \"ne/se-contra\"],\n         [\"On a scale: -5 (Neither or not both) to 5 (Both very conerned with notions of absolute truth and concerned with morality) you are:\", \"ti/fi-contra\"],\n         [\"On a scale: -5 (Neither or not both) to 5 (Both very evaluating, logical, concerned with efficiency, and coopertive, concerned with people's input and opinions) you are:\", \"te/fe-contra\"],\n         [\"On a scale: -5 (Neither or not both) to 5 (Both very concerned with the possible future and destiny of humanity and concerned with the traditions, structures, and past) you are:\", \"ni/si-contra\"]\n\n     ]\n });\n",
 "js_modules/playerlist.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"commands\", \"theme\", \"com\", \"less\", \"text\", \"user\"],\n\n\n     loadModule: function ()\n     {\n         this.commands.registerCommand(\"playerlist\", this);\n     },\n\n     playerlist:\n     {\n         desc: \"Lists all the online players.\",\n         category: \"basic\",\n\n\n         options:\n         {\n             chan: \"Lists players in the current channel.\"\n         },\n\n\n         server: true,\n\n         perm: function () { return true; },\n\n         code: function (src, cmd, chan)\n         {\n             var pids;\n             if (cmd.flags.chan)\n             {\n                 pids = sys.playersOfChannel(chan);\n             }\n\n             else\n             {\n                 pids = this.user.users();\n             }\n\n             var msgs = [];\n\n             for (var x in pids)\n             {\n                 var i = pids[x];\n                 msgs.push(\"<b>\" + i + \"</b> \" + this.text.escapeHTML(this.user.name(i)));\n             }\n\n             this.com.message(src, \"Online Players:\", this.theme.INFO);\n\n             this.less.less(src, msgs.join(\"<br />\"), true);\n\n\n         }\n\n     }\n});",
 "js_modules/publicfix.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n    counter: 0\n    ,\n    step: function ()\n    {\n        if (this.counter++ >= 60 && !sys.isServerPrivate())\n        {\n            sys.makeServerPublic(false);\n            sys.makeServerPublic(true);\n            this.counter = 0;\n        }\n    }\n});\n",
 "js_modules/ranking.js": "({\n     require: [\"commands\", \"com\", \"theme\", \"util\", \"text\", \"user\"],\n\n     meta:\n     {\n         commands: [\"ranking\"]\n     },\n\n     ranking:\n     {\n         aliases: [\"rating\"],\n         category: \"pokemon\",\n         desc: \"Shows your ranking in the ladder. May add tiers.\",\n         options:\n         {\n             rating: \"Show your raw score.\"\n         },\n         perm: function () { return true; },\n\n         server: false,\n         code: function (src, cmd, chan)\n         {\n             var r, total, tier, tierx, tiers, x, c, i;\n\n             if (cmd.name == \"rating\") cmd.flags.rating = true;\n\n             tiers = cmd.args;\n\n             if (tiers.length === 0)\n             {\n                 c = sys.teamCount(src);\n\n                 for (i = 0; i < c; i++)\n                 {\n                     tiers.push(sys.tier(src, i));\n                 }\n             }\n\n             tiers = this.util.concatSets(tiers);\n\n              this.com.message(src, \"Ranking\"+(tiers.length === 1 ?\"\":\"s\")+\":\");\n\n             for (x in tiers)\n             {\n                 tier = tiers[x];\n                 tierx = this.text.escapeHTML(tier);\n\n                 r = sys.ranking(this.user.name(src), tier);\n                 total = sys.totalPlayersByTier(tier);\n\n                 if (!total)\n                 {\n                     this.com.message(src, \"ERROR: No such tier \" + tier + \"!\", this.theme.WARN);\n                 }\n                 else if (!r)\n                 {\n                     this.com.message(src, \"ERROR: You are not ranked in \" + tier + \"!\", this.theme.WARN);\n                 }\n                 else\n                 {\n                     this.com.message(src, \"<b>\" + tierx + \"<b/>: \"+\"Ranked \" + rank + \" out of \" + sys.totalPlayersByTier(tier) + \" players. \"+(cmd.flags.rating?\"Score \" + sys.ladderRanking(src, tier)+\" \":\"\")+\"(Top \"+Math.ceil(rank/total*10000)/100 +\"%)\", -1, true);\n                 }\n             }\n         }\n\n\n     }\n\n });",
 "js_modules/readlogs.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n    require: [\"com\", \"theme\", \"logs\", \"commands\", \"less\", \"text\", \"user\"]\n    ,\n    readlogs:\n    {\n        server: true,\n\n        category: \"administrative\",\n\n        options:\n        {\n            count: \"How many entries to read.\",\n            trace: \"Show backtraces if available.\",\n            types: \"Comma separated types of log messages to show\",\n            match: \"Pattern matching\"\n//            deep: \"Deep log reading\"\n        },\n\n        perm: function (src)\n        {\n            return \"LOGS\" in this.user.groups(src);\n        }\n        ,\n        code: function (src, cmd, chan)\n        {\n            var g = this.user.groups(src);\n\n            var count = (+cmd.flags.count) || 35;\n            var ptypes = cmd.flags.types || cmd.flags.type;\n            if (ptypes) ptypes = ptypes.split(/,/g);\n            else ptypes = [\"chat\", \"script\", \"io\", \"scripterror\", \"user\", \"command\", \"security\"];\n            var trace = cmd.flags.trace;\n            var types = [];\n\n            if (! (\"ALLPERMS\" in g || \"LOGS[*]\" in g) ) for (var x in ptypes)\n            {\n                if ((\"LOGS[\" + ptypes[x].toUpperCase() + \"]\") in g)\n                {\n                    types.push(ptypes[x]);\n                }\n\n                else if (cmd.flags.type || cmd.flags.types) // only warn if the user specified types manually.\n                {\n                    this.com.message(src, \"Permission Denied: Can't view logs of type \" + ptypes[x] + \".\", this.theme.WARN, false, chan);\n                }\n            }\n\n            else types = ptypes;\n\n\n            var msgs = [];\n\n            for (var i = this.logs.logs.length - 1; i >= 0 && count > 0; i--)\n            {\n                if (types.indexOf(this.logs.logs[i].level) !== -1 && (!cmd.flags.match || this.text.escapeHTML(this.logs.logs[i].msg).indexOf(cmd.flags.match) !== -1))\n                {\n\n                    msgs.push(\n                        \"<b>Type \" + this.logs.logs[i].level + \"</b> at <em>\" + (this.logs.logs[i].time||\"?\") + \"</em>: \" + this.text.escapeHTML(this.logs.logs[i].msg) +\n                            ( !trace || !this.logs.logs[i].trace ? \"\" : \"<br/><code>\" + this.text.escapeHTML(this.logs.logs[i].trace) + \"</code>\")\n                    );\n                    count--;\n                }\n            }\n\n            this.less.less(src, \"<b>Logs:</b><hr/>\" + msgs.join(\"<br/>\") + \"<hr/>\", true, chan);\n        }\n    }\n    ,\n    loadModule: function ()\n    {\n        this.commands.registerCommand(\"readlogs\", this);\n    }\n});\n",
 "js_modules/reputation.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n    \n    require: [\"io\", \"profile\"]\n    ,\n    database: null\n    ,\n    times: new Object\n    ,\n    loadModule: function ()\n    {\n        this.database = this.io.openDB(\"reputation\");\n\n        if (!this.database.users) this.database.users = new Object;\n        \n        this.script.registerHandler(\"afterLogIn\", this);\n        this.script.registerHandler(\"beforeLogOut\", this);\n\n        var u = sys.playerIds();\n\n        for (var x in u)\n        {\n            this.afterLogIn(u[x]);\n        }\n    }\n    ,\n    unloadModule: function()\n    {\n        var u = sys.playerIds();\n\n        for (var x in u)\n        {\n            this.beforeLogOut(u[x]);\n        }\n\n        this.io.closeDB(\"reputation\");\n    }\n    ,\n    updateReputation: function (src)\n    {\n        var now = +new Date;\n        var p = sys.name(src).toLowerCase();\n        \n        if (!this.database.users[p]) this.database.users[p] = 0;\n        \n        if (!this.times[p]) this.times[p] = now;\n        else \n        {           \n            var diff = now - this.times[p];\n            var minutes =  ~~(diff / 1000 / 60);\n            this.database.users[p] += minutes;\n            \n            this.times[p] = now;\n            this.io.markDB(\"reputation\");\n        }\n    }\n    ,\n    reputationOf: function (src)\n    {\n        return this.database.users[sys.name(src).toLowerCase()] || 0;        \n    }\n    ,\n    afterLogIn: function (src)\n    {\n        this.updateReputation(src);        \n    }\n    ,\n    beforeLogOut: function (src)\n    {\n        var p = sys.name(src).toLowerCase();\n        this.updateReputation(src);\n        delete this.times[p];\n    }\n});\n\n\n",
 "js_modules/reputation_command.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n    require: [\"reputation\", \"commands\", \"profile\", \"com\"]\n    ,\n    reputation_cmd: \n    {\n        desc: \"Shows your reputation\"\n        ,\n        perm: function () { return true }\n        ,\n        code: function (src, cmd, chan) \n        {\n            var p = sys.name(src).toLowerCase();\n\n            this.reputation.updateReputation(src);\n\n            this.com.message([src], \"Your reputation score is: \" + this.reputation.database.users[p]);\n            return;\n        } \n    }\n    ,\n    loadModule: function ()\n    {\n        this.commands.registerCommand(\"reputation\", this, \"reputation_cmd\");\n    }\n});\n",
 "js_modules/reset.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"commands\", \"com\", \"theme\", \"logs\"],\n\n\n     loadModule: function ()\n     {\n         this.commands.registerCommand(\"resetscript\", this);\n\n     },\n\n\n     resetscript:\n     {\n         category: \"system\",\n         server: true,\n         perm: \"RESETSCRIPT\",\n\n         code: function (src, cmd, chan)\n         {\n             if (!cmd.flags.force)\n             {\n                 this.com.message(src, \"Must specify --force.\", this.theme.WARN);\n                 return;\n             }\n\n             if (cmd.flags.warn) this.com.broadcast(\"Restating scripts.\");\n\n             this.logs.logMessage(this.logs.SCRIPT, \"Restarting script from file.\");\n             sys.changeScript(sys.read(\"scripts.js\"));\n\n         }\n     }\n\n });",
 "js_modules/rpg_actions.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     rpgActions:\n     {\n\n         walk: function (src, sub, chan, ctx)\n         {\n             var x, i, steps = 0, adj, dest;\n\n             if (ctx.player.activeActions.length != 0) return;\n\n             const areas = this.areas[ctx.player.area];\n             adj = areas.adjc;\n\n             if (sub.length == 1)\n             {\n                 this.com.message(ctx.player.src, \"You are at: \" + this.areas[ctx.player.area].name + (this.areas[ctx.player.area].desc?\": \" + this.areas[ctx.player.area].desc : \"\")+ \"\\nFrom here you can go to:\", this.theme.GAME, false, chan);\n                 for ( i = 0; i < this.areas[ctx.player.area].adjc.length; i++)\n                 {\n                     var obj = this.areas[ctx.player.area].adjc[i];\n                     var name = (typeof obj === \"string\" ? obj : obj.area);\n                     var dist = (typeof obj === \"string\" ? 10  : obj.distance);\n                     var areaObj = this.areas[name];\n                     this.com.message(ctx.player.src, areaObj.name + \" (\" + name + \") Distance: \" + dist , -1, false, chan);\n                 }\n                 this.com.message(ctx.player.src, \"Other players in this area:\", this.theme.RPG, false, chan);\n                 var pll = this.activeState[ctx.rpg.name].players;\n                 for (x in pll)\n                 {\n                     if (pll[x] != ctx.player && pll[x].area == ctx.player.area && sys.exists(pll[x].src) && sys.isInChannel(pll[x].src, chan))\n                     {\n                         this.com.message(ctx.player.src, pll[x].name + \" [level \"+this.level(pll[x].totalexp)+\"]\" + (pll[x].battle ? \" [battling]\": \"\"), this.theme.RPG, false, chan);\n\n                     }\n                 }\n                 return;\n             }\n\n\n\n             l0: for (i = 1; i < sub.length; i++)\n             {\n                 var to = sub[i];\n\n                 l1:\n                 {\n\n                     for (x in adj)\n                     {\n                         if (typeof adj[x] == \"string\")\n                         {\n                             if (adj[x] == to)\n                             {\n                                 steps = 10;\n                                 break l1;\n                             }\n                         }\n                         else if (adj[x].area == to)\n                         {\n                             steps = adj[x].distance;\n                             break l1;\n                         }\n                     } // end for loop\n\n\n                     this.com.message([src], \"Can't find that place!\", this.theme.RPG, false, chan);\n                     break l0;\n                 } // end l1\n\n                 if (ctx.player.sp < steps)\n                 {\n                     this.com.message(src, \"Not enough stamina (SP)!\", this.theme.RPG);\n                     break l0;\n                 }\n\n\n                 dest = to;\n                 adj = this.areas[to].adjc;\n\n                 ctx.player.activeActions.push({ timer: Math.max(Math.round(steps/10), 1), sp:steps, done: \"walk\", to: to });\n\n             }\n\n             if (dest)\n             {\n                 this.com.message(ctx.player.src, \"You started walking to \" +this.areas[dest].name+ \"!\", this.theme.GAME, false, chan);\n//                 ctx.player.activeActions.push({ timer:1, done: \"location\"});\n             }\n\n\n\n         },\n\n         contemplate:\n         function (src, sub, chan, ctx)\n         {\n             var i, count = Number(+sub[1]) || 1;\n\n             if (ctx.player.activeActions.length != 0) return;\n\n             count = Math.min(Math.max(count, 1), 50);\n\n             for (i = 0; i < count; i++) ctx.player.activeActions.push({ timer: 1, done: \"contemplate\" });\n         },\n\n         allowtransfer:\n         function (src, sub, chan, ctx)\n         {\n             const cons = [\"s\", \"t\", 'r','l','p','v','z','n','m','th','sh','f','c'];\n             const vowls = ['a','e','i','o','u','ae','ie','ou', 'oo'];\n\n             var q = Math.floor(Math.random()*3)+4;\n\n             var password = \"\";\n\n\n             for (var i = 0; i < q; i++)\n             {\n                 if (i%2 == 0)\n                 {\n                     password += cons[Math.floor(Math.random()*cons.length)];\n                 }\n                 else\n                 {\n                     password += vowls[Math.floor(Math.random()*vowls.length)];\n                 }\n             }\n\n             ctx.player.transfer = {password: sys.sha1(password), attempts: 3};\n\n             this.com.message(src, \"Your transfer password is: \" + password);\n         },\n\n         recievechar:\n         function (src, sub, chan, ctx, cmd)\n         {\n             var username, password;\n\n             this.chat.registerCapture(src, getUName, this);\n\n             this.com.message(src, \"You are about to recieve another account's RPG character, the RPG character belonging to the account \"+this.user.name(src)+\" will be lost if the transfer suceeds. Please enter the username into the chat or type exit:\");\n             function getUName (src2, msg, chan2)\n             {\n                 this.chat.registerCapture(src, getPassWd, this);\n                 this.com.message(src, \"Please enter the transfer password into the chat:\");\n                 username = msg;\n             }\n\n             function getPassWd (src2, msg, chan2)\n             {\n                 if (msg == \"exit\") return;\n                 password = sys.sha1(msg); msg = null;\n\n\n                 var newp = this.getPlayer(ctx.rpg.name, username);\n\n                 if (!newp)\n                 {\n                     this.com.message(src, \"Couldn't find that player.\");\n                     return;\n                 }\n\n                 if (!newp.transfer)\n                 {\n                     this.com.message(src, \"Type /rpg allowtransfer on the other account first\");\n                     return;\n                 }\n\n                 if (newp.transfer.password != password)\n                 {\n                     this.com.message(src, \"Password mismatch. Logged in the server security logs. \" + --newp.transfer.attempts + \" of 3 password attempts remaining before /rpg allowtransfer must be reisssued.\", this.theme.CRITICAL);\n                     this.logs.logMessage(this.logs.WARN, \"Password mismatch. \" + this.user.name(src) + \" (IP: \"+sys.ip(src)+\") tried to recieve the RPG character belonging to \" + newp.name + \" but entered the wrong password!\");\n\n                     if (newp.transfer.attempts <= 0 || !newp.transfer.attempts)\n                     {\n                         delete newp.transfer.attempts;\n                     }\n\n                     return;\n                 }\n\n                 if (this.transferPlayer(ctx.rpg.name, newp.name, this.user.name(src)))\n                 {\n                     this.com.message(src, \"Character error.\");\n                 }\n                 else\n                 {\n                     this.com.broadcast(newp.name + \"'s RPG character transfered to \" + this.user.name(src));\n                 }\n             }\n\n             function recieveChar ()\n             {\n\n             }\n\n\n         },\n\n         dig: function (src, sub, chan, ctx)\n         {\n             ctx.player.activeActions.push({ timer: 40, done: \"dig\", tick: \"digTick\" });\n         },\n\n         flee: function (src, sub, chan, ctx)\n         {\n             if (!ctx.player.battle) return;\n\n             if (ctx.player.flee) return;\n             ctx.player.flee = 3;\n             this.com.message(ctx.player.src, \"You plan to flee this battle!\", this.theme.GAME, false, chan);\n         },\n\n         dequip: function (src, sub, chan, ctx)\n         {\n             var slot = (sub[1]||\"\").toLowerCase();\n\n             if (! (slot in {\"lhand\":null, \"rhand\":null, \"head\":null, \"feet\":null, \"body\":null, \"back\":null}))\n             {\n                 this.com.message([src], \"Unknown slot to dequip\");\n                 return;\n             }// add error message\n\n             var item = ctx.player[slot];\n\n             if (item === undefined) throw new Error(\"???\");\n\n             if (item === null && slot === \"lhand\" && ctx.player.rhand && ctx.player.rhand.hands === 2)\n             {\n                 item = ctx.player.rhand;\n                 slot = \"rhand\";\n             }\n\n             if (item === null)\n             {\n                 this.com.message(src, \"No item in that slot.\");\n                 return; // nothing to dequip\n             }\n\n             ctx.player[slot] = null; // remove item\n\n             ctx.player.equips.unshift(item); // Add to equips\n\n             this.com.message([src], \"Item removed.\");\n\n         },\n\n         battle: function (src, sub, chan, ctx)\n         {\n             var x;\n             if (ctx.player.battle) return;\n\n             if (! ctx.rpg.battleCounter) ctx.rpg.battleCounter = 0;\n\n             var mobs = [];\n\n             var ares = this.areas[ctx.player.area];\n             var mba = [];\n\n             if (ares.mobs)\n             {\n\n                 var totalProb = 0;\n\n                 for (x in this.areas[ctx.player.area].mobs)\n                 {\n                     totalProb += this.areas[ctx.player.area].mobs[x].prob;\n                 }\n\n                 var rnd = Math.random()*totalProb;\n\n                 var s = 0;\n\n                 for (x in this.areas[ctx.player.area].mobs)\n                 {\n                     s += this.areas[ctx.player.area].mobs[x].prob;\n                     if (rnd <= s)\n                     {\n                         mobs = mobs.concat(this.areas[ctx.player.area].mobs[x].mobs);\n                     break;\n                     }\n\n                 }\n\n                 for (x in mobs) mba.push(this.mkMob(mobs[x]));\n             } else if (ares.battle)\n             {\n                 for (var x in ares.battle)\n                 {\n                     var count = 0;\n                     var bt = ares.battle[x];\n                     var min = (typeof bt.min == typeof Number() ? bt.min : 1);\n                     var max = bt.max || 3;\n\n                     count = min;\n\n                     var prob = bt.prob || 0.5;\n\n                     while (count < max && Math.random() < prob) count++;\n\n                     if (count < min) count = min;\n\n                     for (var i = 0; i < count; i++) { mba.push(this.mkMob(bt.mob || \"testchicken\")); mobs.push(this.mobs[bt.mob || \"testchicken\"].name);}\n                 }\n             }\n\n\n\n\n\n             if (mba.length == 0)\n             {\n                 this.com.message(src, \"No mobs here to battle!\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             var batId = this.newBattle(ctx.rpg);\n             var batObj = this.getBattle(ctx.rpg, batId);\n\n             ctx.player.battle = batId;\n             batObj.teams = [[ctx.player.name], mba];\n\n             this.com.message(sys.id(ctx.player.name), \"You started battle with \" + mobs.join(\", \") + \"!\", this.theme.RPG, false,chan);\n\n              var pll = this.activeState[ctx.rpg.name].players;\n             for (x in pll)\n             {\n                 if (pll[x] != ctx.player && pll[x].area == ctx.player.area && sys.exists(pll[x].src) && sys.isInChannel(pll[x].src, chan))\n                 {\n                     this.com.message(pll[x].src, ctx.player.name + \" started a battle! You can watch it using /rpg watch \" + ctx.player.name, this.theme.RPG, false, chan);\n                 }\n             }\n\n\n         },\n\n\n\n         challenge:\n         function(src, sub, chan , ctx)\n         {\n             var plname = ctx.action.match(/challenge(?:[,\\/| ]([^;]+)$)?/)[1];\n             if (!plname)\n             {\n                 this.com.message(src,  \"Enter a player name (e.g. /rpg challenge ArchZombie0x)\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             var pl = this.getPlayer(ctx.rpg.name, plname, true);\n\n             if (!pl)\n             {\n                 this.com.message(src,  \"No such player!\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             if (ctx.player.battle)\n             {\n                 this.com.message(src,  \"Leave your battle first!\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             ctx.player.chall = {name: plname.toLowerCase(), time: + new Date};\n\n             if (pl.chall && pl.chall.name == ctx.player.name.toLowerCase())\n             {\n\n                 if ((+new Date) - pl.chall.time >= 60*1000)\n                 {\n                      this.com.message(src, \"The other player's challenge expired by timeout.\", this.theme.RPG, false, chan);\n\n                 }\n                 else\n                 {\n                     if (pl.battle || ctx.player.battle)\n                     {\n                         this.com.message([src, pl.src],  \"Leave your battles first before PvP!\", this.theme.RPG, false, chan);\n                         return;\n                     }\n\n                     if (pl.area != ctx.player.area)\n                     {\n                         this.com.message([src, pl.src],  \"You must be in the same area to PvP!\", this.theme.RPG, false, chan);\n                         return;\n                     }\n\n\n                     this.com.message([pl.src, src], \"Started battle between \" + pl.name + \" and \" + ctx.player.name + \"!\", this.theme.RPG, false, chan);\n\n                     delete pl.chall;\n                     delete ctx.player.chall;\n                     var batId = this.newBattle(ctx.rpg);\n                     var batObj = this.getBattle(ctx.rpg, batId);\n\n                     batObj.allowJoins = false;\n\n                     ctx.player.battle = batId;\n                     pl.battle = batId;\n                     batObj.teams = [[pl.name], [ctx.player.name]];\n\n                     this.com.message([pl.src, src], \"Battle betwen \" + pl.name + \" and \" + ctx.player.name + \"!\", this.theme.RPG, false,chan);\n\n                     var pll = this.activeState[ctx.rpg.name].players;\n                     for (x in pll)\n                     {\n                         if (pll[x] != ctx.player && pll[x] != pl && pll[x].area == ctx.player.area && sys.exists(pll[x].src) && sys.isInChannel(pll[x].src, chan))\n                         {\n                             this.com.message(pll[x].src, ctx.player.name +\" and \" + pl.name + \" started a battle! You can watch it using /rpg watch \" + pl.name, this.theme.RPG, false, chan);\n                         }\n                     }\n\n                     return;\n                 }\n\n\n             }\n\n             this.com.message(pl.src, ctx.player.name + \" challenged \" + pl.name + \"! Type '/rpg challenge \" + ctx.player.name + \"' to accept!\", this.theme.RPG, false, chan);\n             this.com.message(src, ctx.player.name + \" challenged \" + pl.name + \"!\", this.theme.RPG, false, chan);\n\n         },\n\n         look:\n         function (src, sub, chan, ctx)\n         {\n            /* this.com.message(src, \"Players in this area:\", this.theme.RPG, false, chan);\n             var pll = this.activeState[ctx.rpg.name].players;\n             for (var x in pll)\n             {\n                 if (pll[x].area == ctx.player.area)\n                 {\n                     this.com.message(src, pll[x].name + \"[level \"+this.level(pll[x].totalexp)+\"]\" + (pll[x].battle ? \" [battling]\": \"\"), this.theme.RPG, false, chan);\n                 }\n             }*/\n         },\n\t /*\n         test: function (src, sub, chan, ctx)\n         {\n             if (! ctx.rpg.battleCounter) ctx.rpg.battleCounter = 0;\n\n             ctx.player.battle = ctx.rpg.battleCounter;\n             ctx.rpg.battles[ctx.rpg.battleCounter++] = {players: [ctx.player.name], mobs: [this.mkMob(\"testchicken\")]};\n\n\n             for (var x in this.areas[ctx.player.area].mobs)\n             {\n                 this.com.message(sys.id(ctx.player.name), \"You started battle with \" + JSON.stringify(this.areas[ctx.player.area].mobs[x]), this.theme.GAME);\n             }\n         }*/\n         //,\n         view: function (src, sub, chan, ctx)\n         {\n             var msgs = [];\n\n             this.com.message(src, \"Your player:\", this.theme.RPG, false, chan);\n             msgs.push(\"<b>Level:</b> \" + this.level(ctx.player.totalexp || 0));\n\n             this.com.message(src, this.entHtml(ctx.player, sys.os(src) == \"android\"), this.theme.GAME, true, chan);\n             /*\n             if (ctx.player.rhand && this.equips[ctx.player.rhand.type].hands === 2)\n             {\n                 msgs.push(\"<b>Both Hands:</b> \" + this.equipName(ctx.player.rhand));\n             }\n             else\n             {\n                 msgs.push(\"<b>Right Hand:</b> \" + this.equipName(ctx.player.rhand));\n                 msgs.push(\"<b>Left Hand:</b> \" + this.equipName(ctx.player.lhand));\n             }\n             msgs.push(\"<b>Head:</b> \" + this.equipName(ctx.player.head));\n             msgs.push(\"<b>Body:</b> \" + this.equipName(ctx.player.body));\n             msgs.push(\"<b>Feet:</b> \" + this.equipName(ctx.player.feet));\n             msgs.push(\"<b>Back:</b> \" + this.equipName(ctx.player.back));\n             */\n\n             msgs.push(\"<b>RES:</b> \" + Math.floor(ctx.player.res));\n             msgs.push(\"<b>STR:</b> \" + Math.floor(ctx.player.str));\n             msgs.push(\"<b>STA:</b> \" + Math.floor(ctx.player.sta));\n             msgs.push(\"<b>SPD:</b> \" + Math.floor(ctx.player.spd));\n             msgs.push(\"<b>MEN:</b> \" + Math.floor(ctx.player.men));\n             msgs.push(\"<b>MAG:</b> \" + Math.floor(ctx.player.mag));\n             msgs.push(\"<b>PSY:</b> \" + Math.floor(ctx.player.psy));\n            // msgs.push(\"<b>SPR:</b> \" + 0/0);\n\n             this.less.less(src, msgs.join(\"<br />\"), true, chan);\n         },\n\n         stop:\n         function (src, sub, chan, ctx, cmd)\n         {\n\n             ctx.player.activeActions = [];\n\n             this.com.message(src, \"You stopped doing everything.\", this.theme.RPG, false, chan);\n         },\n\n         watch:\n         function (src, sub, chan, ctx, cmd)\n         {\n\n             var plname = ctx.action.match(/watch(?:[,\\/| ]([^;]+)$)?/)[1];\n\n\n             if (!plname && !ctx.player.watching)\n             {\n                 this.com.message(src,  \"Type a player name.\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             if (ctx.player.watching)\n             {\n                 var bat = this.getBattle(ctx.rpg, ctx.player.watching);\n                 if (bat) bat.watchers.splice(bat.watchers.indexOf(ctx.player.name.toLowerCase(), 1));\n                 ctx.player.watching = null;\n             }\n\n             if (!plname)\n             {\n                 this.com.message(src,  \"No player to watch.\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             var pl = this.getPlayer(ctx.rpg.name, plname, true);\n\n\n\n             if (!pl || pl.area != ctx.player.area)\n             {\n                 this.com.message(src,  \"That player seems to be in another area or doesn't exist.\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             if (!pl.battle)\n             {\n                 this.com.message(src,  \"That player doesn't seem to be battling.\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             var bat = this.getBattle(ctx.rpg, pl.battle);\n\n             bat.watchers.push(ctx.player.name.toLowerCase());\n\n             ctx.player.watching = pl.battle;\n\n             var pll = this.pidsOfBattle(bat, chan);\n\n\n             this.com.message(pll, ctx.player.name + \" started watching the battle!\", this.theme.RPG, false, chan);\n         },\n\n         allowjoins:\n         function (src, sub, chan, ctx, cmd)\n         {\n\n\n             if (!ctx.player.battle)\n             {\n                 this.com.message(src,  \"Not in a battle.\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             var bat = this.getBattle(ctx.rpg, ctx.player.battle);\n\n             if (bat.allowJoins === false) // NOT undefined\n             {\n                 this.com.message(src,  \"This battle is private.\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             bat.allowJoins = true;\n\n\n             var pll = this.activeState[ctx.rpg.name].players;\n             for (x in pll)\n             {\n                 if (pll[x] != ctx.player && pll[x].area == ctx.player.area && sys.exists(pll[x].src) && sys.isInChannel(pll[x].src, chan))\n                 {\n                     this.com.message(pll[x].src, ctx.player.name + \" allowed joins for a battle! You can join it using /rpg joinbattle \" + ctx.player.name, this.theme.RPG, false, chan);\n                 }\n             }\n\n         },\n\n\n         joinbattle:\n         function (src, sub, chan, ctx, cmd)\n         {\n\n             var plname = ctx.action.match(/joinbattle(?:[,\\/| ]([^;]+)$)?/)[1];\n             if (ctx.player.battle)\n             {\n                 this.com.message(src,  \"Finish your battle first.\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             if (ctx.player.watching)\n             {\n                 var bat = this.getBattle(ctx.rpg, ctx.player.battle);\n                 if (bat) bat.watchers.splice(bat.watchers.indexOf(ctx.player.name.toLowerCase(), 1));\n                 ctx.player.watching = null;\n             }\n\n             if (!plname)\n             {\n                 this.com.message(src,  \"No player to join.\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             var pl = this.getPlayer(ctx.rpg.name, plname, true);\n\n\n\n             if (!pl || pl.area != ctx.player.area)\n             {\n                 this.com.message(src,  \"That player seems to be in another area or doesn't exist.\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             if (!pl.battle)\n             {\n                 this.com.message(src,  \"That player doesn't seem to be battling.\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             var bat = this.getBattle(ctx.rpg, pl.battle);\n\n             if (!bat.allowJoins)\n             {\n                 this.com.message(src,  \"That battle can't be joined.\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             bat.teams[pl.team].push(ctx.player.name);\n\n             ctx.player.battle = pl.battle;\n\n             var pll = this.pidsOfBattle(bat, chan);\n\n             this.com.message(pll, ctx.player.name + \" joined the battle!\", this.theme.RPG, false, chan);\n         },\n\n         items: function (src, sub, chan, ctx)\n         {\n             var msgs, x, items;\n\n             this.com.message(src, \"Your player's items:\");\n\n             msgs = [];\n\n             items = ctx.player.items;\n\n             for (x in items)\n             {\n                 msgs.push(\"<b>\" + this.items[x].name + \"</b> (x\" + items[x] + \")\");\n             }\n\n             this.less.less(src, msgs.join(\"<br />\"), true);\n\n\n         },\n\n         use:\n         function (src, sub, chan, ctx)\n         {\n             if (sub.length == 1)\n             {\n                 this.com.message(src,  \"Select a move to use next turn using /rpg use <skillname> , for example: /rpg use heal\", this.theme.RPG, false, chan);\n                 return;\n             }\n\n             if (this.playerCanUseSkill(ctx.player, sub[1]))\n             {\n                 ctx.player.use = sub[1];\n                 this.com.message(src,  \"You plan to use \" + sub[1] +\".\", this.theme.RPG, false, chan);\n             }\n             else if (this.skills[sub[1]]) this.com.message(src, \"Skill Error: Not able to use skill \\\"\"+sub[1]+\"\\\"!\", this.theme.ERROR, false, chan);\n             else this.com.message(src, \"Skill Error: No such skill \\\"\"+sub[1]+\"\\\", (example: /rpg use heal), make sure to use the shortnames, (e.g. elshock and not Electric Shock.)\", this.theme.ERROR, false, chan);\n         },\n\n         plan: function (src, sub, chan, ctx)\n         {\n             var plan = [];\n             if (sub.length == 1)\n             {\n                 this.com.message(src,  \"Your plan is: \" + JSON.stringify(plan), this.theme.RPG, false, chan);\n                 return;\n             }\n             for (var x in sub)\n             {\n                 if (x != 0)\n                 {\n                     var pli = sub[x];\n\n                     if (pli.match(/\\w+:[\\d\\.]+/))\n                     {\n                         var m = pli.match(/(\\w+):([\\d\\.]+)/);\n\n                         var skname = m[1];\n                         var prob = Number(m[2]);\n\n                         if (this.playerCanUseSkill(ctx.player, skname))\n                         {\n                             plan.push({skill:skname, prob: prob});\n                         }\n                         else if (this.skills[skname]) this.com.message(src, \"Skill Error: Not able to use skill \\\"\"+skname+\"\\\"!\", this.theme.ERROR, false, chan);\n                         else this.com.message(src, \"Skill Error: No such skill \\\"\"+skname+\"\\\", (example: /rpg plan attack:5 strike:9 heal:1), make sure to use the shortnames, (e.g. elshock and not Electric Shock.)\", this.theme.ERROR, false, chan);\n                     }\n                     else\n                     {\n                         this.com.message(src, \"Format Error, (example: /rpg plan attack:5 strike:9 heal:1), make sure to use the shortnames, (e.g. elshock and not Electric Shock.)\", this.theme.ERROR, false, chan);\n\n                     }\n\n                 }\n\n             }\n\n             ctx.player.plan = plan;\n\n             this.com.message(src, \"Your plan has been set to: \" + JSON.stringify(plan), this.theme.RPG, false, chan);\n\n         },\n\n         print: function (src, sub, chan,ctx)\n         {\n             this.com.message(src, \"Copy/pasteable char output:\", this.theme.RPG, true, chan);\n\n             var msgs = [];\n\n             msgs.push(\"<b>Player:</b> \" + ctx.player.name);\n             msgs.push(\"<b>Level:</b> \" + this.level(ctx.player.totalexp || 0));\n             msgs.push(\"<b>RES:</b> \" + Math.floor(ctx.player.res));\n             msgs.push(\"<b>STR:</b> \" + Math.floor(ctx.player.str));\n             msgs.push(\"<b>STA:</b> \" + Math.floor(ctx.player.sta));\n             msgs.push(\"<b>SPD:</b> \" + Math.floor(ctx.player.spd));\n             msgs.push(\"<b>MEN:</b> \" + Math.floor(ctx.player.men));\n             msgs.push(\"<b>MAG:</b> \" + Math.floor(ctx.player.mag));\n             msgs.push(\"<b>PSY:</b> \" + Math.floor(ctx.player.psy));\n\n\n             for (var x in ctx.player.exp)\n             {\n                 if (this.playerCanUseSkill(ctx.player, x))\n                 {\n                     msgs.push(\"<b>[\"+x+\"]</b>: \"+this.level(ctx.player.exp[x]-this.skills[x].threshold));\n                 }\n\n             }\n\n             this.com.message(src, msgs.join(\", \") + \"\", this.theme.RPG, true, chan);\n\n\n         },\n\n         skills: function (src, sub, chan, ctx)\n         {\n             var msg = [];\n             for (var x in ctx.player.exp)\n             {\n                 if (this.playerCanUseSkill(ctx.player, x))\n                 {\n                     msg.push(\"<b>\" + this.skills[x].name + \"</b> (\"+x+\") [level \"+this.level(ctx.player.exp[x]-this.skills[x].threshold)+\"] \" + (this.skills[x].desc|| \"<description not yet added>\"));\n                 }\n\n             }\n\n             this.com.message(src, \"Skills:<br/>\" + msg.join(\"<br/>\"), this.theme.RPG, true, chan);\n\n         }\n         ,\n         equip: function (src, sub, chan, ctx)\n         {\n             if (!sub[1])\n                 // list equips\n             {\n                 for (var x in ctx.player.equips)\n                 {\n                     this.com.message(src, \"\" + (+x+1) + \": \" + this.equipName(ctx.player.equips[x]));\n                 }\n\n                 return;\n             }\n\n             var idx = +sub[1] - 1;\n\n             var item = ctx.player.equips.splice(idx, 1)[0];\n             var kind = this.equips[item.type];\n\n             if (!item) return; // invalid indexing ._.\n\n             var slot = kind.type;\n\n             if (slot === \"hand\")\n             {\n                 if (sub[2] === \"lhand\") slot = \"lhand\";\n                 else if (sub[2] === \"rhand\") slot = \"rhand\";\n                 else\n                 {\n                     if (kind.hands !== 2)\n                         // error\n                     {\n                         ctx.player.equips.unshift(item); // put item back\n                         this.com.message(src, \"Which hand?\");\n                         return; // exit\n                     }\n\n                     slot = \"rhand\";\n\n                     if (ctx.player.lhand)\n\n                         // remove left hand equip\n                     {\n                         ctx.player.equips.unshift(ctx.player.lhand);\n                         ctx.player.lhand = null;\n                     }\n                 }\n             }\n\n             if (ctx.player[slot]) ctx.player.equips.unshift(ctx.player[slot]);// put old item back\n\n             if (slot === \"lhand\" && ctx.player.rhand && this.equips[ctx.player.rhand.type].hands === 2)\n             {\n                 ctx.player.equips.unshift(ctx.player.rhand);// put old item back\n                 ctx.player.rhand = null;\n             }\n\n             ctx.player[slot] = item;\n\n             this.com.message(src, \"Equipped \" + this.equipName(item));\n\n             return;\n         }\n\n     }\n     ,\n     actions:\n     {\n         location:\n         function (actionObj, ctx)\n         {\n\n\n         },\n\n         contemplate:\n         function (act, ctx)\n         {\n             var oldarea, chan = ctx.chan;\n\n             this.com.message(ctx.player.src, \"You are contemplating the mysteries of life.\", this.theme.RPG, false, ctx.chan);\n\n             ctx.player.msp -= 10;\n             ctx.player.men += 10;\n\n             var lv = this.level(ctx.player.totalexp);\n             ctx.player.totalexp += 10;\n             var newlv = this.level(ctx.player.totalexp);\n\n             if (lv < newlv)\n             {\n                 this.com.broadcast(ctx.player.name + \" has leveled up to level \" + newlv + \"!\", this.theme.GAME, false, ctx.chan);\n             }\n\n             if (ctx.player.activeActions.length != 1) return;\n\n             this.com.message(ctx.player.src, \"Done contemplating.\", this.theme.RPG, false, ctx.chan);\n         },\n\n         walk:\n         function (act, ctx)\n         {\n             var oldarea, chan = ctx.chan;\n\n\n             ctx.player.sp -= act.sp || 0;\n             this.com.message(ctx.player.src, \"Walked from \" + this.areas[ctx.player.area].name + \" to \" +this.areas[act.to].name + \".\", this.theme.RPG, false, ctx.chan);\n             ctx.player.sta += Math.floor(act.sp/2);\n             ctx.player.spd += Math.ceil(act.sp/2);\n             var lv = this.level(ctx.player.totalexp);\n             ctx.player.totalexp += act.sp;\n             var newlv = this.level(ctx.player.totalexp);\n             if (lv < newlv)\n             {\n                 this.com.broadcast(ctx.player.name + \" has leveled up to level \" + newlv + \"!\", this.theme.GAME, false, ctx.chan);\n             }\n             var pll = this.activeState[ctx.rpg.name].players;\n             for (x in pll)\n             {\n                 if (pll[x] != ctx.player && pll[x].area == ctx.player.area && sys.exists(pll[x].src) && sys.isInChannel(pll[x].src, ctx.chan))\n                 {\n                     this.com.message(pll[x].src, ctx.player.name + \" walked out of your area towards \" +this.areas[act.to].name +\".\", this.theme.RPG, false, ctx.chan);\n                 }\n             }\n\n             oldarea = ctx.player.area;\n\n             ctx.player.area = act.to;\n\n             for (x in pll)\n             {\n                 if (pll[x] != ctx.player && pll[x].area == ctx.player.area && sys.exists(pll[x].src) && sys.isInChannel(pll[x].src, ctx.chan))\n                 {\n\n                     if (sys.exists(pll[x].src)) this.com.message(pll[x].src, ctx.player.name + \" walked from \" + this.areas[oldarea].name +\" into your area.\", this.theme.RPG, false, chan);\n                 }\n             }\n\n             if (ctx.player.activeActions.length != 1) return;\n             this.com.message(ctx.player.src, \"You are at: \" + this.areas[ctx.player.area].name + (this.areas[ctx.player.area].desc?\": \" + this.areas[ctx.player.area].desc : \"\")+ \"\\nFrom here you can go to:\", this.theme.GAME, false, ctx.chan);\n             for (var i = 0; i < this.areas[ctx.player.area].adjc.length; i++)\n             {\n                 var obj = this.areas[ctx.player.area].adjc[i];\n                 var name = (typeof obj === \"string\" ? obj : obj.area);\n                 var dist = (typeof obj === \"string\" ? 10  : obj.distance);\n                 var areaObj = this.areas[name];\n                 this.com.message(ctx.player.src, areaObj.name + \" (\" + name + \") Distance: \" + dist , -1, false, ctx.chan);\n             }\n             this.com.message(ctx.player.src, \"Other players in this area:\", this.theme.RPG, false, ctx.chan);\n             for (x in pll)\n             {\n                 if (pll[x] != ctx.player && pll[x].area == ctx.player.area && sys.exists(pll[x].src) && sys.isInChannel(pll[x].src, ctx.chan))\n                 {\n                     this.com.message(ctx.player.src, pll[x].name + \" [level \"+this.level(pll[x].totalexp)+\"]\" + (pll[x].battle ? \" [battling]\": \"\"), this.theme.RPG, false, chan);\n                    \n                 }\n             }\n             return;\n         },\n\n         dig:  function (actionObj, ctx)\n         {\n             //  print(this.util.inspect(ctx.player));\n             var src = sys.id(ctx.player.name);\n             this.com.message([src], \"You dug something up!\", this.theme.GAME);\n\n             for (var x in this.areas[ctx.player.area].digs)\n             {\n                 this.com.message([src], \"It was an \" + x + \"! You threw it away!\", this.theme.GAME);\n             }\n         }\n         ,\n         explore: function (actionObj, ctx)\n         {\n             ctx.rpg.battles[ctx.rpg.battleCounter++] = {players: [ctx.player.name], mobs: [this.mkMob(\"testchicken\")]};\n\n             for (var x in this.areas[ctx.player.area].mobs)\n             {\n                 this.com.message(sys.id(ctx.player.name), \"You started battle with \" + JSON.stringify(this.areas[ctx.player.area].mobs[x]), this.theme.GAME);\n             }\n         }\n         ,\n         digTick: function (actionObj, ctx)\n         {\n             var src = sys.id(ctx.player.name);\n             this.com.message([src], \"You are digging a hole.\", this.theme.GAME);\n         }\n     }\n });\n",
 "js_modules/rpg_areas.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     areaStep: function () {}\n     ,\n     areas:\n     {\n         graveyard:\n         {\n             name: \"The graveyard\", desc: \"You have been revived from the dead! Now crawl out of here and back where you belong.\",\n             adjc: [\"town1\"]\n\n         },\n         town1:\n         {\n             name: \"The Town\", desc:\"Center of all activity! The south center is closed.\", adjc: [\"town1west\", \"town1east\", \"town1north\", \"town1south\"/*, \"town1south\"*/],\n             // mobs: [{prob: 2, mobs:[\"testchicken\"]},{prob: 1, mobs:[\"eshroom\", \"testchicken\"]}]\n             battle: [{min:1, max:1, mob: \"testchicken\" },{min:0, max:1, mob: \"eshroom\", prob: 0.5}]\n         },\n\n\n\n         town1west:\n         {\n             name: \"Town West Side\", desc: \"Naturalist hippies are protesting attempts to get rid of the frog overpopulation.\", adjc: [\"town1\", \"westpath\"],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             battle: [{min:1, max:3, mob: \"dkfrog\", prob:0.7 },{min:0, max:2, mob: \"eshroom\", prob: 0.5}]\n\n\n         },\n\n         westpath:\n         {\n             name: \"West Pathway\", desc: \"The pathway to the West Forest. Travelers sometimes avoid it due to the scary bats the live here.\", adjc: [\"westforest\", \"town1west\"],\n             battle: [{min:1, max:3, mob: \"bat\", prob:0.7 },{min:0, max:2, mob: \"dkfrog\", prob: 0.2}]\n         },\n\n         westforest:\n         {\n             name: \"West Forest\", desc: \"The west forest, inhabited by angry squirrels...\", adjc: [\"westpath\", \"westforest2\"],\n             mobs: [{prob:1, mobs: [\"bat\",\"lsquirrel\"]}, {prob:1, mobs: [\"lsquirrel\",\"lsquirrel\"]}]\n         },\n\n         westforest2:\n         {\n             name: \"West Forest [deep]\", desc: \"Watch out for the deadly squirrels!\", adjc: [\"westforest\", \"westforest3\"],\n             mobs: [{prob:1, mobs: [\"lsquirrel\",\"lsquirrel\"]}, {prob:1, mobs: [\"lsquirrel\",\"dsquirrel\"]}, {prob:1, mobs: [\"dsquirrel\"]},\n                    {prob:1, mobs: [\"dsquirrel\",\"adsquirrel\"]}, {prob:1, mobs: [\"dsquirrel\",\"dsquirrel\"]},{prob:1, mobs: [\"adsquirrel\",\"adsquirrel\"]}\n                   ]\n         },\n\n          westforest3:\n         {\n             name: \"West Forest [factory]\", desc: \"There is an unusual factory here...\", adjc: [\"westforest2\", \"town2east\"],\n             battle: [{ prob: 0.5, min:1, max: 2, mob: \"jetsquirrel\"},{ prob: 0.5, min:0, max: 1, mob: \"adsquirrel\"}]\n\n         },\n\n         town2east:\n         {\n             name: \"Rorthidor [east]\", desc: \"A town of golems. The entrance to the city is nearby.\", adjc: [\"westforest3\", \"town2\"],\n             battle: [{ min:1, max:3, mob: \"golem\", prob:0.3}]\n\n         },\n\n         town2:\n         {\n             name: \"Rorthidor\", desc: \"A town of golems. The city heart.\", adjc: [\"westforest3\", \"town2east\", \"town2north\"],\n             battle: [{ min:1, max:3, mob: \"sgolem\", prob:0.3}]\n\n         },\n\n         town2north:\n         {\n             name: \"Rorthidor [north]\", desc: \"Unusual machines live here.\", adjc: [\"town2\"],\n             battle: [{ min:1, max:2, mob: \"elector\", prob:0.3}]\n\n         },\n\n         town1east:\n         {\n             name: \"Town East Side\", desc:\"Currently having a chicken problem...\", adjc: [\"town1\"],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             battle: [{min:1, max:8, mob: \"testchicken\", prob:0.7 }]\n\n         },\n\n         town1north:\n         {\n             name: \"Town North Side\", desc: \"The locals don't seem to notice the local slime population.\", adjc: [\"town1\"],\n             adjc: [\"town1\", {area:\"sewer1\",distance:3}],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             battle: [{min:1, max:2, mob: \"slime\", prob:0.5 }]\n\n         },\n\n         town1south:\n         {\n             name: \"Town South Side\", desc: \"This part of town has been abandonned since it was taken over by spooks.\", adjc: [\"town1\"],\n             adjc: [\"town1\", {area:\"darkforest\", distance: 40}],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             battle: [{min:1, max:4, mob: \"spook\", prob:0.66 }, {min:0, max:1, mob:\"grim\", prob: 0.1}]\n\n         },\n\n         darkforest:\n         {\n             name: \"Dark Forest\", desc: \"This forest is the natural home of spooks, townspeople avoid it like the plauge. Legend tells of the deadly sinesters that live here.\",\n             adjc: [{area:\"town1south\", distance: 40}, {area:\"darkforest2\", distance: 20}],\n             battle: [{min:1, max:3, mob: \"spook\", prob:0.5 },{min:0, max:2, mob: \"mspook\", prob: 0.5}, {min:0, max:2, mob:\"lspook\", prob: 0.5}, {min:0, max:1, mob:\"grim\", prob: 0.3},  {min:0, max:1, mob:\"sinester\", prob: 0.1}]\n         },\n\n         darkforest2:\n         {\n             name: \"Dark Forest [bones]\", desc: \"Bones lie on the ground everywhere here. There is an ominous presense about. Somehow the walk back seems longer.\",\n             adjc: [{area:\"darkforest\", distance: 40}, {area:\"darkforest3\", distance: 20}, {area:\"darkforest5\", distance: 20}],\n             battle: [{min:0, max:2, mob: \"spook\", prob:0.3 },{min:1, max:2, mob: \"mspook\", prob: 0.5}, {min:0, max:2, mob: \"lspook\", prob: 0.5}, {min:0, max:1, mob:\"grim\", prob: 0.3},  {min:0, max:2, mob:\"sinester\", prob: 0.7}]\n         },\n\n         darkforest3:\n         {\n             name: \"Dark Forest [graveyard]\", desc: \"An old graveyard. Somehow the walk back seems longer.\",\n             adjc: [{area:\"darkforest2\", distance: 65}, {area:\"darkforest\", distance: 40}, {area:\"darkforest4\", distance: 10}],\n             battle: [{min:1, max:3, mob: \"zombie\", prob:0.5 },{min:0, max:2, mob: \"mspook\", prob: 0.5}, {min:0, max:2, mob: \"lspook\", prob: 0.5}, {min:0, max:1, mob:\"grim\", prob: 0.3},  {min:0, max:2, mob:\"sinester\", prob: 0.7}]\n             //\n         },\n\n         darkforest4:\n         {\n             name: \"Dark Forest [crypt]\", desc: \"An old crypt.\",\n             adjc: [{area:\"darkforest3\", distance: 10}],\n             battle: [{min:1, max:3, mob: \"zombie\", prob:0.8 },{min:0, max:2, mob: \"mspook\", prob: 0.5}, {min:0, max:2, mob: \"lspook\", prob: 0.5}]\n         },\n\n         darkforest5:\n         {\n             name: \"Dark Forest [clearing]\", desc: \"Something tells you this place is dangerous. Somehow you can't find your way back\",\n             adjc: [{area:\"darkforest4\", distance: 40},{area:\"darkforest6\", distance: 40}],\n             battle: [{min:1, max:3, mob: \"lspook\", prob:0.5 },{min:0, max:2, mob: \"sinester\", prob: 0.5}, {min:0, max:1, mob: \"sshell\", prob: 0.5}]\n         },\n\n         darkforest6:\n         {\n             name: \"Dark Forest [shadow path]\", desc: \"Shadows lurk everywhere Somehow you can't find your way back\",\n             adjc: [{area:\"darkforest7\", distance: 40}],\n             battle: [{min:0, max:2, mob: \"lspook\", prob:0.5 },{min:0, max:2, mob: \"zombie\", prob: 0.2}, {min:1, max:3, mob: \"sshell\", prob: 0.8}]\n         },\n\n         darkforest7:\n         {\n             name: \"Dark Forest [shadow pits]\", desc: \"Something tells you this place is dangerous.\",\n             adjc: [{area:\"darkforest8\", distance: 40}, {area:\"darkforest5\", distance: 90}],\n             battle: [{min:0, max:2, mob: \"lspook\", prob:0.5 },{min:0, max:2, mob: \"lshell\", prob: 0.2}, {min:1, max:3, mob: \"sshell\", prob: 0.8}]\n         },\n\n         darkforest8:\n         {\n             name: \"Dark Forest [black trees]\", desc: \"Something tells you this place is dangerous.\",\n             adjc: [{area:\"darkforest9\", distance: 40}, {area:\"darkforest7\", distance: 90}],\n             battle: [{min:1, max:2, mob: \"lshell\", prob: 0.7}, {min:0, max:2, mob: \"sshell\", prob: 0.5}]\n         },\n\n\n         darkforest9:\n         {\n             name: \"Dark Forest [black dirt]\", desc: \"Something tells you this place is dangerous.\",\n             adjc: [{area:\"darkforest10\", distance: 40}, {area:\"darkforest8\", distance: 90}],\n             battle: [{min:1, max:2, mob: \"lshell\", prob: 0.7}, {min:0, max:2, mob: \"oshell\", prob: 0.5}]\n         },\n\n         darkforest10:\n         {\n             name: \"Dark Forest [evil paths]\", desc: \"Something tells you this place is dangerous.\",\n             adjc: [{area:\"darkforest11\", distance: 40}, {area:\"darkforest9\", distance: 90}],\n             battle: [{min:1, max:2, mob: \"oshell\", prob: 0.7}, {min:0, max:2, mob: \"ushell\", prob: 0.5}]\n         },\n\n          darkforest11:\n         {\n             name: \"Dark Forest [corrupted vines]\", desc: \"Something tells you this place is dangerous.\",\n             adjc: [{area:\"darkforest12\", distance: 40}, {area:\"darkforest10\", distance: 90}],\n             battle: [{min:1, max:2, mob: \"ushell\", prob: 0.7}, {min:0, max:2, mob: \"xshell\", prob: 0.5}]\n         },\n\n         darkforest12:\n         {\n             name: \"Dark Forest [strange place]\", desc: \"Something tells you this place is dangerous.\",\n             adjc: [{area:\"darkforest11\", distance: 90},{area:\"darkforest13\", distance: 90}],\n             battle: [{min:1, max:2, mob: \"xshell\", prob: 0.7}, {min:0, max:2, mob: \"xshell2\", prob: 0.5}]\n         },\n\n         darkforest13:\n         {\n             name: \"Dark Forest [odd place]\", desc: \"Something tells you this place is dangerous.\",\n             adjc: [{area:\"darkforest14\", distance: 90}],\n             battle: [{min:1, max:2, mob: \"xshell2\", prob: 0.7}]\n         },\n\n         darkforest14:\n         {\n             name: \"Dark Forest [evil place]\", desc: \"Something tells you this place is dangerous.\",\n             adjc: [{area:\"darkforest15\", distance: 90}],\n             battle: [{min:1, max:2, mob: \"xshell2\", prob: 0.7}, {min:0, max:2, mob: \"xshell3\", prob: 0.5}]\n         },\n\n         darkforest15:\n         {\n             name: \"Dark Forest [queer place]\", desc: \"Something tells you this place is dangerous.\",\n             adjc: [{area:\"darkforest12\", distance: 90}],\n             battle: [{min:1, max:2, mob: \"xshell3\", prob: 0.7}, {min:0, max:2, mob: \"xshell2\", prob: 0.5}]\n         },\n\n\n         //\n\n         sewer1:\n         {\n             name: \"The Sewer\", desc: \"Seems like there are a lot of slimes down here!\", adjc: [\"town1north\", \"sewer2\"],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             mobs: [{prob: 2, mobs:[\"slime\",\"slime\",\"slime\",\"slime\",\"slime\"]},{prob: 1, mobs:[\"slime\",\"slime\", \"slime\"]}]\n         },\n\n         sewer2:\n         {\n             name: \"The Sewer (somewhere)\", desc: \"Seems like there are a lot of slimes down here!\", adjc: [\"sewer1\", \"sewer3\"],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             mobs: [{prob: 2, mobs:[\"slime\",\"slime\",\"slime\",\"slime\"]},{prob: 1, mobs:[\"slime\",\"slime\", \"slime\"]}]\n         },\n\n         sewer3:\n         {\n             name: \"The Sewer (pipeway)\", desc: \"Seems like there are a lot of slimes down here!\", adjc: [\"sewer2\", \"sewer4\"],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             mobs: [{prob: 2, mobs:[\"slime\",\"slime2\",\"slime2\"]},{prob: 1, mobs:[\"slime2\",\"slime2\", \"slime2\"]}]\n         },\n\n\n         sewer4:\n         {\n             name: \"The Sewer (intersection)\", desc: \"Seems like there are a lot of slimes down here!\", adjc: [\"sewer3\", \"sewer5\", \"sewer4b\"],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             mobs: [{prob: 2, mobs:[\"slime3\",\"slime3\"]},{prob: 1, mobs:[\"slime2\",\"slime3\", \"slime3\"]}]\n         },\n\n\n         sewer4b:\n         {\n\n             name: \"The Sewer (ghost room)\", desc: \"Seems like there are a lot of slimes down here! ... and some spooks? There seems to be a pipe here which goes back to the entrace, but there's no way to climb back up it if you go down.\", adjc: [\"sewer4\", \"sewer1\"],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             mobs: [{prob: 2, mobs:[\"slime3\",\"slime3\", \"lspook\"]},{prob: 1, mobs:[\"slime2\", \"mspook\", \"slime3\", \"lspook\"]}]\n         },\n\n         sewer5:\n         {\n             name: \"The Sewer (slimy pathway)\", desc: \"Seems like there are a lot of slimes down here!\", adjc: [\"sewer6\", \"sewer4\"],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             mobs: [{prob: 2, mobs:[\"slime4\",\"slime4\",\"slime\"]},{prob: 1, mobs:[\"slime4\",\"slime4\", \"slime3\"]}, {prob: 1, mobs:[\"slime\",\"slime\", \"slime2\"]}]\n         },\n\n         sewer6:\n         {\n             name: \"The Sewer (rusted room)\", desc: \"Seems like there are a lot of slimes down here!\", adjc: [\"sewer5\", \"sewer7\"],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             mobs: [{prob: 2, mobs:[\"slime\",\"slime\"]},{prob: 1, mobs:[\"slime3\",\"slime\", \"slime2\"]},\n                    {prob: 2, mobs:[\"slime2\",\"slime5\"]},{prob: 1, mobs:[\"slime4\",\"slime5\", \"slime5\"]},\n                    {prob: 2, mobs:[\"slime5\",\"slime5\"]},{prob: 1, mobs:[\"slime5\",\"slime3\", \"slime5\"]},\n                    {prob: 2, mobs:[\"slime4\",\"slime2\"]},{prob: 1, mobs:[\"slime5\",\"slime3\", \"slime4\"]}]\n         },\n\n         sewer7:\n         {\n             name: \"The Sewer (stinky pipes)\", desc: \"Seems like there are a lot of slimes down here!\", adjc: [\"sewer6\", \"sewer8\"],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             mobs: [{prob: 2, mobs:[\"slime\",\"slime6\"]},{prob: 1, mobs:[\"slime6\",\"slime\", \"slime2\"]},\n                    {prob: 2, mobs:[\"slime2\",\"slime6\"]},{prob: 1, mobs:[\"slime4\",\"slime5\", \"slime6\"]},\n                    {prob: 2, mobs:[\"slime5\",\"slime6\"]},{prob: 1, mobs:[\"slime5\",\"slime6\", \"slime5\"]},\n                    {prob: 2, mobs:[\"slime6\",\"slime2\"]},{prob: 1, mobs:[\"slime6\",\"slime3\", \"slime4\"]}]\n         },\n\n         sewer8:\n         {\n             name: \"The Sewer (slime path)\", desc: \"Seems like there are a lot of slimes down here!\", adjc: [\"sewer7\", \"sewer9\" ],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             mobs: [{prob: 2, mobs:[\"slime7\",\"slime7\"]},{prob: 1, mobs:[\"slime3\",\"slime\", \"slime7\"]},\n                    {prob: 2, mobs:[\"slime7\",\"slime5\"]},{prob: 1, mobs:[\"slime7\",\"slime5\", \"slime5\"]},\n                    {prob: 2, mobs:[\"slime5\",\"slime7\"]},{prob: 1, mobs:[\"slime5\",\"slime7\", \"slime5\"]},\n                    {prob: 2, mobs:[\"slime7\",\"slime2\"]},{prob: 1, mobs:[\"slime5\",\"slime3\", \"slime4\"]}]\n         },\n\n         sewer9:\n         {\n             name: \"The Sewer (slime core)\", desc: \"Seems like there are a lot of slimes down here!\", adjc: [\"sewer8\", \"slfort1\"],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             mobs: [{prob: 2, mobs:[\"slime7\",\"slime7\"]},{prob: 1, mobs:[\"slime7\",\"slime7\", \"slime7\"]},\n                    {prob: 1, mobs:[\"slime7\",\"slime7\", \"slime6\"]}]\n         },\n\n         slfort1:\n         {\n             name: \"Underground Slime Fortress [outside]\", desc: \"Seems like some kind of slime fortress...\", adjc: [\"sewer9\", \"slfort2\"],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             mobs: [{prob: 2, mobs:[\"slime7\",\"slime8\"]},{prob: 1, mobs:[\"slime7\",\"slime8\", \"slime7\"]},\n                    {prob: 1, mobs:[\"slime8\",\"slime7\", \"slime8\"]}, {prob: 2, mobs:[\"slime8\"]}]\n         },\n\n         slfort2:\n         {\n             name: \"Underground Slime Fortress [inside]\", desc: \"There seems be something awfully dangerous here!\", adjc: [\"slfort1\"],\n             digs:\n             {\n                 ironore: 0.5\n             },\n             mobs: [{prob: 1, mobs:[\"slimed\"]}]\n         },\n\n\n         cliff1:\n         {\n             name: \"A cliff\",\n             adjc: [\"town1\", \"proto\"],\n             mobs: [{prob: 1, mobs:[\"reddragon\"]}]\n         },\n\n         darkpathway:\n         {\n\n         },\n\n         dforest:\n         {\n             name: \"Deadly Forest\",\n             adjc: [\"town1\"],\n             mobs: [{prob: 2, mobs:[\"dsquirrel\"]},{prob: 1, mobs:[\"dsquirrel\", \"dsquirrel\"]}]\n         }\n     }\n\n });\n",
 "js_modules/rpg_battle.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** An rpg battle descriptor. Note the format is subject to change.\n * @name rpgBattle\n * @class\n */\n/** The players in the battle. Note this is an array of player /names/ not objects. This is done so as not to have duiplicates of player objects in the database.\n * @name players\n * @type {Array.<String>}\n * @memberOf rpgBattle.prototype\n */\n/** The mobs in the battle.\n * @name mobs\n * @type {Array.<rpgMob>}\n * @memberOf rpgBattle.prototype\n */\n/** @scope script.modules.rpg_game */\n({\n     /** Battle step will cause a turn in a battle to take place\n      * @event\n      * @param {rpgCtx} ctx\n      * @param {rpgBattle} ctx.battleid The id of the specific battle this should step.\n      * @param {rpgClass} ctx.rpg The current rpg we are in.\n      */\n\n     newBattle:\n     function (rpg)\n     {\n         var id = rpg.battleCounter++;\n         var bat = new Object;\n\n         bat.round = 0;\n         bat.watchers = [];\n         bat.teams = [];\n\n         rpg.battles[id] = bat;\n\n         return id;\n     },\n\n\n     getBattle:\n     function (rpg, bat)\n     {\n         return rpg.battles[bat];\n     },\n\n     getPlayersOfBattle:\n     function (rpg, battle)\n     {\n         var x, x2, teams = battle.teams, players = [];\n\n         for (x in teams) for (x2 in teams[x])\n         {\n             if (typeof teams[x][x2] == typeof String()) players.push(this.getPlayer(rpg.name, teams[x][x2]));\n\n         }\n\n         return players;\n     },\n\n     nn:\n     function (a)\n     {\n         if (isNaN(a)) throw new Error(\"NaN\");\n\n         return a;\n     },\n\n     battleStep: function (ctx)\n     {\n         const DAMAGECONV = {\"mp\":\"mag\", \"sp\":\"sta\", \"msp\":\"men\", \"hp\":\"res\", \"lp\": \"spr\"};\n\n         var _tmp, x, x2, x3, i, players, attacker, move, at, that = this, entities = [], rpg = ctx.rpg, battle = ctx.battle, teams = battle.teams, tracker, chan = ctx.chan, pids = this.pidsOfBattle(battle, chan);\n\n         function nn(a)\n         {\n             if (isNaN(a)) throw new Error(\"NaN\");\n\n             return a;\n         }\n\n         function isDead(e)\n         {\n             return (e.attr && e.attr.undead ? e.hp < -e.maxhp : e.hp <= 0) || e.msp <= 0 || e.sp <= 0;\n         }\n\n         function testDead (e)\n         {\n             var pname, drops, x;\n\n             if ((typeof e.flee == typeof Number() && e.flee <= 0) || (e.attr && e.attr.undead ? e.hp < -e.maxhp : e.hp <= 0) || e.msp <= 0 || e.sp <= 0)\n             {\n                 if ((e.attr && e.attr.undead ? e.hp < -e.maxhp : e.hp <= 0)) that.com.message(pids, e.name + \" was slain!\", that.theme.RPG, false, ctx.chan);\n                 else if (e.sp <= 0) that.com.message(pids, e.name + \" collapsed!\", that.theme.RPG, false, ctx.chan);\n                 else if (e.msp <= 0) that.com.message(pids, e.name + \" lost consciousness!\" , that.theme.RPG, false, ctx.chan);\n                 else if (typeof e.flee == typeof Number() && e.flee <= 0)\n                 {\n                     delete e.flee;\n                     that.com.message(pids, e.name + \" escaped!\" , that.theme.RPG, false, ctx.chan);\n                 }\n                 else that.com.message(pids, e.name + \" died a mysterious death!\", that.theme.RPG, false, ctx.chan);\n\n                 // Remove from teams\n                 teams[e.team].splice(teams[e.team].indexOf(e), 1);\n\n                 if (e.type == \"player\")\n                 {\n                     pname = e.name.toLowerCase();\n\n                     that.getPlayer(rpg.name, pname).battle = null;\n                 }\n                 if (e.drops)\n                 {\n                     drops = that.util.arrayify(e.drops);\n                     for (x in drops) if (drops[x].prob > Math.random() && typeof drops[x].item === typeof String()) // b\n                     {\n                         that.com.message(pids, \"The defeated \" + e.name + \" dropped \" + drops[x].count + \" \" + that.items[drops[x].item].name + \"(s)\", that.theme.RPG, false, chan);\n                         battle.droppedItems[drops[x].item] = (battle.droppedItems[drops[x].item] || 0) + drops[x].count;\n                     }\n                 }\n\n                 return true;\n             }\n\n             else return false;\n         }\n\n         if (!battle.tracker) battle.tracker = new Object;\n         if (!battle.round) { battle.round = 0; battle.xexp = 0; }\n         if (!battle.droppedItems) battle.droppedItems = {};\n\n         tracker = battle.tracker;\n         battle.round++;\n\n\n\n\n         for (x in teams) for (x2 in teams[x])\n         {\n             if (typeof teams[x][x2] == typeof String())\n             {\n                 entities.push(this.getPlayer(rpg.name, teams[x][x2]));\n                 if (!entities[entities.length-1].battle) entities[entities.length-1].battle = ctx.battleId;\n                 if (!battle.tracker[_tmp = teams[x][x2].toLowerCase()]) battle.tracker[_tmp] = { str:0, sta:0, mag:0, men:0, psy:0 };\n             }\n             else entities.push(teams[x][x2]);\n\n             entities[entities.length-1].team = x;\n         }\n\n\n         this.util.shuffle(entities);\n         entities.sort(function (a, b){ return b.spd - a.spd; });\n\n         this.com.message(pids, \"Battle: Start Round #\" + battle.round + \":\", this.theme.RPG, false, ctx.chan);\n\n\n         for (x in entities)\n         {\n             if (battle.round == 1)\n             {\n//                 this.entityUpdateStats(entities[x]);\n                 if (entities[x].xexp) battle.xexp += Number(entities[x].xexp);\n                 entities[x].round = 1;\n             }\n\n             entities[x].round = (entities[x].round || 0) + 1;\n\n             if (entities[x].attr)\n             {\n                 if (entities[x].attr.ghost) this.com.message(pids, entities[x].name + \" is wrapped in shadows!\", this.theme.RPG, false, ctx.chan);\n                 if (entities[x].attr.flying) this.com.message(pids, entities[x].name + \" is airborne!\", this.theme.RPG, false, ctx.chan);\n\n             }\n         }\n\n         roundLoop: for (x in entities)\n         {\n             attacker = ctx.attacker = entities[x];\n             at = entities[x].type;\n             move = ctx.move = this.pickMove(entities[x]);\n\n\n             if (isDead(attacker)) continue roundLoop;\n             if (typeof attacker.flee == typeof Number())\n             {\n                 attacker.flee--;\n                 this.com.message(pids, ctx.attacker.name + \" is trying to escape!\", this.theme.GAME, false, ctx.chan);\n                 continue roundLoop;\n             }\n\n             if (move.cost)\n             {\n\n                 for (x2 in move.cost)\n                 {\n\n                     var mul = 0.8;\n\n                     if (attacker.type == \"player\")\n                     {\n                         mul = this.lMult(attacker.exp[move.shortname]/(this.skills[move.shortname].threshold+1));\n                     }\n\n                     var cos = Math.ceil(move.cost[x2] * mul);\n\n                     nn(cos);\n\n                     if (attacker[x2] <= cos)\n                     {\n\n\n                         //ctx.attacker[x2] -= ctx.move.cost[x2]/3;\n                         this.com.message(pids, ctx.attacker.name + \" tried to use \"  + ctx.move.name + \" but didn't have enough \" + x2.toUpperCase() + \"!\",\n                                          this.theme.GAME, false, ctx.chan);\n\n                         if (attacker.type == \"player\")\n                         {\n                             x3 = DAMAGECONV[x2];\n                             battle.tracker[attacker.name.toLowerCase()][x3] = (battle.tracker[attacker.name.toLowerCase()][x3] || 0) + 50;\n                         }\n                         continue roundLoop;\n                     }\n                 }\n\n                 for (x2 in move.cost)\n                 {\n                     var mul = 0.8;\n\n                     if (attacker.type == \"player\")\n                     {\n                         mul = this.lMult(attacker.exp[move.shortname]/(this.skills[move.shortname].threshold+1));\n                     }\n\n                     var cos = Math.ceil(move.cost[x2] * mul);\n                     nn(cos);\n                     ctx.attacker[x2] -= cos;\n\n                     if (attacker.type == \"player\" && ctx.attacker[x2] <= ctx.attacker[\"max\" + x2]/2)\n                     {\n                         x3 = DAMAGECONV[x2];\n                         if (x3) battle.tracker[attacker.name.toLowerCase()][x3] = (battle.tracker[attacker.name.toLowerCase()][x3] || 0) +  10;\n                     }\n                 }\n             }\n\n\n\n             this.com.message(pids, ctx.attacker.name + \" used \"  + ctx.move.name + \"!\", this.theme.RPG, false, ctx.chan);\n\n             //\n             if (attacker.type === \"player\" && attacker.round <= 250)\n             {\n                 // spd exp\n                 battle.tracker[attacker.name.toLowerCase()].spd = (battle.tracker[attacker.name.toLowerCase()].spd || 0) + x*10;\n                 // move exp\n                 if (!ctx.attacker.exp[move.shortname]) ctx.attacker.exp[move.shortname] = 0;\n\n                 ctx.attacker.exp[move.shortname] += 10;\n\n                 l1: if (this.skills[move.shortname].next)\n                 {\n                     var ar = this.skills[move.shortname].next;\n                     var div = 1;\n                     i = [];\n\n                     for (x2 in ar)\n                     {\n                         attacker.exp[ar[x2]] = attacker.exp[ar[x2]] || 0;\n                         l3:\n                         {\n\n                             l4:\n                             {\n                                 if (!this.skills[ar[x2]])\n                                 {\n                                     try\n                                     {\n                                         throw new Error(\"Skill '\" + ar[x2] + \"' does not exist!\");\n                                     } catch (e) { this.script.error(e); }\n                                 }\n                                 if (!this.skills[ar[x2]].prereq) break l4;\n\n                                 for (x3 in this.skills[ar[x2]].prereq)\n                                 {\n                                     if (attacker.exp[this.skills[ar[x2]].prereq[x3]] < (this.skills[this.skills[ar[x2]].prereq[x3]] || {}).threshold)\n                                     {\n                                         break l3;\n                                     }\n                                 }\n                             }\n\n                             if (attacker.exp[ar[x2]] < (this.skills[ar[x2]] || {}).threshold)\n                             {\n                                 i.push(ar[x2]);\n                             }\n                             else div++;\n                         }\n\n                     }\n\n                     if (i.length == 0)\n                     {\n                         break l1;\n                     }\n\n                     this.util.shuffle(i);\n                     i.sort( function (a, b){ return ctx.attacker.exp[b] - ctx.attacker.exp[a]; } );\n\n                     var oldexp = attacker.exp[i[0]] || 0;\n                     attacker.exp[i[0]] =  oldexp + Math.max(0, Math.ceil(4 + 6/div));\n\n                     if (attacker.exp[i[0]] >= (this.skills[i[0]] || {}).threshold)\n                     {\n                         this.com.message(this.user.id(attacker.name), \"<hr/>\", -1, true, ctx.chan);\n                         this.com.message(this.user.id(attacker.name), \"You gained the skill \" + this.skills[i[0]].name + \"!\", this.theme.RPG, true, ctx.chan);\n                         this.com.message(this.user.id(attacker.name), \"<hr/>\", -1, true, ctx.chan);\n                     }\n\n\n\n                 }\n             }\n\n\n             // todo: : redo this part in order to allow pvp\n             for (x2 in ctx.move.components)\n             {\n                 var cmp = ctx.move.components[x2];\n                 var targets = ctx.targets = [];\n                 var count = cmp.count;\n                 var t = this.util.arrayify(cmp.target);\n\n\n                 for (x3 in t) switch(t[x3])\n                 {\n                 case \"ally\":\n                     for (x4 in entities) if (entities[x4].team == attacker.team) targets.push(entities[x4]);\n                     break;\n                 case \"opp\":\n                     for (x4 in entities) if (entities[x4].team != attacker.team) targets.push(entities[x4]);\n                     break;\n                 case \"self\":\n                     ctx.targets.push(ctx.attacker);\n                     break;\n                 }\n\n\n\n                 if (count == -1) count = targets.length;\n\n                 else this.util.shuffle(targets);\n\n\n                 var maxcount = count;\n\n                 var struck = [];\n\n                 if (count > 0)\n                 {\n                     for (x3 in targets)\n                     {\n\n                         if (count-- === 0) break;\n\n\n                         var damage = this.runComponent(cmp, move, attacker, targets[x3]);\n//                         var dmgObj = this.moves[cmp.move].call(this, {attacker: entities[x], target:targets[x3], component:cmp, move: move});\n//                         var dmg = dmgObj.string;\n\n                         var dmgParts = [];\n\n                         for (x4 in damage)\n                         {\n                             dmgParts.push(String(Math.round(damage[x4])) + \" \" + x4.toUpperCase());\n                         }\n                         if (dmgParts.length) struck.push(targets[x3].name + \" (\"+dmgParts.join(\", \") + \")\");\n                         else struck.push(targets[x3].name);\n\n                         try\n                         {\n                             var q = Object.keys(damage);\n                             for (x4 in damage)\n                             {\n                                 var etype = DAMAGECONV[x4];\n\n                                 if (targets[x3].type == \"player\") if (etype) battle.tracker[targets[x3].name.toLowerCase()][etype] = nn(battle.tracker[targets[x3].name.toLowerCase()][etype] || 0) + nn(10/q.length);\n\n                                 if (ctx.move.exp && attacker.type == \"player\")\n                                 {\n                                     battle.tracker[attacker.name.toLowerCase()][ctx.move.exp] = (battle.tracker[attacker.name.toLowerCase()][ctx.move.exp] || 0) +\n                                         Math.abs(10*0.8*cmp.base/damage[x4] ||0);\n                                 }\n\n                             }\n                         }\n                         catch (e) {this.script.error(e);}\n                     }\n\n\n                 }\n\n                 if (cmp.desc) this.com.message(pids, cmp.desc.replace(/%s/g, ctx.attacker.name).replace(/%t/, struck.join(\" \")), this.theme.RPG, false, ctx.chan);\n\n\n\n\n\n\n\n             }\n\n\n             }\n\n\n\n\n         for (i = 0; i < entities.length; i++)\n         {\n\n\n             if (testDead(entities[i]))\n             {\n\n                 entities.splice(i, 1);\n\n                 i--;\n             }\n\n\n\n         }\n\n         for (x in entities)\n         {\n             this.entityTick(entities[x]);\n         }\n\n         this.com.message(pids, \"Battle: End Round #\" + battle.round + \":\", this.theme.RPG, false, ctx.chan);\n\n         this.printOutStatus(pids, entities, ctx.chan);\n\n\n\n         for (x in teams) if (teams[x].length == 0)\n         {\n             this.com.message(pids, \"Battle ended!\", this.theme.RPG, false, ctx.chan);\n\n             delete ctx.rpg.battles[ctx.battleId];\n\n             var dps = new Object;\n\n\n             players = this.getPlayersOfBattle(rpg, battle);\n\n\n             for (x in battle.droppedItems)\n             {\n                 while (battle.droppedItems[x]-- > 0)\n                 {\n\n                     i = Math.floor(Math.random()*players.length);\n\n                     if (!dps[i]) dps[i] = new Object;\n\n                     dps[i][x] = (dps[i][x] || 0) + 1;\n                 }\n             }\n\n             for (var i in dps)\n             {\n                 var msg = [];\n                 for (x in dps[i])\n                 {\n                     msg.push(dps[i][x] + \" \" + that.items[x].name + \"(s)\");\n\n                     try\n                     {\n                         players[i].items[x] = (players[i].items[x] || 0) + dps[i][x];\n                     }\n                     catch (e)\n                     {\n                         this.script.error(e);\n                     }\n                 }\n\n                 if (msg.length) this.com.message(pids, players[i].name + \" got \" + msg.join(\", \") + \"!\", this.theme.RPG, false, chan);\n             }\n\n\n             for (i in players)\n             {\n                 var pl = players[i];\n\n                 pl.battle = null;\n\n                 pl.totalexp = (pl.totalexp || 0);\n                 var lv = this.level(pl.totalexp);\n                 l2: if (battle.tracker[players[i].name.toLowerCase()])\n                 {\n                     var trackr = battle.tracker[players[i].name.toLowerCase()];\n                     var tot = 0;\n                     for (x in trackr)\n                     {\n                         tot += trackr[x];\n\n\n                     }\n\n                     var roundnum = 0;\n                     var eroundnum = pl.round;\n\n                     pl.round = 0;\n\n                     for (x2 = 0; x2 < eroundnum && x2 < 100; x2++) roundnum++;\n                     for (; x2 < eroundnum && x2 < 50; x2++) roundnum += 2/3;\n                     for (; x2 < eroundnum && x2 < 100; x2++) roundnum += 1/2;\n                     for (; x2 < eroundnum && x2 < 300; x2++) roundnum += 1/3;\n                     for (; x2 < eroundnum && x2 < 500; x2++) roundnum += 1/5;\n                     for (; x2 < eroundnum && x2 < 700; x2++) roundnum += 1/10;\n                     for (; x2 < eroundnum && x2 < 1000; x2++) roundnum += 1/100;\n\n                     roundnum = Math.round(roundnum);\n\n                     //if (roundnum > 100) roundnum = 100 + (roundnum - 100) / 2;\n                     var mult = nn(Math.min(roundnum*10 + nn(battle.xexp || 0), roundnum*15)/tot);\n\n                     for (x in trackr)\n                     {\n                         var v = Math.floor(trackr[x]*mult);\n\n                         if (typeof pl[x] != \"number\") { print(\"WARN: Error condition\\n\" + sys.backtrace()); break l2; }\n\n                         pl[x] = nn(pl[x] + v);\n                         pl.totalexp += nn(v);\n\n                     }\n                 }\n                 // pl.totalexp += battle.round*10;\n                 var lv2 = this.level(pl.totalexp);\n\n                 if (lv2 > lv)\n                 {\n                     this.com.broadcast(pl.name + \" has leveled up to level \" + lv2 + \"!\", this.theme.GAME, false, ctx.chan);\n                 }\n\n                 for (x in battle.watchers)\n                 {\n                     this.getPlayer(ctx.rpg.name, battle.watchers[x]).watching = null;\n                 }\n\n\n             }\n\n             //print(\"Deletebattle \" + ctx.battleId);\n             //delete rpg.battles[ctx.battleId];\n         }\n         },\n\n     pidsOfBattle:\n     function (battle, chan)\n     {\n         var pids = [], x, x2;\n\n         for (x in battle.teams) for (x2 in battle.teams[x]) if (sys.id(battle.teams[x][x2]))\n         {\n             var id = sys.id(battle.teams[x][x2]);\n             pids.push(id);\n             if (! sys.isInChannel(id, chan)) sys.putInChannel(id, chan);\n         }\n\n         if (!battle.watchers) battle.watchers = [];\n\n         for ( x in battle.watchers) if (sys.id(battle.watchers[x]))\n         {\n             var id = sys.id(battle.watchers[x]);\n             pids.push(id);\n             if (! sys.isInChannel(id, chan)) sys.putInChannel(id, chan);\n         }\n\n         return pids;\n     }\n\n });\n",
 "js_modules/rpg_effects.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n",
 "js_modules/rpg_entity.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     entityTick: function (e)\n     {\n         var x;\n\n         e.sp += e.maxsp/30;\n         e.msp += e.maxmsp/20;\n\n         if (e.attr && e.attr.ghost)\n         {\n\n             e.hp += e.maxhp/15;\n         }\n\n         if (e.attr) for (x in e.attr) if (typeof e.attr[x] == typeof Number())\n         {\n             e.attr[x]--;\n             if (!e.attr[x]) delete e.attr[x];\n\n         }\n\n         // Stamina\n         if (e.sp < 0)\n             // No stamina\n         {\n             e.hp += e.sp;\n             // Reduce the HP by the amount of missing stamina.\n\n             e.sp = 0;\n             // Reset stamina\n         }\n\n         if (e.sp > e.maxsp / 3)\n             // Has a fairly large amount of stamina\n         {\n             e.hp += e.maxhp/90;\n             // Recover some HP\n         }\n\n         if (e.sp >= e.maxsp)\n             // high sp\n         {\n             e.sp = e.maxsp;\n             // Remove overflow\n\n             e.hp += e.maxhp/120;\n             // recover extra hp!\n         }\n\n         // Mental Stamina\n         if (e.msp < 0)\n             // No mental stamina\n         {\n             e.mp -= e.msp;\n             e.hp -= e.msp;\n             // Lose hp and mana\n\n             e.msp = 0;\n             // Reset\n         }\n         if (e.msp > e.maxmsp / 3)\n             // Recover mana\n         {\n             e.mp += e.maxmp/60;\n             // increase\n         }\n\n         if (e.msp > e.maxmsp)\n         {\n             e.msp = e.maxmsp;\n         }\n\n         // Mana\n         if (e.mp < 0)\n             // Not enough mana\n         {\n             e.sp += e.mp;\n             e.msp += e.mp;\n             // Decrease staminas\n\n             e.mp = 0;\n             // Reset mana;\n         }\n         if (e.mp > e.maxmp)\n             // Too much mana\n         {\n             if (e.mp > e.maxmp *1.1) e.hp += e.maxmp*1.1 - e.mp;\n             // Decrease HP by overflow, uncontrolable mana damages body!\n\n             e.mp = e.maxmp;\n             // Reset\n         }\n\n         // Health\n         if (e.hp <= 0 && e.attr && e.attr.undead && e.hp > -e.maxhp)\n         {\n             e.hp += e.maxhp/10;\n             if (e.hp > 0) e.hp = 0;\n         }\n         else if (e.hp > e.maxhp)\n         // overflow\n         {\n             e.hp = e.maxhp;\n             // reset\n         }\n\n\n\n\n\n     },\n\n     \"1/ln(1.2)\": 1/Math.log(1.2),\n     \"1/ln(1.3)\": 1/Math.log(1.3),\n     \"1/3600*0.1\": 1/3600*0.1,\n     \"1/3600*0.15\": 1/3600*0.15,\n\n     totalStats: function (e)\n     {\n         return this.nn(e.str+e.res+e.sta + e.mag+e.men+e.psy+e.spd+e.spr);\n     },\n\n     entityUpdateStats: function (e)\n     {\n         /*\n          * plot {y = ln(x/3600 + 2)/ln(1.2) + x/3600*0.1, y = ln(x/3600 + 2)/ln(1.3) + x/3600*0.15} from 3600 to 3600*20\n          *\n          * Physical:\n          * y = ln(x/3600 + 2)/ln(1.2) + x/3600*0.1\n          *\n          * Magical:\n          * y = ln(x/3600 + 2)/ln(1.3) + x/3600*0.15\n          *\n          * plot {y = ln(x + 1)/ln(1.2) + x*0.1, y = ln(x + 1)/ln(1.3) + x*0.15, y = 0.17x + ln(x+1)/ln(1.8), y = 0.172x + 5.5 ln (x + 1)} from 0 to 250\n          *\n          Physical  y = 0.1x + 5.48481 log(1+x)\n          Magical y = 0.15x + 3.81149 log(1+x)\n          Psychic y = 0.17x + 1.7013 log(1+x)\n          Defensive y = 0.172x + 5.5 log(1+x)\n          *\n          */\n\n         if (!e.attr) e.attr = {};\n         var base = 100;\n         base = (e.totalexp / 7) || e.base || 100;\n         if (!e.sta) e.sta = base;\n         if (!e.str) e.str = base;\n         if (!e.res) e.res = base;\n         if (!e.men) e.men = base;\n         if (!e.psy) e.psy = base;\n         if (!e.spd) e.spd = base;\n         if (!e.mag) e.mag = base;\n         if (!e.spr) e.spr = base;\n\n         e.physpower = Math.floor(  100*(0.1*e.str/3600 + 5.48181 * Math.log( e.str/3600 + 1))    );\n         e.magicpower = Math.floor(  100*(0.15*e.mag/3600 + 3.81149 * Math.log( e.mag/3600 + 1))    );\n         e.psypower = Math.floor(  100*(0.17*e.psy/3600 + 1.7013 * Math.log( e.psy/3600 + 1))   );\n         e.defpower = Math.floor(    100*(0.172*e.res/3600 + 5.5 *Math.log(e.res/3600+1))    );\n\n\n         e.maxhp = Math.floor(    100*(0.172/3600*e.res + 5.5*Math.log(e.res/3600 + 1))   );\n         e.maxsp = Math.floor(    100*(0.172/3600*e.sta + 5.5*Math.log(e.sta/3600 + 1))   );\n         e.maxmp = Math.floor(    100*(0.172/3600*e.mag + 5.5*Math.log(e.mag/3600 + 1))   );\n         e.maxlp = Math.floor(    100*(0.08/3600*e.spr + 5.5*Math.log(e.spr/3600 + 1))   );\n\n\n         /*e.physpower =  Math.floor((Math.log(e.str/3600 + 1) * this[\"1/ln(1.2)\"] + e.str * this[\"1/3600*0.1\"])*100);\n         e.maxsp =  Math.floor((Math.log(e.sta/3600 + 1) * this[\"1/ln(1.2)\"] + e.sta * this[\"1/3600*0.1\"])*100);\n         e.maxhp = Math.floor( (Math.log(e.res/3600 + 1) * this[\"1/ln(1.2)\"] + e.res * this[\"1/3600*0.1\"])*100);*/\n/*\n         e.magicpower = Math.floor(  (Math.log(e.mag/3600 + 1) * this[\"1/ln(1.3)\"] + e.mag * this[\"1/3600*0.15\"])*100  );\n         e.maxmsp =     Math.floor(  (Math.log(e.men/3600 + 1) * this[\"1/ln(1.3)\"] + e.men * this[\"1/3600*0.15\"])*100   );\n         e.maxmp =      Math.floor(  (Math.log(e.mag/3600 + 1) * this[\"1/ln(1.3)\"] + e.mag * this[\"1/3600*0.15\"])*100  );\n\n         e.psypower = Math.floor(  (Math.log(e.psy/3600 + 1) * this[\"1/ln(1.3)\"] + e.psy * this[\"1/3600*0.15\"])*100  );\n*/\n         //e.offense = Math.floor(e.power / 10000 * (100 + this.equipAtk(e.lhand) + this.equipAtk(e.rhand)));\n         //e.defense = Math.floor(e.power / 10000 * (100 + this.equipDef(e.lhand)/2 + this.equipDef(e.rhand)/2 + this.equipDef(e.body) + this.equipDef(e.feet) + this.equipDef(e.head) + this.equipDef(e.back)));\n     },\n/*\n     entityReadyStats:\n     function (e)\n     {\n       e.\n     },\n     */\n     initializeEntity: function (e)\n     {\n         var base = 100;\n         base = (e.totalexp / 7) || e.base || 100;\n         if (!e.sta) e.sta = base;\n         if (!e.str) e.str = base;\n         if (!e.res) e.res = base;\n         if (!e.men) e.men = base;\n         if (!e.psy) e.psy = base;\n         if (!e.spd) e.spd = base;\n         if (!e.mag) e.mag = base;\n         if (!e.spr) e.spr = base;\n\n         this.entityUpdateStats(e);\n         e.hp = e.maxhp;\n         e.mp = e.maxmp;\n         e.msp = e.maxmsp;\n         e.sp = e.maxsp;\n         e.lp = e.maxlp;\n\n     },\n\n     entHtml:  function (e, droid)\n     {\n         var that = this;\n\n\n         function bar (val, max, colorfull, colorempty, neon)\n         {\n             var hpBar = \"\";\n             var d;\n\n             if (!droid && !that.config.lowBandwidth)\n             {\n                 var hpFract = Math.floor(val/max*8*10);\n                 if (hpFract < 0) hpFract = 0;\n                 var hpTenths = (hpFract - hpFract%8)/8;\n                 var hpEightiths = (hpFract-hpTenths*8) % 8;\n\n                 for (var x = 0; x < hpTenths; x++) hpBar += \"\\u2588\";\n                 var hpSlivers = [\"\", \"\\u258f\", \"\\u258e\", \"\\u258d\", \"\\u258c\", \"\\u258b\", \"\\u258a\", \"\\u2589\"];\n\n                 //if (\"\" + hpSlivers[hpEightiths] == \"undefined\") print( \"UNDEFINED \" + [val, max, hpSlivers, hpEightiths, hpFract, hpTenths, hpTenths*8, hpFract - hpTenths].join(\", \"));\n\n                 if (hpEightiths >= 4) hpBar += \"\\u2588\";\n                 //else hpBar += hpSlivers[hpEightiths];\n                 while(hpBar.length < 10) hpBar += \"\\u259e\";\n\n                 return \"[<span style='color:\" + that.color.colorTriadToString(that.color.neonify(that.color.colorMixProp(colorfull, colorempty, val/max), neon))+ \"'>\" + hpBar + \"</span>] (\"+String(val/max*100).substring(0, 5)+\"%) \" + Math.floor(val) + \"/\" + Math.floor(max);\n\n             }\n             else return \"<span style='color:\" + that.color.colorTriadToString(that.color.neonify(that.color.colorMixProp(colorfull, colorempty, val/max), neon))+ \"'>(\"+String(val/max*100).substring(0, 5)+\"%) \" + Math.floor(val) + \"/\" + Math.floor(max) + \"</span>\";\n         }\n\n         return \"<table><tr><td></td><td><br/>\" + e.name +\"<br/></td></tr>\" +\n             \"<tr><td><b>HP</b></td><td>\" + bar(e.hp, e.maxhp, [0, 0xff, 0], [0xff, 00, 00], 1) + \"</td></tr>\"+\n             \"<tr><td><b>SP</b></td><td>\" + bar(e.sp, e.maxsp,  [0x40, 0xee, 0x30], [0xaa, 0xaa, 0xaa], 0) +\"</td></tr>\"+\n             \"<tr><td><b>MP</b></td><td>\" + bar(e.mp, e.maxmp, [0, 0, 0xff], [0, 00, 00], 0) +\"</td></tr>\"+\n             \"<tr><td><b>MSP</b></td><td>\" + bar(e.msp, e.maxmsp,  [0xaa, 0xaa, 0xff], [00, 00, 00], 0) +\"</td></tr></table>\";\n\n     },\n\n     printOutStatus: function (pids, entities, chan)\n     {\n         var player_htmls = [];\n         var mob_htmls= [];\n         for (x in entities)\n         {\n             (entities[x].team == 0 ? player_htmls : mob_htmls).push(this.entHtml(entities[x]));\n         }\n\n         var outhtml = \"<p align='center' style='size:8'><table><tr><td><h1></h1></td><td><h1>&nbsp;&nbsp;&nbsp;&nbsp;V.S.&nbsp;&nbsp;&nbsp;&nbsp;</h1></td><td><h1></h1></td></tr>\";\n\n         for (var i = 0; i < player_htmls.length || i < mob_htmls.length; i++)\n         {\n             outhtml += \"<tr><td>\" + (player_htmls[i]||\"&nbsp;\") + \"</td><td></td><td>\" + (mob_htmls[i]||\"&nbsp;\") + \"</td></tr>\";\n         }\n\n         outhtml += \"</table></p>\";\n\n\n\n         this.com.message(pids, outhtml, -1, true, chan);\n\n     }\n\n });\n",
 "js_modules/rpg_equips.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** This type of object contains the definitions of equips.\n * @name rpgEquip\n * @class\n */\n/** The human readable version of the name of this equip.\n * @name name\n * @memberOf rpgEquip.prototype\n */\n/** Either 'head' 'body' 'feet' 'hand' or 'back'.\n * @name type\n * @memberOf rpgEquip.prototype\n */\n/** How many hands, for equips of class hand, either 1 or 2.\n * @name hands\n * @memberOf rpgEquip.prototype\n * @type Number\n */\n/** An array of all the different types of materials that can be used to make this item.\n * @name materials\n * @memberOf rpgEquip.prototype\n */\n/** How much of the material is needed to make the item.\n * @name amount\n * @memberOf rpgEquip.prototype\n */\n/** How much protection or damage the item provides.\n * @name base\n * @memberOf rpgEquip.prototype\n */\n/** @scope script.modules.rpg_game */\n({\n    /** Names of equips and the corresponding equip.\n     * @type {Object.<rpgEquip>}\n     */\n    equips:\n    {\n        shoes:\n        {\n            name: \"Shoes\",\n            type: \"feet\",\n            amount: 25,\n            base: 10,\n            materials: [\"hide\", \"scale\"]\n        },\n\n        hat:\n        {\n            name: \"Hat\",\n            type: \"head\",\n            amount: 5,\n            base: 20,\n            materials: [\"cloth\", \"hide\"]\n        },\n\n        helmet:\n        {\n            name: \"Helmet\",\n            type: \"head\",\n            materials: [\"metal\", \"scale\", \"bone\"],\n            amount: 5,\n            base: 25\n        },\n\n        cloak:\n        {\n            name: \"Cloak\",\n            type: \"back\",\n            amount: 30,\n            base: 5,\n            materials: [\"cloth\", \"hide\"]\n        },\n\n        clothes:\n        {\n            name: \"Casual Wear\",\n            type: \"body\",\n            amount: 30,\n            base: 25,\n            materials:  [\"cloth\"]\n        },\n\n        suit:\n        {\n            name: \"Suit\",\n            type: \"body\",\n            amount: 45,\n            base: 30,\n            materials: [\"cloth\"]\n        },\n\n        larmor:\n        {\n            name: \"Light Armor\",\n            type: \"body\",\n            amount: 40,\n            materials: [\"metal\", \"scale\", \"wood\"],\n            base: 20\n        },\n\n        armor:\n        {\n            name: \"Armor\",\n            type: \"body\",\n            amount: 60,\n            base: 40,\n            materials: [\"metal\", \"scale\"]\n        },\n\n        harmor:\n        {\n            name: \"Heavy Armor\",\n            type: \"body\",\n            amount: 200,\n            materials: [\"metal\"],\n            base: 80\n        },\n\n        sharmor:\n        {\n            name: \"Superheavy Armor\",\n            type: \"body\",\n            amount: 1250,\n            base: 180\n        },\n\n        shortsword:\n        {\n            name: \"Shortsword\",\n            type: \"hand\",\n            subtype: \"blade\",\n            hands: 1,\n            amount: 5,\n            material: [\"bone\", \"metal\", \"wood\"],\n            base: 20\n        },\n\n        sword:\n        {\n            name: \"Sword\",\n            type: \"hand\",\n            subtype: \"blade\",\n            hands: 1,\n            amount: 10,\n            material: [\"bone\", \"metal\", \"wood\"],\n            base: 40,\n            magic: 30\n        },\n\n        longsword:\n        {\n            name: \"Longsword\",\n            type: \"hand\",\n            subtype: \"blade\",\n            hands: 1,\n            amount: 20,\n            material: [\"bone\", \"metal\", \"wood\"],\n            base: 65\n        },\n\n        broadsword:\n        {\n            name: \"Broadsword\",\n            type: \"hand\",\n            subtype: \"blade\",\n            hands: 2,\n            amount: 70,\n            material: [\"bone\", \"metal\", \"wood\"],\n            base: 150\n        },\n\n        wand:\n        {\n            name: \"Wand\",\n            type: \"hand\",\n            subtype: \"magic\",\n            hands:1,\n            amount: 3,\n            materials: [\"bone\", \"wood\", \"metal\"],\n            base: 5,\n            magic: 50\n        },\n\n        staff:\n        {\n            name: \"Staff\",\n            type: \"hand\",\n            hands: 2,\n            subtype: \"magic\",\n            amount: 15,\n            materials: [\"wood\", \"bone\", \"metal\"],\n            base: 15,\n            magic: 110\n\n\n        }\n        ,\n        pickaxe:\n        {\n            name: \"Pickaxe\",\n            type: \"hand\",\n            hands:1,\n            subtype: \"pickaxe\",\n            amount: 15,\n            base: 15,\n            materials: [\"metal\",\"bone\", \"wood\", \"stone\"]\n        }\n    }\n    ,\n    equipQMult: function (e)\n    {\n        if (! (\"quality\" in e)) return 0; // obvious error but wont cause crash\n\n        if (e.quality === null) return 10; // items blessed by tux (hacked dev toys >:D)\n\n        else return this.qMult(e.quality/100);\n    },\n    \n    equipAtk: function (e)\n    {\n        if (!e) return 0;\n        return Math.max(20, (this.equips[e.type].base || 20) * (this.materials[e.material].sharpness || 20) * this.equipQMult(e));\n    }\n    ,\n    equipDef: function (e)\n    {\n        if (!e) return 0;\n        return Math.max(20, (this.equips[e.type].base || 20) * (this.materials[e.material].strength || 20) * this.equipQMult(e));\n    }\n    ,\n    equipName: function(e)\n    {\n        if (!e) return \"Nothing\";\n        var qm = this.equipQMult(e);\n        var qs;\n        var qdt = [\n            [0, \"Failure of a %\"],\n            [0.3, \"Really shity %\"],\n            [0.5, \"Ordinary %\"],\n            [0.70, \"Fine %\"],\n            [0.82, \"Excellent %\"],\n            [0.87, \"Superb %\"],\n            [0.92, \"Supreme %\"],\n            [0.94, \"Legendary %\"],\n            [0.97, \"Sacred %\"],\n            [1, \"Divine % (hacked >:3)\"]\n        ];\n\n        for (var x in qdt) if (qm >= qdt[x][0]) qs = qdt[x][1];\n\n\n        return qs.replace(/\\%/, (this.materials[e.material].name + \" \" + this.equips[e.type].name));\n    }\n});\n",
 "js_modules/rpg_game.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** Contains the RPG game :)\n * @name rpg_game\n * @memberOf script.modules\n * @requires io, com, theme, commands, util, logs, less\n * @namespace\n * @augments Module\n * */\n/** @scope script.modules.rpg_game */\n({\n\n     require: [\"io\", \"com\", \"theme\", \"commands\", \"util\", \"logs\", \"less\", \"color\", \"user\", 'chat'],\n\n     include: [\"rpg_areas\", \"rpg_player\", \"rpg_entity\", \"rpg_actions\",\n               \"rpg_mobs\", \"rpg_equips\", \"rpg_materials\", \"rpg_moves\",\n               \"rpg_battle\", \"rpg_items\", \"rpg_skills\"],\n\n\n     database: null,\n     /** channel */\n     channels: null,\n\n     game: null,\n\n     players: null,\n\n     hooks: null\n     ,\n     loadModule: function ()\n     {\n         this.database = this.io.openDB(\"rpg_game\");\n         if (!this.database.games) this.database.games = new Object;\n         this.channels = new Object;\n         this.hooks = new Object;\n         this.activeState = new Object;\n\n         this.commands.registerCommand(\"loadrpg\", this);\n         this.commands.registerCommand(\"rpg\", this);\n\n         this.script.registerHandler(\"step\", this);\n\n\n         this.io.registerConfig(this, { lowBandwidth: false });\n\n         for (var x in this.skills)\n         {\n             this.skills[x].shortname = x;\n         }\n     },\n\n     unloadModule: function ()\n     {\n         this.io.closeDB(\"rpg_game\");\n\n\n     },\n\n     step: function ()\n     {\n         for (var x in this.channels)\n         {\n             this.RPGStep(this.channels[x], x);\n         }\n     },\n\n     RPGStep: function (rpg, chan)\n     {\n\n         if (rpg.paused) return;\n         rpg.tick++;\n\n         if (rpg.tick % 5 != 0) return;\n\n         for (var x in rpg.areas)\n         {\n             this.areaStep(rpg.areas[x], { rpg: rpg, chan: chan });\n         }\n\n         for (x in this.activeState[rpg.name].players)\n         {\n             this.playerStep(this.activeState[rpg.name].players[x], {rpg: rpg, chan: chan});\n         }\n\n         for (x in rpg.battles)\n         {\n             this.battleStep( {rpg:rpg, battle: rpg.battles[x], battleId: x, chan:chan, message: this.hooks[rpg.name] });\n         }\n     },\n\n     getRPG: function (rpgname)\n     {\n         if (this.database.games[rpgname])\n         {\n             this.activeState[rpgname] = { players: {} };\n\n\n             return this.database.games[rpgname];\n         }\n\n         else\n         {\n             var newr = this.database.games[rpgname] =\n                 {\n                     name: rpgname,\n                     //areas: JSON.parse(JSON.stringify(this.areas)),\n                     materials: {},\n//                     players: {},\n                     pdb: {},\n                     pdbCounter: 0,\n                     battles: {},\n                     battleCoutner: 0,\n                     running: false,\n                     tick: 0\n                 };\n\n\n\n             this.activeState[rpgname] = { players: {} };\n\n\n\t     return newr;\n         }\n\n         return newr;\n     },\n\n\n\n     startRPGinChan: function (rpgname, chan)\n     {\n         var rpg = this.getRPG(rpgname);\n\n         this.channels[chan] = rpg;\n\n         if ( this.hooks[rpgname] ) throw new Error(\"Already hooked into another channel?\");\n\n         this.logs.logMessage(this.logs.INFO, \"Loaded RPG game \" + rpgname + \" in channel \" + sys.channel(chan));\n\n         this.hooks[rpgname] =\n             {\n                 message: this.util.bind\n                 (\n                     this\n                     ,\n                     function(player, message)\n                     {\n                         this.com.message([player], message, this.theme.GAME, true, [chan]);\n                     }\n                 )\n                 ,\n                 broadcast: this.util.bind\n                 (\n                     this\n                     ,\n                     function (message)\n                     {\n                         this.com.broadcast(message, this.theme.GAME, true, [chan]);\n                     }\n                 )\n             };\n\n\n         rpg.running = true;\n         rpg.chan = chan;\n\n     },\n\n     /** @type commandDescriptor */\n     rpg: // not to be confused with \"RPG\"\n     {\n         mode: \"lazy\",\n         category: \"fun/rpg\",\n         desc: \"Enter an RPG command!\",\n         perm: \"RPG[PLAY]\",\n         code: function (src, cmd, chan)\n         {\n             if (!this.channels[chan])\n             {\n                 this.com.message([src], \"No RPG running in that channel\", this.theme.WARN);\n                 return;\n             }\n\n             var rpg = this.channels[chan];\n\n             var player = this.getPlayer(rpg.name, this.user.name(src));\n\n\n             //    this.com.message([src], \"Creating you a new RPG character!\", this.theme.GAME);\n             //    this.logs.logMessage(this.logs.INFO, sys.name(src) + \" created an RPG character in RPG \" + rpg.\n             player.name = this.user.name(src);\n\n             if (!cmd.input || cmd.input.match(/^\\s*$/))\n             {\n                 this.com.message(src, \"Subcommands, (/rpg <subcommand>):\\n\"\n                                  + \"walk <area> (ommit area to show current area)\\n\"\n                                  + \"view (view player stats)\\n\"\n                                  + \"battle (start a battle)\\n\"\n                                  + \"items (show items)\\n\"\n                                  + \"plan <move>:<prob> <move>:<prob> ... (e.g. /rpg plan attack:5 heal:2)\\n\"\n                                  + \"use <skillname> (to use that skill on the next turn)\\n\"\n                                  + \"skills (shows your skills available to use via /rpg plan or use)\\n\"\n                                  // + \"equip Show available equips or equip one.\\n\"\n                                  // + \"dequip remove slot item\\n\"\n                                  + \"print (to print out copypasteable info)\\n\"\n                                  + \"flee (To escape the current battle)\\n\"\n                                  + \"watch playername (To watch a player's battle, must be in same location ingame.)\\n\"\n                                  + \"challenge playername (To challenge a player to a PVP match)\\n\"\n                                  + \"allowjoins (Allow players to join a PvE battle)\\n\"\n                                  + \"joinbattle playername (To join a PvE battle)\\n\"\n                                  + \"contemplate turns (to contemplate for a few turns, the mysteries of life)\",\n                                  this.theme.RPG, false, chan);\n                 return;\n             }\n\n             //    rpg.players[sys.name(src).toLowerCase()] = player;\n\n             var actions = String(cmd.input).split(/\\;/g);\n\n             for (var x in actions)\n             {\n                 var subactions = actions[x].split(/[,\\/| ]/g);\n\n                 if (subactions.length == 0) continue;\n\n                 subactions[0] = subactions[0].toLowerCase();\n                 if (subactions[0] in this.rpgActions)\n                 {\n                     this.rpgActions[subactions[0]].apply(this, [src, subactions, chan, {player: player, rpg: rpg, action: actions[x] }, cmd] );\n                 }\n             }\n         }\n     },\n\n     /** @type commandDescriptor */\n     loadrpg:\n     {\n         mode: \"lazy\",\n         desc: \"Loads an RPG into a channel.\",\n         category: \"administrative/rpg\",\n         perm: \"RPG[ADMIN]\",\n         code: function (src, cmd, chan)\n         {\n\n             var rpgname = cmd.input.replace(/^\\s*([^\\s]+)\\s*$/, \"$1\");\n\n             if (this.channels[chan])\n             {\n                 this.com.message([src], \"This channel already has a running RPG\", this.theme.WARN);\n                 return;\n             }\n\n             var rpg = this.getRPG(rpgname);\n\n             delete rpg.areas;\n\n             if (this.hooks[rpgname])\n             {\n                 this.com.message([src], \"RPG is already running!\", this.theme.WARN);\n                 return;\n             }\n\n             this.startRPGinChan(rpgname, chan);\n\n             this.com.broadcast(\"RPG \\\"\"+rpg.name+\"\\\" loaded in #\" + sys.channel(chan) + \"!\");\n         }\n     },\n\n     qMult:\n     function (q)\n     {\n         // min\n         return 1 - (1 / Math.log(q + 4));\n     },\n\n     qMult2:\n     function (q)\n     {\n         // min\n         return 1 - (1 / (Math.pow(q, 0.5) + 1.5));\n     },\n\n     lMult:\n     function (q)\n     {\n         // min\n         return 0.3 + (0.7 / Math.log(q + Math.E));\n     }\n\n\n });\n",
 "js_modules/rpg_items.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n\n     useItem:\n     function (itemclass, pids, player, chan)\n     {\n         if (!item.use)\n         {\n             this.com.message(pids, \"Was distracted by the shiny \" + item.name + \".\", this.theme.WARN, chan);\n             return;\n         }\n     },\n\n     items:\n     {\n\t goo:\n         {\n             name: \"Goo Lump\"\n\n         },\n\n         spkcrystal:\n         {\n             name:\"Spooky Crystal\"\n         },\n\n         destinygem:\n         {\n             name:\"Destiny Gem\"\n         },\n\n\n         /* METALS */\n         ironore:\n         {\n             name: \"Iron Ore\",\n             material: \"iron\",\n             base: 2\n         },\n\n         goldore:\n         {\n             name: \"Gold Ore\",\n             material: \"gold\",\n             base: 2\n         },\n\n         tinore:\n         {\n             name: \"Tin Ore\",\n             material: \"tin\",\n             base: 2\n         },\n\n         silverore:\n         {\n             name: \"Silver Ore\",\n             material: \"tin\",\n             base: 2\n         },\n\n         tiore:\n         {\n             name: \"Titanium Ore\",\n             material: \"ti\",\n             base: 2\n         },\n\n         tinore:\n         {\n             name: \"Tin Ore\",\n             material: \"tin\",\n             base: 2\n         },\n\n\n\n\n         shroomcap:\n         {\n             name: \"Mushroom Cap\"\n         },\n\n         testfeather:\n         {\n             name: \"Chicken Feather\"\n         }\n     }\n });\n",
 "js_modules/rpg_materials.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n\n\n\n\n/* /////////////////////// WARNING TO GAMERS /////////////////////////////\n\n These values are SUBJECT TO CHANGE. Source code viewer beware! They wont\n stay like this!\n\n /////////////////////////////////////////////////////////////////////// */\n\n\n\n\n({\n\n    materials:\n    {\n        birch:\n        {\n            name: \"Birch Wood\",\n            type: \"wood\",\n            strength: 7,\n            sharpness: 5,\n            density: 5,\n            magic: 20\n        },\n\n        ebony:\n        {\n            name: \"Ebony Wood\",\n            type: \"wood\",\n            strength: 35,\n            sharpness: 10,\n            density: 14,\n            magic: 25\n        },\n\n        oak:\n        {\n            name: \"Oak Wood\",\n            type: \"wood\",\n            strength: 20,\n            sharpness: 8,\n            density: 8,\n            magic: 10\n        },\n\n        ivory:\n        {\n            name: \"Ivory\",\n            type: \"bone\",\n            strength: 30,\n            sharpness: 80,\n            density: 15,\n            magic: 35\n        },\n\n        wdscale:\n        {\n            name: \"White Dragon Scale\",\n            type: \"scale\",\n            strength: 70,\n            sharpness: 20,\n            density: 15\n        },\n\n        wdfang:\n        {\n            name: \"White Dragon Fang\",\n            type: \"bone\",\n            strength: 10,\n            sharpness: 60,\n            density: 20\n        },\n\n        firedscale:\n        {\n            name: \"Fire Dragon Scale\",\n            type: \"scale\",\n            strength: 120,\n            sharpness: 20,\n            density: 35\n        },\n\n        firedfang:\n        {\n            name: \"Fire Dragon Fang\",\n            type: \"bone\",\n            strength: 30,\n            sharpness: 80,\n            density: 45\n        },\n\n        sdscale:\n        {\n            name: \"Sky Dragon Scale\",\n            type: \"scale\",\n            strength: 50,\n            sharpness: 15,\n            density: 8\n        },\n\n        sdfang:\n        {\n            name: \"Sky Dragon Fang\",\n            type: \"fang\",\n            strength: 15,\n            sharpness: 40,\n            density: 12\n        },\n\n        iron:\n        {\n            name: \"Iron\",\n            type: \"metal\",\n            strength: 60,\n            sharpness: 40,\n            density: 80,\n            magic: 5\n\n        },\n\n        copper:\n        {\n            name: \"Copper\",\n            type: \"metal\",\n            strength: 40,\n            sharpness: 30,\n            density: 70,\n            magic: 5\n        },\n\n        zinc:\n        {\n            name: \"Zinc\",\n            type: \"metal\",\n            strength: 30,\n            sharpness: 20,\n            density: 40,\n            magic: 7\n        },\n\n        gold:\n        {\n            name: \"Gold\",\n            type: \"metal\",\n            strength: 20,\n            sharpness: 10,\n            density: 40,\n            magic: 60\n        },\n\n        silver:\n        {\n            name: \"Silver\",\n            type: \"metal\",\n            strength: 25,\n            sharpness: 10,\n            density: 40,\n            magic: 60\n        },\n\n        electrum:\n        {\n            name: \"Electrum\",\n            type: \"metal\",\n            strength: 22,\n            sharpness: 10,\n            density: 40,\n            magic: 120\n        },\n\n        steel:\n        {\n            name: \"Steel\",\n            type: \"metal\",\n            strength: 120,\n            sharpness: 60,\n            density: 95,\n            magic: 2\n        },\n\n        hgsteel:\n        {\n            name: \"High-Grade Steel\",\n            type: \"metal\",\n            strength: 150,\n            sharpness: 70,\n            density: 100,\n            magic: 1\n\n        },\n\n        ti:\n        {\n            name: \"Titanium\",\n            strength: 90,\n            sharpness: 50,\n            density: 40,\n            magic: 5\n        }\n        ,\n        ametal:\n        {\n            name: \"Amorphorous Metal Alloy\",\n            type: \"metal\",\n            strength: 125,\n            sharpness: 350,\n            density: 85,\n            magic: 85\n        }\n        ,\n        diamond:\n        {\n            name: \"Diamond\",\n            type: \"gem\",\n            strength: 200,\n            sharpness: 250,\n            density: 40,\n            magic: 50\n        }\n        ,\n        brass:\n        {\n            name: \"Brass\",\n            type: \"metal\",\n            strength: 140,\n            sharpness: 60,\n            density: 90,\n            magic: 5\n        }\n        ,\n        ruby:\n        {\n            name: \"Ruby\",\n            type: \"gem\",\n            strength: 100,\n            sharpness: 250,\n            density: 40\n        }\n        ,\n        leather:\n        {\n            name: \"Leather\",\n            type: \"hide\",\n            strenth: 30,\n            sharpness: 0,\n            density: 5\n        }\n        ,\n        snakeskin:\n        {\n            name: \"Snakeskin\",\n            type: \"hide\",\n            strength: 25,\n            sharpness: 5,\n            density: 22\n        }\n        ,\n        cotton:\n        {\n            name: \"Cotton\",\n            type: \"cloth\",\n            strength: 8,\n            sharpness: 0,\n            density: 3\n        }\n    }\n\n});\n    /*\n      Ideally these should be (relatively) realistic:\n\n      hardness (Vickers) / 10\n      density (g/cm^3) *10\n      resistance (nΩ·m) / 5\n      thermal 100/(W·m−1·K−1)\n      opacity (opaque%)\n\n      Mark details where this has been looked up with //(*)\n\n      Put //fictional for non-real materials, e.g.:\n\n      dragontooth:\n      {\n      // fictional\n          hardness: ...\n          ...\n      }\n\n\n\n    */",
 "js_modules/rpg_mixins.js": "({\n     mixins:\n     {\n         electrum: { output: 2, input: { gold:1, silver: 1}},\n         brass: {output:3, input: { copper:2, zinc: 1}},\n         steel: {output:10, input: {iron: 9, graphite: 1}}\n     }\n\n\n });",
 "js_modules/rpg_mobs.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     mkMob: function (mb)\n     {\n         var m = JSON.parse(JSON.stringify(this.mobs[mb]));\n\n         this.initializeEntity(m);\n\n         m.xexp = this.nn(Math.round(Math.log(this.totalStats(m)/3600 + 1)*100));\n\n\n         m.type = \"mob\";\n\n         return m;\n     },\n\n     mobs:\n     {\n         testchicken:\n         {\n             name: \"Chicken\",\n             desc: \"\",\n             base: 75, res: 100,\n             drops: [{ prob: 1, item: \"testfeather\", count: 1 }],\n             plan:\n             [{ prob: 0.7, skill: \"peck\"}, { prob: 0.3, skill: \"peckground\" }]\n         },\n\n         slime:\n         {\n             name: \"Slime\", attr: {wet: true},\n             desc: \"A slimy slime!\",\n             base: 120,\n             drops: [{ prob: 0.1, item: \"goo\", count: 1 }],\n             plan: [{prob:1, skill:\"attack\"}]\n         },\n\n         slime2:\n         {\n             name: \"Big Slime\", attr: {wet: true},\n             desc: \"Larger than average slime.\",\n             base: 480,\n             drops: [{ prob: 0.14, item: \"goo\", count: 1 }],\n             plan: [{prob:1, skill:\"attack\"},{prob:1, skill: \"sltackle\"}]\n\n         },\n\n         slime3:\n         {\n             name: \"Large Slime\", attr: {wet: true},\n             desc: \"Larger than average slime.\",\n             base: 960,\n             drops: [{ prob: 0.14, item: \"goo\", count: 2 }],\n             plan: [{prob:1, skill:\"sltackle\"}]\n\n         },\n\n         slime4:\n         {\n             name: \"Huge Slime\", attr: {wet: true},\n             desc: \"Larger than average slime.\",\n             base: 1440,\n             drops: [{ prob: 0.16, item: \"goo\", count: 3 }],\n             plan: [{prob:1, skill:\"slvortex\"},{prob:2, skill: \"sltackle\"}]\n\n         },\n\n         slime5:\n         {\n             name: \"Enormous Slime\", attr: {wet: true},\n             desc: \"Larger than average slime.\",\n             base: 2160,\n             drops: [{ prob: 0.16, item: \"goo\", count: 4 }],\n             plan: [{prob:1, skill: \"slvortex\"}]\n\n         },\n\n         slime6:\n         {\n             name: \"Giant Slime\", attr: {wet: true},\n             desc: \"Larger than average slime.\",\n             base: 3240,\n             drops: [{ prob: 0.18, item: \"goo\", count: 5 }],\n             plan: [{prob:1, skill:\"slvortex\"}]\n\n         },\n\n         slime7:\n         {\n             name: \"Mega Slime\", attr: {wet: true},\n             desc: \"Larger than average slime.\",\n             base: 3600*2,\n             drops: [{ prob: 0.2, item: \"goo\", count: 6 }],\n             plan: [{prob:1, skill:\"slvortex\"}, {prob:1, skill: \"slexp\"}]\n\n         },\n\n         slime8:\n         {\n             name: \"Giga Slime\", attr: {wet: true},\n             desc: \"Larger than average slime.\",\n             base: 3600*4.5,\n             drops: [{ prob: 0.2, item: \"goo\", count: 6 }],\n             plan: [{prob:2, skill:\"slcrash\"}, {prob:1, skill: \"slexp\"}]\n\n         },\n\n         slimed:\n         {\n             name: \"Giga Slime Dragon\", attr: {wet: true, flying: true},\n             desc: \"lolwut.\",\n             base: 3600*9,\n             drops: [{ prob: 1, item: \"goo\", count: 8 }],\n             plan: [{prob:1, skill:\"slcrash\"}, {prob:1, skill: \"slbreath\"}]\n\n         },\n\n         spook:\n         {\n             name: \"Spook\",\n             desc: \"A ghastly spook. It's small size does not pack a small threat!\",\n             base: 350, res: 200, attr: { ghost: true },\n             plan: [{prob:5, skill:\"shadows\"}, {prob:1, skill:\"hellrain\"}],\n             drops: [{ prob:0.1, item: \"spkcrystal\", count:1 }, { prob:0.1, item: \"spkcrystal\", count:1 }, { prob: 0.01, item: \"destinygem\", count:1 }]\n\n         },\n\n         grim:\n         {\n             name: \"Grim\",\n             desc: \"A ghastly grim. It's a dangerous devil!\",\n             base: 350, res: 650,  attr: { ghost: true, flying: true },\n             plan: [{prob:3, skill:\"hellrain\"},{prob:1, skill:\"shadows\"}]\n\n         },\n\n         mspook:\n         {\n             name: \"Medium Spook\",\n             desc: \"A ghastly spook. It's much larger than your average spook!\",\n             base: 950, res: 700,  attr: { ghost: true },\n             plan: [{prob:2, skill:\"shadows\"}, {prob:3, skill:\"hellrain\"}],\n             drops: [{ prob:0.2, item: \"spkcrystal\", count:1 }, { prob:0.2, item: \"spkcrystal\", count:1 }, { prob: 0.07, item: \"destinygem\", count:1 }]\n\n         },\n\n         lspook:\n         {\n             name: \"Large Spook\",\n             desc: \"A ghastly spook. It's WAY larger than your average spook!\",\n             base: 1950, res: 1400, attr: { ghost: true },\n             plan: [{prob:2, skill:\"blackfog\"},{prob:1, skill:\"shadows\"}, {prob:1, skill:\"hellrain\"}, {prob:2, skill: \"blood\"}],\n             drops: [{ prob:0.3, item: \"spkcrystal\", count:1 }, { prob:0.3, item: \"spkcrystal\", count:1 }, { prob: 0.1, item: \"destinygem\", count:1 }]\n\n         },\n\n         sinester:\n         {\n             name: \"Sinester\",\n             base: 3700, attr: { ghost: true, flying: true }, mag: 4200,\n             plan: [{prob:5, skill:\"blackfog\"}, {prob:1, skill:\"hellstorm\"}, {prob:3, skill: \"blood\"}],\n             drops: [{ prob:1, item: \"destinygem\", count:1 }, { prob:0.5, item: \"destinygem\", count:1 }, { prob: 0.3, item: \"destinygem\", count:1 }]\n         },\n\n         sshell:\n         {\n             name: \"Shallow Shell\",\n             base: 7600, str: 3600, sta: 1600, attr: {ghost: true},\n             plan: [{prob:5, skill:\"dispulse\"}]\n         },\n\n         lshell:\n         {\n             name: \"Lost Shell\",\n             base: 12600,\n             attr: {ghost: true},\n             plan: [{prob:5, skill:\"disblast\"}, {prob:2, skill:\"disfield\"}]\n         },\n\n         oshell:\n         {\n             name: \"Oblivion Shell\",\n             base: 17600, str: 3600, sta: 3600,\n             attr: {ghost: true},\n             plan: [{prob:5, skill:\"diswarp\"}]\n         },\n\n         ushell:\n         {\n             name: \"Uber Shell\",\n             base: 23600, str: 3600, sta: 8600,\n             attr: {ghost: true},\n             plan: [{prob:5, skill:\"disexpl\"}]\n         },\n\n         xshell:\n         {\n             name: \"X Shell\",\n             base: 35600, str: 3600, sta: 23600,\n             attr: {ghost: true},\n             plan: [{prob:5, skill:\"disexpl\"}]\n         },\n\n         xshell2:\n         {\n             name: \"X Shell Vespir\",\n             base: 41600, str: 3600, sta: 36600,\n             attr: {ghost: true},\n             plan: [{prob:5, skill:\"disexpl\"}]\n         },\n\n         xshell3:\n         {\n             name: \"X Shell Exolesco\",\n             base: 72600, str: 3600, sta: 55600,\n             attr: {ghost: true},\n             plan: [{prob:5, skill:\"disexpl\"}]\n         },\n\n         zombie:\n         {\n             name: \"Zombie\",\n             base: 3600, sta: 6000, men: 6000, str: 4000, res: 8000,\n             attr: {undead: true},\n             plan: [{prob:3, skill: \"superpunch\"}, {prob: 1, skill:\"sonichand\"}]\n         },\n\n         eshroom:\n         {\n             name: \"Evil Mushroom\",\n             desc: \"One day, a mushroom turned into a monster... but... it didn't get any larger when that happened.\",\n             str: 50,\n             res: 50,\n             drops: [{\n                         prob: 1,\n                         item: \"shroomcap\",\n                         count: 1\n                     }]\n         },\n\n         dkfrog:\n         {\n             name: \"Dark Frog\",\n             desc: \"You can ask this frog is he's read any well-known gririmore, and his responce, more than likely, will be 'read-it read-it'.\",\n             base: 300\n         },\n\n         bat:\n         {\n             name: \"Scary Bat\",\n             desc: \"An unfortunately frightening bat.\",\n             base: 700, spd: 400, attr: {flying: true},\n             plan:[{ prob:1, skill:\"fangs\"}]\n         },\n\n         lsquirrel:\n         {\n             name: \"Lethal Squirrel\",\n             desc: \"Nuts with evil, this squirrel is as dangerous as squirls get!\",\n             base: 1200,\n             men: 600,\n             spd: 3600,\n             plan:[{ prob:1, skill:\"fangs\"}]\n         },\n\n         dsquirrel:\n         {\n             name: \"Deadly Squirrel\",\n             desc: \"Nuts with evil, this squirrel is as dangerous as squirls get!\",\n             base: 1600,\n             men: 800,\n             spd: 4600,\n             plan: [{prob:1, skill: \"superpunch\"}]\n         },\n\n         adsquirrel:\n         {\n             name: \"Armoured Deadly Squirrel\",\n             desc: \"Nuts with evil, this squirrel is as dangerous as squirls get!\",\n             base: 1600,\n             res: 4600,\n             men: 800,\n             spd: 3600,\n             plan: [{prob:1, skill: \"superpunch\"}]\n         },\n\n         jetsquirrel:\n         {\n             name: \"Deadly Squirrel with Jetpack\", attr: { flying: true },\n             desc: \"Nuts with evil, this squirrel is as dangerous as squirls get!\",\n             base: 4400,\n             men: 3300,\n             spd: 7600,\n             plan: [{prob:2, skill: \"sonichand\"}, {prob:1, skill: \"bombs\"}]\n         },\n\n         golem:\n         {\n             name: \"Golem\", attr: {grounded: true},\n             base: 5600, res: 24000, sta: 17000, spd: 2400,\n             plan: [{prob:2, skill: \"superpunch\"}, {prob:1, skill: \"grndbrk\"}]\n         },\n\n         sgolem:\n         {\n             name: \"Super Golem\", attr: {grounded: true},\n             base: 9600, res: 29000, sta: 21000, spd: 2300,\n             plan: [{prob:1, skill: \"superpunch\"}, {prob:2, skill: \"grndbrk\"}]\n         },\n\n         elector:\n         {\n             name: \"Elector\", attr: {flying:true},\n             base: 24600, res: 7200, sta: 5000, spd: 65200,\n             plan: [{prob:5, skill: \"thunderstorm\"}, {prob:2, skill: \"voltblast\"}, {prob:1, skill: \"bombs\"}]\n         },\n\n\n\n\n         reddragon:\n         {\n             name: \"Red Dragon\",\n             desc: \"...\",\n             base: 3600*1200, attr: { flying: true },\n             plan: [{\n                     prob: 1,\n                     skill: \"firebreath\"\n                 }]\n         }\n     }\n });\n",
 "js_modules/rpg_moves.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** @scope script.modules.rpg_game */\n({\n     offenseClasses:\n     {\n         none:\n         function(ctx)\n         {\n             var qmlt = 0.8, base = ctx.component.base;\n\n             if (ctx.attacker.type == \"player\")\n             {\n                 qmlt = this.qMult2((ctx.attacker.exp[ctx.move.shortname]-this.skills[ctx.move.shortname].threshold)/base*1.2 || 0 + Math.E);\n             }\n             else if (ctx.attacker.base)\n             {\n                 qmlt = this.qMult2((ctx.attacker.base)/base || 0 + Math.E);\n             }\n             return { offense: 1, qmult: qmlt};\n         },\n\n         general:\n         function (ctx)\n         {\n             var damage, base = ctx.component.base, offense = ctx.attacker.defpower, qmlt = 0.8;\n\n             if (ctx.attacker.type == \"player\")\n             {\n                 qmlt = this.qMult2((ctx.attacker.exp[ctx.move.shortname]-this.skills[ctx.move.shortname].threshold)/base*1.2 || 0 + Math.E);\n             }\n             else if (ctx.attacker.base)\n             {\n                 qmlt = this.qMult2((ctx.attacker.base)/base/3 || 0 + Math.E);\n             }\n\n             return {offense: offense, qmult: qmlt };\n\n         },\n\n         physical:\n         function (ctx)\n         {\n             var damage, base = ctx.component.base,offense = ctx.attacker.physpower, qmlt = 0.8;\n\n             if (ctx.attacker.type == \"player\")\n             {\n                 qmlt = this.qMult2((ctx.attacker.exp[ctx.move.shortname]-this.skills[ctx.move.shortname].threshold)/base*1.2 || 0 + Math.E);\n             }\n             else if (ctx.attacker.base)\n             {\n                 qmlt = this.qMult2((ctx.attacker.base)/base/3 || 0 + Math.E);\n             }\n\n             return {offense: offense, qmult: qmlt };\n\n         },\n\n         magical:\n         function (ctx)\n         {\n             var damage, base = ctx.component.base,offense = ctx.attacker.magicpower, qmlt = 0.8;\n\n             if (ctx.attacker.type == \"player\")\n             {\n                 qmlt = this.qMult2((ctx.attacker.exp[ctx.move.shortname]-this.skills[ctx.move.shortname].threshold)/base || 0 + Math.E);\n             }\n             else if (ctx.attacker.base)\n             {\n                 qmlt = this.qMult2((ctx.attacker.base)/base/3 || 0 + Math.E);\n             }\n\n             return {offense: offense, qmult: qmlt };\n\n         },\n\n         psychic:\n         function (ctx)\n         {\n             var damage, base = ctx.component.base,offense = ctx.attacker.psypower, qmlt = 0.8;\n\n             if (ctx.attacker.type == \"player\")\n             {\n                 qmlt = this.qMult2((ctx.attacker.exp[ctx.move.shortname]-this.skills[ctx.move.shortname].threshold)/base/3 || 0 + Math.E);\n             }\n             else if (ctx.attacker.base)\n             {\n                 qmlt = this.qMult2((ctx.attacker.base)/base/3 || 0 + Math.E);\n             }\n\n             return {offense: offense, qmult: qmlt };\n         }\n\n\n     },\n\n     defenseClasses:\n     {\n         none:\n         function ()\n         {\n             return 1;\n         },\n\n         general:\n         function (ctx)\n         {\n             var defense = ctx.target.defpower;\n\n\n\n             return defense;\n         },\n\n         physical:\n         function(ctx)\n         {\n             var defense = ctx.target.defpower;\n\n             if (ctx.target.attr && ctx.target.attr.ghost)\n             {\n                 defense *= 2;\n             }\n\n             if (ctx.target.attr && ctx.target.attr.flying && !(ctx.component.attr && ctx.component.attr.air))\n             {\n                 defense *= 2;\n             }\n\n             return defense;\n         },\n\n         magical:\n         function(ctx)\n         {\n             var defense = ctx.target.defpower;\n             return defense;\n         },\n\n         electric:\n         function(ctx)\n         {\n             var defense = ctx.target.defpower;\n\n             if (ctx.component.attr && ctx.component.attr.air && ctx.target.attr && ctx.target.attr.flying)\n             {\n                 defense /= 2;\n             }\n\n             if (ctx.target.attr && ctx.target.attr.wet)\n             {\n                 defense /= 2;\n             }\n\n             else if (ctx.target.attr && ctx.target.attr.grounded)\n             {\n                 defense *= 8;\n             }\n\n             return defense;\n         },\n\n         ice:\n         function(ctx)\n         {\n             var defense = ctx.target.defpower;\n\n             if (ctx.target.attr && ctx.target.attr.flying)\n             {\n                 defense /= 2;\n             }\n\n             return defense;\n         },\n\n         fire:\n         function(ctx)\n         {\n             var defense = ctx.target.defpower;\n\n             if (ctx.target.attr && (ctx.target.attr.ghost || ctx.target.attr.flamable))\n             {\n                 defense /= 2;\n             }\n\n             if (ctx.target.attr && (ctx.target.attr.wet || ctx.target.attr.firey))\n             {\n                 defense *= 2;\n             }\n\n             return defense;\n         },\n\n         light:\n         function(ctx)\n         {\n             var defense = ctx.target.defpower;\n\n             if (ctx.target.attr && (ctx.target.attr.ghost || ctx.target.attr.undead))\n             {\n                 defense /= 2;\n             }\n\n             return defense;\n         },\n\n         water:\n         function(ctx)\n         {\n             var airlevel, defense = ctx.target.defpower;\n\n             if (ctx.target.attr && ctx.target.attr.firey)\n             {\n                 defense /= 2;\n             }\n\n             return defense;\n         },\n\n         ghost:\n         function(ctx)\n         {\n             var defense = ctx.target.defpower;\n\n             if (ctx.target.attr && ctx.target.attr.firey)\n             {\n                 defense *= 2;\n             }\n\n             return defense;\n         },\n\n         psychic:\n         function(ctx)\n         {\n             var defense = ctx.target.defpower;\n\n             if (ctx.target.attr && ctx.target.attr.ghost)\n             {\n                 defense /= 2;\n             }\n\n             return defense;\n         }\n\n\n\n\n\n\n\n     },\n\n     calcDamage:\n     function (ctx)\n     {\n         var base = ctx.component.base, qmult = ctx.qmult, mult = Math.min(Math.max(0.1, Math.pow(ctx.offense/ctx.defense, 0.5)), 10);\n\n         return base * qmult * mult;\n     },\n\n     damageClasses:\n     {\n         normal:\n         function (ctx)\n         {\n             var damage = ctx.damage;\n\n             return {hp:-damage};\n         },\n\n         ghost:\n         function (ctx)\n         {\n             var damage = Math.round(ctx.damage/3);\n\n             return {hp: -damage, sp: -damage, msp: -damage};\n         },\n\n         ice:\n         function (ctx)\n         {\n             var damage = Math.round(ctx.damage/2);\n\n             return { hp: -damage, sp: -damage };\n         },\n\n         dark:\n         function (ctx)\n         {\n             var damage = Math.round(ctx.damage/2);\n\n             return { hp: -damage, mp: -damage };\n         },\n\n         nullify:\n         function (ctx)\n         {\n             return { mp: -ctx.damage };\n         },\n\n         heal:\n         function (ctx)\n         {\n             var damage = ctx.damage;\n\n             return { hp: damage};\n         },\n\n         healmp:\n         function (ctx)\n         {\n             var damage = ctx.damage;\n\n             return { mp: damage};\n         },\n\n         healsp:\n         function (ctx)\n         {\n             var damage = ctx.damage;\n\n             return { sp: damage};\n         },\n\n         healmsp:\n         function (ctx)\n         {\n             var damage = ctx.damage;\n\n             return { sp: damage};\n         },\n\n         none:\n         function()\n         {\n             return {};\n         },\n\n         ghostify:\n         function(ctx)\n         {\n             var turns = Math.round(ctx.damage);\n\n             if (!ctx.target.attr) ctx.target.attr = {ghost:turns};\n\n             else ctx.target.attr.ghost = (ctx.target.attr.ghost || 0) + turns;\n\n             return {};\n         },\n\n         psychic:\n         function (ctx)\n         {\n             var damage = Math.round(ctx.damage);\n\n             return { msp: -damage };\n         }\n\n\n     },\n\n     componentClasses:\n     {\n         physical:\n         {\n             offense: \"physical\", defense: \"physical\", damage: \"normal\"\n         },\n\n         ghost:\n         {\n             offense: \"magical\", defense: \"ghost\", damage: \"ghost\"\n         },\n\n         ice:\n         {\n             offense: \"magical\", defense: \"ice\", damage: \"ice\"\n         },\n\n         dark:\n         {\n             offense: \"magical\", defense: \"ghost\", damage: \"dark\"\n         },\n\n         magical:\n         {\n             offense: \"magical\", defense: \"magical\", damage: \"normal\"\n         },\n\n         psychic:\n         {\n             offense: \"psychic\", defense: \"psychic\", damage: \"psychic\"\n         },\n\n         heal:\n         {\n             offense: \"none\", defense: \"none\", damage: \"heal\"\n         },\n\n         boostmsp:\n         {\n             offense: \"none\", defense: \"none\", damage: \"healmsp\"\n         },\n\n         boostmp:\n         {\n             offense: \"none\", defense: \"none\", damage: \"healmp\"\n         },\n\n         boostsp:\n         {\n             offense: \"none\", defense: \"none\", damage: \"healsp\"\n         },\n\n         ghostify:\n         {\n             offense: \"none\", defense: \"none\", damage: \"ghostify\"\n         },\n\n         light:\n         {\n             offense: \"magical\", defense: \"light\", damage: \"normal\"\n         }\n     },\n\n\n     runComponent:\n     function (comp, move, attacker, target)\n     {\n         var x, offenseObj = this.offenseClasses[comp.offense || this.componentClasses[comp.move].offense].call(this, {attacker: attacker, move: move, base: comp.base, component: comp}),\n         offense = offenseObj.offense, qmult = offenseObj.qmult, defense = this.defenseClasses[comp.defense || (comp.move && this.componentClasses[comp.move].defense) || \"general\"].call(this, {target: target, component: comp}), damage = this.calcDamage.call(this, {offense:offense, defense: defense, qmult: qmult, component: comp}), damageObj = this.damageClasses[comp.damage || (this.componentClasses[comp.move] || {}).damage || \"normal\"]({damage: damage, target: target, component: comp, qmult: qmult});\n         // defense classes\n\n         //print(JSON.stringify([damage, damageObj, offense, defense, qmult]));\n         for (x in damageObj)\n         {\n             target[x] += damageObj[x];\n         }\n\n\n\n         return damageObj;\n     },\n\n     /** Selects a skill from the entities use or plan attributes.\n      * @param entity The entity to select a move from\n      * @returns {rpgSkillDescriptor} The skill to use\n      */\n     pickMove: function (entity)\n     {\n         var temp, total, index, iterative_weight_total, random_weighted_index;\n\n         if (entity.use)\n         {\n             temp = entity.use;\n             delete entity.use;\n             return this.skills[temp];\n         }\n\n         else if (entity.plan)\n         {\n             total = 0;\n\n             for (index = 0; index < entity.plan.length; index++)\n             {\n                 total += entity.plan[index].prob;\n             }\n\n             random_weighted_index = Math.random()*total;\n\n             for (index = 0, iterative_weight_total = 0; index < entity.plan.length; index++)\n             {\n                 iterative_weight_total += entity.plan[index].prob;\n\n                 if (iterative_weight_total > random_weighted_index)\n                 {\n                     return this.skills[entity.plan[index].skill];\n                 }\n\n             }\n         }\n\n         return this.skills.attack;\n     }\n });\n",
 "js_modules/rpg_player.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n\n     /** Returns a made up \"level\" value, has no effect on gameplay, but needed because ZOMG rpg haz no levelz?!!?!?!\n      *\n      */\n     level: function (exp)\n     {\n         return Math.floor(Math.log(exp/2 + Math.E) + Math.pow(exp/60,0.6)/2);\n     },\n\n     getPlayer: function (rpgname, name, soft)\n     {\n         //this.database.pdbCounter = Number(this.database.pdbCounter);\n\n         var pid, pobj, np, x;\n\n         pid = this.database.games[rpgname].pdb[name.toLowerCase()];\n         pobj = this.activeState[rpgname].players[pid];\n\n         if (!pid)\n         {\n             if (soft) return null;\n             pid = ++this.database.games[rpgname].pdbCounter;\n             this.database.games[rpgname].pdb[name.toLowerCase()] = pid;\n             pobj = this.activeState[rpgname].players[pid];\n         }\n\n         if (!pobj)\n         {\n             pobj = this.io.registerDB(this, \"rpg_game.game$\"+rpgname+\".p$\" + String(pid));\n             this.activeState[rpgname].players[pid] = pobj;\n         }\n\n         if (Object.keys(pobj) == 0)\n         {\n             np = this.newPlayer();\n\n             for (x in np) pobj[x] = np[x];\n\n             np = null; x = null;\n         }\n\n         pobj.name = name;\n         if (!pobj.battleActions) pobj.battleActions = [];\n         if (!pobj.totalexp) pobj.totalexp = 0;\n\n         this.entityUpdateStats(pobj);\n         return pobj;\n\n\n     },\n\n     transferPlayer:\n     function (rpgname, playerfrom, playerto)\n     {\n         var pid, pobj, np, x, pid2;\n\n         if (playerto.toLowerCase() == playerfrom.toLowerCase()) return 2;\n\n         pid = this.database.games[rpgname].pdb[playerfrom.toLowerCase()];\n         if (!pid) return 1;\n\n         pid2 = this.database.games[rpgname].pdb[playerto.toLowerCase()];\n\n         if (pid2)\n         {\n             this.database.games[rpgname].pdb[\"~\"+ String(+new Date) +\"~\" + playerto.toLowerCase()] = pid2;\n         }\n\n         this.database.games[rpgname].pdb[playerto.toLowerCase()] = pid;\n         delete this.database.games[rpgname].pdb[playerfrom.toLowerCase()];\n\n         return 0;\n     },\n\n     newPlayer: function ()\n     {\n         var newp =\n             {\n                 type: null,\n                 area: \"town1\",\n                 name: null,\n\n                 exp: {},\n\n\n                 str: 100,                res: 100,\n                 spd: 100,                mag: 100,\n                 psy: 100,                spr: 100,\n                 men: 100,\n\n                 hp: 100, mp:0,\n                 lp: 100, sp: 0,\n                 msp: 0,\n\n                 type: \"player\",\n\n                 items: {},\n                 // Bulk items, e.g., {... ironore: 50, ... }\n\n                 equips: [],\n                 // Single items\n\n                 battle: null,\n                 // Active battle ID\n\n                 activeActions: [],\n                 // Current action being executed. These occur outside of battle\n                 // And they are qued.\n\n\n                 bulkEffects: [],\n                 // All of these are executed at the same time.\n\n                 indvEffects: {},\n                 // Like bulkEffects, but an object instead of array.\n\n                 head: null,\n\n                 body:\n                 // Cotton clothing.\n                 {\n\n                     material: \"cotton\",\n                     type: \"clothes\",\n                     quality: 600\n                 },\n\n\n                 lhand: null,\n\n                 rhand:\n                 // A wooden sword.\n                 {\n                     material: \"birch\",\n                     type: \"sword\",\n                     quality: 600\n                 },\n\n\n                 feet:\n                 // Leather shoes\n                 {\n                     material: \"leather\",\n                     type: \"shoes\",\n                     quality: 600\n                 }\n\n             };\n\n         this.initializeEntity(newp);\n\n         return newp;\n     },\n\n     playerStep: function (player, ctx)\n     {\n         // Only run player steps while the player is online\n         var src = this.user.id(player.name), _tmp, x, y;\n         if (!src) return;\n         else { player.src = src; player.os = sys.os(src); }\n\n\n         l0: if (player.battle)\n         {\n             if (!(_tmp = this.getBattle(ctx.rpg, player.battle)))\n             {\n\n                 try\n                 {\n                     throw new Error(\"Dead battle detected, no such battle ID: \"+player.battle+\" for \"+player.name+\".\");\n                 } catch (e) { this.script.error(e); }\n                 player.battle = null;\n                 break l0;\n             }\n\n             for (x in _tmp.teams) for (y in _tmp.teams[x]) if (typeof _tmp.teams[x][y] == typeof String() && _tmp.teams[x][y].toLowerCase() == player.name.toLowerCase())\n             {\n                 return; // normal batte\n             }\n\n             try\n             {\n                 throw new Error(\"Dead battle detected, not in battle ID: \"+player.battle+\" for \"+player.name+\".\");\n             } catch (e) { this.script.error(e); }\n             player.battle = null;\n\n         }\n         // Regular player events don't occur while the player is in a battle!\n\n         if (!this.areas[player.area] || player.hp <= 0)\n         {\n             player.hp = 1;\n             player.sp = 1;\n             player.mp = 1;\n             player.msp = 1;\n             player.area = \"graveyard\";\n             player.activeActions = [];\n\n             this.com.message(player.src, 'You were revived at the graveyard...');\n         }\n\n         this.playerUpdateStats(player);\n\n         this.entityTick(player);\n\n\n\n\n         for (var x in player.activeActions)\n         {\n             if (\"timer\" in player.activeActions[x] && --player.activeActions[x].timer <= 0)\n             {\n                 if (player.activeActions[x].done) this.actions[player.activeActions[x].done].call(this, player.activeActions[x], { rpg: ctx.rpg, player:player, index: x, chan:ctx.chan });\n                 player.activeActions.shift();\n                 break;\n             }\n             else if (player.activeActions[x].tick)\n             {\n                 this.actions[player.activeActions[x].tick].call(this, player.activeActions[x], { rpg: ctx.rpg, player:player, index: x, chan: ctx.chan  });\n             }\n             break;\n         }\n\n\n\n     }\n     ,\n\n     playerUpdateStats: function (e)\n     {\n         const constlist = [\"str\", \"res\", \"sta\", \"men\", \"psy\", \"spd\", \"spr\", \"mag\"];\n         for (x in constlist)\n         {\n             e[constlist[x]] = Math.max(Math.abs(e[constlist[x]] || 0), 100);\n         }\n\n         e.totalexp = this.totalStats(e)-700;\n\n         this.entityUpdateStats(e);\n\n\n         //  e.maxmp =  (e.mag*0.13 + (Math.log(e.mag+Math.E)*10 | 0));\n         // e.maxsp = (e.str*0.02 + e.res*0.02 + (Math.log(e.res/100+Math.E)*150 | 0));\n         //  e.maxmsp = (e.res*0.01 + e.mag*0.01 + e.psy*0.12 + e.spr*0.01 + (Math.log(e.psy/1000+Math.E)*50 | 0));\n         //  e.maxhp = (e.str*0.01 + e.res*0.03 + (Math.log(e.res/100+Math.E)*100 | 0));\n         //  e.power = Math.floor(800*Math.log(3/2*e.str+e.psy/3+Math.E)+e.psy/25000+300);\n         //e.offense = Math.floor(e.power / 10000 * (100 + this.equipAtk(e.lhand) + this.equipAtk(e.rhand)));\n         //e.defense = Math.floor(e.power / 10000 * (100 + this.equipDef(e.lhand)/2 + this.equipDef(e.rhand)/2 + this.equipDef(e.body) + this.equipDef(e.feet) + this.equipDef(e.head) + this.equipDef(e.back)));\n     }\n });\n",
 "js_modules/rpg_skills.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** This type of object contains the definitions of skills\n * @name rpgSkill\n * @class\n */\n/** The name of the skill\n * @name name\n * @memberOf rpgSkill.prototype\n */\n/** The cost of using the skill.\n * @name cost\n * @memberOf rpgSkill.prototype\n * @type rpgCost\n */\n/** Skill level.\n * @name level\n * @type rpgSkillLevel\n * @memberOf rpgSkill.prototype\n */\n/**\n * @name rpgSkillComponent\n * @class\n */\n/** Target of the component, either \"self\", \"opp\", \"ally\" or combinations of such (in array)\n * @name target\n * @memberOf rpgSkillComponent.prototype\n */\n/** How many enemies to strike\n * @name count\n * @memberOf rpgSkillComponent.prototype\n */\n/** Type of component, e.g., 'physical', 'magical', 'heal' etc.\n * @name move\n * @memberOf rpgSkillComponent.prototype\n */\n/** The base damage done.\n * @name base\n * @memberOf rpgSkillComponent.prototype\n */\n\n\n/** @scope script.modules.rpg_game */\n({\n     playerCanUseSkill: function (player, skillname)\n     {\n         var skill = this.skills[skillname], exp;\n\n         if (!skill) return false;\n\n         if (skill.threshold === null || skill.threshold === undefined) return false;\n\n         if (skill.threshold === 0) return true;\n\n         exp = player.exp[skillname] || 0;\n\n         return skill.threshold <= exp;\n     },\n\n     skills:\n     {\n         // Mob skills\n\n         firebreath:\n         {\n             name: \"Fire Breath\", elemet: \"fire\", cost: { mp: 1300},\n             components: [{ target: \"opp\", base: 3500,  desc: \"%s blasted fire at %t!\", count: 3 }]\n         },\n         peck:\n         {\n             name: \"Chicken Peck\", element: \"phsyical\",\n             components: [{ target: \"opp\", base: 5, move: \"physical\", desc: \"%s pecked %t!\", count: 1 }]\n         },\n\n         peckground:\n         {\n             name: \"Chicken Peck\", element: \"phsyical\",\n             components: [{ target: \"none\", base : 0, move: \"nil\", desc: \"%s pecked the ground!\", count: 0 }]\n         },\n\n         rabbit:\n         {\n             name: \"It's Dyanamite\", element: \"root\", threshold:1,\n             components:[{ target: \"opp\", base:20, move: \"instakill\", desc: \"A killer rabbit that's dynamite was summonned by %s and it attacked %t!\", count: 1},{desc:\"http://www.youtube.com/watch?v=Nvs5pqf-DMA\", count: 0}]\n         },\n\n         sltackle:\n         {\n             name: \"Slimy Tackle\", cost: {sp: 15},\n             components: [{target: \"opp\", base: 35, move: \"physical\", desc: \"%s tackled %t!\", count:1}]\n         },\n\n         slvortex:\n         {\n             name: \"Slimy Vortex\", cost: {mp: 25},\n             components: [{target: \"opp\", base: 95, move: \"physical\", desc: \"%s summoned a slimy vortex which engulfs %t!\", count:1}]\n         },\n\n         slexp:\n         {\n             name: \"Slimy Explosion\", cost: {mp: 87},\n             components: [{target: \"opp\", base: 195, move: \"physical\", desc: \"%s created a slimy explosion which blasted %t!\", count:5}]\n         },\n\n         slcrash:\n         {\n             name: \"Slimy Crash\", cost: {mp: 189},\n             components: [{target: \"opp\", base: 409, move: \"physical\", desc: \"%s used slimy crash which covered %t in slime!\", count:2}]\n         },\n\n         slbreath:\n         {\n             name: \"Slimy Breath\", cost: {mp: 289},\n             components: [{target: \"opp\", base: 802, offense: \"magical\", defense:\"physical\", damage: \"normal\", desc: \"%s breathed slime on %t!\", count:2}]\n         },\n\n         fangs:\n         {\n             name: \"Fangs\", cost: {sp: 8}, threshold: 100,\n             components: [{target: \"opp\", base: 14, move: \"physical\", desc: \"%s bit %t!\", count:1}]\n         },\n\n\n\n\n         // Player skills\n\n         attack:\n         {\n             name: \"Attack\", element: \"physical\", exp: \"res\", next: [\"psyburst\", \"heal\", \"shadows\", \"punch\", \"thundershock\", \"snowb\", \"disspr\", \"darkstrike\" /*, \"thundershock\", \"shadows\", \"toxin\", \"blades\"*/], threshold: 0,\n             desc: \"A basic attack\",\n             components: [{ target: \"opp\", base:5, offense: \"general\", defense: \"general\", desc: \"%s attacked %t!\", count:1 }]\n         },\n\n         disspr:\n         {\n             name: \"Distortion Spirit\", cost: {msp: 1}, threshold: 60*10, next: [\"diswave\"],\n             components: [{target: \"opp\", base: 10, move: \"magical\", desc: \"%s hit %t with a distortion energy!\", count:1}]\n\n         },\n\n         diswave:\n         {\n             name: \"Distortion Wave\", cost: {msp: 2}, threshold: 3600/2, next: [\"disbrk\"],\n             components: [{target: \"opp\", base: 14, move: \"magical\", desc: \"%s blasted %t with a distortion wave!\", count:1}]\n\n         },\n\n         disbrk:\n         {\n             name: \"Distortion Break\", cost: {msp: 4}, threshold: 3600, next: [\"dispulse\"],\n             components: [{target: \"opp\", base: 34, move: \"magical\", desc: \"%s caught %t in a distortion fissure!\", count:1}]\n         },\n\n         dispulse:\n         {\n             name: \"Distortion Pulse\", cost: {msp: 6}, threshold: 3600*2, next: [\"disblast\"],\n             components: [{target: \"opp\", base: 74, move: \"magical\", desc: \"%s blasted %t with a distortion pulse!\", count:1}]\n         },\n\n         disblast:\n         {\n             name: \"Distortion Blast\", cost: {msp: 8}, next: [\"disfield\"], threshold: 3600*3,\n             components: [{target: \"opp\", base: 154, move: \"magical\", desc: \"%s blasted %t with a surge of distortion energy!\", count:1}]\n         },\n\n         disfield:\n         {\n             name: \"Distortion Field\", cost: {msp: 10}, next: [\"diswarp\"], threshold: 3600*6,\n             components: [{target: \"opp\", base: 234, move: \"magical\", desc: \"%s captured %t within a distortion field!\", count:4}]\n         },\n\n         diswarp:\n         {\n             name: \"Distortion Warp\", cost: {msp: 14}, next: [\"disexpl\"], threshold: 3600*8,\n             components: [{target: \"opp\", base: 554, move: \"magical\", desc: \"%s captured %t within a distortion warp!\", count:4}]\n         },\n\n         disexpl:\n         {\n             name: \"Distortion Explosion\", threshold: 3600*14,\n             cost: {msp: 16}, next: [],\n             components: [{target: \"opp\", base: 904, move: \"magical\", desc: \"%s released an explosion of distortion energy! It struk %t!\", count:4}]\n         },\n\n         fireb:\n         {\n             name: \"Fireball\", element: \"fire\", exp: \"mag\", desc: \"The user fires an extra cold snowball at the enemy!\", cost: { mp: 5, sp:5, msp:1 }, threshold: 60*10,\n             components: [{ target: \"opp\", base:15, move: \"ice\", desc: \"%s threw a snow ball at %t!\", count:1 }], next: [\"snowdr\"]\n\n\n         },\n\n         snowb:\n         {\n             name: \"Snowball\", element: \"ice\", exp: \"mag\", desc: \"The user fires an extra cold snowball at the enemy!\", cost: { mp: 5, sp:5, msp:1 }, threshold: 60*10,\n             components: [{ target: \"opp\", base:15, move: \"ice\", desc: \"%s threw a snow ball at %t!\", count:1 }], next: [\"snowdr\"]\n\n\n         },\n\n         snowdr:\n         {\n             name: \"Snow Drift\", element: \"ice\", exp: \"mag\", desc: \"The user brings snow upon thy enemies!\", cost: { mp: 15, msp: 3 }, threshold: 60*15, next: [\"icecl\"],\n             components: [{ target: \"opp\", base:35, move: \"ice\", desc: \"%s attacked %t with lots of snow!\", count:1 }]\n\n         },\n\n         icecl:\n         {\n             name: \"Icicles\", element: \"ice\", exp: \"mag\", desc: \"The user drops icicles upon thy foes!\", threshold: 60*25, cost: {mp: 35, msp: 5 },\n             components: [{ target: \"opp\", base:95, move: \"ice\", desc: \"%s dropped icicles on %t!\", count:1 }], next: [\"iceball\"]\n\n\n         },\n\n         iceball:\n         {\n             name: \"Ice Ball\", element: \"ice\", exp: \"mag\", desc: \"The user throws a ball of ice at thy foes!\", threshold: 60*45, cost: {mp: 80, msp: 5 },\n             components: [{ target: \"opp\", base:140, move: \"ice\", desc: \"%s threw an ice ball at %t!\", count:1 }], next: [\"chwave\"]\n\n\n         },\n\n         chwave:\n         {\n             name: \"Chilly Wave\", element: \"ice\", exp: \"mag\", desc: \"The user attacks their enemies with cold air!\", threshold: 60*60, cost: {mp: 120, msp: 10 },\n             components: [{ target: \"opp\", base:220, move: \"ice\", desc: \"%s sent frigid air at %t!\", count:3 }], next: [\"arcpulse\"]\n\n\n         },\n\n         arcpulse:\n         {\n             name: \"Arctic Pulse\", element: \"ice\", exp: \"mag\", desc: \"The user blasts the enemy with fridgid air!\", threshold: 60*75, cost: {mp: 220, msp: 20 }, next: [\"arcshock\"],\n             components: [{ target: \"opp\", base:550, move: \"ice\", desc: \"%s blasted %t with a blast of fridgid air!\", count:3 }]\n         },\n\n         arcshock:\n         {\n             name: \"Arctic Shock\", element: \"ice\", exp: \"mag\", desc: \"The user blasts the enemy with a shockwave of fridgid air!\", threshold: 3600*3, cost: {mp: 220, msp: 20 }, next: [\"arcfreeze\"],\n             components: [{ target: \"opp\", base:1100, move: \"ice\", desc: \"%s blasted %t with a shockwave of fridgid air!\", count:3 }]\n         },\n\n         arcfreeze:\n         {\n             name: \"Arctic Freeze\", element: \"ice\", exp: \"mag\", desc: \"The user blasts the enemy with frozen air!\", threshold: 3600*9, cost: {mp: 400, msp: 40 },\n             components: [{ target: \"opp\", base:1880, move: \"ice\", desc: \"%s blasted %t with a shockwave of frozen air!\", count:3 }]\n         },\n\n         blz:\n         {\n             name: \"Blizzard\", element: \"ice\", exp: \"mag\", desc: \"The user blasts the enemy with hail, snow, and rain!\", threshold: 3600*24, cost: {mp: 820, msp: 30 },\n             components: [{ target: \"opp\", base:2880, move: \"ice\", desc: \"%s summoned a terrible blizzard that chilled %t!\", count:5 }]\n         },\n\n         thundershock:\n         {\n\n             name: \"Thundershock\", cost: {mp:15, msp:5}, exp: \"mag\", next: [\"thunderbolt\"], threshold: 60*10, attr: {air:true},\n             desc: \"User zaps enemy!\",\n             components: [{ target: \"opp\", base:36, offense: \"magical\", defense: \"electric\", desc: \"%s zapped %t!\", count:1 }]\n         },\n\n         thunderbolt:\n         {\n\n             name: \"Thunderbolt\", cost: {mp:35, msp:10}, exp: \"mag\", next: [\"voltblast\"], threshold: 60*15, attr: {air:true},\n             desc: \"User calls upon lighting.\",\n             components: [{ target: \"opp\", base:86, offense: \"magical\", defense: \"electric\", desc: \"%s zapped %t!\", count:1 }]\n         },\n\n\n         voltblast:\n         {\n\n             name: \"Volt Blast\", cost: {mp:89, msp:15}, exp: \"mag\", next: [\"thunderstorm\"], threshold: 60*35,\n             desc: \"User creates an electric discharge by imbalancing the polarity of the ground and air.\",\n             components: [{ target: \"opp\", base:210, offense: \"magical\", defense: \"electric\", desc: \"%s shocked %t with a strong electric discharge!\", count:1 }]\n         },\n\n\n\n         thunderstorm:\n         {\n\n             name: \"Thunderstorm\", cost: {mp:190, msp:20}, exp: \"mag\", next: [\"plasmabomb\"], threshold: 3600, attr: {air: true},\n             desc: \"Fires a large number of lightning bolts down on foes.\",\n             components: [{ target: \"opp\", base: 320, offense: \"magical\", defense: \"electric\", desc: \"%s called down a thunderstorm on %t!\", count:3 }]\n         },\n\n         plasmabomb:\n         {\n             name: \"Plasma Bomb\", cost: {mp:350, msp:30}, exp: \"mag\", next: ['plasmavtr'], threshold: 3600,  attr: {air: true},\n             desc: \"Fires a ball of plasma at an enemy.\",\n             components: [{ target: \"opp\", base:640, offense: \"magical\", defense: \"electric\", desc: \"%s shot hot plasma at %t!\", count:1 }]\n         },\n\n         plasmavtr:\n         {\n             name: \"Plasma Vortex\", cost: {mp:550, msp:50}, exp: \"mag\", threshold: 3600*3,  attr: {air: true}, next: [\"plasmastorm\"],\n             desc: \"A vortex of plasma.\",\n             components: [{ target: \"opp\", base:1120, offense: \"magical\", defense: \"electric\", desc: \"%s trapped %t in a vortex of plasma!\", count:1 }]\n         },\n\n         plasmastorm:\n         {\n             name: \"Plasma Storm\", cost: {mp:950, msp:90}, exp: \"mag\",  threshold: 3600*9,  attr: {air: true},\n             desc: \"A storm of plasma.\",\n             components: [{ target: \"opp\", base:2120, offense: \"magical\", defense: \"electric\", desc: \"%s summoned a plasma storm that zapped and burned %t!\", count:1 }]\n         },\n/*\n         bomb:\n         {\n             name: \"Bomb\", cost: { mp: 15, sp: 5 }, exp: \"mag\",\n         },\n  */\n\n         bombs:\n         {\n             name: \"Bombs\", cost: {sp:15, mp:15},\n             components: [{ target: \"opp\", base: 136, offense: \"magical\", defense: \"fire\", desc: \"%s dropped bombs on %t!\", count:1 }]\n         },\n\n\n         punch:\n         {\n             name: \"Punch\", cost: {sp:5, msp:1}, exp: \"str\", next: [\"kick\", \"superpunch\"], threshold: 60*5,\n             desc: \"The user punches their enemy.\",\n             components: [{ target: \"opp\", base:15, move: \"physical\", desc: \"%s punched %t!\", count:1 }]\n\n         },\n\n         superpunch:\n         {\n             name: \"Super Punch\", cost: {sp:15, msp:5}, exp: \"str\", next: [\"megapunch\"], threshold: 60*10,\n             desc: \"The user punches their enemy with greater force.\",\n             components: [{ target: \"opp\", base:36, move: \"physical\", desc: \"%s punched %t!\", count:1 }]\n\n         },\n\n\n         megapunch:\n         {\n             name: \"Mega Punch\", cost: {sp:32, msp:12}, exp: \"str\", next: [\"sonichand\", \"ghostpunch\"], threshold: 60*15,\n\n             desc: \"The user punches their enemy with even greater force.\",\n             components: [{ target: \"opp\", base:56, move: \"physical\", desc: \"%s punched %t with a powerful punch!\", count:1 }]\n\n         },\n\n         sonichand:\n         {\n             name: \"Sonic Hand\", cost: {sp: 65, msp: 12}, exp: \"str\", next: [\"blitzhand\"], threshold: 60*20,\n             desc: \"The user punches their enemy with great speed and power.\",\n             components: [{ target: \"opp\", base:107, move: \"physical\", desc: \"%s punched %t with a powerful punch at blinding speed!\", count:1 }]\n         },\n\n         blitzhand:\n         {\n             name: \"Bliltz Hand\", cost: {sp: 160, msp: 12}, exp: \"str\", next: [\"shatterbreak\"], threshold: 60*35,\n             desc: \"The user punches their enemy with incredible great speed and power.\",\n             components: [{ target: \"opp\", base:340, move: \"physical\", desc: \"%s punched %t with a powerful punch at blinding speed!\", count:1 }]\n         },\n\n         shatterbreak:\n         {\n             name: \"Shatterbreak\", cost: {sp: 254, msp: 22}, exp: \"str\", next: [\"forcepunch\"], threshold: 60*35,\n             desc: \"A secret move which shatters bones and smashes rocks.\",\n             components: [{ target: \"opp\", base:512, move: \"physical\", desc: \"%s used shatterbreak against %t!\", count:1 }]\n         },\n\n         forcepunch:\n         {\n             name: \"Force Punch\", cost: {sp: 304, msp: 22}, exp: \"str\", next: [\"blastpunch\"], threshold: 3600,\n             desc: \"A punch like no other.\",\n             components: [{ target: \"opp\", base:812, move: \"physical\", desc: \"%s used shatterbreak against %t!\", count:1 }]\n         },\n\n         blastpunch:\n         {\n             name: \"Blast Punch\", cost: {sp: 404, mp: 30, msp: 22}, exp: \"str\", next: [\"exppunch\"], threshold: 3600*2,\n             desc: \"When regular punches aren't enough.\",\n             components: [{ target: \"opp\", base:1304, offense: \"physical\", defense: \"fire\", desc: \"%s punched %t causing a small explosion!\", count:1 }]\n         },\n\n         icepunch:\n         {\n             name: \"Ice Punch\", cost: {sp: 404, mp: 30, msp: 22}, exp: \"str\", next: [], threshold: 3600*2,\n             desc: \"When regular punches aren't enough.\",\n             components: [{ target: \"opp\", base:1304, offense: \"physical\", defense: \"ice\", damage: \"ice\", desc: \"%s punched %t causing a small explosion!\", count:1 }]\n         },\n\n         vltpunch:\n         {\n             name: \"Volt Punch\", cost: {sp: 404, mp: 30, msp: 22}, exp: \"str\", next: [], threshold: 3600*2,\n             desc: \"When regular punches aren't enough.\",\n             components: [{ target: \"opp\", base:1304, offense: \"physical\", defense: \"electric\", damage: \"normal\", desc: \"%s punched %t causing a small explosion!\", count:1 }]\n         },\n\n         exppunch:\n         {\n             name: \"Explosion Punch\", cost: {sp: 704, mp: 100, msp: 30}, exp: \"str\", next: [\"oblpunch\"], threshold: 3600*3,\n             desc: \"When blast punches aren't enough.\",\n             components: [{ target: \"opp\", base:2024, move: \"physical\", desc: \"%s punched %t causing an explosion!\", count:1 }]\n         },\n\n\n         oblpunch:\n         {\n             name: \"Obliteratory Punch\", cost: {sp: 1204, mp: 200, msp: 30}, exp: \"str\", next: [], threshold: 3600*5,\n             desc: \"When you have a power complex.\",\n             components: [{ target: \"opp\", base:2789, move: \"physical\", desc: \"%s punched %t causing a large explosion!\", count:1 }]\n         },\n\n         ghostpunch:\n         {\n             name: \"Ghostly Punch\", cost: {sp: 65, msp: 12}, exp: \"str\", next: [], threshold: 60*20,\n             desc: \"The user punches their enemy with shadows.\",\n             components: [{ target: \"opp\", base:107, offense: \"physical\", defense: \"ghost\", damage:\"ghost\", desc: \"%s punched %t with a ghostly punch!\", count:1 }]\n         },\n\n         kick:\n         {\n             name: \"Kick\", cost: {sp:8, msp:2}, exp: \"str\", next: [\"superkick\"], threshold: 60*5,\n\n             desc: \"The user kicks their enemy.\",\n             components: [{ target: \"opp\", base:20, move: \"physical\", desc: \"%s kicked %t!\", count:1 }]\n\n         },\n\n         superkick:\n         {\n             name: \"Super Kick\", cost: {sp:16, msp:2}, exp: \"str\", next: [\"sweep\"], threshold: 60*5,\n\n             desc: \"The user kicks their enemy.\",\n             components: [{ target: \"opp\", base:35, move: \"physical\", desc: \"%s kicked %t!\", count:1 }]\n\n         },\n\n         sweep:\n         {\n             name: \"Sweeping Kick\", cost: {sp:16, msp:2}, exp: \"str\", next: [\"grndsweep\"], threshold: 60*5,\n\n             desc: \"The user kicks their enemies with a spinning flourish.\",\n             components: [{ target: \"opp\", base:35, move: \"physical\", desc: \"%s kicked %t!\", count:2 }]\n\n         },\n\n         grndsweep:\n         {\n             name: \"Groundsweeper\", cost: {sp:25, msp:4}, exp: \"str\", next: [\"grndbrk\"], threshold: 60*5,\n\n             desc: \"The user kicks their enemies with a spinning flourish.\",\n             components: [{ target: \"opp\", base:45, move: \"physical\", desc: \"%s hit %t in a fast combo flurry of kicks!\", count: 4 }]\n         },\n\n         grndbrk:\n         {\n             name: \"Groundbreak\", cost: {sp:45, msp:5}, exp: \"str\", next: [], threshold: 60*5,\n\n             desc: \"The user uses a strong kick, tearing up even the ground.\",\n             components: [{ target: \"opp\", base:75, move: \"physical\", desc: \"%s hit %t in a heavy sweep kick!\", count: 2 }]\n         },\n\n         heal:\n         {\n             name: \"Healing Spell\", cost: {mp:10, msp: 5}, exp: \"mag\", next: [\"healbubble\", \"healpulse\", \"lightburst\"], threshold: 60*5,\n             desc: \"Heals an ally.\",\n             components: [{ target: \"ally\", base: 17, move: \"heal\", desc: \"%s healed %t!\", count: 1}]\n         },\n\n         lightburst:\n         {\n             name: \"LightBurst\", cost: {mp: 20, sp: 5, msp: 5}, exp: \"mag\", threshold: 60*10, next: [\"lightblast\"],\n             desc: \"Releases a light which burns an enemy.\",\n             components: [{ target: \"opp\", base: 45, move: \"light\", desc: \"%s released a luminous light which burns %t!\", count:1 }]\n         },\n\n         lightblast:\n         {\n             name: \"Light Blast\", cost: {mp: 35, sp: 5, msp: 15}, exp: \"mag\", threshold: 60*15, next: [\"sunburst\", \"blitzfield\"],\n             desc: \"Releases a strong blast of light which burns an enemy.\",\n             components: [{ target: \"opp\", base: 75, move: \"light\", desc: \"%s released a blast of billiant light at %t!\", count:1 }]\n         },\n\n         sunburst:\n         {\n             name: \"Sunburst\", cost: {mp: 89, sp: 5, msp: 35}, exp: \"mag\", threshold: 60*20, next: [\"lux\"],\n             desc: \"Fires a ball of condensed light energy which burns an enemy.\",\n             components: [{ target: \"opp\", base: 172, move: \"light\", desc: \"%s shot a ball of white hot light at %t!\", count:1 }]\n         },\n\n         lux:\n         {\n             name: \"Luxecaedere\", cost: {mp: 160, sp: 35, msp: 68}, exp: \"mag\", threshold: 3600*0.8, next: [\"luxi\"],\n             desc: \"Summons powerful light energy which burns an enemy.\",\n             components: [{ target: \"opp\", base: 320, move: \"light\", desc: \"%s summoned a blazing hot light which burns %t!\", count:1 }]\n         },\n\n         luxi:\n         {\n             name: \"Luxiudicium\", cost: {mp: 305, sp: 45, msp: 230}, exp: \"mag\", threshold: 3600*2, next: [\"judgement\"],\n             desc: \"Summons powerful light energy which wraps around and burns an enemy.\",\n             components: [{ target: \"opp\", base: 780, move: \"light\", desc: \"%s summoned a blazing hot light which purges %t!\", count:1 }]\n         },\n\n         judgement:\n         {\n             name: \"Judgement\", cost: {mp: 705, sp: 170, msp: 330}, exp: \"mag\", threshold: 3600*5, next: [\"decree\"],\n             desc: \"Summons powerful light energy from the sky which which burns an enemy.\",\n             components: [{ target: \"opp\", base: 1430, move: \"light\", desc: \"%s calls a blazing judgement upon %t!\", count:1 }]\n         },\n\n         decree:\n         {\n             name: \"King's Decree\", cost: {mp: 1305, sp: 170, msp: 330}, exp: \"mag\", threshold: 3600*9, next: [\"law\"],\n             desc: \"A decree issued with power from the heavens.\",\n             components: [{ target: \"opp\", base: 2430, move: \"light\", desc: \"%s casts a powerfull decree. The spell brings down holy fire upon %t!\", count:1 }]\n         },\n\n         law:\n         {\n             name: \"Spirit's Law\", cost: {mp: 2305, sp: 470, msp: 730}, exp: \"mag\", threshold: 3600*24,\n             desc: \"A powerful magical attack that draws upon light energy to attack.\",\n             components: [{ target: \"opp\", base: 4690, move: \"light\", desc: \"%s casts a spell which causes fire from all sides to burn %t!\", count:1 }]\n         },\n\n\n\n\n\n         blitzfield:\n         {\n             name: \"Blitzfield\", cost: {mp: 89, sp: 5, msp: 35}, exp: \"mag\", threshold: 60*20, next: [\"hseal\"],\n             desc: \"Brings forth a power from the world which purges from the ground to all enemies.\",\n             components: [{ target: \"opp\", base: 65, move: \"light\", desc: \"%s casts a spell which engulfs the field in light, burning their enemies! %t\", count:5 }]\n         },\n\n         hseal:\n         {\n             name: \"Holy Seal\", cost: {mp: 148, sp: 20, msp: 85}, exp: \"mag\", threshold: 60*35, next: [\"ager\"],\n             desc: \"Traps enemies in a magical spell which injures all enemies within it.\",\n             components: [{ target: \"opp\", base: 113, move: \"light\", desc: \"%s casts a spell seal around the battlefield which damages %t within it!\", count:5 }]\n         },\n\n         ager:\n         {\n             name: \"Agerexussum\", cost: {mp: 328, sp: 30, msp: 125}, exp: \"mag\", threshold: 3600, next: [\"halfld\"],\n             desc: \"Traps enemies in a magical spell which purges and burns all enemies within it.\",\n             components: [{ target: \"opp\", base: 210, move: \"light\", desc: \"%s casts a spell seal around the battlefield which purges %t!\", count:5 }]\n         },\n\n         halfld:\n         {\n             name: \"Hallowed Field\", next: [\"purgatory\"],\n             desc: \"Calls upon a mysterious power to slay the casters enemies.\",\n             cost: {mp: 428, sp: 60, msp: 225}, exp: \"mag\", threshold: 3600*3,\n             components: [{ target: \"opp\", base: 410, move: \"light\", desc: \"%s invokes a mysterious power which causes a hallowed aura to descent upon %t!\", count:7 }]\n         },\n\n         purgatory:\n         {\n             name: \"Purgatory\", cost: {mp:628, sp: 30, msp: 235}, exp: \"mag\", threshold: 3600*5,\n             desc: \"Calls upon a greater holy power to slay the casters enemies.\",\n             components: [{ target: \"opp\", base: 810, move: \"light\", desc: \"%s invokes purgatory! %t was crushed by the holy aura!\", count:7 }]\n         },\n\n         revel:\n         {\n             name: \"Holy Revelation\", cost: {mp:1400, sp: 70, msp: 325}, exp: \"mag\", threshold: 3600*9,\n             desc: \"The casters enemies are harmed by holy revelations.\",\n             components: [{ target: \"opp\", base: 810, move: \"light\", desc: \"%s invokes purgatory! %t was crushed by the holy aura!\", count:7 }]\n         },\n\n         holylight:\n         {\n             name: \"Holy Light\", cost: {mp:2400, sp: 110, msp: 425}, exp: \"mag\", threshold: 3600*32,\n             desc: \"The caster brings down a divine and holy light upon their enemies.\",\n             components: [{ target: \"opp\", base: 3310, move: \"light\", desc: \"%s calls forth a powerful spell that brings rays of light down from the sky! %t was pierced by the light rays!\", count:10 }]\n         },\n\n\n         healbubble:\n         {\n\n             name: \"Healing Bubble\", cost: {mp:15, msp: 5}, exp: \"mag\", next: [\"healwave\"], threshold: 60*10,\n\n             desc: \"Creates a bubble of magical energy that heals all allies within it.\",\n             components: [{ target: \"ally\", base: 25, move: \"heal\", desc: \"%t was in %s's healing bubble.\", count: 3}]\n\n         },\n\n         healwave:\n         {\n             name: \"Healing Wave\", cost: {mp:30, msp: 25}, next: [\"healrain\"], threshold: 60*15,\n             desc: \"Creates a wave of magical energy that heals all allies who touch it.\",\n             components: [{ target: \"ally\", base: 50, move: \"heal\", desc: \"%t was caught in %s's healing wave.\", count: 3}]\n         },\n\n         healrain:\n         {\n\n             name: \"Healing Rain\", cost: {mp:67, msp: 45}, exp: \"mag\", next: [\"elixarai\"], threshold: 60*25,\n             desc: \"Creates a shower of magical energy that heals all allies who touch it.\",\n             components: [{ target: \"ally\", base: 120, move: \"heal\", desc: \"%t bathed in the healing rain\", count: 9}]\n\n         },\n\n         elixarai:\n         {\n\n             name: \"Elixarai\", cost: {mp:140, msp: 110}, exp: \"mag\", next: [\"holyguard\"], threshold: 60*30,\n             desc: \"The field is engulfed in a blinding light which heals all allies within it.\",\n             components: [{ target: \"ally\", base: 240, move: \"heal\", desc: \"%t was healing by the blinding light!\", count: 10}]\n\n         },\n\n         holyguard:\n         {\n\n             name: \"HolyGuard\", cost: {mp:240, msp: 180}, exp: \"mag\", next: [], threshold: 60*45,\n             desc: \"The field is engulfed in a powerfull energy which heals all allies within it.\",\n             components: [{ target: \"ally\", base: 440, move: \"heal\", desc: \"%t was healing by the descending energy!\", count: 10}]\n\n         },\n\n\n         healpulse:\n         {\n\n             name: \"Healing Pulse\", cost: {mp:25, msp: 10},  exp: \"mag\", next: [\"healingenergy\"], threshold: 60*10,\n             desc: \"Creates a pulse of magical energy with stronger healing abilities.\",\n             components: [{ target: \"ally\", base: 50, move: \"heal\", desc: \"%s used healing pulse on %t!\", count: 1}]\n\n         },\n\n         healingenergy:\n         {\n\n             name: \"Healing Energy\", cost: {mp:45, msp: 25}, exp: \"mag\", next: [\"healinghope\"], threshold: 60*30,\n             desc: \"A healing energy that restores health.\",\n             components: [{ target: \"ally\", base: 95, move: \"heal\", desc: \"%s used healing energy on %t!\", count: 1}]\n\n         },\n\n         healinghope:\n         {\n\n             name: \"Healing Hope\", cost: {mp:75, msp: 60}, exp: \"mag\", next: [\"angelwing\", \"invigoration\"], threshold: 60*45,\n             desc: \"A wish of healing creates miracles in even the most dire circumstances.\",\n             components: [{ target: \"ally\", base: 180, move: \"heal\", desc: \"%s used healing hope on %t!\", count: 1}]\n\n         },\n\n         angelwing:\n         {\n\n             name: \"Angel's Wing\", cost: {mp:140, msp: 110}, exp: \"mag\", next: [\"angelpromise\"], threshold: 3600,\n             desc: \"Calls upon a greater power to assist in healing where people fail.\",\n             components: [{ target: \"ally\", base: 340, move: \"heal\", desc: \"A holy energy healed %t!\", count: 1}]\n\n         },\n\n         angelpromise:\n         {\n\n             name: \"Angel's Promise\", cost: {mp:250, msp: 230}, exp: \"mag\", next: [], threshold: 3600*1.5,\n             desc: \"Calls upon a greater power to assist in healing where people fail.\",\n             components: [{ target: \"ally\", base: 670, move: \"heal\", desc: \"A holy energy healed %t!\", count: 1}]\n\n         },\n\n         altruist:\n         {\n             name: \"Altruist's Sacrafice\", exp: \"res\", cost: { mp: 100, msp: 30 }, threshold: 3600*2,\n             components: [/*{target: \"ally\", base: 850, move: \"transfer\"}*/]\n         },\n\n         invigoration:\n         {\n             name: \"Invigoration\", exp: \"mag\", cost: {mp: 200, msp: 130}, threshold: 3600*2,\n             components: [{target: \"self\", base: 500, move: \"heal\"}]\n         },\n\n         psyburst:\n         {\n             name: \"Psycho Burst\", exp: \"psy\", desc: \"The user concentrates psychic energy and uses it to attack.\", cost: { msp: 8 }, threshold: 60*5,next: [\"psyshock\"],\n             components: [{ target: \"opp\", base: 25, move: \"psychic\", desc: \"%s unleashed a burst of psychic energy against %t!\", count: 1}]\n         },\n\n         psyshock:\n         {\n             name: \"Psycho Shock\", exp: \"psy\", desc: \"The user concentrates psychic energy and unleashes it in a shockwave.\", cost: { msp: 20 }, threshold: 60*15, next: [\"psyslice\", 'hyperfocus'],\n             components: [{ target: \"opp\", base: 55, move: \"psychic\", desc: \"%s unleashed a shockwave of psychic energy towards %t!\", count: 1}]\n         },\n\n         hyperfocus:\n         {\n             name: 'Hyperfocus', exp: 'men', desc: 'The user improves their focus to regain mental stamina', cost: {sp: 30}, threshold: 60*20,\n             components: [{ target: \"self\", base: 54, move: \"boostmsp\", desc: \"%s gained a state of higher focus!\", count: 1}]\n         },\n\n         psyslice:\n         {\n             name: \"Psycho Slice\", exp: \"psy\", desc: \"The user concentrates psychic energy into a wedge and unleashes it.\", cost: { msp: 40 }, threshold: 60*35, next: [\"psyblast\", \"blackout\"],\n             components: [{ target: \"opp\", base: 145, move: \"psychic\", desc: \"%s unleashed a blade of psychic energy towards %t!\", count: 1}]\n         },\n\n         psyblast:\n         {\n             name: \"Psycho Blast\", exp: \"psy\", desc: \"The user unleashes a blast of psychic energy\", cost: { msp: 80 }, threshold: 60*45, next: [\"neur\"],\n             components: [{ target: \"opp\", base: 320, move: \"psychic\", desc: \"%s blasted %t with psychic energy!\", count: 1}]\n         },\n\n         neur:\n         {\n             name: \"Neurotic Energy\", exp: \"psy\", desc: \"The user unleashes a neurotic wave of psychic energy.\", cost: { msp: 270 }, threshold: 3600,\n             components: [{ target: \"opp\", base: 790, move: \"psychic\", desc: \"%s attacked %t with neurotic psychic energy!\", count: 1}], next: [\"psyc\"]\n         },\n\n         psyc:\n         {\n             name: \"Psychotic Energy\", exp: \"psy\", desc: \"The user unleashes a psychotic wave of psychic energy.\", cost: { msp: 680 }, threshold: 3600*3,\n             components: [{ target: \"opp\", base: 1500, move: \"psychic\", desc: \"%s attacked %t with psychotic psychic energy!\", count: 1}], next: [\"polar\"]\n         },\n\n         polar:\n         {\n             name: \"Polar Strike\", exp: \"psy\", desc: \"The user distorts the targets mind by influencing them towards manic-depressive thoughts.\", cost: { msp: 1680 }, threshold: 3600*24,\n             components: [{ target: \"opp\", base: 3200, move: \"psychic\", desc: \"%s attacked %t with polar psychic energy!\", count: 1}], next: [\"schis\"]\n         },\n\n         schis:\n         {\n             name: \"Psychic Schism\", exp: \"psy\", desc: \"The user distorts the targets mind by influencing them towards a split personality.\", cost: { msp: 3580 }, threshold: 3600*230,\n             components: [{ target: \"opp\", base: 5100, move: \"psychic\", desc: \"%s brought down psychic energy on %t which causes a terrible headache!\", count: 1}]\n         },\n\n\n         blackout:\n         {\n             name: \"Blackout\", desc: \"The user unleashes a large of psychic energy which hits multiple enemies.\", cost: { msp: 95 }, exp:\"psy\", next: [\"blackmind\"], threshold: 3600*45,\n             components: [{ desc: \"%s unleashed a storm of psychic energy!\" },\n                          { target: \"opp\", base: 285, move: \"psychic\", desc: \"%t was caught in the flux!\", count: 3}]\n         },\n\n         blackmind:\n         {\n             name: \"Black Mind\", desc: \"The user unleashes a terrible flux of psychic energy.\", cost: { msp: 198 }, threshold: 3600*78, next: [\"hyster\"],\n             components: [{ desc: \"%s unleashed a terrible flux of psychic energy!\" },\n                          { target: \"opp\", base: 380, move: \"psychic\", desc: \"%t was caught in the flux!\", count: 5}]\n         },\n\n         panic:\n         {\n\n         },\n\n         hyster:\n         {\n             name: \"Hysteria\", desc: \"The user unleashes a hysteric flux of psychic energy.\", cost: { msp: 198 }, threshold: 3600*3,\n             components: [{ target: \"opp\", base: 670, move: \"psychic\", desc: \"%s unleashed a terrible flux of psychic energy! %t was caught in the flux!\", count: 5}]\n         },\n\n         shadows:\n         {\n             name: \"Shadows\", exp: \"mag\",  desc: \"A terrible shadow attacks the enemy!\", cost: {mp: 10, msp:5}, threshold: 60*7, next:[\"blackfog\"],\n             components: [{ target: \"opp\", base: 25, move: \"ghost\", desc: \"%t was caught by shadows controlled by %s!\", count: 1}]\n         },\n\n\n\n         blackfog:\n         {\n             name: \"Black Fog\", exp: \"mag\", desc: \"A black fog engulfs the enemy!\", cost: {mp: 15, msp:10}, threshold: 60*10, next: [\"blood\", \"hellrain\"],\n             components: [{ target: \"opp\", base: 35, move: \"ghost\", desc: \"%t suffocated in black fog!\", count: 1}]\n         },\n\n         blood:\n         {\n             name: \"Devil's Blood\", exp: \"mag\", desc: \"The user sacrafices their own blood to lay a curse on the enemy\", cost: { hp: 55, mp: 10, msp: 10 }, threshold: 60*15, next: [\"sarachith\"],\n             components: [{ target: \"opp\", base: 110, move: \"ghost\", desc: \"%s drew blood unto the ground and it curses %t!\", count: 1}]\n\n         },\n\n         sarachith:\n         {\n             name: \"Sarachith\", exp: \"res\", desc: \"The user users a contract of demons to injure their opponent.\", cost: { hp: 85, mp: 10, msp: 10 }, threshold: 60*25, next: [\"ghostbody\"],\n             components: [{ target: \"opp\", base: 225, move: \"ghost\", desc: \"%s exchanged a contract with demons and it curses %t!\", count: 1}]\n         },\n\n         ghostbody:\n         {\n             name: \"Ghost Body\", exp: \"mag\", desc: \"The user empowers ghostly energy.\", cost: {mp: 300, msp: 200}, threshold: 60*45,\n             components: [{ target: \"self\", base: 10, move: \"ghostify\", desc: \"%s was wrapped in shadows!\", count:1}]\n         },\n\n         hellrain:\n         {\n             name: \"Hell's Rain\", exp: \"mag\", desc: \"A terrible downpour of pure darkness enroaches the battlefield!\", cost: {mp:20, msp:5}, threshold: 60*20, next: [\"hellstorm\"],\n             components: [{ target: \"opp\", base: 65, move: \"ghost\", desc: \"%t was caught in the dark rain!\", count: 5},{ target: \"ally\", base: 25, move: \"ghost\", desc: \"%t was caught in the dark rain!\", count: 2}]\n\n         },\n\n         darkstrike:\n         {\n             name: \"Dark Strike\", exp: \"mag\", desc: \"An evil strike\", cost: { mp: 10, sp:5, msp:2}, next:  [\"darkbash\"],  threshold: 60*10,\n             components: [{ target: \"opp\", base: 25, move: \"dark\", defense: \"physical\", desc: \"%s uses dark energy to strike %t!\", count: 1}]\n         },\n\n         darkbash:\n         {\n             name: \"Dark Bash\", exp: \"mag\", desc: \"Bases the opponent with dark energy.\", cost: { mp: 30, sp: 10, msp:2}, next:  [\"darkpulse\"],  threshold: 60*10,\n             components: [{ target: \"opp\", base: 70, move: \"dark\", defense: \"physical\", desc: \"%s bashed %t with dark energy!\", count: 1}]\n         },\n\n         darkpulse:\n         {\n             name: \"Dark Pulse\", exp: \"mag\", desc: \"A pulse of evil energy injures a foe.\", cost: { mp: 35, msp:15}, next:  [\"darkblitz\"], threshold: 60*35,\n             components: [{ target: \"opp\", base: 120, move: \"dark\", desc: \"%t was blasted by %s's evil energy!\", count: 1}]\n         },\n\n         darkblitz:\n         {\n             name: \"Dark Blitz\", exp: \"mag\", desc: \"Weapons made from shadows injure your enemy.\", cost: { mp: 135, msp:15}, next:  [\"darkstorm\"],  threshold: 60*45,\n             components: [{ target: \"opp\", base: 270, move: \"dark\", defense: \"physical\", desc: \"Dark weapons called by %s fall from the sky and fall upon %t!\", count: 1}]\n         },\n\n         darkstorm:\n         {\n             name: \"Dark Storm\", exp: \"mag\", desc: \"Darkness falls from the sky.\", cost: { mp: 335, msp:30}, next:  [],  threshold: 3600,\n             components: [{ target: \"opp\", base: 680, move: \"dark\", desc: \"Dark energy falls from the sky and injures %t!\", count: 1}]\n         },\n\n\n         hellstorm:\n         {\n             name: \"Hellstorm\", exp: \"mag\", desc: \"A wretched downpour of pure darkness enroaches the battlefield!\", cost: {mp:40, msp:15}, threshold: 60*20, next: [\"helltwister\"],\n             components: [{ target: \"opp\", base: 135, move: \"ghost\", desc: \"%t was caught in the dark storm!\", count: 5},{ target: \"ally\", base: 25, move: \"ghost\", desc: \"%t was caught in the dark storm!\", count: 2}]\n\n\n         },\n\n         helltwister:\n         {\n             name: \"Hell's Twister\", exp: \"mag\", desc: \"A swirling vortex of shadows attacks the enemy!\", cost: {mp:90, msp:20}, threshold: 60*30, next: [\"scourge\"],\n             components: [{ target: \"opp\", base: 235, move: \"ghost\", desc: \"%t was caught in the dark twister!\", count: 3}]\n\n\n         },\n\n         scourge:\n         {\n             name: \"Hell's Scourge\", exp: \"mag\", desc: \"A descent of horrible energy devastates the battlefield!\", cost: {mp:120, msp:30}, threshold: 60*45, next: [\"vehemence\"],\n             components: [{ target: \"opp\", base: 315, move: \"ghost\", desc: \"%s summoned an evil energy which descended upon the battlefield and injured %t!\", count: 5}]\n\n         },\n\n         vehemence:\n         {\n             name: \"Hell's Vehemence\", exp: \"mag\", desc: \"An evil energy descends upon an enemy.\", cost: {mp: 220, msp: 60}, threshold: 3600*1.5, next: [\"ardor\"],\n             components: [{ target: \"opp\", base: 650, move: \"ghost\", desc: \"An evil energy descended upon %t!\", count: 1}]\n         },\n\n         ardor:\n         {\n             name: \"Ghost's Ardor\", exp: \"mag\", desc: \"An ghastly spirit descends upon an enemy.\", cost: {mp: 420, msp: 60}, threshold: 3600*3, next: [\"pillars\"],\n             components: [{ target: \"opp\", base: 1050, move: \"ghost\", desc: \"A ghastly spirit descended upon %t!\", count: 1}]\n\n         },\n\n         pillars:\n         {\n             name: \"7 Ghostly Pillars\", exp: \"mag\", desc: \"Pillars of the underworld are brought forth to attack.\", cost: {mp: 870, msp: 60}, threshold: 3600*6,\n             components: [{ target: \"opp\", base: 2150, move: \"ghost\", desc: \"%s summoned 7 ghostly pillars which surrounded the enemy! The space inside became cursed and injures %t!\", count: 1}]\n\n         }\n\n\n         /*\n         ardor:\n         {\n             name: 'Tricksters Ardour', exp: \"mag\", desc: \"A\n         }*/\n\n         //vhemenence:\n\n\n\n\n\n\n\n\n     }\n });\n",
 "js_modules/rules.js": "({ // starts module\n    require: [\"commands\", \"com\", \"io\"],\n    loadModule: // rules.loadModule\n    function ()\n    {\n        this.commands.registerCommand(\"rules\", this);\n\n        this.io.registerConfig(this, { rules: [\"No trolling.\", \"No flaming.\", \"No spamming.\"], sendRulesOnLogin: 0 });\n\n        this.script.registerHandler(\"afterLogIn\", this);\n    },\n\n\n    rules:\n    {\n        category: \"basic\",\n        desc: \"Shows the server's rules.\",\n        perm: function ()\n        {\n            return true; // all users should be able to use /rules so don't check anything\n        },\n\n        code: function (src, cmd, chan) // code that runs /rules\n        {\n             var x; // declare variable x\n\n             for (x in this.config.rules)\n             {\n                 this.com.message(src, \"Rule #\" + x + \": \" + this.config.rules[x]);\n             }\n        }\n\n    },\n\n    afterLogIn: function (src)\n    {\n        if (this.config.sendRulesOnLogin == 1)\n        {\n            this.com.message(src, \"Please type /rules to read the rules!\");\n        }\n\n        if (this.config.sendRulesOnLogin == 2)\n        {\n            var x; // declare variable x\n\n            for (x in this.config.rules)\n            {\n                this.com.message(src, \"Rule #\" + x + \": \" + this.config.rules[x]);\n            }\n        }\n    }\n});\n",
 "js_modules/sched.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n\n     timers: null,\n     timerDB: null,\n     needsSorting: false,\n     i: 0,\n     \n     \n     setTimer: function (module, time, callback)\n     {\n         this.i++;\n         \n         this.timerDB[i] = []; \n     },\n     \n\n     at: function (time, callback)\n     {\n         this.timers.push({time: time, callback: callback, id: this.i++});\n         this.needsSorting = true;\n     },\n\n     \n     step: function (callback)\n     {\n         if (this.needsSorting)\n         {   \n             this.timers.sort( function (a, b) { return a.time - b.time } );\n             this.needsSorting = false;\n         }\n\n         var now = +new Date;\n         \n         for (var i = 0; i < this.timers.length; i++)\n         {\n             if (this.timers[i].time <= now)\n             {\n                 this.timers[i].callback();\n             }\n             else\n             {\n                 break;\n             }\n         }\n         \n         this.timers.splice(0, i);\n     },\n\n\n     loadModule: function ()\n     {\n         this.timers = [];\n         this.script.registerHandler(\"step\", this);\n     }\n\n });\n",
 "js_modules/schema.js": "({\n     defsToSchema: function (defs)\n     {\n         var schema = new Object;\n\n         \n     }\n });\n",
 "js_modules/security.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"sched\", \"io\", \"com\", \"user\", \"theme\", \"util\", \"text\"],\n\n     database: null,\n\n     loadModule: function ()\n     {\n         this.database = this.io.registerDB(this, \"security.2\");\n\n         this.script.registerHandler(\"beforeLogIn\", this);\n         this.script.registerHandler(\"afterChangeTeam\", this);\n\n         this.database.bans = this.database.bans || new Object;\n         this.database.mutes = this.database.mutes || new Object;\n\n         this.database.muteCtr = this.database.muteCtr || 0;\n\n         this.database.banCtr = this.database.banCtr || 0;\n\n     },\n\n     chk: function ()\n     {\n         var q = this.user.users();\n\n         if (this.script.modules.gateway) for (var x in q)\n         {\n             if (! this.script.modules.gateway.checkUser(q[x]))\n             {\n                 sys.kick(q[x]);\n             }\n         }\n     },\n\n     parseAfflictedArgs: function (args)\n     {\n\n     },\n\n\n     afflicted: function (src, object, expire)\n     {\n         var lname, ip, now;\n\n         now = +new Date;\n         ip = (src == 0? \"0.0.0.0\" : sys.ip(src));\n\n         lname = this.user.name(src).toLowerCase();\n\n        // if (this.user.hasPerm(src, \"PROTECTED\")) return null;\n\n         for (var x in object)\n         {\n             var ban = object[x];\n             if (ban.expires && ban.expires !== true && ban.expires <= now)\n             {\n                 if (expire) expire(x);\n                 delete object[x];\n\n                 continue;\n             }\n\n             if (ban.names) for (var x2 in ban.names)\n             {\n                 if (lname == ban.names[x2].toLowerCase())\n                 {\n                     return x;\n                 }\n\n             }\n\n             if (ban.nameRegex) for (var x2 in ban.nameRegex)\n\n\n             {\n                 var m = ban.nameRegex[x2].match(/^\\/(.+)\\/(\\w*)$/);\n                 if (lname.match(new RegExp(m[1], m[2])))\n                     return x;\n\n             }\n\n             if (ban.ips) for (var x2 in ban.ips)\n             {\n                 if (ip == ban.ips[x2]) return x;\n             }\n\n             if (ban.subnets) for (var x2 in ban.subnets)\n             {\n                 if (this.util.ipMatchesSubnet(ip, ban.subnets[x2]))\n                 {\n                     return x;\n\n                 }\n\n             }\n         }\n\n         return null;\n     },\n\n     prune: function (object)\n     {\n         var k = Object.keys(object);\n         for (var i in k)\n         {\n             var x = k[i];\n             if (object[x].expires && +new Date >= object.expires) delete object[x];\n         }\n     },\n\n     removeAfflicted: function (param, object)\n     {\n         var lname, ip;\n\n         var rs = [];\n\n         lname = param.toLowerCase();\n\n\n         loop1: for (var x in object)\n         {\n             if (lname.match(/^#\\d+$/) && x === lname.match(/^#(\\d+)$/)[1])\n             {\n                 rs.push(x);\n                 delete object[x];\n                 continue loop1;\n             }\n             var ban = object[x];\n\n\n             if (ban.names) for (var x2 in ban.names)\n             {\n                 if (lname == ban.names[x2].toLowerCase())\n                 {\n                     rs.push(x);\n                     delete object[x];\n                     continue loop1;\n                 }\n\n             }\n\n             if (ban.nameRegex) for (var x2 in ban.nameRegex)\n\n\n             {\n                 var m = ban.nameRegex[x2].match(/^\\/(.+)\\/(\\w+)$/);\n                 if (lname.match(new RegExp(m[1], m[2])) || param == ban.nameRegex[x2])\n                 {\n                     rs.push(x);\n                     delete object[x];\n                     continue loop1;\n                 }\n\n             }\n\n             if (ban.ips) for (var x2 in ban.ips)\n             {\n                 if (param == ban.ips[x2])\n                 {\n                     rs.push(x);\n                     delete object[x];\n                     continue loop1;\n                 }\n             }\n\n             if (ban.subnets) for (var x2 in ban.subnets)\n             {\n                 if (param == ban.subnets[x2] || (param.match(/\\d+\\.\\d+\\.\\d+\\.\\d+/) && this.util.ipMatchesSubnet(param, ban.subnets[x2])))\n                 {\n                     rs.push(x);\n                     delete object[x];\n                     continue loop1;\n                 }\n\n             }\n         }\n\n         return rs;\n     },\n\n     banID: function (src)\n     {\n         return this.afflicted(src, this.database.bans);\n     },\n\n     muteID: function (src)\n     {\n         return this.afflicted (src, this.database.mutes);\n     },\n\n     beforeLogIn: function (src)\n     {\n         var name = this.user.name(src);\n\n         if (name.match(/\\d+\\.\\d+.\\d+\\.\\d+/) || name.match(/\\//))\n         {\n             this.com.message(src, \"Illegal name.\", this.theme.CRITICAL);\n             sys.stopEvent();\n             return;\n         }\n     },\n\n     afterChangeTeam: function (src)\n     {\n\n         var name = this.user.name(src);\n\n         if (name.match(/\\d+\\.\\d+.\\d+\\.\\d+/) || name.match(/\\//))\n         {\n             this.com.message(src, \"Illegal name.\", this.theme.CRITICAL);\n             sys.kick(src);\n             return;\n         }\n     }\n\n });\n",
 "js_modules/server.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** handles ~~Server~~: /bla bla\n * @name server\n * @memberOf script.modules\n * @namespace\n * */\n/** @scope script.modules.server */\n({\n    require: [\"commands\", \"parsecommand\", \"com\", \"theme\", \"logs\", \"user\", \"chat\"]\n    ,\n    serverChan: null\n    ,\n    SERVER: 0\n    ,\n    loadModule: function ()\n    {\n        this.script.registerHandler(\"beforeServerMessage\", this);\n        this.commands.registerCommand(\"srvchan\", this);\n        this.serverChan = -1;\n    }\n    ,\n    /** This event catches commands and executes them.\n     * @event\n     */\n    beforeServerMessage: function (msg)\n    {\n        sys.stopEvent();\n\n        this.chat.beforeChatMessage(this.SERVER, msg, this.serverChan);\n\n        /*\n        if (msg.match(/^\\//))\n        {\n\t    this.commands.issueCommand( this.SERVER, msg, this.serverChan);\n\n            return;\n\n            var cmdObj = this.parsecommand.parseCommand(msg);\n            var cmdName = cmdObj.name;\n\n            this.logs.logMessage(this.logs.COMMAND, (this.serverChan ? \"[#\"+sys.channel(this.serverChannel)+\"] \" : \"\") + this.user.name(this.SERVER) + \": \" + msg);\n\n            if (!cmdName)\n            {\n                this.com.message(this.SERVER, \"Please enter a command.\", this.theme.WARN);\n                return;\n            }\n\n            if (!this.commands.commands_db[cmdName])\n            {\n                this.com.message(this.SERVER, \"Command does not exist.\", this.theme.WARN);\n                return;\n            }\n\n            if (!this.commands.serverCanUseCmd(cmdName))\n            {\n                this.com.message(this.SERVER, \"Sorry, but that command can't be used in the server console.\", this.theme.WARN);\n                return;\n            }\n\n            var cd = this.commands.commands_db[cmdName];\n\n            cd.code.call(cd.bind, 0, cmdObj, this.serverChan);\n        }\n\n        else\n        {\n            sys.broadcast(msg, this.serverChan, this.SERVER, false, -1);\n            this.logs.logMessage(this.logs.CHAT, (this.serverChan === -1 ? \"[N/A] \" : \"[#\"+sys.channel(this.serverChan)+\"] \") + this.user.name(this.SERVER) + \": \" + msg);\n        }\n         */\n    }\n    ,\n    srvchan:\n    {\n        category: \"administrative\",\n        server:true,\n        desc: \"Sets the channel used by the server messages.\",\n        perm: function(src) { return false; },\n        code: function (src, cmd, chan)\n        {\n            if (!cmd.input)\n            {\n                this.serverChan = -1;\n                this.logs.logMessage(this.logs.INFO, this.user.name(src) + \" unset the server channel.\", this.theme.INFO);\n                return;\n            }\n\n            var c = cmd.input;\n\n            var ch = sys.channelId(c);\n\n            if (ch == undefined)\n            {\n                this.com.message(src, \"Unknown channel.\", this.theme.WARN);\n                return;\n            }\n\n            this.logs.logMessage(this.logs.INFO, this.user.name(src) + \" set the server channel to #\" + sys.channel(ch) + \".\", this.theme.INFO);\n            this.serverChan = ch;\n\n            return;\n        }\n    }\n});",
 "js_modules/serverimp.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n\n    require: [\"commands\"],\n\n\n    loadModule: function ()\n    {\n        this.commands.registerCommand(\"serversay\", this);\n    },\n\n\n    serversay:\n    {\n        server: false,\n        category: \"system\",\n\n        perm: function (src)\n        {\n            return false;\n        },\n\n        code: function (src, cmd, chan)\n        {\n            this.script.beforeServerMessage(cmd.input);\n        }\n    }\n\n});",
 "js_modules/setauth.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"commands\", \"com\", \"theme\", \"user\"]\n    ,\n    setauth:\n    {\n        category: \"administrative\",\n        server: true\n        ,\n        aliases: [\"auth\"]\n        ,\n        desc: \"Set user auth level\"\n        ,\n        options:\n        {\n            level: \"What level to set the user to.\"\n        },\n        examples:\n        [\n            [{args: [\"Super Admin\", \"Super Admin2\"], flags: {level: \"owner\"} }, \"Makes the users Super Admin and Super Admin2 both owners.\"]\n        ]\n        ,\n        perm: \"AUTH\"\n        ,\n        code: function (src, cmd, chan)\n        {\n            var lvto;\n            var levels =\n                {\n                    \"3\":3, \"owner\":3, \"root\":3,\n                    \"2\":2, \"admin\":2, \"administrator\":2,\n                    \"1\":1, \"mod\":1, \"moderator\":1,\n                    \"0\":0, \"user\": 0, \"none\":0\n                };\n\n            var level_tr =\n                [\n                    \"User\",\n                    \"Moderator\",\n                    \"Administrator\",\n                    \"Owner\"\n                ];\n\n            var level = null;\n\n            if (!cmd.flags.level)\n            {\n                this.com.message(src, \"Enter a level option. See /help setauth.\");\n                return;\n            }\n\n            if (cmd.flags.level.toLowerCase() in levels)\n            {\n                level = levels[cmd.flags.level.toLowerCase()];\n                lvto = level_tr[level];\n            }\n\n            else\n            {\n                this.com.message([src], \"Unknown level\", this.theme.WARN);\n                return;\n            }\n\n            for (var x in cmd.args)\n            {\n                if (! sys.dbIp(cmd.args[x]))\n                {\n                    this.com.message([src], \"User unknown\", this.theme.WARN);\n                    continue;\n                }\n\n                if (! sys.dbRegistered(cmd.args[x]))\n                {\n                    this.com.message([src], \"User unregistered\", this.theme.WARN);\n                    continue;\n                }\n\n                if (! (this.user.hasPerm(src, \"AUTH[\" + level +\"]\") && this.user.hasPerm(src, \"AUTH[\" + this.user.nameAuth(cmd.args[x])+\"]\")))\n                {\n                    this.com.message(src, \"Not high enough level for that.\");\n                    continue;\n                }\n\n                var i = sys.id(cmd.args[x]);\n\n                if (i)\n                {\n                    sys.changeAuth(i, level);\n                }\n                else\n                {\n                    sys.changeDbAuth(cmd.args[x], level);\n                }\n\n                this.user.majorGroupDropMemberName(\"User\", cmd.args[x]);\n                this.user.majorGroupDropMemberName(\"Moderator\", cmd.args[x]);\n                this.user.majorGroupDropMemberName(\"Administrator\", cmd.args[x]);\n                this.user.majorGroupDropMemberName(\"Owner\", cmd.args[x]);\n                this.user.majorGroupAddMemberName(lvto, cmd.args[x]);\n\n                this.com.broadcast(this.user.name(src) + \" set \" + cmd.args[x] + \" to \" + lvto + \".\", this.theme.INFO);\n            }\n        }\n    }\n    ,\n    loadModule: function()\n    {\n        this.commands.registerCommand(\"setauth\", this);\n    }\n});\n",
 "js_modules/sourcedist.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n// Command\n({\n\n     require: [\"commands\", \"logs\", \"text\", \"theme\", \"com\"],\n\n     loadModule: function ()\n     {\n         //this.publicIP = sys.synchronousWebCall(\"http://icanhazip.com/\");\n\n         /* if (!this.publicIP || !this.publicIP.match(/^(\\d{1,3}\\.){3}\\d{1,3}\\n?$/))\n          {\n          //this.publicIP = null; //throw new Error(\"Could not initialize public IP\")\n          this.logs.logMessage(this.logs.CRITICAL, \"Could not initialize public IP\");\n          return;\n          }*/\n\n         //this.commands.registerCommand(\"getsource\", this);\n     },\n\n\n     getsource:\n     {\n         perm: function ()\n         {\n             return true;\n         }\n         ,\n         options:\n         {\n             client: \"Sends the source into the client window, instead of a link if available.\"\n         }\n         ,\n         code: function (src, cmd, chan)\n         {\n\n             var modules = [];\n\n             if (cmd.flags.loaded) cmd.args = Object.keys(this.script.modules);\n             if (cmd.flags.all) cmd.args = Object.keys(this.script.modInfo);\n\n             var text = [\"Source Code:\"];\n\n             if (cmd.args.length == 0)\n             {\n                 for (var x in this.script.modInfo)\n                 {\n                     if (!this.script.modInfo[x]) continue;\n                     text.push(\"<b>Module \" + x + \" exists as a \" +this.script.modInfo[x].type+ \" module at \"+this.script.modInfo[x].path+\" in state \"+this.script.modInfo[x].state+\".</b>\");\n                 }\n\n                 this.com.message(src,text.join(\"<br/>\"), this.theme.INFO, true);\n                 this.com.message(src, \"Try /getsource <modname>, or /getsource --loaded or /getsource --all\", this.theme.INFO);\n                 return;\n             }\n\n\n\n             for (var x in cmd.args)\n             {\n                 text.push(\"<b>Module \" + cmd.args[x] + \" exists as a \" +this.script.modInfo[cmd.args[x]].type+ \" module at \"+this.script.modInfo[cmd.args[x]].path+\" in state \"+this.script.modInfo[cmd.args[x]].state+\".</b>\");\n                 text.push(\"<code>\" + this.text.escapeHTML(this.script.modInfo[cmd.args[x]].code) + \"</code>\");\n             }\n\n             this.com.message(src,text.join(\"<br/>\"), this.theme.INFO, true);\n         }\n     }\n     ,\n     sendSource: function (src)\n     {\n         var test = null;\n\n         // test = sys.synchronousWebCall(\"http://localhost:5081/test\");\n\n         var text = [];\n         if (1)// || test !== \"ZVxScripts Web Module: Confirming source distributed via webserver. /s/ zvxscriptswebsource\");\n         {\n             var flist = sys.filesForDirectory(\"js_modules\");\n             for (var x in flist) if (!flist[x].match(/^#.+#$/) && !flist[x].match(/~$/))\n             {\n                 text.push(\"<b>File: \" + flist[x] + \"</b>\");\n                 text.push(\"<code>\" + this.text.escapeHTML(sys.read(\"js_modules/\" + flist[x] )) + \"</code>\");\n             }\n             sys.sendHtmlMessage(src, \"<hr/>\" + text.join(\"<hr/>\")+ \"<hr/>\");\n         }\n\n         if (0 && test)\n         {\n             //   sys.sendHtmlMessage(src, \"<a href='http://\" + this.ip + \":5081/zvxscripts-source.zip'>Download</a>\");\n         }\n\n\n     },\n\n\n     sendSource2: function (src)\n     {\n         var test = null;\n\n         var flist = sys.filesForDirectory(\"js_modules\");\n         for (var x in flist) if (!flist[x].match(/^#.+#$/) && !flist[x].match(/~$/))\n         {\n             text.push(\"<b>File: \" + flist[x] + \"</b>\");\n             text.push(\"<code>\" + this.text.escapeHTML(sys.read(\"js_modules/\" + flist[x] )) + \"</code>\");\n         }\n\n\n         sys.sendHtmlMessage(src, \"<hr/>\" + text.join(\"<hr/>\")+ \"<hr/>\");\n\n\n\n     }\n });",
 "js_modules/std.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n    require: [\"text\", \"sched\", \"io\"]\n});\n",
 "js_modules/test.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"color\", \"com\", \"theme\"],\n\n     runTests: function (src)\n     {\n         var red = [0xff, 00, 00];\n\n         var green = [0, 0xff, 0];\n\n         this.com.message(src, \"Mixing test...\");\n\n         for (var i = 0; i <= 1; i += 1/21)\n         {\n             var c = this.color.colorMixProp(red, green, i);\n             var cd = this.color.colorTriadToString(c);\n             this.com.message(src, \"<font color=\"+cd+\">Mix \" + JSON.stringify(red) + \" and \" + JSON.stringify(green) + \" @ p = \" + i + \" for \" + JSON.stringify(c) + \"</font>\", this.theme.INFO, true);\n         }\n\n         this.com.message(src, \"Neonify test...\");\n\n         for (var i = 0; i <= 1; i += 1/20)\n         {\n             var c = this.color.colorMixProp(red, green, i);\n             var c2 = this.color.neonify(c, 1);\n             var cd = this.color.colorTriadToString(c2);\n             this.com.message(src, \"<font color=\"+cd+\">Neonify \" + JSON.stringify(c) + \" for \" + JSON.stringify(c2) + \"</font>\", this.theme.INFO, true);\n         }\n\n     }\n\n });\n",
 "js_modules/test2.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"test\", \"com\"],\n\n     loadModule: function ()\n     {\n         this.test.registerTest(\"qtest\", this);\n     },\n\n\n     qtest: function ()\n     {\n         this.com.broadcast(\"qtest!\");\n     }\n});",
 "js_modules/text.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** Text module\n * @memberof script.modules\n * @name text\n * @namespace\n */\n/** @scope script.modules.text */\n({\n    hotswap: true\n    ,\n    escapeHTML: function (html)\n    {\n        return html.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\\n/g,\"<br/>\").replace(/ /g, \"&nbsp;\");\n    }\n    ,\n    stripHTML: function (html)\n    {\n        return html.replace(/<br ?\\/?>/g, \"\\n\").replace(/<\\/?[^>]+>/g, \"\").replace(/&lt;/g, \"<\").replace(/&gt;/g, \">\").replace(/&amp;/g, \"&\").replace(/&nbsp;/g, \" \");\n    }\n});\n",
 "js_modules/theme.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"text\", \"time\"],\n     hotswap: true,\n\n     INFO: 0,\n     WARN: 1,\n     CRITICAL: 2,\n     GAME: 3,\n     TOUR: 4,\n     LOG: 5,\n     RPG: 6,\n\n\n     TEMPLATE1: \"<span style='color:%1;'><timestamp /><b>~Script~:</b></span> %2\",\n     TEMPLATE2: \"<span style='color:%1;'><timestamp /><b>~Script~:</b> %2</span>\",\n     TEMPLATE3: \"<span style='color:%1;'><timestamp />%2</span>\",\n\n\n     formatAs: function (text, type)\n     {\n         switch (type)\n         {\n         case this.INFO:\n             return this.TEMPLATE1.replace(/%1/g, \"blue\").replace(/%2/, text);\n\n         case this.WARN:\n             return this.TEMPLATE1.replace(/%1/g, \"red\").replace(/%2/, text);\n\n         case this.CRITICAL:\n             return this.TEMPLATE2.replace(/%1/g, \"red\").replace(/%2/, text);\n\n         case this.GAME:\n         case this.RPG:\n             return this.TEMPLATE1.replace(/%1/g, \"green\").replace(/%2/, text);\n\n         case this.TOUR:\n             return this.TEMPLATE2.replace(/%1/g, \"green\").replace(/%2/, text);\n\n         case this.LOG:\n             return this.TEMPLATE3.replace(/%1/g, \"grey\").replace(/%2/, text);\n\n\n         default:\n             return text;\n         }\n     },\n\n     issuetext: function (issued)\n     {\n         var outtext = [];\n         function out(prop, propname)\n         {\n             if (issued[prop] && issued[prop].length)\n             {\n                 outtext.push(propname + \": \" + issued[prop].join(\", \") + \".\");\n             }\n         }\n\n         if (issued.author) outtext.push(\"Issued by: \" + issued.author);\n         if (issued.reason) outtext.push(\"Reason: \" + issued.reason);\n\n         outtext.push(\"Expires: \" + ( issued.expires?  this.time.diffToStr(Math.round(issued.expires/1000)*1000 - +new Date) + \" (\" +  new Date(issued.expires).toString() +\")\" : \"indefinite\"));\n\n\n         out.call(this, \"names\", \"Names\");\n         out.call(this, \"ips\", \"IPs\");\n         out.call(this, \"subnets\", \"IP Subnets\");\n         out.call(this, \"nameRegex\", \"Regular Expressions\");\n\n         out.call(this, \"hostnames\", \"Hostname Regular Expression(s)\");\n\n         return outtext.join(\"\\n\");\n\n     },\n\n\n\n     issuehtml: function (issued)\n     {\n         var outtext = [];\n         function out(prop, propname)\n         {\n             if (issued[prop] && issued[prop].length)\n             {\n                 outtext.push(\"<b>\"+  propname + \"</b>: \" + this.text.escapeHTML(issued[prop].join(\", \")) + \".\");\n             }\n         }\n\n\n         if (issued.author) outtext.push(\"<b>Issued by:</b> \" + issued.author);\n         if (issued.reason) outtext.push(\"<b>Reason:</b> \" + issued.reason);\n\n         outtext.push(\"<b>Expires:</b> \" + ( issued.expires?  this.time.diffToStr(Math.round((issued.expires - +new Date)/1000)*1000) + \" (\" +  new Date(issued.expires).toString() +\")\" : \"indefinite\"));\n\n         out.call(this, \"names\", \"Name(s)\");\n         out.call(this, \"ips\", \"IP(s)\");\n         out.call(this, \"subnets\", \"IP Subnet(s)\");\n         out.call(this, \"nameRegex\", \"Regular Expression(s)\");\n         out.call(this, \"hostnames\", \"Hostname Regular Expression(s)\");\n\n         return outtext.join(\"<br/>\");\n\n     }\n\n\n });\n",
 "js_modules/time.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n    hotswap: true\n    ,\n    conversionFactors:\n    {\n        milisecond:1,\n        ms: 1,\n        second: 1000,\n        s: 1000,\n        sec: 1000,\n        minute: 60000,\n        min: 60000,\n        hour: 3600000,\n        hr: 3600000,\n        day: 86400000,\n        dy: 86400000,\n        week: 604800000,\n        wk: 604800000,\n        month: 2678400000,\n        mo: 2678400000,\n        year: 31536000000,\n        yr: 31536000000\n    }\n    ,\n    diffToStr: function (diff)\n    {\n        var s = [];\n\n        var years = (diff - (diff % 31536000000)) / 31536000000;\n        diff -= years*31536000000;\n        var months = (diff - (diff % 2678400000)) / 2678400000;\n        diff -= months*2678400000;\n        var weeks = (diff - (diff % 604800000)) / 604800000;\n        diff -= weeks*604800000;\n        var days = (diff - (diff % 86400000)) / 86400000;\n        diff -= days*86400000;\n        var hours = (diff - (diff % 3600000)) / 3600000;\n        diff -= hours*3600000;\n        var minutes = (diff - (diff % 60000)) / 60000;\n        diff -= minutes*60000;\n        var seconds = (diff - (diff % 1000)) / 1000;\n        diff -= seconds*1000;\n        var ms = diff;\n\n\n        if (years)\n        {\n            s.push(\"\" + years + \" year\" + (years==1?\"\":\"s\"));\n        }\n\n\n        if (months)\n        {\n            s.push(\"\" + months + \" month\" + (months==1?\"\":\"s\"));\n        }\n\n        if (weeks)\n        {\n            s.push(\"\" + weeks + \" week\" + (weeks==1?\"\":\"s\"));\n        }\n\n        if (days)\n        {\n            s.push(\"\" + days + \" day\" + (days==1?\"\":\"s\"));\n        }\n\n        if (hours)\n        {\n            s.push(\"\" + hours + \" hour\" + (hours==1?\"\":\"s\"));\n        }\n\n        if (minutes)\n        {\n            s.push(\"\" + minutes + \" minute\" + (minutes==1?\"\":\"s\"));\n        }\n\n        if (seconds)\n        {\n            s.push(\"\" + seconds + \" second\" + (seconds==1?\"\":\"s\"));\n        }\n\n        if (ms)\n        {\n            s.push(\"\" + ms + \" milisecond\" + (ms==1?\"\":\"s\"));\n        }\n\n        return s.join(\", \");\n    }\n\n    ,\n    strToDiff: function (str)\n    {\n        var chunks = str.replace(/\\.|\\!/g,\"\").split(/\\s*(?:,\\s*and|and|,)\\s*/g);\n        var total = 0;\n\n        for (var x in chunks)\n        {\n            var subchunks = chunks[x].split(/\\s+/g);\n\n            if (subchunks.length != 2) continue;\n\n            var intv = 1;\n            var mod = 1000;\n\n            if (+subchunks[0] >= 0)\n            {\n                intv = +subchunks[0];\n            }\n            else if (subchunks[0] == \"a\" || subchunks[0] == \"an\")\n            {\n                intv = 1;\n            }\n            else continue;\n\n            var other = subchunks[1].toLowerCase();\n\n            if (other.charAt(other.length - 1) == \"s\" && !(other in this.conversionFactors))\n            {\n                other = other.slice(0, -1);\n            }\n\n            if (other in this.conversionFactors)\n            {\n                mod = this.conversionFactors[other];\n            }\n            else continue;\n\n            total += mod*intv;\n        }\n\n\n        return total;\n\n    }\n});\n",
 "js_modules/tournament.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n(\n{\n    require: [\"com\", \"theme\", \"commands\", \"user\"],\n\n\n    activeTours: null,\n\n\n    tourOf: null,\n\n\n    matchIDs: null,\n\n\n    version: 1,\n\n\n    loadModule: function()\n    {\n        this.activeTours = new Object;\n        this.tourOf = new Object;\n        this.matchIDs = new Object;\n    },\n\n\n    /** Adds a player to the tournament\n     * @param tour The tournament to modify.\n     * @param src The player ID affected.\n     */\n    tourAdd: function (tour, src)\n    {\n        var lowname = this.user.name(src).toLowerCase();\n\n        if (tour.players.indexOf(lowname) !== -1) return false;\n\n        tour.players.push(lowname);\n\n        return true;\n    },\n\n\n    hotswap: function ()\n    {\n        if (old.verison != this.version) return false;\n\n\n        this.activeTours = old.activeTours;\n        return true;\n    },\n\n\n    newRound: function (tour)\n    {\n        this.util.shuffle(tour.players);\n\n        for (var i = 0; i < tour.players.length -1; i += 2)\n        {\n            this.com.broadcast(tour.players[i] + \" V.S. \" + tour.players[i + 1] + \"!\", this.theme.TOUR);\n            tour.matchups.push([tour.players[i], tour.players[i+1]]);\n        }\n    },\n\n\n    beforeBattleStarted: function (source, target, clauses, rated, mode, battleid, team1, team2)\n    {\n        if (!this.tourOf[source] && !this.tourOf[target]) return;\n\n        var tour = this.tourOf[source];\n\n        if (tour != this.tourOf[target])\n        {\n            this.com.message([source, target], \"Players in a tournament may only battle their opponent!\", this.theme.WARN);\n            sys.stopEvent();\n            return;\n        }\n\n        var matchup_id;\n\n        matchup_check:\n        {\n            var matchups = tour.matchups;\n\n            for (var x in matchups) if (matchups[x].indexOf(this.user.name(source).toLowerCase()) != -1 && matchups[x].indexOf(this.user.name(target).toLowerCase()) !== -1)\n            {\n                matchup_id = x;\n                break matchup_check;\n            }\n\n            this.com.message([source, target], \"Players in a tournament may only battle their opponent!\", this.theme.WARN);\n            sys.stopEvent();\n            return;\n        }\n\n        var tier = tour.tier;\n\n        if (tier)\n        {\n            if (sys.tier(source, team1) !== tier)\n            {\n                this.com.message([source, target], this.user.name(source) + \" is in the wrong tier!\");\n                sys.stopEvent();\n                return;\n            }\n\n            if (sys.tier(target, team2) !== tier)\n            {\n                this.com.message([source, target], this.user.name(target) + \" is in the wrong tier!\");\n                sys.stopEvent();\n                return;\n            }\n        }\n\n        this.matchIDs[source] =\n        this.matchIDs[target] =\n                                battleid;\n\n        return;\n\n    },\n\n    afterBattleEnded: function (winner, loser, result, battle_id)\n    {\n\n        if (this.matchIDs[battleid])\n        {\n            var tour = this.tourOf[winner];\n\n            if (result === \"tie\")\n            {\n                this.com.broadcast(this.user.name(winner) + \" and \" + this.user.name(loser) + \" tied!\");\n            }\n            else\n            {\n                this.com.broadcast(this.user.name(winner) + \" defeated \" + this.user.name(loser) + \"!\");\n                var lname = this.user.name(loser).toLowerCase();\n\n                tour.players[lname]--;\n                if (tour.players[lname] <= 0) delete tour.players[x];\n            }\n\n            this.tour.matchups[this.matchIDs[battleid]] = []; // Don't want to delete\n\n            this.checkTour(tour);\n\n            return;\n        }\n    },\n\n\n    checkTour: function (tour)\n    {\n        var players = tour.players;\n\n        if (players.length <= 1)\n        {\n            if (players.length == 1)\n            {\n                this.com.broadcast(this.user.name(sys.id(tour.players[0])) + \" won the tournament!\");\n\n                for (var x in this.activeTours) if (this.activeTours[x] === tour)\n                {\n                    delete this.activeTours[x];\n                }\n\n\n            }\n        }\n    },\n\n    tourjoin:\n    {\n        desc: \"Joins running tournament.\",\n\n        perm: function (src)\n        {\n            var g = this.user.groups(src);\n            return \"TOURNAMENT[JOIN]\" in g || \"TOURNAMENT[*]\" in g;\n        },\n\n        code: function (src)\n        {\n\n        }\n    }\n\n\n\n});",
 "js_modules/tours.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     require: [\"commands\", \"io\", \"util\", \"com\", \"theme\"]\n     ,\n     database: null\n     ,\n     loadModule: function ()\n     {\n     var database = this.io.openDB(\"tours\");\n     this.tours = database.chans;\n     }\n     ,\n     unloadModule: function ()\n     {\n     this.io.closeDB(\"tours\");\n     }\n     ,\n     newtour:\n     {\n     perm: function (src)\n     {\n         return sys.auth(src) >= 1;\n     }\n     ,\n     code: function (src, cmd, chan)\n     {\n         if (this.tours[sys.channel(chan).toLowerCase()])\n         {\n         this.com.message([src], \"Channel already has a running tournament.\", this.theme.WARN);\n         return;\n         }\n         \n         var tr = this.tours[sys.channel(chan).toLowerCase()] = new Object;\n\n         this.com.broadcast(sys.name(src) + \" has started a new tournament in #\" + sys.channel(chan));\n\n         tr.type = \"single\";\n\n         tr.players = [];\n\n         return;\n        \n     }\n     }\n     ,\n     jointour: \n     {\n     perm: function ()\n     {\n         return true;\n     }\n     ,\n     code: function (src, cmd, chan)\n     {\n         var tr = this.tours[sys.channel(chan).toLowerCase()];\n         \n         if (!tr)\n         {\n         this.com.message(src, \"No\")\n         \n         }\n     }\n     }\n     ,\n     afterBattleEnded:\n});",
 "js_modules/uptime.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n    start: null\n    ,\n    require: [\"time\"]\n    ,\n    loadModule: function ()\n    {\n        this.start = + new Date;\n    }\n    ,\n    unloadModule: function()\n    {\n\n    }\n    ,\n\n    hotswap: function (old)\n    {\n        this.start = old.start;\n\n        return true;\n    }\n    ,\n    uptimeRaw: function ()\n    {\n        return (+new Date)-this.start;\n    }\n    ,\n    uptime: function ()\n    {\n        return this.time.diffToStr((+new Date)-this.start);\n    }\n});\n",
 "js_modules/user.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** Module that provides sys-like functions but also works with e.g., ~~Server~~ and etc.<br/>\n * @desc This module also proviedes functions to manage user settings, usergroups, etc.\n * @name user\n * @memberOf script.modules\n * @namespace\n * */\n/** @scope script.modules.user */\n({\n     require: [\"io\", \"util\", \"zsrx\"],\n     /* Object that stores a reference to database.invisible\n      * @type Object\n      */\n\n     invisibleUsers: null,\n\n     users: function ()\n     {\n         var a = [];\n\n         sys.playerIds().forEach(\n             function(i)\n             {\n                 if (sys.loggedIn(i)) a.push(i);\n             }\n         );\n\n         return a;\n     },\n\n     updateGroupObj: function (g)\n     {\n         if (g.perms.indexOf(\"SERVEROP\") != -1)\n         {\n             g.perms.splice(g.perms.indexOf(\"SERVEROP\"), 1);\n             g.perms.push(\"ALLPERMS\");\n         }\n     },\n\n\n     loadModule: function ()\n     {\n         var x;\n\n         this.script.registerHandler(\"beforeLogIn\", this);\n         /*var db = this.io.openDB(\"user\");\n         db.invisble = db.invisible || new Object;\n         db.usergroups = db.usergroups || new Object;\n          */\n         this.database = {\n             usergroups: this.io.registerDB(this, \"user.perms\"),\n             majorgroupinfo: this.io.registerDB(this, \"user.groups\"),\n             userconf: this.io.registerDB(this, \"user.userconf\")\n         };\n\n         this.relMajors = new Object;\n\n         this.cache = new Object;\n\n         //this.io.registerConfig(this, { segroups0: [\"LISTSEC\"], segroups1: [\"KICKOP\", \"LOGS\", \"LOGS[CHAT]\", \"LOGS[INFO]\", \"CHATOP\", \"INFOSEC\", \"PROTECTED\"],\n         //                              segroups2: [\"BANOP\", \"AUTHOP\"], segroups3: [\"LOGS[*]\", \"SILENT\", \"INVISIBLE\", \"OVERRIDE\"]});\n\n\t this.registerConfigHook = this.util.generateRegistor(this, this.util.LIST_REGISTOR, \"configHooks\");\n\n         var t = this;\n         function declMajor (name, perms, inherit)\n         {\n             var test = !t.majorGroupExists(name);\n             if (test)\n             {\n                 t.createMajorGroup(name);\n                 t.majorGroupAddPerms(name, perms);\n                 t.majorGroupInheritsAdd(name, inherit);\n             }\n         }\n\n         if (Object.keys(this.database.majorgroupinfo).length == 0)\n             // config deleted/new server, add defaults that are not \"required\"\n         {\n             declMajor(\"ServerOperator\", [\"ALLPERMS\"], \"User\");\n\n             declMajor(\"Scripter\", [\"LOGS[SCRIPTERROR]\"], \"User\");\n             declMajor(\"VIP\", [\"PROTECTED\"], \"User\");\n         }\n\n\n         declMajor(\"User\", [\"CHAT\"]);\n         declMajor(\"Registered\", [\"LIST[BANS]\", \"LIST[MUTES]\", \"INFO[GROUPS]\", \"INFO[AUTH]\", \"CHANNEL[MODERATE]\", \"CHANNEL[REGISTER]\", \"RPG[PLAY]\"], \"User\");\n         declMajor(\"Moderator\", [\"CHANNEL[*]\", \"KICK\", \"LOGS[CHAT]\", \"LOGS[INFO]\", \"MUTE\", \"INFO[IP]\", \"PROTECTED\"], \"Registered\");\n         declMajor(\"Administrator\", [\"BAN\", \"AUTH[0]\", \"AUTH[1]\"], \"Moderator\");\n         declMajor(\"Owner\", [\"LOGS[*]\", \"AUTH[*]\", \"SILENT\", \"INVISIBLE\", \"OVERRIDE\", \"INFO[*]\", \"CONFIGURE[MOTD.MESSAGE]\", \"CONFIGURE[ANNOUNCEMENT.TEXT]\"],  \"Administrator\");\n\n\n         this.updateRelationalDB();\n\n         for (x in this.database.majorgroupinfo)\n         {\n             this.updateGroupObj(this.database.majorgroupinfo[x]);\n         }\n\n         for (x in this.database.userconf)\n         {\n             this.userNameConfig(x);\n         }\n\n\n     },\n\n     updateRelationalDB: function ()\n     {\n         var x, x2;\n\n         this.relMajors = new Object;\n\n         for (x in this.database.majorgroupinfo)\n         {\n             var group = this.database.majorgroupinfo[x];\n\n\n             for (x2 in group.members)\n             {\n                 this.relMajors[group.members[x2]] = this.relMajors[group.members[x2]] || [];\n\n                 this.relMajors[group.members[x2]].push(group.name);\n             }\n         }\n     },\n\n\n     /**\n      * @param {String} name\n      * @returns {Number} Auth level.\n      */\n     nameAuth: function (name)\n     {\n         return (sys.id(name) ? this.auth(sys.id(name)) : sys.dbAuth(name));\n     },\n\n     unloadModule: function ()\n     {\n     },\n\n     name: function (id)\n     {\n         if (id == 0 && (typeof id === \"number\" || typeof id === \"string\") ) return \"~~Server~~\";\n         else return sys.name(id);\n     },\n\n     userConfig: function (user)\n     {\n         var name = this.name(user);\n\n         return this.userNameConfig(name);\n\n     },\n\n     userNameConfig: function(name)\n     {\n\n         var lname = name.toLowerCase();\n\n\t var config, defConfig = new Object;\n\n\t if (!( config = this.database.userconf[lname]) )\n\t {\n             config = new Object;\n\n\n\t }\n\n         for (var x in this.configHooks)\n\t {\n\t     this.configHooks[x](config, name );\n             this.configHooks[x](defConfig, name);\n\t }\n\n         if (this.zsrx.zsrx(config) != this.zsrx.zsrx(defConfig))\n         {\n             this.database.userconf[lname] = config;\n         }\n         else\n         {\n             delete this.database.userconf[lname];\n         }\n\n\n         return config;\n\n     },\n\n     setUserConf: function (src, obj)\n     {\n         var name = this.name(src);\n\n         return this.setNameUserConf(name, obj);\n     },\n\n     setNameUserConf: function (name, obj)\n     {\n         var lname = name.toLowerCase(), defConfig = new Object, x;\n\n         for (x in this.configHooks)\n\t {\n             this.configHooks[x](defConfig, name);\n\t }\n\n         if (this.zsrx.zsrx(obj) != this.zsrx.zsrx(defConfig))\n         {\n             this.database.userconf[lname] = obj;\n         }\n         else\n         {\n             delete this.database.userconf[lname];\n         }\n     },\n\n     clearCache: function ()\n     {\n         this.cache = new Object;\n     },\n\n\n     majorGroups: function (src)\n     {\n         return this.nameMajorGroups(this.name(src));\n     },\n\n     majorGroupExists: function (name, perms)\n     {\n         return name in this.database.majorgroupinfo;\n     },\n\n     majorGroupAddPerms: function (name, perms)\n     {\n         perms = this.util.arrayify(perms);\n\n         var group = this.database.majorgroupinfo[name];\n\n         for (var x in perms)\n         {\n             if (group.perms.indexOf(perms[x]) === -1)\n             {\n                 group.perms.push(perms[x]);\n             }\n         }\n\n         this.clearCache();\n\n     },\n\n     majorGroupDropPerms: function (name, perms)\n     {\n         var group, x, index;\n         perms = this.util.arrayify(perms);\n\n         group = this.database.majorgroupinfo[name];\n\n         for ( x in perms)\n         {\n             index = group.perms.indexOf(perms[x]);\n\n             if (index !== -1)\n             {\n                 group.perms.splice(index, 1);\n             }\n         }\n\n         this.clearCache();\n\n     },\n\n     majorGroupInheritsAdd: function (name, groups)\n     {\n         var group = this.database.majorgroupinfo[name];\n\n         if (!group.inherits) group.inherits = [];\n\n         group.inherits = this.util.concatSets(group.inherits, this.util.arrayify(groups));\n\n         this.clearCache();\n\n         return;\n     },\n\n      majorGroupInheritsSet: function (name, groups)\n     {\n         var group = this.database.majorgroupinfo[name];\n\n         if (!group.inherits) group.inherits = [];\n\n         group.inherits = this.util.concatSets(this.util.arrayify(groups));\n\n         this.clearCache();\n\n         return;\n     },\n\n     createMajorGroup: function (name)\n     {\n         this.database.majorgroupinfo[name] =\n             {\n                 name: name,\n                 desc: \"\",\n                 perms: [],\n                 members: [],\n                 inherits: []\n             };\n\n         this.clearCache();\n\n         return;\n     },\n\n     deleteMajorGroup: function (name)\n     {\n         var g = this.database.majorgroupinfo[name];\n\n         for (var x in g.members)\n         {\n             var username = g.members[x];\n\n             if (!this.relMajors[username]) continue;\n\n             var index = this.relMajors[username].indexOf(name);\n             this.relMajors[username].splice(index, 1);\n\n         }\n\n         delete this.database.majorgroupinfo[name];\n         this.clearCache();\n         return;\n     },\n\n     getGroup: function (groupname)\n     {\n         return this.database.majorgroupinfo[groupname];\n     },\n\n     majorGroupDropMember: function (groupname, user)\n     {\n         return this.majorGroupDropMemberName(groupname, this.name(user));\n     },\n\n     majorGroupAddMember: function (groupname, user)\n     {\n         return this.majorGroupAddMemberName(groupname, this.name(user));\n     },\n\n     majorGroupAddMemberName: function (groupname, username)\n     {\n         username = username.toLowerCase();\n\n         if (this.database.majorgroupinfo[groupname].members.indexOf(username) !== -1) return false;\n\n         this.clearCache();\n\n         this.database.majorgroupinfo[groupname].members.push(username);\n\n         this.relMajors[username] = this.relMajors[username] || [];\n         this.relMajors[username].push(groupname);\n\n         return true;\n     },\n\n\n\n     majorGroupDropMemberName: function (groupname, username)\n     {\n         var index;\n\n         username = username.toLowerCase();\n\n         index = this.database.majorgroupinfo[groupname].members.indexOf(username);\n\n         if (index === -1) return false;\n\n         this.clearCache();\n\n         this.database.majorgroupinfo[groupname].members.splice(index, 1);\n\n         this.relMajors[username] = this.relMajors[username] || [];\n\n         index = this.relMajors[username].indexOf(groupname);\n         this.relMajors[username].splice(index, 1);\n\n\n         return true;\n     },\n\n\n     nameMajorGroups: function(name)\n     {\n         var ugroups, groups, majors;\n         var lname = name.toLowerCase();\n\n         if (lname == \"~~server~~\")\n         {\n             return {\"Sever\":null};\n         }\n\n         if (sys.dbRegistered(lname))\n         {\n             groups = {\"Registered\": null};\n         }\n         else return {\"User\": null};\n\n         if (!this.relMajors[lname]) ugroups = [];\n         else ugroups = this.relMajors[lname];\n\n         if (ugroups) for (var x in ugroups)\n         {\n             groups[ugroups[x]] = null;\n\n         }\n\n         if ((!(\"User\" in groups))  &&  (!(\"Moderator\" in groups))  &&  (!(\"Administrator\" in groups))  &&  (!(\"Owner\" in groups)))\n         {\n             groups.User = null;\n         }\n\n\n         return groups;\n     },\n\n\n     beforeLogIn: function (src)\n     {\n         var groups = this.majorGroups(src);\n\n         if ( src != 0 &&  ((!(\"User\" in groups))  &&  (!(\"Moderator\" in groups))  &&  (!(\"Administrator\" in groups))  &&  (!(\"Owner\" in groups)) || this.auth(src) != 0 ) )\n         {\n             var a = this.auth(src);\n\n             if (a)\n             {\n                 this.majorGroupAddMember([null, \"Moderator\", \"Administrator\", \"Owner\"][this.auth(src)], src);\n             }\n         }\n     },\n\n     groups: function (src)\n     {\n         if (src == 0) return {\"ALLPERMS\": null};\n\n         else return this.nameGroups(this.name(src));\n     },\n\n     permsOfMajorGroup: function (groupname)\n     {\n         if (this.cache[\"$permsMaj$\" + groupname]) return this.cache[\"$permsMaj$\" + groupname];\n         var groupmod = {};\n\n         var group = this.database.majorgroupinfo[groupname];\n\n         if (! group) return {};\n\n         var perms = group.perms || [];\n\n         for (var x in group.inherits)\n         {\n             perms = this.util.concatSets(perms, this.permsOfMajorGroup(group.inherits[x]));\n         }\n\n         this.cache[\"$permsMaj$\" + groupname] = perms;\n\n         return perms;\n     },\n\n     id: sys.id,\n\n     hasPerm: function (id, perm)\n     {\n         if (id == 0) return true;\n\n         var g = this.groups(id);\n\n         if (\"ALLPERMS\" in g) return true;\n\n         var _;\n         return (perm in g) || ((_ = perm.match(/^([A-Z]+)\\[([^\\]]+)\\]$/)) && ((_[1]+\"[*]\") in g));\n     },\n\n     nameGroups: function (name)\n     {\n         var _, majors;\n         name = name.toLowerCase();\n\n\n         if (name == \"~~server~~\") return {\"ALLPERMS\": null};\n\n         else\n         {\n             var x;\n             var groups = {};\n\n             //  var auth = +this.nameAuth(name);\n             /*\n              switch (+auth)\n              {\n              case 3:\n              for ( x in this.config.segroups3 )\n              {\n              groups[this.config.segroups3[x]] = null;\n              if ((_ = x.match(/^([A-Z])\\[.+\\]/))) groups[_[1]] = null;\n              }\n              case 2:\n              for ( x in this.config.segroups2 )\n              {\n              groups[this.config.segroups2[x]] = null;\n              if ((_ = x.match(/^([A-Z])\\[.+\\]/))) groups[_[1]] = null;\n              }\n              case 1:\n              for ( x in this.config.segroups1 )\n              {\n              groups[this.config.segroups1[x]] = null;\n              if ((_ = x.match(/^([A-Z])\\[.+\\]/))) groups[_[1]] = null;\n              }\n              default:\n              for ( x in this.config.segroups0 )\n              {\n              groups[this.config.segroups0[x]] = null;\n              if ((_ = x.match(/^([A-Z])\\[.+\\]/))) groups[_[1]] = null;\n              }\n\n              }*/\n\n             if (sys.dbRegistered(name))\n             {\n                 if (this.database.usergroups[name])\n                 {\n                     for (x in this.database.usergroups[name]) groups[this.database.usergroups[name][x]] = null;\n                 }\n             }\n\n             var majorgroups = this.nameMajorGroups(name);\n\n             for (x in majorgroups)\n             {\n                 var sub = this.permsOfMajorGroup(x);\n                 for (var x2 in sub) groups[sub[x2]] = null;\n             }\n\n\n\n             for (x in groups)\n             {\n                 majors = x.match(/^([A-Z]*)\\[([A-Z\\.\\*]*)\\]$/);\n                 if (majors)\n                 {\n                     groups[majors[1]] = null;\n                 }\n             }\n\n             if (\"ALLPERMS\" in groups) return {\"ALLPERMS\":null};\n\n\n             return groups;\n\n         }\n     },\n\n     nameToProper: function (name)\n     {\n         if (name.match(/~~Server~~/i)) return \"~~Server~~\";\n\n         if (sys.id(name)) return this.name(sys.id(name));\n\n         return name;\n     },\n\n     auth: function (id)\n     {\n         if (id == 0) return 3;\n\n         var a = sys.auth(id);\n\n         return a;\n     },\n\n     changeInvisible: function (id, bool)\n     {\n         if (!id) return;\n\n         var lname = this.name(id).toLowerCase();\n         if (lname in this.invisibleUsers && !bool)\n         {\n             sys.changeAuth(id, this.invisibleUsers[lname]);\n             delete this.invisibleUsers[lname];\n         }\n\n         if (bool && !(lname in this.invisibleUsers))\n         {\n             this.invisibleUsers[lname] = this.auth(id);\n             sys.changeAuth(id, 0);\n         }\n     }\n });",
 "js_modules/userconf.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n\n     require: [\"user\", \"commands\", \"com\", \"theme\", \"zsrx\", \"io\"],\n\n     loadModule: function ()\n     {\n         this.commands.registerCommand(\"userconf\", this);\n         this.io.registerConfig(this, {\"maxUserconfLength\": 1000});\n     },\n\n     userconf:\n     {\n         mode: \"strict\",\n         server: true,\n         perm: true,\n         category: \"basic\",\n\n         desc: \"Configures your per-user configuration. /userconf <propname> <operator> <value>. See /help userconf.\",\n         help: \"Type /userconf for a list, (not that not all are relevant to all users.) To configure an option, use /userconf option = newvalue. Instead of = you may also insert using <<, or splice using >>.\",\n         examples:\n         [\n             [\"commandParser = \\\"optargs\\\"\",\"Changes your command parser to optargs-mode.\"],\n             [\"recieveLogTypes << \\\"CHAT\\\"\",\"Adds \\\"CHAT\\\" to the recieveLogTypes setting\"]\n         ],\n\n\n         perm: function () { return true; },\n\n         code: function (src, cmd, chan)\n         {\n             var string = cmd.input || \"\";\n\n             var origin = this.user.userConfig(src);\n\n             var modobj = origin;\n\n             var match = string.match(/^\\s*([\\w]+(?:\\.[\\w]+)*)(?:\\s*(\\:?\\=|\\+\\=|<<|>>|~)\\s*(.*$))?/i);\n\n             if (!match)\n             {\n                 this.com.message(src, \"Conf:\\n\" + JSON.stringify(modobj, 1, null));\n                 return;\n             }\n\n             var pathway = match[1].split(/\\./g);\n\n             if (pathway.length == 0) { this.com.message(src, \"Invalid property chain.\", this.theme.WARN); return; }\n\n             var finalProp = pathway.pop();\n\n             if (finalProp === \"__proto__\") { this.com.message(src, \"Invalid property chain.\", this.theme.WARN); return; }\n\n\n\n             for (var x in pathway)\n             {\n\n                 var i = pathway[x];\n\n                 if (i === \"__proto__\") { this.com.message(src, \"Invalid property chain.\", this.theme.WARN); return; }\n\n                 modobj = modobj[pathway[x]];\n\n                 if (typeof modobj !== \"object\" || modobj instanceof Array)\n                 {\n                     this.com.message(src, \"Invalid property chain.\");\n                     return;\n                 }\n\n             }\n\n             if (! match[2])\n             {\n                 this.com.message(src, JSON.stringify(modobj[finalProp]), this.theme.INFO);\n                 return;\n             }\n\n             try\n             {\n                 var prop = JSON.parse(match[3]);\n             }\n             catch (e)\n             {\n                 this.com.message(src, \"Parse error: \" + e);\n                 return;\n             }\n\n\n\n             switch (match[2])\n             {\n             case \":=\":\n             case \"=\":\n                 if (typeof prop != \"object\" && typeof prop === typeof modobj[finalProp])\n                 {\n                     modobj[finalProp] = prop;\n                     if (this.zsrx.zsrx(modobj).length > this.config.maxUserconfLength)\n                     {\n                         for (var x in origin) delete origin[x];\n\n                         this.com.message(src, \"Configuration Overflow.\", this.theme.CRITICAL);\n                         return;\n\n                     }\n                     else {\n                         this.user.setUserConf(src, origin);\n                         this.com.message(src, \"Configured.\");\n                     }\n\n                     return true;\n                 }\n                 else if (typeof modobj[finalProp] === \"object\" && modobj[finalProp] instanceof Array && typeof prop === \"object\" && prop instanceof Array)\n                 {\n                     for (x in prop) if (typeof prop[x] === \"object\") throw new Error(\"Wrong argument type or wrong operator.\");\n\n                     modobj[finalProp] = prop;\n                     this.user.setUserConf(src, origin);\n                     if (this.zsrx.zsrx(modobj).length > this.config.maxUserconfLength)\n                     {\n                         for (var x in origin) delete origin[x];\n\n                         this.com.message(src, \"Configuration Overflow.\", this.theme.CRITICAL);\n                         return;\n\n                     }\n                     else {\n                         this.user.setUserConf(src, origin);\n                         this.com.message(src, \"Configured.\");\n                     }\n                     return true;\n                 }\n                 throw new Error(\"Wrong argument type or wrong operator.\");\n             case \"<<\":\n                 if (typeof modobj[finalProp] === \"object\" && modobj[finalProp] instanceof Array && typeof prop != \"object\")\n                 {\n                     modobj[finalProp].push(prop);\n                     this.user.setUserConf(src, origin);\n\n                     if (this.zsrx.zsrx(modobj).length > this.config.maxUserconfLength)\n                     {\n                         for (var x in origin) delete origin[x];\n\n                         this.com.message(src, \"Configuration Overflow.\", this.theme.CRITICAL);\n                         return;\n\n                     }\n                     else {\n                         this.user.setUserConf(src, origin);\n                         this.com.message(src, \"Configured.\");\n                     }\n                     return true;\n\n                 }\n                 throw new Error(\"Wrong argument type or wrong operator.\");\n             case \">>\":\n                 if (typeof modobj[finalProp] === \"object\" && modobj[finalProp] instanceof Array && typeof prop != \"object\")\n                 {\n                     if (modobj[finalProp].indexOf(prop) !== -1) modobj[finalProp].splice(modobj[finalProp].indexOf(prop), 1);\n\n                     if (this.zsrx.zsrx(modobj).length > this.config.maxUserconfLength)\n                     {\n                         for (var x in origin) delete origin[x];\n\n                         this.com.message(src, \"Configuration Overflow.\", this.theme.CRITICAL);\n                         return;\n\n                     }\n                     else {\n                         this.user.setUserConf(src, origin);\n                         this.com.message(src, \"Configured.\");\n                     }\n                     return;\n                 }\n                 throw new Error(\"Wrong argument type or wrong operator.\");\n             case \"~\":\n\n\n\n\n             }\n\n             throw new Error(\"Wrong argument type or wrong operator.\");\n\n\n\n\n         }\n\n\n\n\n\n\n     }\n\n\n });\n",
 "js_modules/util.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** Utilities module\n * @memberof script.modules\n * @name util\n * @namespace\n */\n/** @scope script.modules.util */\n({\n     hotswap: true\n     ,\n     /** Binds a function and object together.\n      * @param {Object} obj The object to be used as \"this\" when calling func.\n      * @param {Function} func The function to be called.\n      * @return A new function which is a clone of func, but where the this object is always obj.\n      */\n     bind: function (obj, func)\n     {\n         return function ()\n         {\n             return func.apply(obj, arguments);\n         };\n\n     }\n     ,\n     /** Converts a value to an array if it isn't already one.\n      * @param variant The value to be wrapped in an array if it isn't already one\n      * @return {Array}\n      * @example arrayify(8) >> [8], arrayify([7, 8]) >> [7, 8]\n      */\n     arrayify: function (variant)\n     {\n         if (typeof variant === \"undefined\" || variant === null) return variant;\n         if (typeof variant !== \"object\" || !(variant instanceof Array)) return [variant];\n\n         return variant;\n     },\n\n     concatSets: function ()\n     {\n         var output = [];\n\n         for (var i = 0; i < arguments.length; i++)\n         {\n             arguments[i] = this.arrayify(arguments[i]);\n             var s = arguments[i];\n             for (var x2 in s)\n             {\n                 if (output.indexOf(s[x2]) == -1) output.push(s[x2]);\n             }\n         }\n\n         return output;\n     },\n     /** Shuffles the array.\n      * @param array Array to be shuffled.\n      */\n     shuffle: function (array)\n     {\n         // fisheryates\n         var i = array.length;\n         var temp;\n         var rand;\n\n         for (i = array.length; i;)\n             // Shuffles the array\n         {\n             rand = Math.floor(Math.random() * i--);\n             temp = array[i];\n             array[i] = array[rand];\n             array[rand] = temp;\n         }\n     }\n     ,\n     /** Inspects variant\n      * @param variant Value to be inspected\n      * @param {Boolean} exclude If duiplicates should only be printed once. (recommended)\n      * @return {String} Human readable representation of variant.\n      */\n     inspect: function (variant, exclude, maxdepth, iters)\n     {\n         // Rather complicated function, bear with it!\n         /** The stack frames variable includes all the objects we are already inside of, to catch circular references. */\n         var stack_frames = [];\n\n         /** The refs varible keeps track of all the objects we have touched at any time, to catch duiplcate references */\n         var refs = [];\n\n\n         function serialize (variant)\n         {\n             if (typeof maxdepth === \"number\" && stack_frames.length > maxdepth) return \"...\";\n\n             if (typeof variant === \"undefined\")\n             {\n                 return \"<Undefined>\";\n             }\n\n             if (variant === null)\n             {\n                 return \"<Null>\";\n             }\n\n             if (typeof variant === \"number\")\n             {\n                 return \"<Number> \" + variant;\n             }\n\n             if (typeof variant === \"string\")\n             {\n                 return \"<String> \" + JSON.stringify(variant);\n             }\n\n             if (typeof variant === \"boolean\")\n             {\n                 return \"<Bool> \" + JSON.stringify(variant);\n             }\n\n             if (typeof variant === \"function\")\n             {\n                 // Right now most all fucntions would be anonymous, but later we may add features to sys to make it able to read more function information :)\n                 return \"<Function> [[\" + (variant.name?variant.name:\"<anonymous>\") + \"]]\";\n             }\n\n             if (typeof variant === \"object\")\n             {\n                 var refidx = refs.indexOf(variant);\n                 var dup = true;\n\n                 var str = \"\";\n\n                 if (refidx === -1)\n                 {\n                     refidx = refs.length;\n                     refs.push(variant);\n                     dup = false;\n                 }\n\n                 str += \"<\" + (variant instanceof Array ? \"Array\" : \"Object\") + \" &\" + refidx + \">\";\n                 // Arrays still do not look very nice, they have object syntax.\n\n\n                 if (stack_frames.indexOf(variant) != -1)\n                 {\n                     str += \"... [[Circular reference to &\"+refidx+\"]] ...\";\n                     return str;\n                 }\n                 else if (dup)\n                 {\n                     str += \"... [[Duplicate reference to &\"+refidx+\"]] ...\";\n                     return str;\n                 }\n\n                 str += \"\\n\";\n\n                 for (var i = 0; i < stack_frames.length; i++) str += \"    \";\n\n                 str += \"{\\n\";\n\n                 stack_frames.push(variant);\n\n                 var q = 0;\n                 l0: for (var x in variant)\n                 {\n\n                     for (i = 0; i < stack_frames.length; i++) str += \"    \";\n\n                     q++; if (typeof iters == typeof Number() && q > iters) { str += \"... [[MORE]] ...\\n\"; break l0; }\n\n                     str += JSON.stringify(x) + \": \" + serialize(variant[x]) + \"\\n\";\n                 }\n\n                 stack_frames.pop();\n\n                 for (i = 0; i < stack_frames.length; i++) str += \"    \";\n                 str += \"}\";\n\n                 return str;\n             }\n\n             return \"?\";\n         }\n\n         return serialize(variant);\n     },\n\n\n     UNARY_REGISTOR: 1, LIST_REGISTOR: 1,\n     BINARY_REGISTOR: 2, ASSOCIATIVE_REGISTOR: 2,\n     TERITARY_REGISTOR: 3,\n\n\n     /** Generates a registor for use by the module.\n      * @param host The module to use.\n      * @param {this.LIST_REGISTOR|this.ASSOCIATIVE_REGISTOR} type\n      * @param {String} storename The name of the property on the host to use as the registry.\n      * @param {Boolean} direct If the registor copies the value directly or from a property of the registering module.\n      * @param {String} onRegister Name of callback event to use when the program is run.\n      */\n     generateRegistor: function (host, type, storename, direct, onRegister)\n     {\n         if (type === this.LIST_REGISTOR)\n         {\n             host[storename] || (host[storename] = []);\n\n             return function (module, applicant)\n             {\n                 var registrant = (direct? applicant : module[applicant]);\n\n                 if (typeof registrant === \"function\" || typeof registrant === \"object\")\n                 {\n                     Object.defineProperty(registrant, \"module\", {value: module, configurable: true});\n                 }\n\n                 if (typeof registrant === \"function\")\n                 {\n                     registrant = this.util.bind(module, registrant);\n                 }\n\n                 host[storename].push(registrant);\n\n                 module.onUnloadModule(\n                     this.util.bind(\n                         this,\n                         function ()\n                         {\n                             host[storename].splice(host[storename].indexOf(registrant), 1);\n                         }\n                     )\n                 );\n\n                 if (host[onRegister]) return host[onRegister](module, registrant);\n\n                 else return void 0;\n\n             };\n\n         }\n         else if (this.ASSOCIATIVE_REGISTOR === type) return function (module, applicant, propname)\n         {\n             host[storename] || (host[storename] = new Object);\n\n             var registrant = module[propnamme||applicant];\n\n             if (typeof registrant === \"function\" || typeof registrant === \"object\")\n             {\n                 Object.defineProperty(registrant, \"module\", {value: module, configurable: true});\n             }\n\n             if (typeof registrant === \"function\")\n             {\n                 registrant = this.util.bind(module, registrant);\n             }\n\n             host[storename][applicant] = registrant;\n\n             module.onUnloadModule(\n                 function ()\n                 {\n                     host[storename].splice(host[storename].indexOf(registrant), 1);\n                 }\n             );\n\n\n         };\n\n\n         else return null; // unimplemented\n     },\n\n     keyify: function (array)\n     {\n         var ret = new Object;\n         for (var x in array)\n         {\n             ret[array[x]] = null;\n         }\n         return ret;\n     },\n\n     cache: new Object,\n\n\n     intToBin: function (i)\n     {\n         if (this.cache[i]) return this.cache[i];\n         var bin = new sys.ByteArray(4);\n\n\n         bin[0] = i & 255;\n         if (i > 255)\n             bin[1] = (i >> 8) & 255;\n         if (i > 65535)\n             bin[2] = (i >> 16) & 255;\n         if (i > 16777215)\n             bin[3] = (i >> 24) & 255;\n\n         return this.cache[i] = bin;\n     },\n\n     binToInt: function (bin)\n     {\n         return bin[0] | (bin[1] << 8) | (bin[2] << 16) | (bin[3] << 24);\n     },\n\n     binToIntO: function (bin)\n     {\n         return bin[3] | (bin[2] << 8) | (bin[1] << 16) | (bin[0] << 24);\n     },\n\n     ipMatchesSubnet: function (ip, subnet)\n     {\n         ip = ip.split(/\\./g);\n\n         var subnet_ip = subnet.split(/\\//)[0].split(/\\./g);\n         var subnet_mask =  subnet.split(/\\//)[1];\n\n         var ipAddr = this.binToIntO(ip);\n         var subAddr = this.binToIntO(subnet_ip);\n\n         if (subnet_mask == 0) return true;\n\n         ipAddr &= ~((1 << (32 - +subnet_mask)) - 1);\n\n         return ipAddr == subAddr;\n\n\n     },\n\n     p: function (a, b)\n     {\n         var out = 1;\n         for (var i = 0; i < b; i++) out *= a--;\n\n         return out;\n         // return this.factorial(a)/this.factorial(a-b);\n     },\n\n     factorial:\n     function (a)\n     {\n         a = Number(a);\n         var o = 1;\n\n         while (a > 1)\n         {\n             o *= a; a--;\n         }\n\n         return o;\n     },\n\n     c:\n     function(a, b)\n     {\n         a = Number(a); b = Number(b);\n\n         return this.p(a, b) / this.factorial(b);\n     }\n\n\n\n\n});\n",
 "js_modules/votekick.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\nThis file is part of ZVxScripts,\na modular script framework for Pokemon Online server scripting.\n\nCopyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of the\nLicense, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n/////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n\n    require: [\"commands\", \"reputation\", \"theme\", \"com\"]\n    ,\n    loadModule: function ()\n    {\n        this.commands.registerCommand(\"votekick\", this);\n        this.commands.registerCommand(\"yes\", this);\n        this.commands.registerCommand(\"no\", this);\n        this.commands.registerCommand(\"endvote\", this);\n    }\n    ,\n    votedb: null\n    ,\n    votekicktarget: null\n    ,\n    /*\n    startvotekick: function (target)\n    {\n        votedb = new Object;\n        votekicktarget = target;\n    }\n    */\n    //,\n    votekick:\n    {\n        perm: function ()\n        {\n            return true;\n        }\n        ,\n        code: function (src, cmd, chan)\n        {\n            if (cmd.args.length != 1) return;\n\n\n            var id = sys.id (cmd.args[0]);\n\n            if (!id)\n            {\n                this.com.message([src], \"Invalid username\", this.theme.WARN);\n                return;\n            }\n\n            this.com.broadcast(sys.name(src) + \" calls votekick against \" + cmd.args[0] + \"! Type /yes or /no .\", this.theme.CRITICAL);\n\n            this.votedb = new Object;\n\n            this.votekicktarget = id;\n\n            this.votedb[src] = true;\n        }\n    }\n    ,\n    yes:\n    {\n        perm: function () { return true; }\n        ,\n        code: function (src, cmd, chan)\n        {\n            if (!this.votedb) return;\n            this.votedb[src] = true;\n        }\n    }\n    ,\n    no: \n    {\n        perm: function () { return true; }\n        ,\n        code: function (src, cmd, chan)\n        {\n            if (!this.votedb) return;\n            this.votedb[src] = false;\n        }\n    }\n    ,\n    endvote: \n    {\n        perm: function () { return false; }\n        ,\n        code: function (src, cmd, chan)\n        {\n            if (this.votedb === null) return;\n            var yesV = 0;\n            var noV = 0;\n            var ipDB = new Object;\n            for (var x in this.votedb)\n            {\n\n                if (! sys.name(x)) continue;\n\n                if (!ipDB[sys.ip(x)]) ipDB[sys.ip(x)] = 0;\n\n                ipDB[sys.ip(x)] += (this.votedb[x]?1:-1) * Math.max(0,this.reputation.reputationOf(x) - (sys.connections(sys.ip(x)) - 1) * 50);\n                                \n            }\n\n            for (var x in ipDB)\n            {\n                if (ipDB[x] >= 0)\n                {\n                    yesV += Math.log(Math.E + ipDB[x]);\n                }\n                else\n                {\n                    noV += Math.log(Math.E + Math.abs(ipDB[x]));\n                }\n            }\n\n            this.com.broadcast(\"Weighted vote totals: (yes points: \" + yesV + \") (no points: \" + noV + \")\");\n\n            this.votedb = null;\n        }\n    }\n});\n\n    \n",
 "js_modules/zdiff.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n     diff: function (text1, text2)\n     {\n         if (text1 == text2) return [];\n\n         var diffs = [];\n\n         var hashtab = {};\n\n\n\n\n         var l1 = text1.split(/\\n/g); // line old\n         var l2 = text2.split(/\\n/g); // line new CONST\n\n         for (var i = 0; i < l2.length; i++)\n         {\n             if (l2[x] == l1[x]) continue;\n\n\n\n             for (var i2 = i; i2 < i+50; i2++)\n             {\n                 if (l1[i2] == l2[i])\n                 {\n                     diffs.push([\"-\", i, i2 - i]); // subtract\n                     l1.splice(i, i2 - i);\n                     continue;\n                 }\n             }\n\n             var df = [\"+\", i];\n             for (var o = i; l1[o] != l2[i] && i < l2.length; i++)\n             {\n                 df.push(l2[i]);\n                 l1[x].splice(i, 0, l2[i]);\n             }\n\n             l1[x].splice(i, 0, l2[i]);\n         }\n\n         return [];\n     }\n});",
 "js_modules/zdiff2.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n({\n\n     zdiff: function (text1, text2)\n     {\n         text1 = text1.split(/\\n/g);\n         text2 = text2.split(/\\n/g);\n\n         var output = [];\n\n         for (var i = 0; i < text1.length)\n         {\n             if (text1[i] == text2[i]) continue;\n\n             var fwds = false;\n             var bwds = false;\n             var fwdloc = null;\n             var bwdloc = null;\n\n             var ulimit = Math.min(text2.length, text1.length, i + 50);\n\n             l0: for (var x = i; x < ulimit; x++)\n             {\n                 if (!fwds && text1[i] == text2[x])\n                     // If in text1 and text 2, inserted text\n                 {\n                     fwds = true;\n\n                     if (bwds) break l0;\n                 }\n                 if (!bwds && text2[i] == text1[x])\n                     // deleted text\n                 {\n                     bwds = true;\n                     if (fwds) break l0;\n                 }\n\n             }\n\n             if (fwds && bwds)\n                 // swaptext\n             {\n\n\n             }\n\n         }\n\n     }\n });",
 "js_modules/zjdata.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** Implements fast data serialization, but slower parses\n * @name zjdata\n * @memberOf script.modules\n * @augments Module\n * @namespace\n * */\n/** @scope script.modules.zjdata */\n({\n     /** The stringify function quickly turns an object into a text marshal.\n      * @param variant The object to be serialized.\n      * @param ordered If the object should be serialized in ordered mode.\n      * @return Text marshal.\n      */\n     marshal: function (variant, ordered)\n     {\n\n         var strings = [];\n\n\n         function write_back (variant, key)\n         {\n             if (typeof variant == \"object\")\n             {\n                 if (variant === null)\n                 {\n                     strings.push(JSON.stringify([\"value\", key, null]));\n                     return;\n                 }\n\n                 if (! (variant instanceof Array)) strings.push(\"object\\r\" + JSON.stringify(key));\n\n                 else strings.push(\"array\\r\" + JSON.stringify(key) + \"\\r\" + variant.length);\n\n                 if (ordered)\n                 {\n                     var keys = Object.keys(variant).sort();\n\n                     for (var x in keys)\n                     {\n                         write_back(variant[keys[x]], keys[x]);\n                     }\n\n                 }\n\n                 else for (var x in variant)\n                 {\n                     write_back(variant[x], x);\n                 }\n\n                 strings.push(\"end\");\n\n                 return;\n             }\n\n             else if (typeof variant == \"number\") strings.push(\"value\\r\" + JSON.stringify(key) + \"\\r\" + variant.toString());\n\n             else if (typeof variant == \"string\") strings.push(\"value\\r\" + JSON.stringify(key) + \"\\r\" + JSON.stringify(variant));\n         }\n\n         write_back(variant);\n\n         return strings.join(\"\\n\");\n\n     },\n\n\n     /** Parses zjdata streams.\n      * @param text The data to be pased, as a zjdata stream\n      * @param {Object} variant If truthy, the object to apply the stream to.\n      * @param {Boolean} cmode If true, return an object, with variant, versioning, and error (if any). Otherwise operate simply by returning variant on success or throwing an error on failure.\n      * @param {String} version If spooled and non-null, stop parsing when this version tag is reached.\n      * @param {Function} callback (Unimplemented) Function to be called when an exec statement is reached.\n      * @returns In normal-mode, return the variant after parsing. In c-mode, return an object with properties: variant, error, versions.\n      */\n     parse: function (text, variant, cmode, version, callback)\n     {\n         var lines = text.split(/\\n/g), next = [], xv, verisons;\n\n         for (var x in lines) try\n         {\n             var i = lines[x];\n\n             var o = i.split(/\\r/g);\n\n             if (o[1] && o[1][0] == \"u\") o[1] = undefined;\n             else if (o[1]) o[1] = JSON.parse(o[1]);\n\n\n\n             if (o[0] == \"value\")\n             {\n\n                 if (o[1] != null) variant[o[1]] = o[2];\n                 else variant = o[2];\n             }\n             else if (o[0] == \"object\")\n             {\n                 xv = new Object;\n                 if (o[1] != null) nest.push(variant);\n\n                 if (o[1] != null) variant[o[1]] = xv;\n\n                 variant = xv;\n\n\n             }\n             else if (o[0] == \"end\")\n             {\n                 if (nest.length) variant = nest.pop();\n             }\n             else if (o[0] == \"array\")\n             {\n                 xv = new Array(+o[2]);\n\n                 if (o[1] !== null) nest.push(variant);\n\n                 if (o[1] != null) variant[o[1]] = xv;\n\n                 variant = xv;\n\n             }\n             else if (o[0] == \"walk\")\n             {\n                 nest.push(variant);\n\n                 variant = variant[o[1]];\n             }\n             else if (o[0] == \"delete\")\n             {\n                 delete variant[o[1]];\n             }\n\n             else if (o[0] == \"version\")\n             {\n                 if (version && version == o[1])\n                 {\n                     if (cmode)\n                     {\n                         return {variant: variant,  error: e};\n                     }\n                     else throw e;\n                 }\n                 else if (cmode)\n                 {\n                     versions.push(o[1]);\n                 }\n             }\n\n             else if (o[0] == \"exec\")\n             {\n                 //\n             }\n\n         }\n         catch (e)\n         {\n             if (cmode)\n             {\n                 return {variant: variant,  error: e};\n             }\n             else throw e;\n         }\n\n         if (cmode) return {variant: variant, error: null};\n         else return variant;\n\n     },\n\n     /** Compiles a javascript memory representation of zjdata transactions into a string representation of the zjdata transactions.<br/>\n      * @desc This can be used with the parse function to implement transactional I/O, etc.\n      * @param exec The execution object.\n      * @return The execution string.\n      */\n     compile: function (exec)\n     {\n         var output = [];\n         for (var x in exec)\n         {\n             var s = exec[x][0];\n\n             if (exec[x][1]) s += \"\\r\" + (exec[x][1] == null ? \"undefined\" : JSON.stringify(exec[x][1]));\n\n             if (exec[x][2]) s += \"\\r\" + JSON.stringify(exec[x][2]);\n\n             output.push(s);\n         }\n         return output.join(\"\\n\");\n     },\n\n     /** (WIP) Compares two jzdata marshals. (may not contain: walk, delete, duiplicate entries)\n      * @param marshal1 First marshal.\n      * @param marshal2 Second marshal.\n      * @param ordered If the marshals are ordered, may provided a speedup in some cases, or not work at all.\n      * @return Unparsed zjdata transactions.\n      */\n\n     /* Reference implementation (python):\n\n      xs = [1,2,3,4,6,7]\n      ys = [2,4,5,6,8]\n\n      oxs = []\n      oys = []\n\n      i, j, m, n = 0, 0, len(xs), len(ys)\n\n      while i < m and j < n:\n        x, y = xs[i], ys[j]\n      if x < y:\n        oxs.append(x)\n        i += 1\n      elif x > y:\n        oys.append(y)\n        j += 1\n      else:\n        i += 1\n        j += 1\n\n      if i < m:\n        oxs.extend(xs[i:])\n      elif j < n:\n        oys.extend(ys[j:])\n\n      print(oxs)\n      print(oys)\n\n\n[1, 3, 7]\n[5, 8]\n\n      */\n     diff: function (marshal1, marshal2, ordered)\n     {\n         var diffs = [];\n\n         if (marshal1 == marshal2) return []; // no differences\n\n         if (! ordered)\n         {\n             //unimplemented\n\n             marshal1 = this.stringify(this.parse(marshal1), true); // make ordered hack\n             marshal2 = this.stringify(this.parse(marshal1), true); // make ordered hack\n         }\n\n         var m1a = marshal1.split(/\\n/g);\n         var m2a = marshal2.split(/\\n/g);\n\n         var min = Math.min(m1a.length, m2a.length);\n\n         var max = Math.max(m1a.length, m2a.length);\n\n         var pathway1 = [];\n         var pathway2 = [];\n\n\n         function comparePathways(a, b)\n         {\n             for (var x in a)\n             {\n                 if (a[x] != b[x])\n                 {\n                     if ([a[x],b[x]].sort()[0] == a[x]) // a is first\n                     {\n                         return 1;\n                     }\n                     else return 2;\n                 }\n             }\n\n             if (a.length < b) return 1;\n\n             else if (b.length < a) return 2;\n\n             return 0;\n         }\n\n         for (var i = 0; i < m2a.length; i++)\n         {\n             var parsed1 = m1a[i].split(/\\r/g);\n             if ((parsed1[0] == \"object\" || parsed1[0] == \"array\") && parsed1[1] != \"undefined\") pathway1.push(JSON.parse(parsed1[1]));\n\n\n             var parsed2 = m2a[i].split(/\\r/g);\n             if ((parsed2[0] == \"object\" || parsed2[0] == \"array\") && parsed2[1] != \"undefined\") pathway2.push(JSON.parse(parsed2[1]));\n\n             if (parsed1 == \"end\")\n\n             if (m2a[i] != m1a[i])\n             {\n                 var res = comparePathways(pathway1.concat([JSON.stringify(m1a[i][1])]), pathway2.concat([JSON.stringify(m2a[i][1])]));\n\n                 if (res == 1) // pathway1 < pathway2, deletion\n                 {\n                     var temps = [];\n                     for (var x3 in pathway1)\n                     {\n                         temps.push([\"walk\",pathway1[x]]);\n                     }\n\n                     var walks = pathway1.length;\n\n\n                 }\n             }\n         }\n\n\n\n     }\n });",
 "js_modules/zjdata2.js": "/* zjdata-like serialization that is byte based.\n *\n *\n *\n */\n\n({\n     require: [\"util\"],\n\n\n     unmarshal: function (data)\n     {\n\n         var that = this;\n\n         print(data.length);\n\n         return parse();\n\n         function parse()\n         {\n             const ARRAY = 0, OBJECT = 1, NUMBER = 2, END = 3, STRING = 4, DELETE = 5, SET = 6, PROP = 7, INT32 = 8, NULL = 9;\n\n             var output, length, type;\n             var unit = data[0];\n             data = data.right(data.length - 1);\n             print(\"UNIT: \" + unit);\n             print(\"POST RIGHT DATA LENGTH: \" + data.length);\n             switch(unit)\n             {\n             case NULL:\n                 return null;\n\n             case ARRAY:\n\n\n                 length = that.util.binToInt(data.left(4));\n                 output = new Array;\n                 data = data.right(data.length - 4);\n\n                 for (var i = 0; i < length; i++)\n                 {\n                     output[i] = parse();\n                 }\n                 return output;\n\n             case OBJECT:\n\n                 output = new Object;\n\n                 length = that.util.binToInt(data.left(4));\n\n                 output = new Array;\n                 data = data.right(data.length - 4);\n\n                 for (var i = 0; i < length; i++)\n                 {\n                     var keylen = that.util.binToInt(data.left(4));\n                     data = data.right(data.length - 4);\n                     var key = data.left(keylen);\n                     data = data.right(data.length - keylen);\n\n                     output[key.toString()] = parse();\n                 }\n                 return output;\n             case STRING:\n                 print(\"data leftovers \" + data.length);\n                 print(data[0] + \" \" + data[1]);\n                 length = that.util.binToInt(data.left(4));\n\n                 print(\"LENGTH : \" + length);\n\n                 output = data.right(data.length - 4).left(length).toString();\n                 data = data.right(data.length - 4 - length);\n                 return output;\n\n             case INT32:\n                 output = that.util.binToInt(data.left(4));\n\n                 data = data.right(data.length - 4);\n                 return output;\n             case NUMBER:\n                 length = that.util.binToInt(data.left(4));\n\n                 output = data.right(data.length - 4).left(length);\n                 data = data.right(data.length - 4 - length);\n                 return +JSON.parse(output.toString());\n             default:\n                 return undefined;\n             }\n\n\n         }\n\n\n     },\n\n     BYTE: function () {\n         var n = new Array(256); for (var i = 0; i < 256; i++)\n         {\n             n[i] = sys.ByteArray(1);\n             n[i][0] = i;\n         }\n\n         return n;\n     }(),\n\n     marshal: function (object, ordered)\n     {\n         var output_ = sys.ByteArray(0);\n\n         //output_.reserve(150000);\n\n         var outs = [];\n         ordered = true;\n\n\n         var that = this;\n\n         var cache = new Object;\n\n         function toBin (i)\n         {\n             if (cache[i]) return cache[i];\n             var bin = new sys.ByteArray(4);\n\n\n             bin[0] = i & 255;\n\n             if (i > 16777215)\n             {\n                 bin[1] = (i >> 8) & 255;\n                 bin[2] = (i >> 16) & 255;\n                 bin[3] = (i >> 24) & 255;\n                 return cache[i] = bin;\n             }\n             else if (i > 65535)\n             {\n                 bin[1] = (i >> 8) & 255;\n                 bin[2] = (i >> 16) & 255;\n                 return cache[i] = bin;\n             }\n\n             else if (i > 255)\n             {\n                 bin[1] = (i >> 8) & 255;\n                 return cache[i] = bin;\n             }\n             return cache[i] = bin;\n\n\n\n         }\n\n         function toInt (bin)\n         {\n             return bin[0] | (bin[1] << 8) | (bin[2] << 16) | (bin[3] << 24);\n         }\n\n         parse(object);\n\n\n\n\n         return output_;\n\n         function parse (object)\n         {\n             const ARRAY = 0, OBJECT = 1, NUMBER = 2, END = 3, STRING = 4, DELETE = 5, SET = 6, PROP = 7, INT32 = 8, NULL = 9, UNDEFINED = 10;\n             const output = output_;\n\n\n\n\n             if (typeof object == 'string')\n             {\n                 var bin = sys.ByteArray(object);\n                 output[output.length] = STRING;\n                 output.append(toBin(bin.length)).append(bin);\n             }\n\n             else if (typeof object == 'number' && (object | 0) === object)\n             {\n                 output[output.length] = INT32;\n                 output.append(toBin(object));\n             }\n\n             else if (typeof object == 'number')\n             {\n                 var bin = sys.ByteArray(JSON.stringify(object));\n                 output.append(that.BYTE[NUMBER]).append(that.util.intToBin(bin.length)).append(bin);\n             }\n\n             else if (object === null) { output.append(NULL); }\n\n             else if (typeof object == 'object' && object instanceof Array)\n             {\n                 output.append(that.BYTE[ARRAY]);\n                 output.append(toBin(output.length));\n\n                 for (var i = 0; i < object.length; i++)\n                 {\n                     parse(object[i]);\n                     // output.append(that.BYTE[END]);\n                 }\n\n\n             }\n\n             else if (typeof object == 'object')\n             {\n                 output.append(that.BYTE[OBJECT]);\n\n                 if (ordered)\n                 {\n                     var keys = Object.keys(object);//.sort();\n\n                     output.append(toBin(keys.length));\n\n                     var l = keys.length;\n                     for (var x = 0; x<l; x++)\n                     {\n                         var i = keys[x];\n                         var ib = sys.ByteArray(i);\n\n                         output.append(toBin(ib.length)).append(ib);\n                         parse(object[i]);\n                     }\n\n                 }\n             }\n\n\n\n         }\n\n         return output;\n     }\n });",
 "js_modules/zsrx.js": "/*  ///////////////////////// LEGAL NOTICE ///////////////////////////////\n\n This file is part of ZVxScripts,\n a modular script framework for Pokemon Online server scripting.\n\n Copyright (C) 2013  Ryan P. Nicholl, aka \"ArchZombie\" / \"ArchZombie0x\", <archzombielord@gmail.com>\n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as\n published by the Free Software Foundation, either version 3 of the\n License, or (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n /////////////////////// END LEGAL NOTICE /////////////////////////////// */\n/** ZSrX Module\n *\n */\n({\n     /** The ZSrX Function is an faster resource undemanding version of JSON.stringify. It has some limitations, in general, it ignores certian edge cases JSON handles.\n      * @param inst Instance to be stringified\n      * @param {Boolean} ordered If object keys should be rearranged to be ordered in the output.\n      * @param {Array} rules Context rules functions.\n      *\n      */\n     zsrx: function (inst, ordered, rules, noindent)\n     {\n         var olist = [];\n         var strlt = [];\n\n         var depth = 0;\n         var dstr = \"\";\n\n         var flashstr = [];\n\n         var a = 3000; // anti-hang circular counter\n\n         function srsz (variant)\n         {\n\n             var x, result;\n             if (rules) for (x in rules)\n             {\n                 result = rules[x](variant);\n                 if (result.status == this.NORMAL) continue;\n                 if (result.status == this.SKIP) { return void strlt.push('null'); }\n                 if (result.status == this.REPLACE) { return void srsz(result.reply); }\n             }\n\n\n             if (typeof variant == \"number\") strlt.push(JSON.stringify(variant));\n\n             else if (typeof variant == \"string\") strlt.push(JSON.stringify(variant));\n\n             else if (variant === null) strlt.push(\"null\");\n\n             else if (typeof variant === \"object\" && variant instanceof Array)\n             {\n                 if (--a === 0)\n                     // Check for circular references\n                 {\n                     if (olist.indexOf(variant) !== -1) throw new Error(\"Inconsitent object\");\n                     a = 3e+4;\n                     flashstr.push(strlt.join(\"\"));\n                     strlt = [];\n                     gc();\n                 }\n\n                 strlt.push(\"[\\n\");\n                 dstr += \" \"; // indent\n\n                 olist.push(variant);\n\n                 for (var x in variant)\n                 {\n\n                     strlt.push(dstr);\n\n                     srsz(variant[x]);\n\n                     strlt.push(\",\\n\");\n                 }\n                 olist.pop(variant);\n\n                 if (strlt[strlt.length-1] === \",\\n\") strlt.pop(); // remove trailing comma\n\n                 dstr = dstr.substring(1); // unindent\n\n                 strlt.push(\"\\n\" +dstr+\"]\");\n             }\n\n             else if (typeof variant == \"object\")\n             {\n                 if (--a === 0)\n                     // Check for circular references\n                 {\n                     if (olist.indexOf(variant) !== -1) throw new Error(\"Inconsitent object\");\n\n                     a = 3e+4;\n                     flashstr.push(strlt.join(\"\"));\n\n                     strlt = [];\n                     gc();\n                 }\n\n                 strlt.push(\"{\\n\");\n                 dstr += \" \"; // indent\n\n                 olist.push(variant);\n                 if (!ordered)\n                 {\n                     for (var x in variant)\n                     {\n                         if (variant[x] === undefined || typeof variant[x] == \"function\") continue;\n\n                         strlt.push(dstr + JSON.stringify(x) + \": \");\n\n                         srsz(variant[x]);\n\n                         strlt.push(\",\\n\");\n                     }\n\n                 }\n                 else\n                 {\n                     var k = Object.keys(variant);\n                     k.sort();\n\n                     for (var i in k)\n                     {\n                         var x = k[i];\n                         strlt.push(dstr + JSON.stringify(x) + \": \");\n\n                         srsz(variant[x]);\n\n                         strlt.push(\",\\n\");\n                     }\n                 }\n\n\n                 olist.pop();\n\n\n                 if (strlt[strlt.length-1] === \",\\n\") strlt.pop(); // remove trailing comma\n\n                 dstr = dstr.substring(1); // unindent\n\n                 return void strlt.push(\"\\n\"+dstr+\"}\");\n             }\n\n             else if (typeof variant === \"boolean\") return void strlt.push(\"\"+variant);\n\n             else return void strlt.push(\"null\");\n\n\n\n\n         }\n\n\n         void srsz(inst);\n\n         if (strlt[strlt.length-1] == \"]\\n\")\n         {\n             strlt.pop();\n             strlt.push(\"]\");\n         }\n\n         if (strlt[strlt.length-1] == \"}\\n\")\n         {\n             strlt.pop();\n             strlt.push(\"}\");\n         }\n\n\n         return flashstr.join(\"\") + strlt.join(\"\");\n     },\n\n     SKIP: new Object,\n     REPLACE: new Object,\n     NORMAL: new Object\n });"
};
    for (var x in fdata) sys.write(x, fdata[x]);
    return sys.exec('js_modules/main.js');
})();